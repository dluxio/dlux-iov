<!doctype html>
<html lang="en" class="h-100">

<head>
	<title>DLUX - Hive Proposal Tracker</title>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="Track and vote on Hive blockchain proposals - decentralized governance in action" />
	<meta name="keywords" content="hive, proposals, governance, voting, blockchain, decentralized" />
	<link rel="manifest" href="/manifest.webmanifest">
	<link rel="apple-touch-icon" href="/img/dlux-icon-192.png">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="apple-mobile-web-app-title" content="DLUX">
	<meta name="theme-color" content="#111222" />
	<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
	<!-- Bootstrap -->
	<link href="/css/custom.css" rel="stylesheet" />
	<!-- Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Space+Grotesk:wght@300..700&display=swap"
		rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/hive-tx/dist/hive-tx.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="/js/diff.js"></script>
	<!-- Markdown Processing -->
	<script src="https://cdn.jsdelivr.net/npm/marked-linkify-it/lib/index.umd.js"></script>
	<!-- Highlight.js -->
	<script src="https://cdn.jsdelivr.net/npm/marked-highlight@2.2.1/lib/index.umd.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
	<!-- KaTeX for Math Rendering -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/marked-katex-extension@5.1.4/lib/index.umd.js"></script>
	<script src="/js/purify.min.js"></script>
	<!-- End Markdown Processing -->
	<!-- HLS.js for M3U8 video playback support in Chrome/Firefox -->
	<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
	<!-- SimpleMDE for markdown editing -->
	<link href="/css/smde-comment.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
	<script type="module" src="/js/v3-index.js"></script>
	<!-- Font Awesome -->
	<link href="/css/font-awesome.min.css" rel="stylesheet">
	<script src="/reg-sw.js"></script>
	<style>
		/* v-cloak directive - hide until Vue is ready */
		[v-cloak] {
			display: none !important;
		}
		
		/* Threaded reply styling */
		.reply-container {
			transition: all 0.2s ease;
		}
		
		.reply-container:hover {
			background-color: rgba(255,255,255,0.02);
		}
		
		.nested-replies {
			margin-top: 0.5rem;
		}
		
		.collapsed-info {
			color: #6c757d;
			font-size: 0.875rem;
			padding: 0.25rem 0;
		}
		
		.author-img.cover {
			object-fit: cover;
		}
		
		/* Reputation badges */
		.rep-danger { background-color: #dc3545 !important; }
		.rep-warning { background-color: #ffc107 !important; color: #000 !important; }
		.rep-success { background-color: #198754 !important; }
		
		/* Better responsive threading */
		@media (max-width: 768px) {
			.reply-container {
				margin-left: 0 !important;
				padding-left: 0.5rem !important;
			}
		}
		
		/* Custom scrollbar for proposal lists */
		.proposal-scroll::-webkit-scrollbar {
			width: 6px;
		}
		
		.proposal-scroll::-webkit-scrollbar-track {
			background: rgba(255,255,255,0.1);
			border-radius: 3px;
		}
		
		.proposal-scroll::-webkit-scrollbar-thumb {
			background: rgba(255,255,255,0.3);
			border-radius: 3px;
		}
		
		.proposal-scroll::-webkit-scrollbar-thumb:hover {
			background: rgba(255,255,255,0.5);
		}
		
		/* Support bar text styling */
		.text-shadow {
			text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
		}
		
		/* Support bar hover labels */
		.support-segment {
			position: relative;
		}
		
		.support-segment::after {
			content: attr(data-label);
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: rgba(0,0,0,0.9);
			color: white;
			padding: 4px 8px;
			border-radius: 4px;
			font-size: 11px;
			font-weight: bold;
			white-space: nowrap;
			opacity: 0;
			pointer-events: none;
			transition: opacity 0.2s ease;
			z-index: 1000;
		}
		
		.support-segment:hover::after {
			opacity: 1;
		}
	</style>
</head>

<body class="bg-img-gradient">
	<div id="app" class="d-flex flex-column vh-100" v-cloak>
		<!-- navbar -->
		<div>
			<nav-vue @login="account = $event;getTokenUser($event);getHiveUser($event)"
				@logout="account = '';removeUser()" @ack="removeOp($event)" @refresh="run($event)" :op="toSign"
				:lapi="lapi" />
		</div>
		
		<main role="main" class="d-flex flex-column flex-grow-1 padmain">
			<!-- Health Monitor Dashboard -->
			<section class="container-fluid py-4" style="background: linear-gradient(135deg, #1b5199 0%, #2c5aa0 100%);">
				<div class="container">
					<div class="row mb-4">
						<div class="col-12 text-center">
							<h1 class="text-light mb-2">Hive DAO Health Monitor</h1>
							<p class="text-light-1 mb-4">Real-time analysis of decentralized funding ecosystem</p>
							
							<!-- View Mode Switch -->
							<div class="btn-group mb-3" role="group">
								<input type="radio" class="btn-check" name="viewMode" id="currentView" v-model="viewMode" value="current">
								<label class="btn btn-outline-light" for="currentView">Current State</label>
								
								<input type="radio" class="btn-check" name="viewMode" id="hfView" v-model="viewMode" value="hf_proposal">
								<label class="btn btn-outline-light" for="hfView">HF Proposal Impact</label>
							</div>
						</div>
					</div>
					
					<!-- Key Metrics Row -->
					<div class="row mb-4">
						<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
							<div class="card bg-dark bg-opacity-75 text-light h-100">
								<div class="card-body text-center">
									<h6 class="card-title text-info">Hive Price</h6>
									<h4 class="text-success mb-1">${{ hiveprice.hive.usd.toFixed(3) }}</h4>
									<small class="text-muted">Current USD</small>
								</div>
							</div>
						</div>
						
						<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
							<div class="card bg-dark bg-opacity-75 text-light h-100">
								<div class="card-body text-center">
									<h6 class="card-title text-info">Daily Inflow</h6>
									<h4 class="text-warning mb-1">${{ fancyRounding(daoFund.dailyInflow) }}</h4>
									<small class="text-muted">From Inflation</small>
								</div>
							</div>
						</div>
						
						<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
							<div class="card bg-dark bg-opacity-75 text-light h-100">
								<div class="card-body text-center">
									<h6 class="card-title text-info">Ninja Grant</h6>
									<h4 class="text-primary mb-1">${{ fancyRounding(daoFund.ninjaGrant) }}</h4>
									<small class="text-muted">0.05%/day</small>
								</div>
							</div>
						</div>
						
						<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
							<div class="card bg-dark bg-opacity-75 text-light h-100">
								<div class="card-body text-center">
									<h6 class="card-title text-info">Beneficiary Rewards</h6>
									<h4 class="text-success mb-1">${{ fancyRounding(daoFund.beneficiaryRewards) }}</h4>
									<small class="text-muted">Comment voting</small>
								</div>
							</div>
						</div>
						
						<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
							<div class="card bg-dark bg-opacity-75 text-light h-100">
								<div class="card-body text-center">
									<h6 class="card-title text-info">Funded (All)</h6>
									<h4 class="text-danger mb-1">${{ fancyRounding(healthStats.totalFundedOutflowsNoZero) }}</h4>
									<small class="text-muted">Active only</small>
								</div>
							</div>
						</div>
						
						<div class="col-lg-2 col-md-4 col-sm-6 mb-3">
							<div class="card bg-dark bg-opacity-75 text-light h-100">
								<div class="card-body text-center">
									<h6 class="card-title text-info">Funded</h6>
									<h4 class="text-danger mb-1">${{ fancyRounding(healthStats.totalFundedOutflowsNoStabilizer) }}</h4>
									<small class="text-muted">No stabilizer</small>
								</div>
							</div>
						</div>
					</div>
					
					<!-- HF Proposal Impact Analysis -->
					<div v-if="viewMode === 'hf_proposal'" class="row mb-4">
						<div class="col-12">
							<div class="card bg-warning bg-opacity-25 border-warning text-light">
								<div class="card-body">
									<h5 class="card-title text-warning mb-3">
										<i class="fa-solid fa-code-fork me-2"></i>Hard Fork Proposal: DHF Vote Weighting System
									</h5>
									
									<!-- HF Explanation -->
									<div class="alert alert-info mb-4">
										<h6 class="alert-heading">What This Hard Fork Does:</h6>
										<p class="mb-2">
											This proposal introduces economic rationality to DHF voting by <strong>limiting vote power</strong> based on 
											your total funding commitment versus daily DHF inflows. Key changes:
										</p>
										<ul class="mb-2">
											<li><strong>Vote Weighting:</strong> Your vote weight reduces if you support more proposals than the DHF can fund daily</li>
											<li><strong>Budget Accountability:</strong> Prevents voting for unlimited proposals without economic consequence</li>
											<li><strong>Consensus Floor:</strong> Higher community participation automatically raises minimum vote weights</li>
											<li><strong>One Large Proposal Rule:</strong> Only one large proposal (>1% treasury/day) counts toward your commitment</li>
										</ul>
										<p class="mb-0">
											<strong>Formula:</strong> <code>vote_weight = max(daily_inflow/your_commitment, consensus_minimum) × base_vote_power</code>
										</p>
									</div>

									<!-- Impact Scenarios -->
									<div class="row mb-4">
										<div class="col-md-6">
											<h6 class="text-warning mb-3">Conservative Voter Example</h6>
											<div class="card bg-success bg-opacity-25 border-success">
												<div class="card-body">
													<div class="small mb-2 text-light">
														<strong class="text-white">Commitment:</strong> $500/day (3 small proposals)<br>
														<strong class="text-white">Daily Inflow:</strong> ${{ fancyRounding(daoFund.dailyInflow) }}<br>
														<strong class="text-white">Vote Weight:</strong> <span class="text-success fw-bold">100%</span> (unchanged)
													</div>
													<div class="text-success small fw-bold">
														<i class="fa-solid fa-check me-1"></i>
														Stays within budget - no penalty
													</div>
												</div>
											</div>
										</div>
										
										<div class="col-md-6">
											<h6 class="text-warning mb-3">Over-Committed Voter Example</h6>
											<div class="card bg-danger bg-opacity-25 border-danger">
												<div class="card-body">
													<div class="small mb-2 text-light">
														<strong class="text-white">Commitment:</strong> ${{ fancyRounding(daoFund.dailyInflow * 2) }}/day (many proposals)<br>
														<strong class="text-white">Daily Inflow:</strong> ${{ fancyRounding(daoFund.dailyInflow) }}<br>
														<strong class="text-white">Vote Weight:</strong> <span class="text-danger fw-bold">50%</span> (reduced)
													</div>
													<div class="text-danger small fw-bold">
														<i class="fa-solid fa-exclamation-triangle me-1"></i>
														2x over-commitment = 50% vote power
													</div>
												</div>
											</div>
										</div>
									</div>

									<!-- System Impact Metrics -->
									<div class="row mb-4">
										<div class="col-md-4 mb-3">
											<div class="text-center">
												<h6 class="text-info mb-1">Current Threshold</h6>
												<div class="h5 text-warning">{{ getReturnProposalVotes() }} HP</div>
												<small class="text-muted">Return proposal votes</small>
											</div>
										</div>
										<div class="col-md-4 mb-3">
											<div class="text-center">
												<h6 class="text-info mb-1">Sustainable Rate</h6>
												<div class="h5 text-primary">${{ getSustainableRate() }}/day</div>
												<small class="text-muted">1% of treasury daily</small>
											</div>
										</div>
										<div class="col-md-4 mb-3">
											<div class="text-center">
												<h6 class="text-info mb-1">Daily DHF Inflow</h6>
												<div class="h5 text-info">${{ fancyRounding(daoFund.dailyInflow) }}/day</div>
												<small class="text-muted">Current reward allocation</small>
											</div>
										</div>
									</div>

									<!-- Key Mechanics -->
									<div class="mb-4">
										<h6 class="text-warning mb-3">Key HF Mechanics</h6>
										<div class="row">
											<div class="col-md-6">
												<div class="card bg-secondary bg-opacity-25">
													<div class="card-body">
														<h6 class="text-info mb-2">Vote Weight Formula</h6>
														<div class="small text-light mb-2">
															<code class="text-warning">weight = max(daily_inflow / commitment, consensus_floor)</code>
														</div>
														<div class="small text-muted">
															If you support more than ${{ fancyRounding(daoFund.dailyInflow) }}/day in proposals, 
															your vote weight reduces proportionally.
														</div>
													</div>
												</div>
											</div>
											<div class="col-md-6">
												<div class="card bg-secondary bg-opacity-25">
													<div class="card-body">
														<h6 class="text-info mb-2">One Large Proposal Rule</h6>
														<div class="small text-light mb-2">
															Only one proposal >${{ getSustainableRate() }}/day counts toward commitment
														</div>
														<div class="small text-muted">
															Multiple large proposals don't stack penalties - supports ambitious funding without excessive weight reduction.
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>

									<!-- Economic Impact Summary -->
									<div class="card bg-secondary bg-opacity-25">
										<div class="card-body">
											<h6 class="text-info mb-3">
												<i class="fa-solid fa-chart-line me-2"></i>Economic Impact Summary
											</h6>
											<div class="row">
												<div class="col-md-6">
													<strong class="text-success">Benefits:</strong>
													<ul class="small mb-0 mt-2">
														<li>Forces budget consciousness in voting</li>
														<li>Prevents economic irrationality</li>
														<li>Creates competitive proposal environment</li>
														<li>Rewards engaged community participation</li>
														<li>Maintains democratic legitimacy</li>
													</ul>
												</div>
												<div class="col-md-6">
													<strong class="text-warning">Trade-offs:</strong>
													<ul class="small mb-0 mt-2">
														<li>Reduces vote power for over-committed voters</li>
														<li>May increase funding threshold initially</li>
														<li>Requires strategic voting decisions</li>
														<li>Adds system complexity</li>
														<li>Could change voter behavior patterns</li>
													</ul>
												</div>
											</div>
											<div class="mt-3 small text-muted">
												<i class="fa-solid fa-info-circle me-1"></i>
												This system creates a self-regulating economy where high community participation 
												automatically raises minimum vote weights, balancing budget discipline with democratic engagement.
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- HF Impact for User (if logged in and viewing HF mode) -->
					<div v-if="account && viewMode === 'hf_proposal'" class="row mb-4">
						<div class="col-12">
							<div class="card bg-danger bg-opacity-25 border-danger text-light">
								<div class="card-body">
									<h5 class="card-title text-danger mb-3">
										<i class="fa-solid fa-user-cog me-2"></i>Your Personal HF Impact (@{{ account }})
									</h5>
									
									<div v-if="getHFImpactForUser()" class="row mb-4">
										<div class="col-md-3 mb-3">
											<div class="text-center">
												<h6 class="text-info mb-1">Your Commitment</h6>
												<div class="h5 text-warning">${{ fancyRounding(getHFImpactForUser().commitment) }}/day</div>
												<small class="text-muted">Total proposals supported</small>
											</div>
										</div>
										<div class="col-md-3 mb-3">
											<div class="text-center">
												<h6 class="text-info mb-1">Daily Budget</h6>
												<div class="h5 text-info">${{ fancyRounding(getHFImpactForUser().dailyInflow) }}/day</div>
												<small class="text-muted">Available DHF inflow</small>
											</div>
										</div>
										<div class="col-md-3 mb-3">
											<div class="text-center">
												<h6 class="text-info mb-1">Your Vote Weight</h6>
												<div class="h5" :class="getHFImpactForUser().voteWeight >= 1 ? 'text-success' : 'text-danger'">
													{{ (getHFImpactForUser().voteWeight * 100).toFixed(1) }}%
												</div>
												<small class="text-muted">Under HF weighting</small>
											</div>
										</div>
										<div class="col-md-3 mb-3">
											<div class="text-center">
												<h6 class="text-info mb-1">Status</h6>
												<div v-if="getHFImpactForUser().isOverCommitted" class="h6 text-danger">
													<i class="fa-solid fa-exclamation-triangle me-1"></i>Over-Committed
												</div>
												<div v-else class="h6 text-success">
													<i class="fa-solid fa-check me-1"></i>Within Budget
												</div>
												<small class="text-muted">Budget analysis</small>
											</div>
										</div>
									</div>
									
									<div v-if="getHFImpactForUser() && getHFImpactForUser().isOverCommitted" class="alert alert-warning">
										<h6 class="alert-heading">
											<i class="fa-solid fa-exclamation-triangle me-2"></i>Over-Commitment Alert
										</h6>
										<p class="mb-2">
											You're supporting <strong>${{ fancyRounding(getHFImpactForUser().commitment - getHFImpactForUser().dailyInflow) }}</strong> 
											more per day than the DHF can sustainably fund. Under the proposed hard fork:
										</p>
										<ul class="mb-2">
											<li>Your vote weight would be reduced to <strong>{{ (getHFImpactForUser().voteWeight * 100).toFixed(1) }}%</strong></li>
											<li>This represents a <strong>{{ (getHFImpactForUser().weightReduction * 100).toFixed(1) }}%</strong> reduction in voting power</li>
											<li>Consider reducing your proposal commitments to maintain full voting power</li>
										</ul>
										<p class="mb-0">
											<strong>Recommendation:</strong> Support proposals totaling ${{ fancyRounding(getHFImpactForUser().dailyInflow) }}/day or less to maintain 100% vote weight.
										</p>
									</div>
									
									<div v-else-if="getHFImpactForUser()" class="alert alert-success">
										<h6 class="alert-heading">
											<i class="fa-solid fa-check me-2"></i>Budget Conscious Voting
										</h6>
										<p class="mb-0">
											Excellent! Your proposal commitments are within the daily DHF budget. 
											Under the proposed hard fork, you would maintain <strong>100% voting power</strong> 
											because you're supporting proposals that total less than the ${{ fancyRounding(getHFImpactForUser().dailyInflow) }}/day 
											DHF inflow.
										</p>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- User Voting Stats (if logged in) -->
					<div v-if="account && viewMode === 'current'" class="row mb-4">
						<div class="col-12">
							<div class="card bg-dark bg-opacity-75 text-light">
								<div class="card-body">
									<h5 class="card-title text-info mb-3">Your Voting Impact (@{{ account }})</h5>
									<div class="row">
										<div class="col-lg-4 col-md-6 mb-3">
											<div class="text-center">
												<h6 class="text-warning mb-1">${{ fancyRounding(healthStats.userVotedOutflowsNoZero) }}</h6>
												<small class="text-muted">Total Voted</small>
											</div>
										</div>
										<div class="col-lg-4 col-md-6 mb-3">
											<div class="text-center">
												<h6 class="text-warning mb-1">${{ fancyRounding(healthStats.userVotedOutflowsNoStabilizer) }}</h6>
												<small class="text-muted">Voted (Excluding Stabilizer)</small>
											</div>
										</div>
										<div class="col-lg-4 col-md-6 mb-3">
											<div class="text-center">
												<h6 class="mb-1" :class="getUserVote(0) ? 'text-success' : 'text-danger'">
													{{ getUserVote(0) ? '✓ Supporting' : '✗ Not Supporting' }}
												</h6>
												<small class="text-muted">Return Proposal</small>
											</div>
										</div>
									</div>
									
									<!-- Voting Power Impact Analysis -->
									<div class="row mt-4">
										<div class="col-12">
											<div class="card bg-secondary bg-opacity-25">
												<div class="card-body">
													<h6 class="text-warning mb-3">
														<i class="fa-solid fa-balance-scale me-2"></i>Your Voting Power Impact
													</h6>
													<div class="row">
														<div class="col-md-6">
															<div class="small text-muted mb-2">Estimated Voting Power:</div>
															<div class="h6 text-info">{{ formatVotes(getUserVotingPower()) }} HP</div>
														</div>
														<div class="col-md-6">
															<div class="small text-muted mb-2">Threshold Impact Range:</div>
															<div class="h6 text-warning">
																{{ formatVotes(getThresholdImpactRange().min) }} - {{ formatVotes(getThresholdImpactRange().max) }} HP
															</div>
														</div>
													</div>
													
													<div class="row mt-3">
														<div class="col-md-6">
															<div class="small text-muted mb-2">Return Proposal Effect:</div>
															<div v-if="getUserVote(0)" class="text-success small">
																<i class="fa-solid fa-arrow-up me-1"></i>
																Raising threshold by ~{{ formatVotes(getUserVotingPower()) }} HP
															</div>
															<div v-else class="text-warning small">
																<i class="fa-solid fa-arrow-up me-1"></i>
																Could raise threshold by ~{{ formatVotes(getUserVotingPower()) }} HP
															</div>
														</div>
														<div class="col-md-6">
															<div class="small text-muted mb-2">Proposals You Could Impact:</div>
															<div class="h6 text-info">{{ getProposalsInRange().length }} proposals</div>
														</div>
													</div>
													
													<!-- Actionable Proposals List -->
													<div v-if="getProposalsInRange().length > 0" class="mt-3">
														<div class="small text-muted mb-2">Proposals within your voting range ({{ getProposalsInRange().length }} total):</div>
														<div class="d-flex flex-wrap gap-1 proposal-scroll" style="max-height: 120px; overflow-y: auto;">
															<span v-for="proposal in getProposalsInRange()" :key="proposal.id" 
																class="badge bg-info cursor-pointer" 
																@click="openProposalModal(proposal)"
																:title="proposal.subject">
																#{{ proposal.id }}
															</span>
														</div>
													</div>
													
													<div class="small text-muted mt-3">
														<i class="fa-solid fa-info-circle me-1"></i>
														Your vote can push proposals {{ formatVotes(getUserVotingPower()) }} HP up or down. 
														{{ !getUserVote(0) ? 'Voting for' : 'Not voting for' }} the return proposal 
														{{ !getUserVote(0) ? 'raises' : 'could raise' }} the funding threshold.
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<!-- Price Projection Controls -->
					<div class="row mb-4">
						<div class="col-12">
							<div class="card bg-dark bg-opacity-75 text-light">
								<div class="card-body">
									<h5 class="card-title text-info mb-3">Price Growth Projection</h5>
									<div class="row align-items-center">
										<div class="col-md-8">
											<label for="priceGrowth" class="form-label">Hive Price Growth Rate (APR): {{ priceGrowthRate }}%</label>
											<input type="range" class="form-range" id="priceGrowth" 
												v-model.number="priceGrowthRate" min="-50" max="500" step="10">
											<div class="d-flex justify-content-between small text-muted mt-1">
												<span>-50%</span>
												<span>0%</span>
												<span>100%</span>
												<span>300%</span>
												<span>500%</span>
											</div>
										</div>
										<div class="col-md-4">
											<div class="text-center">
												<h6 class="text-success">Projected Price (1yr)</h6>
												<h4 class="text-warning">${{ getProjectedValues().projectedPrice.toFixed(3) }}</h4>
												<small class="text-muted">
													{{ priceGrowthRate > 0 ? '+' : '' }}{{ priceGrowthRate }}% growth
												</small>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<!-- 3-Year Budget Projection Chart -->
					<div class="row mb-4">
						<div class="col-12">
							<div class="card bg-dark bg-opacity-75 text-light">
								<div class="card-body">
									<div class="d-flex justify-content-between align-items-center mb-3">
										<h5 class="card-title text-info mb-0">3-Year Budget Projection</h5>
										<div class="d-flex gap-2">
											<button @click="openCustomAnalysisModal()" 
												class="btn btn-sm btn-outline-primary">
												<i class="fa-solid fa-calculator me-1"></i>Custom Analysis
											</button>
																		<button v-if="selectedProposalForAnalysis || customAnalysis.active" 
								@click="clearAllAnalysis()" 
								class="btn btn-sm btn-outline-warning">
								<i class="fa-solid fa-broom me-1"></i>Reset Analysis
							</button>
											<span v-if="selectedProposalForAnalysis" class="badge bg-info">
												{{ isProposalFunded(selectedProposalForAnalysis) ? 'Removing' : 'Adding' }}: 
												{{ selectedProposalForAnalysis.subject.substring(0, 30) }}...
											</span>
											<span v-if="customAnalysis.active" class="badge bg-primary">
												{{ customAnalysis.isAddition ? 'Adding' : 'Removing' }}: 
												${{ fancyRounding(customAnalysis.dailyAmount) }}/day custom funding
											</span>
										</div>
									</div>
									
														<div class="mb-3" style="height: 500px;">
						<canvas id="budgetChart"></canvas>
					</div>
									
									<div class="row">
										<div class="col-md-4">
											<h6 class="text-success mb-2">Key Assumptions</h6>
											<ul class="small text-muted mb-0">
												<li>Hive reward fund grows 8% annually</li>
												<li>Hive price grows at {{ priceGrowthRate }}% annually</li>
												<li>Current outflows remain constant (HBD)</li>
												<li>Ninja grant scales with Hive price</li>
												<li>Only active proposals considered</li>
											</ul>
										</div>
										<div class="col-md-4">
											<h6 class="text-info mb-2">Chart Legend</h6>
											<ul class="small text-muted mb-0">
												<li><span class="text-info">Teal:</span> Treasury balance (HBD)</li>
												<li><span class="text-warning">Orange:</span> Hive balance (ninja fund)</li>
												<li><span class="text-primary">Blue:</span> Total daily inflow</li>
												<li><span class="text-success">Purple:</span> Ninja grant (decreasing)</li>
												<li><span style="color: rgb(34, 197, 94);">Green:</span> Beneficiary rewards (comment voting)</li>
												<li><span class="text-danger">Red:</span> Daily outflow</li>
											</ul>
										</div>
										<div class="col-md-4" v-if="calculateFundProjectionAnalysis()">
											<h6 class="text-warning mb-2">Fund Trajectory</h6>
											<div class="small text-muted">
												<div v-if="calculateFundProjectionAnalysis().hasMaxValue">
													<strong class="text-warning">Peak Fund:</strong><br>
													${{ fancyRounding(calculateFundProjectionAnalysis().maxTreasury) }}<br>
													<span class="text-muted">in {{ Math.round(calculateFundProjectionAnalysis().maxTreasuryDay / 365 * 10) / 10 }} years</span>
												</div>
												<div v-else>
													<strong class="text-success">Exponential Growth</strong><br>
													<span class="text-muted">Fund continues growing</span>
												</div>
												<div v-if="calculateFundProjectionAnalysis().equilibriumSpending" class="mt-2">
													<strong class="text-info">Sustainable Spending:</strong><br>
													${{ fancyRounding(calculateFundProjectionAnalysis().equilibriumSpending) }}/day
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<!-- Budget Health Summary -->
					<div class="row">
						<div class="col-12">
							<div class="card bg-dark bg-opacity-75 text-light">
								<div class="card-body">
									<h5 class="card-title text-info mb-4">
										Annual Budget Health Summary
										<span v-if="selectedProposalForAnalysis" class="badge bg-info ms-2">
											{{ isProposalFunded(selectedProposalForAnalysis) ? 'Removing' : 'Adding' }} Impact Analysis
										</span>
									</h5>
									
									<div class="row mb-4">
										<div class="col-md-6">
											<h6 class="text-success mb-3">Inflows (Annual)</h6>
											<div class="d-flex justify-content-between align-items-center mb-2">
												<span>Rewards Inflow:</span>
												<div class="text-end">
													<span class="text-success">${{ fancyRounding(getProjectedValues().projectedDailyInflow * 365) }}</span>
													<div v-if="priceGrowthRate !== 0" class="small text-muted">
														was ${{ fancyRounding(daoFund.dailyInflow * 365) }} @ 0%
													</div>
												</div>
											</div>
											<div class="d-flex justify-content-between align-items-center mb-2">
												<span>Ninja Grant:</span>
												<div class="text-end">
													<span class="text-primary">${{ fancyRounding(getProjectedValues().projectedNinjaGrant * 365) }}</span>
													<div v-if="priceGrowthRate !== 0" class="small text-muted">
														was ${{ fancyRounding(daoFund.ninjaGrant * 365) }} @ 0%
													</div>
												</div>
											</div>
											<div class="d-flex justify-content-between align-items-center mb-2">
												<span>Beneficiary Rewards:</span>
												<div class="text-end">
													<span class="text-success">${{ fancyRounding(getProjectedValues().projectedBeneficiaryRewards * 365) }}</span>
													<div v-if="priceGrowthRate !== 0" class="small text-muted">
														was ${{ fancyRounding(daoFund.beneficiaryRewards * 365) }} @ 0%
													</div>
												</div>
											</div>
											<hr class="border-secondary">
											<div class="d-flex justify-content-between align-items-center">
												<strong>Total Annual Inflow:</strong>
												<div class="text-end">
													<strong class="text-warning">${{ fancyRounding(getProjectedValues().projectedTotalInflow * 365) }}</strong>
													<div v-if="priceGrowthRate !== 0" class="small text-muted">
														was ${{ fancyRounding((daoFund.dailyInflow + daoFund.ninjaGrant + daoFund.beneficiaryRewards) * 365) }} @ 0%
													</div>
												</div>
											</div>
										</div>
										
										<div class="col-md-6">
											<h6 class="text-danger mb-3">Outflows (Annual)</h6>
											<div class="d-flex justify-content-between align-items-center mb-2">
												<span>All Funded:</span>
												<div class="text-end">
													<span class="text-danger">
														${{ fancyRounding(healthStats.totalFundedOutflows * 365) }}
														<span v-if="selectedProposalForAnalysis" class="text-warning">
															(${{ fancyRounding(getProjectedValuesWithProposalImpact().projectedTotalOutflowAllAnnual * 365) }})
														</span>
													</span>
												</div>
											</div>
											<div class="d-flex justify-content-between align-items-center mb-2">
												<span>Funded (Excluding Stabilizer):</span>
												<div class="text-end">
													<span class="text-danger">
														${{ fancyRounding(healthStats.totalFundedOutflowsNoStabilizer * 365) }}
														<span v-if="selectedProposalForAnalysis || customAnalysis.active" class="text-warning">
															(${{ fancyRounding(getProjectedValuesWithProposalImpact().projectedTotalOutflowAnnual * 365) }})
														</span>
													</span>
												</div>
											</div>
											<hr class="border-secondary">
											<div class="d-flex justify-content-between align-items-center">
												<strong>Net Balance (Excluding Stabilizer):</strong>
												<div class="text-end">
																									<strong :class="(getProjectedValues().projectedTotalInflow * 365 - healthStats.totalFundedOutflowsNoStabilizer * 365) > 0 ? 'text-success' : 'text-danger'">
													${{ fancyRounding(getProjectedValues().projectedTotalInflow * 365 - healthStats.totalFundedOutflowsNoStabilizer * 365) }}
												</strong>
												<span v-if="selectedProposalForAnalysis || customAnalysis.active" class="text-warning d-block">
													<strong :class="(getProjectedValues().projectedTotalInflow * 365 - getProjectedValuesWithProposalImpact().projectedTotalOutflowAnnual * 365) > 0 ? 'text-success' : 'text-danger'">
														(${{ fancyRounding(getProjectedValues().projectedTotalInflow * 365 - getProjectedValuesWithProposalImpact().projectedTotalOutflowAnnual * 365) }})
													</strong>
												</span>
													<div v-if="priceGrowthRate !== 0" class="small text-muted">
														was ${{ fancyRounding((daoFund.dailyInflow + daoFund.ninjaGrant + daoFund.beneficiaryRewards) * 365 - healthStats.totalFundedOutflowsNoStabilizer * 365) }} @ 0%
													</div>
												</div>
											</div>
										</div>
									</div>
									
									<!-- Analysis Impact Summary -->
									<div v-if="selectedProposalForAnalysis || customAnalysis.active" class="row mb-4">
										<div class="col-12">
											<div class="card bg-info bg-opacity-25 border-info">
												<div class="card-body">
													<h6 class="text-info mb-3">
														<i class="fa-solid fa-chart-line me-2"></i>Budget Impact Analysis
													</h6>
													
													<!-- Proposal Impact -->
													<div v-if="selectedProposalForAnalysis && getProjectedValuesWithProposalImpact().proposalImpact" class="mb-4">
														<h6 class="text-warning mb-2">
															{{ getProjectedValuesWithProposalImpact().proposalImpact.action === 'adding' ? 'Adding' : 'Removing' }} 
															{{ getProjectedValuesWithProposalImpact().proposalImpact.isShortTerm ? 'Short-Term' : '' }} Proposal: 
															{{ selectedProposalForAnalysis.subject.substring(0, 50) }}{{ selectedProposalForAnalysis.subject.length > 50 ? '...' : '' }}
														</h6>
														
														<!-- Short-term proposal info -->
														<div v-if="getProjectedValuesWithProposalImpact().proposalImpact.isShortTerm" class="alert alert-info mb-3">
															<div class="small">
																<strong><i class="fa-solid fa-clock me-1"></i>Short-Term Proposal:</strong><br>
																<span class="text-muted">
																	Duration: {{ getProjectedValuesWithProposalImpact().proposalImpact.totalDuration.toFixed(1) }} days total, 
																	{{ getProjectedValuesWithProposalImpact().proposalImpact.remainingDays.toFixed(1) }} days remaining
																</span><br>
																<span class="text-muted">
																	This analysis shows one-time impact, not ongoing funding.
																</span>
															</div>
														</div>
														
														<div class="row mb-3">
															<div class="col-md-4">
																<strong class="text-light">Daily Change:</strong><br>
																<span :class="getProjectedValuesWithProposalImpact().proposalImpact.dailyChange > 0 ? 'text-danger' : 'text-success'">
																	{{ getProjectedValuesWithProposalImpact().proposalImpact.dailyChange > 0 ? '+' : '' }}${{ fancyRounding(Math.abs(getProjectedValuesWithProposalImpact().proposalImpact.dailyChange)) }}/day
																</span>
															</div>
															<div class="col-md-4">
																<strong class="text-light">
																	{{ getProjectedValuesWithProposalImpact().proposalImpact.isShortTerm ? 'Total Remaining Impact:' : 'Annual Change:' }}
																</strong><br>
																<span :class="getProjectedValuesWithProposalImpact().proposalImpact.annualChange > 0 ? 'text-danger' : 'text-success'">
																	{{ getProjectedValuesWithProposalImpact().proposalImpact.annualChange > 0 ? '+' : '' }}${{ fancyRounding(Math.abs(getProjectedValuesWithProposalImpact().proposalImpact.annualChange)) }}{{ getProjectedValuesWithProposalImpact().proposalImpact.isShortTerm ? '' : '/year' }}
																</span>
															</div>
															<div class="col-md-4">
																<strong class="text-light">% of Annual Inflow:</strong><br>
																<span :class="getProjectedValuesWithProposalImpact().proposalImpact.annualChange > 0 ? 'text-danger' : 'text-success'">
																	{{ getProjectedValuesWithProposalImpact().proposalImpact.annualChange > 0 ? '+' : '' }}{{ (Math.abs(getProjectedValuesWithProposalImpact().proposalImpact.annualChange) / (getProjectedValues().projectedTotalInflow * 365) * 100).toFixed(2) }}%
																</span>
															</div>
														</div>
														
														<!-- Voting Actions for Analyzed Proposal -->
														<div v-if="account && isProposalActive(selectedProposalForAnalysis)" class="mt-3 p-3 rounded" style="background: rgba(255,255,255,0.05);">
															<h6 class="text-light mb-2">
																<i class="fa-solid fa-vote-yea me-2"></i>Quick Actions
															</h6>
															<div class="d-flex gap-2 align-items-center">
																<div v-if="getUserVote(selectedProposalForAnalysis.id)" class="text-success small me-3">
																	<i class="fa-solid fa-check me-1"></i>You are supporting this proposal
																</div>
																<div v-else class="text-muted small me-3">
																	<i class="fa-solid fa-minus me-1"></i>Not voted
																</div>
																
																<button v-if="!getUserVote(selectedProposalForAnalysis.id)" 
																	@click="voteForProposal(selectedProposalForAnalysis.id, true)"
																	:disabled="votingProposal === selectedProposalForAnalysis.id"
																	class="btn btn-success btn-sm">
																	<span v-if="votingProposal === selectedProposalForAnalysis.id" class="spinner-border spinner-border-sm me-1"></span>
																	<i v-else class="fa-solid fa-thumbs-up me-1"></i>
																	Support
																</button>
																<button v-else 
																	@click="voteForProposal(selectedProposalForAnalysis.id, false)"
																	:disabled="votingProposal === selectedProposalForAnalysis.id"
																	class="btn btn-outline-danger btn-sm">
																	<span v-if="votingProposal === selectedProposalForAnalysis.id" class="spinner-border spinner-border-sm me-1"></span>
																	<i v-else class="fa-solid fa-thumbs-down me-1"></i>
																	Remove Support
																</button>
																
																<button @click="openProposalModal(selectedProposalForAnalysis)" 
																	class="btn btn-outline-info btn-sm ms-2">
																	<i class="fa-solid fa-info-circle me-1"></i>
																	View Details
																</button>
															</div>
														</div>
													</div>
													
													<!-- Custom Analysis Impact -->
													<div v-if="customAnalysis.active && getProjectedValuesWithProposalImpact().customImpact" class="mb-4">
														<h6 class="text-primary mb-2">
															{{ getProjectedValuesWithProposalImpact().customImpact.action === 'adding' ? 'Adding' : 'Removing' }} Custom Analysis: 
															{{ getProjectedValuesWithProposalImpact().customImpact.description }}
														</h6>
														<div class="row mb-3">
															<div class="col-md-4">
																<strong class="text-light">Daily Change:</strong><br>
																<span :class="getProjectedValuesWithProposalImpact().customImpact.dailyChange > 0 ? 'text-danger' : 'text-success'">
																	{{ getProjectedValuesWithProposalImpact().customImpact.dailyChange > 0 ? '+' : '' }}${{ fancyRounding(Math.abs(getProjectedValuesWithProposalImpact().customImpact.dailyChange)) }}/day
																</span>
															</div>
															<div class="col-md-4">
																<strong class="text-light">Annual Change:</strong><br>
																<span :class="getProjectedValuesWithProposalImpact().customImpact.annualChange > 0 ? 'text-danger' : 'text-success'">
																	{{ getProjectedValuesWithProposalImpact().customImpact.annualChange > 0 ? '+' : '' }}${{ fancyRounding(Math.abs(getProjectedValuesWithProposalImpact().customImpact.annualChange)) }}/year
																</span>
															</div>
															<div class="col-md-4">
																<strong class="text-light">% of Annual Inflow:</strong><br>
																<span :class="getProjectedValuesWithProposalImpact().customImpact.annualChange > 0 ? 'text-danger' : 'text-success'">
																	{{ getProjectedValuesWithProposalImpact().customImpact.annualChange > 0 ? '+' : '' }}{{ (Math.abs(getProjectedValuesWithProposalImpact().customImpact.annualChange) / (getProjectedValues().projectedTotalInflow * 365) * 100).toFixed(2) }}%
																</span>
															</div>
														</div>
													</div>
													
													<!-- Combined Impact (if both active) -->
													<div v-if="selectedProposalForAnalysis && customAnalysis.active" class="mb-3">
														<hr class="border-secondary">
														<h6 class="text-success mb-2">Combined Impact:</h6>
														<div class="row">
															<div class="col-md-4">
																<strong class="text-light">Total Daily Change:</strong><br>
																<span :class="(getProjectedValuesWithProposalImpact().proposalImpact.dailyChange + getProjectedValuesWithProposalImpact().customImpact.dailyChange) > 0 ? 'text-danger' : 'text-success'">
																	{{ (getProjectedValuesWithProposalImpact().proposalImpact.dailyChange + getProjectedValuesWithProposalImpact().customImpact.dailyChange) > 0 ? '+' : '' }}${{ fancyRounding(Math.abs(getProjectedValuesWithProposalImpact().proposalImpact.dailyChange + getProjectedValuesWithProposalImpact().customImpact.dailyChange)) }}/day
																</span>
															</div>
															<div class="col-md-4">
																<strong class="text-light">Total Annual Change:</strong><br>
																<span :class="(getProjectedValuesWithProposalImpact().proposalImpact.annualChange + getProjectedValuesWithProposalImpact().customImpact.annualChange) > 0 ? 'text-danger' : 'text-success'">
																	{{ (getProjectedValuesWithProposalImpact().proposalImpact.annualChange + getProjectedValuesWithProposalImpact().customImpact.annualChange) > 0 ? '+' : '' }}${{ fancyRounding(Math.abs(getProjectedValuesWithProposalImpact().proposalImpact.annualChange + getProjectedValuesWithProposalImpact().customImpact.annualChange)) }}/year
																</span>
															</div>
															<div class="col-md-4">
																<strong class="text-light">% of Annual Inflow:</strong><br>
																<span :class="(getProjectedValuesWithProposalImpact().proposalImpact.annualChange + getProjectedValuesWithProposalImpact().customImpact.annualChange) > 0 ? 'text-danger' : 'text-success'">
																	{{ (getProjectedValuesWithProposalImpact().proposalImpact.annualChange + getProjectedValuesWithProposalImpact().customImpact.annualChange) > 0 ? '+' : '' }}{{ (Math.abs(getProjectedValuesWithProposalImpact().proposalImpact.annualChange + getProjectedValuesWithProposalImpact().customImpact.annualChange) / (getProjectedValues().projectedTotalInflow * 365) * 100).toFixed(2) }}%
																</span>
															</div>
														</div>
													</div>
													
													<div class="small text-muted mt-2">
														<i class="fa-solid fa-info-circle me-1"></i>
														Values in parentheses in the budget summary above show the impact with these changes applied.
														Adjust the APR slider to see how price growth affects these projections.
													</div>
												</div>
											</div>
										</div>
									</div>

									<!-- Visual Budget Chart -->
									<div class="mb-3">
										<h6 class="small text-muted mb-2">Budget Visualization (Annual)</h6>
										<div class="progress mb-2" style="height: 20px;">
											<div class="progress-bar bg-success" role="progressbar" 
												:style="'width: ' + Math.min((getProjectedValues().projectedDailyInflow * 365 / (getProjectedValues().projectedTotalInflow * 365)) * 100, 100) + '%'">
												Rewards
											</div>
											<div class="progress-bar bg-primary" role="progressbar" 
												:style="'width: ' + Math.min((getProjectedValues().projectedNinjaGrant * 365 / (getProjectedValues().projectedTotalInflow * 365)) * 100, 100) + '%'">
												Ninja
											</div>
											<div class="progress-bar" style="background-color: rgb(34, 197, 94);" role="progressbar" 
												:style="'width: ' + Math.min((getProjectedValues().projectedBeneficiaryRewards * 365 / (getProjectedValues().projectedTotalInflow * 365)) * 100, 100) + '%'">
												Beneficiary
											</div>
										</div>
										<div class="progress" style="height: 20px;">
											<div class="progress-bar bg-danger" role="progressbar" 
												:style="'width: ' + Math.min(((selectedProposalForAnalysis || customAnalysis.active ? getProjectedValuesWithProposalImpact().projectedTotalOutflowAnnual : healthStats.totalFundedOutflowsNoStabilizer) * 365 / (getProjectedValues().projectedTotalInflow * 365)) * 100, 100) + '%'">
												Funded (Excluding Stabilizer)
												<span v-if="selectedProposalForAnalysis || customAnalysis.active"> - With Analysis Impact</span>
											</div>
										</div>
									</div>
									
									<!-- Equilibrium Analysis -->
									<div class="row mt-4">
										<div class="col-12">
											<div class="card bg-secondary bg-opacity-25">
												<div class="card-body">
													<h6 class="text-info mb-3">
														<i class="fa-solid fa-balance-scale me-2"></i>Equilibrium Analysis
													</h6>
													<div class="row">
														<div class="col-md-3">
															<div class="small text-muted mb-2">Time to sustainable fund level:</div>
															<div v-if="calculateEquilibriumYears() !== null && calculateEquilibriumYears() > 0" class="h5 text-info">
																{{ calculateEquilibriumYears().toFixed(1) }} years
															</div>
															<div v-else-if="calculateEquilibriumYears() === 0" class="h5 text-success">
																In target band (75x-150x)
															</div>
															<div v-else class="h5 text-danger">
																Never (under spending)
															</div>
														</div>
														<div class="col-md-3">
															<div class="small text-muted mb-2">Spending analysis:</div>
															<div v-if="calculateFundProjectionAnalysis() && calculateFundProjectionAnalysis().spendingCushion > 0" class="h5 text-success">
																+${{ fancyRounding(calculateFundProjectionAnalysis().spendingCushion) }}/day cushion
															</div>
															<div v-else-if="calculateSpendingReductionNeeded() !== null && calculateSpendingReductionNeeded() > 0" class="h5 text-warning">
																-${{ fancyRounding(calculateSpendingReductionNeeded()) }}/day needed
															</div>
															<div v-else-if="calculateSpendingReductionNeeded() === 0" class="h5 text-success">
																Balanced
															</div>
															<div v-else class="h5 text-muted">
																Calculating...
															</div>
														</div>
														<div class="col-md-3">
															<div class="small text-muted mb-2">Current runway (0% growth):</div>
															<div v-if="calculateRunwayAtZeroGrowth() !== null" class="h5 text-info">
																{{ Math.floor(calculateRunwayAtZeroGrowth()) }} days
															</div>
															<div v-else class="h5 text-success">
																50+ years
															</div>
														</div>
														<div class="col-md-3" v-if="priceGrowthRate !== 0">
															<div class="small text-muted mb-2">Projected runway ({{ priceGrowthRate }}% growth):</div>
															<div v-if="calculateProjectedRunway() !== null" class="h5 text-info">
																{{ Math.floor(calculateProjectedRunway()) }} days
															</div>
															<div v-else class="h5 text-success">
																50+ years
															</div>
														</div>
													</div>
													<div class="small text-muted mt-2">
														<i class="fa-solid fa-info-circle me-1"></i>
														The DAO is currently over-funded due to the ninja grant. Sustainable funding occurs 
														in the 75x-150x daily inflow band, allowing indefinite funding through modest returns (2-3% annually). 
														Note: Ninja grant decreases over time as the Hive balance depletes at 0.05% daily.
													</div>
												</div>
											</div>
										</div>
									</div>

									<div class="text-center mt-3">
										<a class="btn btn-primary" href="#proposals">
											<i class="fa-solid fa-arrow-down me-2"></i>View Detailed Proposals
										</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Main Content -->
			<div id="proposals" class="container-fluid py-4">
				<div class="container">
					<!-- Filter, Stats, and Create Proposal Bar -->
					<div class="row mb-4">
						<div class="col-lg-8">
							<div class="card card-bg text-light">
								<div class="card-body">
									<div class="d-flex flex-wrap align-items-center gap-3">
										<div class="d-flex align-items-center">
											<label class="form-label me-2 mb-0">Status:</label>
											<select v-model="filterStatus" class="form-select form-select-sm" style="width: auto;">
												<option value="all">All</option>
												<option value="active">Active</option>
												<option value="inactive">Inactive</option>
												<option value="expired">Expired</option>
											</select>
										</div>
										<div class="d-flex align-items-center">
											<label class="form-label me-2 mb-0">Sort:</label>
											<select v-model="sortBy" class="form-select form-select-sm" style="width: auto;">
												<option value="votes">Votes</option>
												<option value="created">Created</option>
												<option value="funding">Funding</option>
												<option value="end_date">End Date</option>
											</select>
										</div>
										<div class="d-flex align-items-center">
											<input v-model="searchTerm" type="text" class="form-control form-control-sm" 
												placeholder="Search proposals..." style="width: 200px;">
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-4">
							<div class="card card-bg text-light">
								<div class="card-body">
									<div class="row">
										<div class="col-8">
											<h6 class="card-title mb-1">Quick Stats</h6>
											<p class="h4 mb-0 text-info">{{ proposals.length }} Proposals</p>
											<small class="text-muted d-block">{{ filteredProposals.length }} shown</small>
											<small class="text-success">
												{{ proposals.filter(p => isProposalFunded(p)).length }} funded
											</small>
										</div>
										<div class="col-4 d-flex align-items-center">
											<button v-if="account" @click="openCreateProposalModal()" 
												class="btn btn-primary btn-sm w-100">
												<i class="fa-solid fa-plus me-1"></i>
												Create
											</button>
											<div v-else class="text-center w-100">
												<small class="text-muted">Login to create proposals</small>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Loading State -->
					<div v-if="loading" class="text-center py-5">
						<div class="spinner-border text-light" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<p class="mt-3 text-light">Loading proposals...</p>
					</div>

					<!-- Error State -->
					<div v-if="error" class="alert alert-danger" role="alert">
						<h5 class="alert-heading">Error Loading Proposals</h5>
						<p>{{ error }}</p>
						<button @click="loadProposals" class="btn btn-danger">Retry</button>
					</div>

					<!-- Proposal List -->
					<div v-if="!loading && !error" class="row">
						<div v-for="proposal in filteredProposals" :key="proposal.id" class="col-12 mb-4">
							<div class="card card-bg text-light h-100" :data-proposal-id="proposal.id">
								<div class="card-body">
									<div class="row">
										<div class="col-lg-8">
											<div class="d-flex align-items-start mb-3">
												<span class="badge me-3 fs-6" 
													:class="getProposalStatusClass(proposal)">
													#{{ proposal.id }}
												</span>
																							<div class="flex-grow-1">
												<h5 class="card-title mb-2">
													<a @click="openProposalModal(proposal)" 
														href="#" class="text-decoration-none text-light">
														{{ proposal.subject }}
													</a>
													<a @click="openBlogModal(proposal.creator, proposal.permlink)" 
														href="#" class="text-decoration-none text-muted">
														<i class="fa-solid fa-external-link fa-sm ms-2"></i>
													</a>
												</h5>
													<p class="text-muted mb-2">
														by <a :href="'/@' + proposal.creator" 
															class="text-info text-decoration-none">
															@{{ proposal.creator }}
														</a>
													</p>
													<div class="d-flex flex-wrap gap-3 small text-muted">
														<span><i class="fa-solid fa-calendar me-1"></i>{{ formatDate(proposal.start_date) }}</span>
														<span><i class="fa-solid fa-calendar-xmark me-1"></i>{{ formatDate(proposal.end_date) }}</span>
														<span><i class="fa-solid fa-coins me-1"></i>{{ fancyRounding(proposal.daily_pay.amount / 1000) }} HBD/day</span>
													</div>
												</div>
											</div>
										</div>
										<div class="col-lg-4">
											<div class="text-lg-end">
												<!-- Support Status -->
												<div class="mb-3">
													<div class="d-flex justify-content-between align-items-center mb-1">
														<small class="text-muted">Support Level</small>
														<small class="text-light">{{ formatVotes(proposal.total_votes) }} HP</small>
													</div>
													<div class="progress" style="height: 8px;">
														<div class="progress-bar" role="progressbar" 
															:class="isProposalFunded(proposal) ? 'bg-success' : (getVotePercentage(proposal) >= 100 ? 'bg-warning' : 'bg-danger')"
															:style="'width: ' + Math.max(getVotePercentage(proposal), 10) + '%'">
														</div>
													</div>
													<div class="d-flex justify-content-between align-items-center">
														<small class="text-muted">
															<span v-if="isProposalFunded(proposal)" class="text-success">✓ Funded</span>
															<span v-else-if="getVotePercentage(proposal) >= 100" class="text-warning">Threshold</span>
															<span v-else class="text-danger">{{ getSupportLabel(proposal) }}</span>
														</small>
														<button @click="openSupportersModal(proposal)" 
															class="btn btn-outline-info btn-sm"
															title="View supporters list">
															<i class="fa-solid fa-users fa-xs me-1"></i>
															<span class="d-none d-sm-inline">Supporters</span>
														</button>
													</div>
												</div>

												<!-- User Vote Status -->
												<div v-if="account" class="mb-3">
													<div v-if="getUserVote(proposal.id)" class="text-success small">
														<i class="fa-solid fa-check me-1"></i>You support this proposal
													</div>
													<div v-else class="text-muted small">
														<i class="fa-solid fa-minus me-1"></i>Not voted
													</div>
												</div>

												<!-- Management Buttons (for proposal creator) -->
												<div v-if="account && account === proposal.creator" class="d-grid gap-2 mb-2">
													<div class="btn-group" role="group">
														<button v-if="isProposalActive(proposal)"
															@click="openUpdateProposalModal(proposal)"
															:disabled="updatingProposal === proposal.id"
															class="btn btn-warning btn-sm"
															title="Update proposal details">
															<span v-if="updatingProposal === proposal.id" class="spinner-border spinner-border-sm me-1"></span>
															<i v-else class="fa-solid fa-edit me-1"></i>
															Update
														</button>
														<button v-if="isProposalActive(proposal)"
															@click="removeProposal(proposal.id)"
															:disabled="removingProposal === proposal.id"
															class="btn btn-danger btn-sm"
															title="Cancel this proposal">
															<span v-if="removingProposal === proposal.id" class="spinner-border spinner-border-sm me-1"></span>
															<i v-else class="fa-solid fa-times me-1"></i>
															Cancel
														</button>
													</div>
												</div>

												<!-- Voting Buttons -->
												<div v-if="account && isProposalActive(proposal)" class="d-grid gap-2">
													<button v-if="!getUserVote(proposal.id)" 
														@click="voteForProposal(proposal.id, true)"
														:disabled="votingProposal === proposal.id"
														class="btn btn-success btn-sm"
														:title="getVoteTooltip(proposal, true)"
														data-bs-toggle="tooltip" data-bs-placement="left">
														<span v-if="votingProposal === proposal.id" class="spinner-border spinner-border-sm me-1"></span>
														<i v-else class="fa-solid fa-thumbs-up me-1"></i>
														Support
													</button>
													<button v-else 
														@click="voteForProposal(proposal.id, false)"
														:disabled="votingProposal === proposal.id"
														class="btn btn-outline-danger btn-sm"
														:title="getVoteTooltip(proposal, false)"
														data-bs-toggle="tooltip" data-bs-placement="left">
														<span v-if="votingProposal === proposal.id" class="spinner-border spinner-border-sm me-1"></span>
														<i v-else class="fa-solid fa-thumbs-down me-1"></i>
														Remove Support
													</button>
												</div>
												<div v-else-if="!account" class="text-muted small">
													<i class="fa-solid fa-sign-in-alt me-1"></i>Login to vote
												</div>
												
												<!-- Chart Analysis Button -->
												<div class="mt-2">
																						<button v-if="selectedProposalForAnalysis && selectedProposalForAnalysis.id === proposal.id"
										@click="clearProposalAnalysis()"
										class="btn btn-outline-warning btn-sm w-100">
										<i class="fa-solid fa-times me-1"></i>Clear Analysis
									</button>
													<button v-else-if="proposal.id !== 0 && !isStabilizerProposal(proposal)"
														@click="selectProposalForAnalysis(proposal)"
														class="btn btn-outline-info btn-sm w-100">
														<i class="fa-solid fa-chart-line me-1"></i>
														{{ isProposalFunded(proposal) ? 'Analyze Removing' : 'Analyze Adding' }}
													</button>
													<div v-else-if="proposal.id === 0" class="text-center">
														<small class="text-info">
															<i class="fa-solid fa-info-circle me-1"></i>Return Proposal<br>
															<span class="text-muted">Sets funding threshold</span>
														</small>
													</div>
													<div v-else-if="isStabilizerProposal(proposal)" class="text-center">
														<small class="text-secondary">
															<i class="fa-solid fa-info-circle me-1"></i>Stabilizer Proposal<br>
															<span class="text-muted">No net budget impact</span>
														</small>
													</div>
												</div>
											</div>
										</div>
									</div>

									<!-- Budget Impact Accordion -->
									<div class="col-12 mt-3">
										<button class="btn btn-sm btn-outline-secondary w-100" type="button" 
											data-bs-toggle="collapse" :data-bs-target="'#budget-' + proposal.id">
											<i class="fa-solid fa-chart-line me-2"></i>Budget Impact Analysis
										</button>
																					<div class="collapse mt-2" :id="'budget-' + proposal.id">
												<div class="card card-body bg-secondary bg-opacity-25">
													<h6 class="text-info mb-3">
														{{ isShortTermProposal(proposal) ? 'One-Time' : 'Annual' }} Budget Impact
													</h6>
													
													<!-- Short-term proposal info -->
													<div v-if="isShortTermProposal(proposal)" class="alert alert-info mb-3 small">
														<div class="d-flex align-items-center">
															<i class="fa-solid fa-clock me-2"></i>
															<div>
																<strong>Short-Term Proposal</strong><br>
																<span class="text-muted">
																	{{ getTotalDurationDays(proposal).toFixed(0) }} days total, 
																	{{ Math.max(0, getRemainingDays(proposal)).toFixed(0) }} days remaining
																</span>
															</div>
														</div>
													</div>
													
													<div class="row mb-3">
														<div class="col-md-4">
															<strong>Daily Cost:</strong><br>
															<span class="text-warning">{{ fancyRounding(getBudgetImpact(proposal).daily) }} HBD</span>
														</div>
														<div class="col-md-4">
															<strong>{{ isShortTermProposal(proposal) ? 'Remaining Cost:' : 'Total Cost:' }}</strong><br>
															<span class="text-warning">
																{{ isShortTermProposal(proposal) ? 
																	fancyRounding(getBudgetImpact(proposal).daily * Math.max(0, getRemainingDays(proposal))) : 
																	fancyRounding(getBudgetImpact(proposal).yearly) 
																}} HBD
															</span>
														</div>
														<div class="col-md-4">
															<strong>% of Annual Inflow:</strong><br>
															<span class="text-warning">
																{{ isShortTermProposal(proposal) ? 
																	((getBudgetImpact(proposal).daily * Math.max(0, getRemainingDays(proposal))) / getBudgetImpact(proposal).yearlyInflow * 100).toFixed(1) :
																	getBudgetImpact(proposal).percentOfInflow.toFixed(1) 
																}}%
															</span>
														</div>
													</div>

												<!-- Simple Budget Visualization -->
												<div class="mb-3">
													<h6 class="small text-muted mb-2">Annual Budget Impact</h6>
													<div class="d-flex align-items-center mb-1">
														<span class="small me-2" style="min-width: 80px;">Funded:</span>
														<div class="progress flex-grow-1 me-2" style="height: 8px;">
															<div class="progress-bar bg-success" role="progressbar" 
																:style="'width: ' + Math.min((getBudgetImpact(proposal).yearly / getBudgetImpact(proposal).yearlyInflow) * 100, 100) + '%'">
															</div>
														</div>
														<span class="small">{{ fancyRounding(getBudgetImpact(proposal).yearly) }} HBD</span>
													</div>
													<div class="d-flex align-items-center">
														<span class="small me-2" style="min-width: 80px;">Available:</span>
														<div class="progress flex-grow-1 me-2" style="height: 8px;">
															<div class="progress-bar bg-info" role="progressbar" 
																:style="'width: ' + Math.min(((getBudgetImpact(proposal).yearlyInflow - getBudgetImpact(proposal).yearly) / getBudgetImpact(proposal).yearlyInflow) * 100, 100) + '%'">
															</div>
														</div>
														<span class="small">{{ fancyRounding(getBudgetImpact(proposal).yearlyInflow - getBudgetImpact(proposal).yearly) }} HBD</span>
													</div>
												</div>

												<div class="small text-muted">
													<i class="fa-solid fa-info-circle me-1"></i>
													<span v-if="isShortTermProposal(proposal)">
														This short-term proposal would consume 
														{{ ((getBudgetImpact(proposal).daily * Math.max(0, getRemainingDays(proposal))) / getBudgetImpact(proposal).yearlyInflow * 100).toFixed(1) }}% 
														of the annual DAO inflow over its remaining {{ Math.max(0, getRemainingDays(proposal)).toFixed(0) }} days
														({{ fancyRounding(getBudgetImpact(proposal).yearlyInflow) }} HBD/year total inflow including ninja grant & beneficiary rewards)
													</span>
													<span v-else>
														This proposal would consume {{ getBudgetImpact(proposal).percentOfInflow.toFixed(1) }}% 
														of the annual DAO inflow ({{ fancyRounding(getBudgetImpact(proposal).yearlyInflow) }} HBD/year including ninja grant & beneficiary rewards)
													</span>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- No Results -->
					<div v-if="!loading && !error && filteredProposals.length === 0" class="text-center py-5">
						<i class="fa-solid fa-search fa-3x text-muted mb-3"></i>
						<h4 class="text-light">No proposals found</h4>
						<p class="text-muted">Try adjusting your filters or search terms.</p>
					</div>
				</div>
			</div>
		</main>

		<div>
			<foot-vue />
		</div>

		<!-- Blog Detail Modal -->
		<div v-if="blogPost" class="modal fade" id="blogModal" tabindex="-1" aria-labelledby="blogModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-fullscreen">
				<div class="modal-content bg-dark">
					<div class="modal-header border-secondary">
						<h5 class="modal-title text-light" id="blogModalLabel">{{ blogPost.title || 'Blog Post' }}</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body p-0">
						<detail-vue v-if="blogPost" :post="blogPost" :account="account" :modal="false" 
							:voteval="0" :head_block="0" :broca_refill="0" :broca="0" :spk_power="0"
							:contracts="{}" :extendcost="{}" :post_select="postSelect" :has_ipfs="false"
							:TOKEN="'HBD'" :solo="true" :hide="false"
							@tosign="sendIt($event)" @reply="handleReply($event)" @vote="handleVote($event)">
						</detail-vue>
						<div v-else class="text-center py-5">
							<div class="spinner-border text-light" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
							<p class="mt-3 text-light">Loading blog post...</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Proposal Detail Modal -->
		<div v-if="showProposalModal" class="modal fade" id="proposalModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content bg-dark text-light">
					<div class="modal-header border-secondary">
						<h5 class="modal-title">
							<span v-if="selectedProposal">{{ selectedProposal.subject }}</span>
							<span v-else-if="pendingProposalId">Proposal #{{ pendingProposalId }}</span>
							<span v-else>Loading Proposal...</span>
						</h5>
						<button type="button" class="btn-close btn-close-white" 
								@click="dismissModal('proposalModal')"></button>
					</div>
					<div class="modal-body">
						<!-- Loading State -->
						<div v-if="!selectedProposal && pendingProposalId" class="text-center py-5">
							<div class="spinner-border text-light mb-3" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
							<p class="text-light">Fetching proposal details...</p>
						</div>
						
						<!-- Proposal Content -->
						<div v-else-if="selectedProposal">
							<div class="row mb-3">
								<div class="col-md-6">
									<strong class="text-info">Creator:</strong><br>
									<a :href="'/@' + selectedProposal.creator" 
										class="text-light text-decoration-none">
										@{{ selectedProposal.creator }}
									</a>
								</div>
								<div class="col-md-6">
									<strong class="text-info">Status:</strong><br>
									<span v-if="isProposalFunded(selectedProposal)" class="text-success">✓ Funded</span>
									<span v-else-if="getVotePercentage(selectedProposal) >= 100" class="text-warning">Threshold</span>
									<span v-else class="text-danger">{{ getSupportLabel(selectedProposal) }}</span>
								</div>
							</div>
							
							<div class="row mb-3">
								<div class="col-md-6">
									<strong class="text-info">Daily Payment:</strong><br>
									{{ fancyRounding(selectedProposal.daily_pay.amount / 1000) }} HBD
								</div>
								<div class="col-md-6">
									<strong class="text-info">Total Support:</strong><br>
									{{ formatVotes(selectedProposal.total_votes) }} HP
								</div>
							</div>
							
							<div class="row mb-3">
								<div class="col-md-6">
									<strong class="text-info">Start Date:</strong><br>
									{{ formatDate(selectedProposal.start_date) }}
								</div>
								<div class="col-md-6">
									<strong class="text-info">End Date:</strong><br>
									{{ formatDate(selectedProposal.end_date) }}
								</div>
							</div>
							
							<div class="mb-3">
								<strong class="text-info">Receiver:</strong><br>
								<a :href="'/@' + selectedProposal.receiver" 
									class="text-light text-decoration-none">
									@{{ selectedProposal.receiver }}
								</a>
							</div>

							<div class="mb-3">
								<div class="d-flex justify-content-between align-items-center mb-2">
									<strong class="text-info">Support Progress:</strong>
									<button @click="openSupportersModal(selectedProposal)" 
										class="btn btn-outline-info btn-sm">
										<i class="fa-solid fa-users me-1"></i>
										View Supporters
									</button>
								</div>
								<div class="progress mt-2" style="height: 12px;">
									<div class="progress-bar" role="progressbar" 
										:class="isProposalFunded(selectedProposal) ? 'bg-success' : (getVotePercentage(selectedProposal) >= 100 ? 'bg-warning' : 'bg-danger')"
										:style="'width: ' + Math.max(getVotePercentage(selectedProposal), 5) + '%'">
										{{ getVotePercentage(selectedProposal).toFixed(1) }}%
									</div>
								</div>
							</div>
							
							<!-- User Vote Status -->
							<div v-if="account" class="mb-3 p-3 rounded" 
								:class="getUserVote(selectedProposal.id) ? 'bg-success bg-opacity-25' : 'bg-secondary bg-opacity-25'">
								<div v-if="getUserVote(selectedProposal.id)" class="text-success">
									<i class="fa-solid fa-check me-2"></i>You are supporting this proposal
								</div>
								<div v-else class="text-muted">
									<i class="fa-solid fa-minus me-2"></i>You have not voted on this proposal
								</div>
							</div>
						</div>
						
						<!-- Error State -->
						<div v-else class="text-center py-5">
							<i class="fa-solid fa-exclamation-triangle fa-3x text-warning mb-3"></i>
							<h5 class="text-light">Proposal Not Found</h5>
							<p class="text-muted">The requested proposal could not be loaded.</p>
						</div>
					</div>
					<div class="modal-footer border-secondary d-flex justify-content-between">
						<div class="d-flex gap-2">
							<button v-if="selectedProposal" @click="openBlogModal(selectedProposal.creator, selectedProposal.permlink)" 
								class="btn btn-outline-info">
								<i class="fa-solid fa-file-alt me-1"></i>View Blog Post
							</button>
							
							<!-- Analyze Button or Info -->
							<div v-if="selectedProposal">
								<button v-if="selectedProposal.id !== 0 && !isStabilizerProposal(selectedProposal)" 
									@click="selectProposalForAnalysis(selectedProposal); dismissModal('proposalModal')"
									class="btn btn-outline-warning">
									<i class="fa-solid fa-chart-line me-1"></i>
									{{ isProposalFunded(selectedProposal) ? 'Analyze Removing' : 'Analyze Adding' }}
								</button>
								<span v-else-if="selectedProposal.id === 0" class="badge bg-info">
									<i class="fa-solid fa-info-circle me-1"></i>Return Proposal - Sets funding threshold
								</span>
								<span v-else-if="isStabilizerProposal(selectedProposal)" class="badge bg-secondary">
									<i class="fa-solid fa-info-circle me-1"></i>Stabilizer - No net outflow impact
								</span>
							</div>
						</div>
						
						<div v-if="selectedProposal && account && isProposalActive(selectedProposal)">
							<button v-if="!getUserVote(selectedProposal.id)" 
								@click="voteForProposal(selectedProposal.id, true); dismissModal('proposalModal')"
								:disabled="votingProposal === selectedProposal.id"
								class="btn btn-success">
								<span v-if="votingProposal === selectedProposal.id" class="spinner-border spinner-border-sm me-1"></span>
								<i v-else class="fa-solid fa-thumbs-up me-1"></i>
								Support Proposal
							</button>
							<button v-else 
								@click="voteForProposal(selectedProposal.id, false); dismissModal('proposalModal')"
								:disabled="votingProposal === selectedProposal.id"
								class="btn btn-outline-danger">
								<span v-if="votingProposal === selectedProposal.id" class="spinner-border spinner-border-sm me-1"></span>
								<i v-else class="fa-solid fa-thumbs-down me-1"></i>
								Remove Support
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Create Proposal Modal -->
		<div class="modal fade" id="createProposalModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content bg-dark text-light">
					<div class="modal-header border-secondary">
						<h5 class="modal-title">
							<i class="fa-solid fa-plus-circle me-2"></i>Create New Proposal
						</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" 
								@click="closeCreateProposalModal"></button>
					</div>
					<div class="modal-body">
						<form @submit.prevent="createProposal">
							<div class="mb-3">
								<label class="form-label">Subject <span class="text-danger">*</span></label>
								<input 
									v-model="createProposalForm.subject" 
									type="text" 
									class="form-control bg-dark text-light border-secondary"
									placeholder="Brief description of your proposal (max 80 characters)"
									maxlength="80"
									required>
								<div class="form-text">{{ createProposalForm.subject.length }}/80 characters</div>
							</div>

							<div class="row mb-3">
								<div class="col-md-6">
									<label class="form-label">Creator <span class="text-danger">*</span></label>
									<input 
										:value="account" 
										type="text" 
										class="form-control bg-secondary text-light border-secondary"
										disabled>
									<div class="form-text">Your account that will create this proposal</div>
								</div>
								<div class="col-md-6">
									<label class="form-label">Receiver <span class="text-danger">*</span></label>
									<input 
										v-model="createProposalForm.receiver" 
										type="text" 
										class="form-control bg-dark text-light border-secondary"
										placeholder="Account that will receive the funds"
										required>
									<div class="form-text">Account name that will receive payments</div>
								</div>
							</div>

							<div class="row mb-3">
								<div class="col-md-6">
									<label class="form-label">Start Date <span class="text-danger">*</span></label>
									<input 
										v-model="createProposalForm.start_date" 
										type="date" 
										class="form-control bg-dark text-light border-secondary"
										:min="getMinStartDate()"
										required>
									<div class="form-text">When payments should begin</div>
								</div>
								<div class="col-md-6">
									<label class="form-label">End Date <span class="text-danger">*</span></label>
									<input 
										v-model="createProposalForm.end_date" 
										type="date" 
										class="form-control bg-dark text-light border-secondary"
										:min="createProposalForm.start_date"
										required>
									<div class="form-text">When payments should end</div>
								</div>
							</div>

							<div class="row mb-3">
								<div class="col-md-6">
									<label class="form-label">Daily Payment <span class="text-danger">*</span></label>
									<div class="input-group">
										<input 
											v-model.number="createProposalForm.daily_pay" 
											type="number" 
											step="0.001" 
											min="0.001"
											class="form-control bg-dark text-light border-secondary"
											placeholder="0.000"
											required>
										<span class="input-group-text bg-dark text-light border-secondary">HBD</span>
									</div>
									<div class="form-text">Amount paid per day in HBD</div>
								</div>
								<div class="col-md-6">
									<label class="form-label">Permlink <span class="text-danger">*</span></label>
									<div class="input-group">
										<input 
											v-model="createProposalForm.permlink" 
											type="text" 
											class="form-control bg-dark text-light border-secondary"
											:class="createProposalForm.permlinkValid === false ? 'is-invalid' : (createProposalForm.permlinkValid === true ? 'is-valid' : '')"
											placeholder="your-proposal-post-permlink"
											pattern="[a-z0-9-]+"
											title="Only lowercase letters, numbers, and hyphens allowed"
											@blur="validatePermlink(createProposalForm.permlink, account).then(valid => createProposalForm.permlinkValid = valid)"
											required>
										<span v-if="createProposalForm.permlinkValid === true" class="input-group-text bg-success text-white border-secondary">
											<i class="fa-solid fa-check"></i>
										</span>
										<span v-else-if="createProposalForm.permlinkValid === false" class="input-group-text bg-danger text-white border-secondary">
											<i class="fa-solid fa-times"></i>
										</span>
									</div>
									<div class="form-text">
										Permlink of your detailed proposal post
										<span v-if="createProposalForm.permlinkValid === false" class="text-danger d-block">
											<i class="fa-solid fa-exclamation-triangle me-1"></i>
											Post not found at /@{{ account }}/{{ createProposalForm.permlink }}
										</span>
										<span v-else-if="createProposalForm.permlinkValid === true" class="text-success d-block">
											<i class="fa-solid fa-check me-1"></i>
											Post found and validated
										</span>
									</div>
								</div>
							</div>

							<div class="mb-4">
								<h6 class="text-warning">Cost Summary</h6>
								<div v-if="createProposalForm.daily_pay && createProposalForm.start_date && createProposalForm.end_date" 
									class="p-3 rounded bg-secondary bg-opacity-25">
									<div class="row">
										<div class="col-md-3">
											<div class="text-center">
												<div class="small text-muted">Daily Payment</div>
												<div class="h6 text-warning">{{ createProposalForm.daily_pay }} HBD</div>
											</div>
										</div>
										<div class="col-md-3">
											<div class="text-center">
												<div class="small text-muted">Duration</div>
												<div class="h6 text-info">{{ calculateDuration() }} days</div>
											</div>
										</div>
										<div class="col-md-3">
											<div class="text-center">
												<div class="small text-muted">Total Payments</div>
												<div class="h6 text-primary">{{ (createProposalForm.daily_pay * calculateDuration()).toFixed(3) }} HBD</div>
											</div>
										</div>
										<div class="col-md-3">
											<div class="text-center">
												<div class="small text-muted">Creation Fee</div>
												<div class="h6 text-danger">{{ getProposalCreationCost().toFixed(3) }} HBD</div>
											</div>
										</div>
									</div>
									<hr class="border-secondary my-3">
									<div class="text-center">
										<div class="small text-muted">
											One-time fee charged to your account
											<span v-if="calculateDuration() <= 30">(10 HBD base for ≤30 days)</span>
											<span v-else>(10 HBD base + {{ calculateDuration() - 30 }} HBD for extra days)</span>
										</div>
										<div class="h5 text-danger">{{ getProposalCreationCost().toFixed(3) }} HBD</div>
									</div>
								</div>
							</div>

							<div class="alert alert-info">
								<h6 class="alert-heading">
									<i class="fa-solid fa-info-circle me-1"></i>Important Notes
								</h6>
								<ul class="mb-0 small">
									<li><strong>Creation Fee:</strong> 10 HBD for proposals ≤30 days, +1 HBD per additional day beyond 30</li>
									<li><strong>Your Fee:</strong> {{ getProposalCreationCost().toFixed(3) }} HBD will be deducted from your account balance</li>
									<li><strong>Blog Post:</strong> Create a detailed blog post explaining your proposal first</li>
									<li><strong>Community Support:</strong> Gather community feedback before submitting</li>
									<li><strong>Funding Threshold:</strong> Proposals need more votes than the Return Proposal to receive funding</li>
									<li><strong>Permlink Validation:</strong> Ensure your blog post exists before creating the proposal</li>
								</ul>
							</div>
						</form>
					</div>
					<div class="modal-footer border-secondary">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="closeCreateProposalModal">
							Cancel
						</button>
						<button 
							@click="createProposal()" 
							:disabled="!canCreateProposal() || creatingProposal"
							class="btn btn-primary">
							<span v-if="creatingProposal" class="spinner-border spinner-border-sm me-1"></span>
							<i v-else class="fa-solid fa-plus me-1"></i>
							Create Proposal ({{ getProposalCreationCost().toFixed(3) }} HBD)
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Update Proposal Modal -->
		<div class="modal fade" id="updateProposalModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content bg-dark text-light">
					<div class="modal-header border-secondary">
						<h5 class="modal-title">
							<i class="fa-solid fa-edit me-2"></i>Update Proposal #{{ updateProposalForm.id }}
						</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" 
								@click="closeUpdateProposalModal"></button>
					</div>
					<div class="modal-body">
						<form @submit.prevent="updateProposal">
							<div class="mb-3">
								<label class="form-label">Subject <span class="text-danger">*</span></label>
								<input 
									v-model="updateProposalForm.subject" 
									type="text" 
									class="form-control bg-dark text-light border-secondary"
									placeholder="Brief description of your proposal (max 80 characters)"
									maxlength="80"
									required>
								<div class="form-text">{{ updateProposalForm.subject.length }}/80 characters</div>
							</div>

							<div class="row mb-3">
								<div class="col-md-6">
									<label class="form-label">Creator</label>
									<input 
										:value="account" 
										type="text" 
										class="form-control bg-secondary text-light border-secondary"
										disabled>
								</div>
								<div class="col-md-6">
									<label class="form-label">Daily Payment <span class="text-danger">*</span></label>
									<div class="input-group">
										<input 
											v-model.number="updateProposalForm.daily_pay" 
											type="number" 
											step="0.001" 
											min="0.001"
											:max="updateProposalForm.original_daily_pay"
											class="form-control bg-dark text-light border-secondary"
											placeholder="0.000"
											required>
										<span class="input-group-text bg-dark text-light border-secondary">HBD</span>
									</div>
									<div class="form-text">
										You can only lower the daily payment (max: {{ updateProposalForm.original_daily_pay }} HBD)
									</div>
								</div>
							</div>

							<div class="mb-3">
								<label class="form-label">Permlink <span class="text-danger">*</span></label>
								<div class="input-group">
									<input 
										v-model="updateProposalForm.permlink" 
										type="text" 
										class="form-control bg-dark text-light border-secondary"
										:class="updateProposalForm.permlinkValid === false ? 'is-invalid' : (updateProposalForm.permlinkValid === true ? 'is-valid' : '')"
										placeholder="your-updated-proposal-post-permlink"
										pattern="[a-z0-9-]+"
										title="Only lowercase letters, numbers, and hyphens allowed"
										@blur="validatePermlink(updateProposalForm.permlink, account).then(valid => updateProposalForm.permlinkValid = valid)"
										required>
									<span v-if="updateProposalForm.permlinkValid === true" class="input-group-text bg-success text-white border-secondary">
										<i class="fa-solid fa-check"></i>
									</span>
									<span v-else-if="updateProposalForm.permlinkValid === false" class="input-group-text bg-danger text-white border-secondary">
										<i class="fa-solid fa-times"></i>
									</span>
								</div>
								<div class="form-text">
									Permlink of your updated proposal post
									<span v-if="updateProposalForm.permlinkValid === false" class="text-danger d-block">
										<i class="fa-solid fa-exclamation-triangle me-1"></i>
										Post not found at /@{{ account }}/{{ updateProposalForm.permlink }}
									</span>
									<span v-else-if="updateProposalForm.permlinkValid === true" class="text-success d-block">
										<i class="fa-solid fa-check me-1"></i>
										Post found and validated
									</span>
								</div>
							</div>

							<div class="alert alert-warning">
								<h6 class="alert-heading">
									<i class="fa-solid fa-exclamation-triangle me-1"></i>Update Restrictions
								</h6>
								<ul class="mb-0 small">
									<li>You can only <strong>lower</strong> the daily payment, not increase it</li>
									<li>You cannot change the receiver or extend the proposal duration</li>
									<li>You can change the subject and point to a new permlink</li>
									<li>Create a blog post explaining the changes before updating</li>
									<li>Community will need to re-evaluate their support</li>
								</ul>
							</div>
						</form>
					</div>
					<div class="modal-footer border-secondary">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="closeUpdateProposalModal">
							Cancel
						</button>
						<button 
							@click="updateProposal()" 
							:disabled="!canUpdateProposal() || updatingProposal"
							class="btn btn-warning">
							<span v-if="updatingProposal" class="spinner-border spinner-border-sm me-1"></span>
							<i v-else class="fa-solid fa-save me-1"></i>
							Update Proposal
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Proposal Supporters Modal -->
		<div class="modal fade" id="supportersModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content bg-dark text-light">
					<div class="modal-header border-secondary">
						<h5 class="modal-title">
							<i class="fa-solid fa-users me-2"></i>Proposal Supporters
							<span v-if="selectedProposalForSupporters">
								- #{{ selectedProposalForSupporters.proposal_id || selectedProposalForSupporters.id }}
							</span>
						</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" 
								@click="closeSupportersModal"></button>
					</div>
					<div class="modal-body">
						<div v-if="selectedProposalForSupporters" class="mb-4">
							<h6 class="text-info mb-2">{{ selectedProposalForSupporters.subject }}</h6>
							<div class="row">
								<div class="col-md-6">
									<small class="text-muted">Total Support:</small><br>
									<span class="h6 text-warning">{{ formatVotes(selectedProposalForSupporters.total_votes) }} HP</span>
								</div>
								<div class="col-md-6">
									<small class="text-muted">Number of Supporters:</small><br>
									<span class="h6 text-info">{{ proposalSupporters.length }}</span>
								</div>
							</div>
						</div>

						<!-- Loading State -->
						<div v-if="loadingSupporters" class="text-center py-4">
							<div class="spinner-border text-light mb-3" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
							<p class="text-light">Loading supporters...</p>
						</div>

						<!-- Supporters List -->
						<div v-else-if="proposalSupporters.length > 0">
							<h6 class="text-info mb-3">
								<i class="fa-solid fa-list me-2"></i>Supporters List ({{ proposalSupporters.length }})
								<small class="text-muted">- Sorted by Governance HP</small>
							</h6>
							
							<!-- Visual Support Bar -->
							<div class="mb-4">
								<h6 class="text-info mb-3">
									<i class="fa-solid fa-chart-pie me-2"></i>Support Distribution
								</h6>
								<div class="position-relative" style="height: 40px; background: rgba(255,255,255,0.1); border-radius: 8px; overflow: hidden;">
									<!-- Support segments for supporters with >1% -->
									<div v-for="(supporter, index) in getSignificantSupporters()" :key="supporter.voter"
										class="position-absolute h-100 support-segment"
										:style="getSupporterBarStyle(supporter, index)"
										:data-label="'@' + supporter.voter"
										:title="supporter.voter + ': ' + fancyRounding(supporter.governanceHP) + ' HP (' + getSupporterPercentage(supporter) + '%)'">
									</div>
									<!-- Remaining supporters grouped -->
									<div v-if="getRemainingPercentage() > 0"
										class="position-absolute h-100 support-segment bg-secondary"
										:style="'left: ' + getSignificantSupportersPercentage() + '%; width: ' + getRemainingPercentage() + '%; background: linear-gradient(45deg, #6c757d, #495057);'"
										:data-label="(proposalSupporters.length - getSignificantSupporters().length) + ' others'"
										:title="(proposalSupporters.length - getSignificantSupporters().length) + ' other supporters: ' + fancyRounding(getRemainingHP()) + ' HP (' + getRemainingPercentage().toFixed(1) + '%)'">
									</div>
								</div>
								<div class="d-flex justify-content-between mt-2 small text-muted">
									<span>Most significant supporters shown by name (≥1% support)</span>
									<span>{{ proposalSupporters.length }} total supporters</span>
								</div>
							</div>

							<div class="table-responsive">
								<table class="table table-dark table-striped">
									<thead>
										<tr>
											<th scope="col" style="width: 50px;">#</th>
											<th scope="col">Account</th>
											<th scope="col">Own Vests</th>
											<th scope="col">Proxied Vests</th>
											<th scope="col">Total HP</th>
											<th scope="col">% of Total</th>
										</tr>
									</thead>
									<tbody>
										<tr v-for="(supporter, index) in proposalSupporters" :key="supporter.voter">
											<td>{{ index + 1 }}</td>
											<td>
												<a :href="'/@' + supporter.voter" 
													class="text-light text-decoration-none"
													target="_blank">
													@{{ supporter.voter }}
													<i class="fa-solid fa-external-link fa-xs ms-1"></i>
												</a>
											</td>
											<td>
												<span v-if="supporter.account && !supporter.account.proxy" class="text-info">
													{{ formatVests(getOwnVests(supporter.account)) }}
												</span>
												<span v-else class="text-muted">
													{{ supporter.account?.proxy ? 'Proxied' : '0' }}
												</span>
											</td>
											<td>
												<span v-if="supporter.account && getProxiedVests(supporter.account) > 0" class="text-success">
													{{ formatVests(getProxiedVests(supporter.account)) }}
												</span>
												<span v-else class="text-muted">
													0
												</span>
											</td>
											<td>
												<span v-if="supporter.governanceHP > 0" class="text-warning">
													{{ fancyRounding(supporter.governanceHP) }} HP
												</span>
												<span v-else-if="supporter.account?.proxy" class="text-muted">
													Proxied to @{{ supporter.account.proxy }}
												</span>
												<span v-else class="text-muted">
													0 HP
												</span>
											</td>
											<td>
												<span v-if="supporter.governanceHP > 0" class="text-warning">
													{{ getSupporterPercentage(supporter) }}%
												</span>
												<span v-else class="text-muted">
													Proxy vote
												</span>
											</td>
										</tr>
									</tbody>
								</table>
							</div>

							<!-- Summary Stats -->
							<div class="mt-4 p-3 rounded bg-secondary bg-opacity-25">
								<h6 class="text-warning mb-2">
									<i class="fa-solid fa-chart-bar me-2"></i>Support Analysis
								</h6>
								<div class="row">
									<div class="col-md-3">
										<div class="text-center">
											<div class="small text-muted">Top 5 Supporters</div>
											<div class="h6 text-success">
												{{ fancyRounding(proposalSupporters.slice(0, 5).reduce((sum, s) => sum + s.governanceHP, 0)) }} HP
											</div>
											<div class="small text-muted">
												{{ proposalSupporters.length >= 5 ? 
													((proposalSupporters.slice(0, 5).reduce((sum, s) => sum + s.governanceHP, 0) * 1000000) / parseFloat(selectedProposalForSupporters.total_votes) * 100).toFixed(1) : 
													'100' }}%
											</div>
										</div>
									</div>
									<div class="col-md-3">
										<div class="text-center">
											<div class="small text-muted">Median HP</div>
											<div class="h6 text-info">
												{{ proposalSupporters.length > 0 ? 
													fancyRounding(proposalSupporters[Math.floor(proposalSupporters.length / 2)]?.governanceHP || 0) : 0 }} HP
											</div>
										</div>
									</div>
									<div class="col-md-3">
										<div class="text-center">
											<div class="small text-muted">Average HP</div>
											<div class="h6 text-primary">
												{{ proposalSupporters.length > 0 ? 
													fancyRounding(proposalSupporters.reduce((sum, s) => sum + s.governanceHP, 0) / proposalSupporters.length) : 0 }} HP
											</div>
										</div>
									</div>
									<div class="col-md-3">
										<div class="text-center">
											<div class="small text-muted">Whale Supporters</div>
											<div class="h6 text-warning">
												{{ proposalSupporters.filter(s => s.governanceHP >= 100000).length }}
											</div>
											<div class="small text-muted">(≥100K HP)</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- No Supporters State -->
						<div v-else-if="!loadingSupporters" class="text-center py-4">
							<i class="fa-solid fa-users-slash fa-3x text-muted mb-3"></i>
							<h5 class="text-light">No Supporters Found</h5>
							<p class="text-muted">This proposal doesn't have any supporters yet, or there was an error loading the data.</p>
						</div>
					</div>
					<div class="modal-footer border-secondary">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="closeSupportersModal">
							Close
						</button>
						<button v-if="selectedProposalForSupporters && proposalSupporters.length > 0" 
							@click="exportSupportersList()"
							class="btn btn-outline-info">
							<i class="fa-solid fa-download me-1"></i>
							Export List
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Custom Funding Analysis Modal -->
		<div class="modal fade" id="customAnalysisModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content bg-dark text-light">
					<div class="modal-header border-secondary">
						<h5 class="modal-title">
							<i class="fa-solid fa-calculator me-2"></i>Custom Funding Analysis
						</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" 
								@click="closeCustomAnalysisModal"></button>
					</div>
					<div class="modal-body">
						<div class="mb-4">
							<p class="text-muted">
								Analyze the impact of hypothetical funding amounts on the DAO budget and 3-year projections. 
								This helps you understand how different funding levels would affect the treasury over time.
							</p>
						</div>

						<div class="row mb-4">
							<div class="col-md-6">
								<label class="form-label">Analysis Type</label>
								<select v-model="customAnalysisForm.isAddition" class="form-select bg-dark text-light border-secondary">
									<option :value="true">Adding New Funding</option>
									<option :value="false">Removing Existing Funding</option>
								</select>
								<div class="form-text">
									Choose whether to analyze adding new funding or removing existing funding from the budget.
								</div>
							</div>
							<div class="col-md-6">
								<label class="form-label">Funding Period</label>
								<select v-model="customAnalysisForm.period" class="form-select bg-dark text-light border-secondary">
									<option value="daily">Daily Amount</option>
									<option value="monthly">Monthly Amount</option>
									<option value="yearly">Yearly Amount</option>
								</select>
								<div class="form-text">
									Specify whether your amount is per day, month, or year.
								</div>
							</div>
						</div>

						<div class="mb-4">
							<label class="form-label">
								{{ customAnalysisForm.period === 'daily' ? 'Daily' : customAnalysisForm.period === 'monthly' ? 'Monthly' : 'Yearly' }} Amount (HBD)
							</label>
							<div class="input-group">
								<span class="input-group-text bg-dark text-light border-secondary">$</span>
								<input 
									v-model.number="customAnalysisForm.amount" 
									type="number" 
									step="0.01" 
									min="0" 
									class="form-control bg-dark text-light border-secondary"
									:placeholder="'Enter ' + customAnalysisForm.period + ' amount...'"
									@input="calculateCustomAnalysisPreview">
								<span class="input-group-text bg-dark text-light border-secondary">HBD</span>
							</div>
							<div class="form-text">
								{{ customAnalysisForm.isAddition ? 'Amount to add to' : 'Amount to remove from' }} the DAO budget.
							</div>
						</div>

						<!-- Live Preview -->
						<div v-if="customAnalysisForm.amount > 0" class="mb-4">
							<h6 class="text-info mb-3">Impact Preview</h6>
							<div class="row">
								<div class="col-md-4">
									<div class="text-center p-3 rounded" style="background: rgba(255,255,255,0.05);">
										<div class="small text-muted mb-1">Daily Impact</div>
										<div class="h6 text-warning">
											{{ customAnalysisForm.isAddition ? '+' : '-' }}${{ fancyRounding(getCustomAnalysisDailyAmount()) }}
										</div>
									</div>
								</div>
								<div class="col-md-4">
									<div class="text-center p-3 rounded" style="background: rgba(255,255,255,0.05);">
										<div class="small text-muted mb-1">Annual Impact</div>
										<div class="h6 text-warning">
											{{ customAnalysisForm.isAddition ? '+' : '-' }}${{ fancyRounding(getCustomAnalysisDailyAmount() * 365) }}
										</div>
									</div>
								</div>
								<div class="col-md-4">
									<div class="text-center p-3 rounded" style="background: rgba(255,255,255,0.05);">
										<div class="small text-muted mb-1">% of Annual Inflow</div>
										<div class="h6 text-warning">
											{{ ((getCustomAnalysisDailyAmount() * 365) / (daoFund.dailyInflow * 365) * 100).toFixed(2) }}%
										</div>
									</div>
								</div>
							</div>

							<!-- Budget Bar Visualization -->
							<div class="mt-3">
								<div class="small text-muted mb-2">Budget Impact Visualization</div>
								<div class="progress mb-2" style="height: 20px;">
									<div class="progress-bar bg-info" role="progressbar" 
										:style="'width: ' + Math.min((daoFund.dailyInflow * 365) / (daoFund.dailyInflow * 365) * 100, 100) + '%'">
										Current Inflow
									</div>
								</div>
								<div class="progress" style="height: 20px;">
									<div class="progress-bar bg-danger" role="progressbar" 
										:style="'width: ' + Math.min((healthStats.totalFundedOutflowsNoStabilizer * 365) / (daoFund.dailyInflow * 365) * 100, 100) + '%'">
										Current Outflow
									</div>
									<div class="progress-bar" role="progressbar" 
										:class="customAnalysisForm.isAddition ? 'bg-warning' : 'bg-success'"
										:style="'width: ' + Math.min((getCustomAnalysisDailyAmount() * 365) / (daoFund.dailyInflow * 365) * 100, 100) + '%'">
										{{ customAnalysisForm.isAddition ? 'Added' : 'Removed' }}
									</div>
								</div>
							</div>
						</div>

						<!-- Description Field -->
						<div class="mb-4">
							<label class="form-label">Description (Optional)</label>
							<input 
								v-model="customAnalysisForm.description" 
								type="text" 
								class="form-control bg-dark text-light border-secondary"
								placeholder="e.g., 'Developer Fund', 'Marketing Budget', 'Infrastructure Costs'..."
								maxlength="50">
							<div class="form-text">
								Give your analysis a name for easier identification in the chart.
							</div>
						</div>
					</div>
					<div class="modal-footer border-secondary">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="closeCustomAnalysisModal">
							Cancel
						</button>
						<button 
							@click="applyCustomAnalysis()" 
							:disabled="!customAnalysisForm.amount || customAnalysisForm.amount <= 0"
							class="btn btn-primary">
							<i class="fa-solid fa-chart-line me-1"></i>
							Apply to Chart
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
		crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
		integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.1.0/uuidv4.min.js"></script>
	<script>
		const { Marked } = globalThis.marked;
		const { markedHighlight } = globalThis.markedHighlight
		const marked = new Marked(
			markedHighlight({
				emptyLangClass: 'hljs',
				langPrefix: 'hljs language-',
				highlight(code, lang, info) {
					const language = hljs.getLanguage(lang) ? lang : 'plaintext';
					return hljs.highlight(code, { language }).value;
				}
			})
		)
		
		// Add KaTeX support for math rendering
		marked.use(markedKatex({
			throwOnError: false,
			displayMode: true
		}));
		
		marked.use(markedLinkifyIt({
			'@': {
				validate: function (text, pos, self) {
					var tail = text.slice(pos);

					if (!self.re.hive) {
						self.re.hive = new RegExp(
							'^([a-z0-9\.\-]){1,16}(?!_)(?=$|' + self.re.src_ZPCc + ')'
						);
					}
					if (self.re.hive.test(tail)) {
						if (pos >= 2 && tail[pos - 2] === '@') {
							return false;
						}
						return tail.match(self.re.hive)[0].length;
					}
					return 0;
				},
				normalize: function (match) {
					if (match.url.endsWith('.')) {
						match.url = match.url.substring(0, match.url.length - 1);
					}
					match.url = '/@' + match.url.replace(/^@/, '');
				}
			}
		}, {}));
	</script>
</body>

</html>
