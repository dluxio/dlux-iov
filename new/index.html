<!doctype html>
<html lang="en" class="h-100">

<head>
    <title>New DLUX Post</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/img/dlux-icon-192.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DLUX">
    <meta name="theme-color" content="#111222" />
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
    <script src="/js/cryptojs.min.js"></script>
    <!-- Bootstrap -->
    <link href="/css/custom.css" rel="stylesheet" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Space+Grotesk:wght@300..700&display=swap"
        rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <!-- Markdown -->
    <script src="https://unpkg.com/showdown@1.x/dist/showdown.min.js"></script>
    <link rel="stylesheet"
        href="https://cdn.rawgit.com/CoffeePerry/simplemde-theme-bootstrap-dark/master/dist/simplemde-theme-bootstrap-dark.min.css">
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
    <!-- Marked -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/js/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-linkify-it/lib/index.umd.js"></script>
    <!-- Tagify -->
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/hive-tx/dist/hive-tx.min.js"></script>
    <!-- Upload Scripts -->
    <script type="text/javascript" src="/js/onlyhash.js"></script>
    <script src="/js/buffer.js"></script>
    <script src="/js/drag-drop.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <!-- Tiptap Editor Styles -->
    <link href="/css/tiptap-editor.css" rel="stylesheet" />
    <!-- Mobile-First Editor Styles -->
    <link href="/css/mobile-first-editor.css" rel="stylesheet" />
    <!-- DLUX Video Player Styles -->
    <link href="/css/dlux-video-player.css" rel="stylesheet" />
    <script src="/reg-sw.js"></script>
    <script src="/js/diff.js"></script>
    <script>
        var video_page = true
        marked.use(markedLinkifyIt({
            '@': {
                validate: function (text, pos, self) {
                    var tail = text.slice(pos);

                    if (!self.re.hive) {
                        self.re.hive = new RegExp(
                            '^([a-z0-9\.\-]){1,16}(?!_)(?=$|' + self.re.src_ZPCc + ')'
                        );
                    }
                    if (self.re.hive.test(tail)) {
                        if (pos >= 2 && tail[pos - 2] === '@') {
                            return false;
                        }
                        return tail.match(self.re.hive)[0].length;
                    }
                    return 0;
                },
                normalize: function (match) {
                    if (match.url.endsWith('.')) {
                        match.url = match.url.substring(0, match.url.length - 1);
                    }
                    match.url = '/@' + match.url.replace(/^@/, '');
                }
            }
        }, {}));
    </script>
    <!-- FFmpeg WASM - Local files to avoid CORS issues -->
    <script src="/packages/ffmpeg/package/dist/umd/ffmpeg.js"></script>
    <script src="/packages/util/package/dist/umd/index.js"></script>
    <script src="https://unpkg.com/rxjs@^7/dist/bundles/rxjs.umd.min.js"></script>
    <script src="https://github.com/videojs/mux.js/releases/latest/download/mux.js"></script>
    <!-- HLS.js for M3U8 video playback support in Chrome/Firefox -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Vue Controller -->
    <script type="module" src="/js/v3-user.js"></script>
    <!-- 360° Asset Manager Component -->
    <script type="module" src="/js/components/360-asset-manager.js"></script>
    <!-- dApp Manager Components -->
    <script type="module" src="/js/components/dapp-manager.js"></script>
    <script type="module" src="/js/components/remix-dapp-manager.js"></script>
    <style>
        .form-switch.form-switch-lg .form-check-input {
            height: 2rem;
            width: calc(3rem + 0.75rem);
            border-radius: 4rem;
        }

        .accordion {
            --bs-accordion-color: rgb(173, 181, 189);
            --bs-accordion-bg: #212529;
            --bs-accordion-border-color: #495057;
            --bs-accordion-btn-color: #000000;
            --bs-accordion-btn-bg: #2f3133;
            --bs-accordion-btn-icon: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%235C94FE'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
            --bs-accordion-btn-active-icon: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%235C94FE'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
            --bs-accordion-active-color: #5C94FE;
            --bs-accordion-active-bg: #001D4C;
            --bs-accordion-icon-color: #000000;

        }

        .selected-div {
            background: #434851;
            border: 0;
        }

        .hover-div:hover {
            background: #434851;
        }

        .v-enter-active,
        .v-leave-active {
            transition: opacity .0s ease;
        }

        .scroll {
            padding-top: 70px;
            padding-bottom: 20px;
        }

        @media (min-width: 1200px) {
            .scroll {
                overflow-y: scroll;
                height: 100%;

            }
        }

        iframe {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        iframe img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .v-enter-from,
        .v-leave-to {
            opacity: 0;
        }

        [data-bs-toggle="collapse"].collapsed .if-not-collapsed {
            display: none;
        }

        [data-bs-toggle="collapse"]:not(.collapsed) .if-collapsed {
            display: none;
        }

        #img-well {
            border-style: dashed;
            border-radius: 10px;
            border-width: 5px;
            border-color: rgba(255, 255, 255, 0.5);
        }

        #img-well.drag {
            background: #8ED2C9;
        }

        .overlay {
            z-index: 1;
            background-color: transparent;
        }

        .frame-360 {
            position: relative;
            z-index: 0;
        }
        /* Page-specific styles that should remain here */
        
        /* 360° Asset Manager Styles */
        .asset-360-manager .drop-zone {
            border: 2px dashed #495057;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #212529;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .asset-360-manager .drop-zone:hover,
        .asset-360-manager .drop-zone.dragover {
            border-color: #4ECDC4;
            background-color: #1e2329;
        }
        
        .asset-360-manager .drop-zone-content {
            color: #6c757d;
        }
        
        .asset-360-manager .list-group-item.active {
            background-color: #4ECDC4;
            border-color: #4ECDC4;
            color: #000;
        }
        
        .asset-360-manager canvas {
            display: block;
            margin: 0 auto;
            background-color: #000;
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .asset-360-manager .card:hover {
            transform: scale(1.02);
            border-color: #4ECDC4;
        }

        /* dApp Manager Styles */
        .dapp-manager .drop-zone {
            border: 2px dashed #495057;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #212529;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .dapp-manager .drop-zone:hover,
        .dapp-manager .drop-zone.dragover {
            border-color: #4ECDC4;
            background-color: #1e2329;
        }
        
        .dapp-manager .card:hover {
            transform: scale(1.02);
            border-color: #4ECDC4;
        }

        /* ReMix dApp Manager Styles */
        .remix-dapp-manager .drop-zone {
            border: 2px dashed #495057;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #212529;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .remix-dapp-manager .drop-zone:hover,
        .remix-dapp-manager .drop-zone.dragover {
            border-color: #4ECDC4;
            background-color: #1e2329;
        }
        
        .remix-dapp-manager .card:hover {
            transform: scale(1.02);
            border-color: #4ECDC4;
        }

        /* Generic iframe Drop Zone Styles */
        .iframe-drop-zone {
            transition: all 0.3s ease;
        }
        
        .iframe-drop-zone.dragover {
            background-color: rgba(78, 205, 196, 0.1);
            border-radius: 8px;
        }
        
        .iframe-drop-zone.dragover .bg-darker {
            border: 2px dashed #4ECDC4;
            background-color: #1e2329;
        }

        .carousel-slide-content {
            min-height: 300px;
        }
   
    </style>
</head>

<body class="d-flex h-100 align-items-stretch text-white bg-img-gradient">
    <div id="app" class="d-flex flex-column w-100" v-cloak>
        <!-- navbar -->
        <div>
            <nav-vue @login="account = $event;newme($event)" @logout="account = '';removeUser()" @ack="removeOp($event)"
                @refresh="run($event)" :op="toSign" :lapi="lapi" />
        </div>
        <main role="main" class="d-flex flex-column flex-grow-1 padmain">
            <div class="px-1 px-lg-2 px-xl-3">
            <!-- Mobile-First Layout -->
            <div class="">
                <!-- Floating Action Buttons for Mobile -->
                <div class="floating-actions d-lg-none">
                    <button class="btn btn-primary btn-floating" @click="mediaPanelOpen = true">
                        <i class="fa-solid fa-network-wired"></i>
                    </button>
                    <!-- <button class="btn btn-secondary btn-floating" @click="showEnhanceModal = true">
                        <i class="fa-solid fa-sparkles"></i>
                    </button> -->
                </div>
                
                <!-- Main Content Container - Full Width -->
                <div class="">

                    <!-- Simple Two Column Layout -->
                    <div class="row mt-0">
                        <!-- Left Column: All Content (Blog Editor, dApp Builders) -->
                        <div class="col-lg-8 d-flex flex-column">
                            <!-- DLUX Enhancement Hub -->
                            <div class="dlux-enhancement-hub p-0 mb-2">
                                <!-- Carousel View (shown when no builder active) -->
                                <div v-if="!showDappBuilder && !showRemixBuilder && !currentRemixApp" class="carousel-view">
                                      <!-- Bootstrap Carousel -->
                                    <div id="dluxCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-pause="hover" data-bs-wrap="true">
                                        <!-- Indicators -->
                                        <div class="carousel-indicators">
                                            <button type="button" data-bs-target="#dluxCarousel" data-bs-slide-to="0" class="active"></button>
                                            <button type="button" data-bs-target="#dluxCarousel" data-bs-slide-to="1"></button>
                                            <button type="button" data-bs-target="#dluxCarousel" data-bs-slide-to="2"></button>
                                            <button type="button" data-bs-target="#dluxCarousel" data-bs-slide-to="3"></button>
                                            <button type="button" data-bs-target="#dluxCarousel" data-bs-slide-to="4"></button>
                                        </div>
                                        
                                        <!-- Carousel Items -->
                                        <div class="carousel-inner">
                                            <!-- HIVE Blog -->
                                            <div class="carousel-item active">
                                                <div class="carousel-slide-content" style="background: linear-gradient(135deg, #b41e2f 0%, #d43e3e 100%);">
                                                    <div class="carousel-content-wrapper">
                                                        <div class="container-fluid">
                                                            <div class="row align-items-center">
                                                                <div class="col-12 col-md-3 text-center text-md-end">
                                                                    <div class="carousel-icon">
                                                                        <span>📺</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-12 col-md-6 text-center text-md-start">
                                                                    <h3>HIVE Blog</h3>
                                                                    <p>Now Supports IPFS Video Streaming</p>
                                                                </div>
                                                                <div class="col-12 col-md-3 text-center text-md-start">
                                                                    <button class="btn btn-dark" disabled>
                                                                        <i class="fa-solid fa-check me-2"></i>Standard
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 360 Photo Gallery -->
                                            <div class="carousel-item">
                                                <div class="carousel-slide-content" style="background: linear-gradient(135deg, #0BA56F  0%, #239380 100%);">
                                                    <div class="carousel-content-wrapper">
                                                        <div class="container-fluid">
                                                            <div class="row align-items-center">
                                                                <div class="col-12 col-md-3 text-center text-md-end">
                                                                    <div class="carousel-icon">
                                                                        <span>🌐</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-12 col-md-6 text-center text-md-start">
                                                                    <h3>360° Photo Gallery</h3>
                                                                    <p>For Mobile, Desktop, and VR Headsets</p>
                                                                </div>
                                                                <div class="col-12 col-md-3 text-center text-md-start">
                                                                    <button class="btn btn-dark" @click="showRemixForGallery()">
                                                                        <i class="fa-solid fa-plus me-2"></i>Add to Post
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 3Speak Publisher -->
                                            <div class="carousel-item">
                                                <div class="carousel-slide-content" style="background: linear-gradient(135deg, #458998 0%, #5DB9CD 100%);">
                                                    <div class="carousel-content-wrapper">
                                                        <div class="container-fluid">
                                                            <div class="row align-items-center">
                                                                <div class="col-12 col-md-3 text-center text-md-end">
                                                                    <div class="carousel-icon">
                                                                        <span class="">📹</span>
                                                                        <img src="/img/dapps/3speak.png" alt="3Speak" class="img-fluid ms-auto d-none" style="height: 80px;">
                                                                    </div>
                                                                </div>
                                                                <div class="col-12 col-md-6 text-center text-md-start">
                                                                    <h3>3Speak Video</h3>
                                                                    <p>Publish videos to 3Speak.tv</p>
                                                                </div>
                                                                <div class="col-12 col-md-3 text-center text-md-start">
                                                                    <button class="btn btn-dark" @click="show3SpeakPublisher()">
                                                                        <i class="fa-solid fa-plus me-2"></i>Add to Post
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- NAF Playground -->
                                            <div class="carousel-item">
                                                <div class="carousel-slide-content" style="background: linear-gradient(135deg, #d55a5a 0%, #C44569 100%);">
                                                    <div class="carousel-content-wrapper">
                                                        <div class="container-fluid">
                                                            <div class="row align-items-center">
                                                                <div class="col-12 col-md-3 text-center text-md-end">
                                                                    <div class="carousel-icon">
                                                                        <span>🥽</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-12 col-md-6 text-center text-md-start">
                                                                    <h3>NAF Playground</h3>
                                                                    <p>Collaborate and create in WebVR</p>
                                                                </div>
                                                                <div class="col-12 col-md-3 text-center text-md-start">
                                                                    <button class="btn btn-dark" @click="showNAFPreview()">
                                                                        <i class="fa-solid fa-flask me-2"></i>Preview
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            
                                            
                                            <!-- Custom dApp -->
                                            <div class="carousel-item">
                                                <div class="carousel-slide-content" style="background: linear-gradient(135deg, #6178df 0%, #764BA2 100%);">
                                                    <div class="carousel-content-wrapper">
                                                        <div class="container-fluid">
                                                            <div class="row align-items-center">
                                                                <div class="col-12 col-md-3 text-center text-md-end">
                                                                    <div class="carousel-icon">
                                                                        <span>🚀</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-12 col-md-6 text-center text-md-start">
                                                                    <h3>Custom dApp</h3>
                                                                    <p>Build your own dApp with SPK Network</p>
                                                                </div>
                                                                <div class="col-12 col-md-3 text-center text-md-start">
                                                                    <button class="btn btn-dark" @click="showDappBuilder = true; postCustom_json.vrHash = 'dapp'">
                                                                        <i class="fa fa-hammer me-2"></i>Start Building
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Controls -->
                                        <button class="carousel-control-prev" type="button" data-bs-target="#dluxCarousel" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon"></span>
                                            <span class="visually-hidden">Previous</span>
                                        </button>
                                        <button class="carousel-control-next" type="button" data-bs-target="#dluxCarousel" data-bs-slide="next">
                                            <span class="carousel-control-next-icon"></span>
                                            <span class="visually-hidden">Next</span>
                                        </button>
                                    </div>
                                    
                                    </div>

                                    <!-- SPK Network Integration Header -->
                                    <div class="spk-network-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div class="d-flex align-items-center">
                                                <i class="fa-solid fa-puzzle-piece text-primary fs-2 me-2"></i>
                                                <div>
                                                    <h6 class="mb-0">dApps Powered by SPK Network</h6>
                                                    <small class="text-muted">Decentralized storage for all your content</small>
                                                </div>
                                            </div>
                                            <div class="text-end gap-2 d-flex">
                                                <!-- Remix Button State -->
                                                <button v-if="currentRemixApp" class="btn btn-primary rounded-pill bg-card" @click="closeRemixApp()">
                                                   Cancel <i class="fa-solid fa-xmark ms-2"></i>
                                                </button>
                                                <button v-else-if="showRemixBuilder && !showDappBuilder" class="btn btn-primary rounded-pill bg-card" @click="backToCarousel()">
                                                    <i class="fa-solid fa-chevron-left me-2"></i>Back
                                                </button>
                                                <button v-else-if="!showDappBuilder" class="btn btn-primary rounded-pill bg-card" @click="showRemixBuilder = true; postCustom_json.vrHash = 'remix'; loadRemixApps()">
                                                    <i class="fa-solid fa-shuffle me-2 d-none"></i>Browse
                                                </button>

                                                 

                                                <button v-if="!showDappBuilder && !currentRemixApp" class="btn btn-primary rounded-pill bg-card" @click="showDappBuilder = true; postCustom_json.vrHash = 'dapp';">
                                                    <i class="fa-solid fa-plus me-2 d-none"></i>New
                                                </button>

                                                <button v-if="showDappBuilder && !currentRemixApp" class="btn btn-primary rounded-pill bg-card" @click="backToCarousel()">
                                                    Cancel<i class="fa-solid fa-xmark ms-2"></i>
                                                </button>
                                    
                                            </div>
                                        </div>
                                    </div>
                                
                                    <!-- remixable -->
                                    <div v-if="showRemixBuilder && postCustom_json.vrHash == 'remix'">
                                        <div  v-if="!currentRemixApp || showRemixBrowser">
                                        
                                        <!-- ReMix App Browser (collapsed when app is loaded) -->
                                        <div class="builder-view">
                                            <!-- Search and Filters -->

                                            <div class="row g-3 mb-2">
                                                <div class="col-md-6">
                                                    <label class="form-label">Search</label>
                                                    <input type="text" class="form-control" v-model="remixSearch" 
                                                            placeholder="Search by title, author, or tags..." 
                                                            @input="searchRemixApps()">
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">License</label>
                                                    <select class="form-select" v-model="selectedLicense" @change="filterRemixApps()">
                                                        <option value="">All Licenses</option>
                                                        <option value="MIT">MIT</option>
                                                        <option value="GPLv3">GPLv3</option>
                                                        <option value="Apache-2.0">Apache 2.0</option>
                                                        <option value="BSD-3-Clause">BSD 3-Clause</option>
                                                        <option value="CC0-1.0">CC0 (Public Domain)</option>
                                                        <option value="ISC">ISC</option>
                                                        <option value="MPL-2.0">Mozilla Public License 2.0</option>
                                                        <option value="AGPL-3.0">AGPL 3.0</option>
                                                        <option value="Unlicense">Unlicense</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Sort By</label>
                                                    <select class="form-select" v-model="remixSort" @change="sortRemixApps()">
                                                        <option value="newest">Newest First</option>
                                                        <option value="oldest">Oldest First</option>
                                                        <option value="popular">Most Popular</option>
                                                        <option value="author">Author</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <hr />
     
                                            <!-- ReMix Apps Grid -->
                                            <div class="remix-apps-grid">
                                                <!-- Test 360° Gallery Card -->
                                                <div class="remix-app-card card h-100 border-info bg-dark-gradient">
                                                    <!-- Placeholder Image -->
                                                    <div class="card-img-top d-flex align-items-center justify-content-center" 
                                                         style="height: 150px; background: linear-gradient(135deg, #4ECDC4 0%, #44A3AA 100%);">
                                                        <span style="font-size: 4rem;">🌐</span>
                                                    </div>
                                                    <div class="card-body d-flex flex-column">
                                                        <div class="d-flex align-items-center mb-2">
                                                            <h5 class="card-title text-white mb-0">360° Gallery Template</h5>
                                                            <span class="badge bg-info ms-2">Test</span>
                                                        </div>
                                                        <p class="card-text text-muted flex-grow-1">
                                                            A test application for creating 360° photo galleries with navigation
                                                        </p>
                                                        <div class="mt-auto">
                                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                                <small class="text-muted">by @markegiles</small>
                                                                <span class="badge bg-secondary">CC BY-SA 4.0</span>
                                                            </div>
                                                            <button class="btn btn-primary btn-sm w-100" 
                                                                    @click="selectTestRemixApp()">
                                                                <i class="fa-solid fa-shuffle me-2"></i>ReMix This App
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Test NAF Playground Card -->
                                                <div class="remix-app-card card h-100 border-danger bg-dark-gradient">
                                                    <!-- Placeholder Image -->
                                                    <div class="card-img-top d-flex align-items-center justify-content-center" 
                                                         style="height: 150px; background: linear-gradient(135deg, #FF6B6B 0%, #C44569 100%);">
                                                        <span style="font-size: 4rem;">🥽</span>
                                                    </div>
                                                    <div class="card-body d-flex flex-column">
                                                        <div class="d-flex align-items-center mb-2">
                                                            <h5 class="card-title text-white mb-0">NAF Playground</h5>
                                                            <span class="badge bg-danger ms-2">Preview</span>
                                                        </div>
                                                        <p class="card-text text-muted flex-grow-1">
                                                            Build in Networked A-Frame together - collaborative VR/AR experiences
                                                        </p>
                                                        <div class="mt-auto">
                                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                                <small class="text-muted">by @dlux-io</small>
                                                                <span class="badge bg-secondary">MIT</span>
                                                            </div>
                                                            <button class="btn btn-primary btn-sm w-100" 
                                                                    @click="selectTestNAFApp()">
                                                                <i class="fa-solid fa-eye me-2"></i>Preview App
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Test 3Speak Publisher Card -->
                                                <div class="remix-app-card card h-100 border-success bg-dark-gradient">
                                                    <!-- Placeholder Image -->
                                                    <div class="card-img-top d-flex align-items-center justify-content-center" 
                                                         style="height: 150px; background: linear-gradient(135deg, #27AE60 0%, #229954 100%);">
                                                        <span style="font-size: 4rem;">📹</span>
                                                    </div>
                                                    <div class="card-body d-flex flex-column">
                                                        <div class="d-flex align-items-center mb-2">
                                                            <h5 class="card-title text-white mb-0">3Speak Publisher</h5>
                                                            <span class="badge bg-success ms-2">dApp</span>
                                                        </div>
                                                        <p class="card-text text-muted flex-grow-1">
                                                            Publish videos to 3Speak using m3u8 files from SPK Network
                                                        </p>
                                                        <div class="mt-auto">
                                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                                <small class="text-muted">by @dlux-io</small>
                                                                <span class="badge bg-secondary">MIT</span>
                                                            </div>
                                                            <button class="btn btn-primary btn-sm w-100" 
                                                                    @click="show3SpeakPublisher()">
                                                                <i class="fa-solid fa-video me-2"></i>Open Publisher
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Dynamic ReMix Apps -->
                                                <div v-for="app in displayedRemixApps" :key="app.author + '/' + app.permlink" 
                                                        class="remix-app-card card h-100 border-dark bg-dark-gradient">
                                                    <div class="card-body d-flex flex-column">
                                                        <h5 class="card-title text-white">{{ app.json_metadata?.title || app.permlink }}</h5>
                                                        <p class="card-text text-muted flex-grow-1">
                                                            {{ app.json_metadata?.description || 'No description available' }}
                                                        </p>
                                                        <div class="mt-auto">
                                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                                <small class="text-muted">by @{{ app.author }}</small>
                                                                <span v-if="app.json_metadata?.license" class="badge bg-secondary">
                                                                    {{ app.json_metadata.license }}
                                                                </span>
                                                            </div>
                                                            <button class="btn btn-primary btn-sm w-100" 
                                                                    @click="loadRemixApp(app)">
                                                                <i class="fa-solid fa-shuffle me-2"></i>ReMix This App
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Load More Button -->
                                            <div v-if="hasMoreRemixApps" class="text-center mt-4">
                                                <button class="btn btn-outline-primary" @click="loadMoreRemixApps()">
                                                    <i class="fa-solid fa-plus me-2"></i>Load More Apps
                                                </button>
                                            </div>
                                        </div>

                                        

                                    </div>
                                </div>
                            </div>

                            <!-- Active ReMix Application (when app is loaded) -->
                            <div v-if="currentRemixApp">
                                
                                <!-- ReMix Application iframe -->
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <i class="fa-solid fa-cube fa-fw me-2"></i>
                                            ReMix Builder: {{currentRemixApp.title || 'Test Application'}}
                                        </h6>
                                        <div>
                                            <span v-if="currentRemixApp.isTest" class="badge bg-info">Test Mode</span>
                                        </div>
                                    </div>
                                    
                                    <!-- iframe for ReMix application -->
                                    <div style="height: 600px; min-height: 600px;">
                                        <iframe 
                                            ref="remixApplicationIframe"
                                            :src="getRemixIframeSrc()"
                                            width="100%" 
                                            height="100%"
                                            frameborder="0"
                                            style="border-radius: 0 0 8px 8px;"
                                            @load="initRemixApplicationIframe">
                                        </iframe>
                                    </div>
                                </div>
                            </div>
                                
                            <!-- New dApp (replace carousel when active) -->
                            <div v-if="showDappBuilder && postCustom_json.vrHash == 'dapp'" class="builder-view">
                              
                                <dapp-manager
                                    v-if="account"
                                    :account="account"
                                    :spk-api="spkapi"
                                    :initial-custom-json="postCustom_json || {}"
                                    :spk-file-to-add="handleSPKFileForAssets"
                                    :mode="'create'"
                                    @dapp-updated="handleDappUpdated($event)"
                                    @tosign="sendIt($event)">
                                </dapp-manager>
                                <div v-else class="text-center text-muted py-5">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to build original dApps.</p>
                                </div>
                            </div>
                            
                           
                            
                            

                            <!-- Blog Editor (always shown) -->
                            <div class="bg-dark-1 rounded d-flex align-items-center justify-content-center flex-grow-1">
                                <tiptap-editor-modular ref="tiptapEditor" v-if="account" :username="account"
                                    :auth-headers="collaborationAuthHeaders" :file-to-add="fileToAddToPost"
                                    :post-custom-json="postCustom_json" :initial-content="{
                                        title: postTitle,
                                        body: postBody,
                                        tags: postTags,
                                        permlink: postPermlink,
                                        beneficiaries: postBens,
                                        custom_json: postCustom_json
                                    }" @content-changed="handlePostContentChanged" @publish-post="handlePostPublish"
                                    @update:file-to-add="fileToAddToPost = null" @tosign="sendIt($event)"
                                    @request-auth-headers="ensureCollaborationAuth"></tiptap-editor-modular>
                                <div v-else class="text-center text-muted py-5 my-auto">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to create and edit posts.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: SPK Network (Always Visible) -->
                        <div class="col-lg-4 spk-sidebar d-none d-md-block">
                            <div class="spk-panel card bg-dark border-primary">
                                <div class="card-header bg-primary bg-opacity-10">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="mb-0">
                                            <i class="fa-solid fa-network-wired fa-fw me-2"></i>SPK Network
                                        </h5>
                                        <small class="text-success">
                                            <i class="fa-solid fa-circle me-1"></i>Connected
                                        </small>
                                    </div>
                                </div>
                                <div v-if="account" class="vfs-scroll-pass">
                                <div class="card-body p-1">
                                    <!-- Quick Drop Zone -->
                                    <!-- <div class="spk-quick-drop mb-3" 
                                         @drop.prevent="handleUniversalDrop($event)"
                                         @dragover.prevent="$event.currentTarget.classList.add('drag-active')"
                                         @dragleave="$event.currentTarget.classList.remove('drag-active')">
                                        <div class="text-center p-3">
                                            <i class="fa-solid fa-cloud-arrow-up fa-2x mb-2 text-primary"></i>
                                            <p class="mb-0 small">Drop files here or click browse below</p>
                                        </div>
                                    </div> -->
                                    
                                    <!-- File Processing Status -->
                                    <div v-if="detectedFileType" class="file-processing-status mb-3 p-2 bg-dark rounded vfs-scroll-pass">
                                        <div class="d-flex align-items-center">
                                            <i :class="getFileTypeIcon(detectedFileType)" class="me-2"></i>
                                            <div class="flex-grow-1">
                                                <small class="text-muted d-block">Processing</small>
                                                <strong class="small">{{detectedFileName}}</strong>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- SPK Drive Integration -->
                                    <div class="vfs-scroll-pass">
                                        <contract-vue v-if="account" :nodeview="false" :account="account" :mypfp="mypfp"
                                            :protocol="protocol.broca" :stats="spkStats" @tosign="toSign = $event"
                                            :prop_contracts="contracts" :accountinfo="accountinfo" :spkapi="spkapi"
                                            @done="getSapi" :postpage="true" :post-type="'blog'" class="vfs-scroll-pass"
                                            @add-to-post="handleSPKFileForAssets($event)"
                                            :update-url="false"></contract-vue>
                                    </div>
                                </div>
                                </div>
                                <div v-else class="text-center text-muted py-5 px-3 my-auto">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to use SPK Network.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- SPK Network Panel for Mobile (Bottom Sheet) -->
                <div class="media-panel bg-dark d-md-none" :class="{ active: mediaPanelOpen }">
                    <div class="media-panel-header bg-primary">
                        <div class="media-panel-handle" @click="mediaPanelOpen = false"></div>
                        <h5 class="mb-0">
                            <i class="fa-solid fa-network-wired me-2"></i>SPK Network Storage
                        </h5>
                    </div>
                    <div class="media-panel-content bg-card">
                        <!-- Quick Drop Zone -->
                        <div class="d-none spk-quick-drop mb-3" 
                             @drop.prevent="handleUniversalDrop($event)"
                             @dragover.prevent="$event.currentTarget.classList.add('drag-active')"
                             @dragleave="$event.currentTarget.classList.remove('drag-active')">
                            <div class="text-center p-3">
                                <i class="fa-solid fa-cloud-arrow-up fa-2x mb-2 text-primary"></i>
                                <p class="mb-0 small">Drop files here for decentralized storage</p>
                            </div>
                        </div>
                        <!-- Same content as desktop media sidebar -->
                        <!-- Media Tabs -->
                        <!-- <div class="media-tabs">
                            <button class="media-tab" :class="{ active: activeMediaTab === 'files' }" 
                                    @click="activeMediaTab = 'files'">
                                <i class="fa-solid fa-folder me-1"></i>Files
                            </button>
                            <button class="media-tab" :class="{ active: activeMediaTab === 'video' }" 
                                    @click="activeMediaTab = 'video'">
                                <i class="fa-solid fa-video me-1"></i>Video Tools
                            </button>
                        </div> -->

                        <!-- Files Tab -->
                        <div >
                            <contract-vue v-if="account" :nodeview="false" :account="account" :mypfp="mypfp"
                                :protocol="protocol.broca" :stats="spkStats" @tosign="toSign = $event"
                                :prop_contracts="contracts" :accountinfo="accountinfo" :spkapi="spkapi"
                                @done="getSapi" :postpage="true" :post-type="'blog'"
                                @add-to-post="handleSPKFileForAssets($event)"
                                :update-url="false"></contract-vue>
                        </div>

                        <!-- Video Tools Tab -->
                        <!-- <div v-show="activeMediaTab === 'video'">
                            <div class="video-tools-content">
                                <div v-if="!ffmpegReady && !ffmpegSkipped" class="ffmpeg-install-prompt">
                                    <h6><i class="fa-solid fa-triangle-exclamation me-2"></i>FFmpeg Required</h6>
                                    <p>Video transcoding requires FFmpeg to convert videos for streaming.</p>
                                    <button class="btn btn-primary w-100" @click="loadFFmpeg()">
                                        <i class="fa-solid fa-download me-2"></i>Install FFmpeg (~32MB)
                                    </button>
                                    <button class="btn btn-link text-muted w-100" @click="ffmpegSkipped = true">
                                        Skip for now
                                    </button>
                                </div>

                                <div v-else-if="ffmpegReady">
                                    <p class="text-muted">Video transcoding interface will appear here</p>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>

                <!-- Modal Backdrop -->
                <div class="modal-backdrop-custom" :class="{ active: mediaPanelOpen && isMobile }" 
                     @click="mediaPanelOpen = false"></div>

                <!-- Enhancement Modal for Mobile -->
                <!-- <div class="enhancement-modal d-lg-none" :class="{ active: showEnhanceModal }">
                    <div class="enhancement-modal-header">
                        <h5 class="mb-0"><i class="fa-solid fa-sparkles me-2"></i>Enhance Your Blog</h5>
                        <button class="btn btn-link text-white" @click="showEnhanceModal = false">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                    <div class="enhancement-modal-content">
                        <p class="text-muted mb-4">Add interactive apps to your blog post:</p>
                        
                        <div class="dlux-app-grid">
                            <div class="dlux-app-card" @click="addDluxApp('3speak'); showEnhanceModal = false">
                                <i class="fa-solid fa-video"></i>
                                <span>3Speak Video</span>
                            </div>
                            <div class="dlux-app-card" @click="addDluxApp('gallery'); showEnhanceModal = false">
                                <i class="fa-solid fa-images"></i>
                                <span>Photo Gallery</span>
                            </div>
                            <div class="dlux-app-card" @click="addDluxApp('shop'); showEnhanceModal = false">
                                <i class="fa-solid fa-store"></i>
                                <span>Shop</span>
                            </div>
                            <div class="dlux-app-card" @click="addDluxApp('poll'); showEnhanceModal = false">
                                <i class="fa-solid fa-square-poll-vertical"></i>
                                <span>Poll</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary w-100 mt-4" @click="showDappBuilder = true; showEnhanceModal = false">
                            <i class="fa-solid fa-plus me-2"></i>Create Custom App
                        </button>
                    </div>
                </div> -->

            </div>
            <!-- End of Mobile-First Layout -->
                <!-- Old post type selection -->
                <div v-if="false" class="container text-center">
                    <!-- Post Type Information Banners -->
                    <div class="mt-3">
                        <div class="neon-banner pt-3 px-3 pb-2"
                         :class="{'blog': postCustom_json.vrHash == 'blog', 'video': postCustom_json.vrHash == 'video', 'dapp': postCustom_json.vrHash == 'dapp', 'remix': postCustom_json.vrHash == 'remix'}">
                            <!-- Blog Post Content -->
                            <div v-show="postCustom_json.vrHash == 'blog'">
                                <h6 class="justify-content-center"><i class="fa-solid fa-book fa-fw"></i>Blog Post</h6>
                                <p>Blogs are the default post type and support publishing images and markdown
                                    text to the Hive blockchain. Perfect for articles, tutorials, and general content
                                <p>Blogs are the default post type and support publishing markdown
                                    text with links for photos and videos to the Hive blockchain. Perfect for articles, tutorials, and general content
                                    sharing.</p>
                            </div>

                            <!-- Video Content -->
                            <div v-show="postCustom_json.vrHash == 'video'">
                                <h6 class="justify-content-center"><i class="fa-solid fa-film"></i>Video</h6>
                                <p>Decentralized video streaming on SPK Network. Upload your videos to create 
                                    streaming content accessible through the DLUX platform.</p>
                                    streaming content accessible through the DLUX platform as an 
                                    <pop-vue popover-id="streaming-info" title="Streaming Technology Stack">
                                            <template #trigger>
                                                <a class="text-info-50">
                                                    <span class="tooltip-text text-nowrap">M3U8 playlist</span>
                                                    <i class="fa-solid fa-circle-question fa-fw mx-1"></i>
                                                </a>
                                            </template>
                                            <template #content>
                                                <ul class="text-start list-unstyled mt-2">

                                                    <!-- HLS -->
                                                    <li class="border border-0 border-bottom pb-2 mb-2">
                                                        <div>
                                                            <h6 class="hero-subtitle text-white fs-5 mb-1">HLS - HTTP Live
                                                                Streaming
                                                            </h6>
                                                        </div>
                                                        <p>A streaming protocol that breaks video into small segmented files and
                                                            creates an M3U8 playlist supporting multiple resolutions.</p>
                                                    </li>
                                                    <!-- M3U8 -->
                                                    <li class="border border-0 border-bottom pb-2 mb-2">
                                                        <div>
                                                            <h6 class="hero-subtitle text-white fs-5 mb-1">M3U8 - Media Playlist
                                                            </h6>
                                                        </div>
                                                        <p>A playlist format that contains a list of video segments and their
                                                            associated CIDs, allowing for adaptive bitrate streaming.</p>
                                                    </li>
                                                    <!-- CID -->
                                                    <li class="border border-0 border-bottom pb-2 mb-2">
                                                        <div>
                                                            <h6 class="hero-subtitle text-white fs-5 mb-1">CID - Content
                                                                IDentifier
                                                            </h6>
                                                        </div>
                                                        <p>A unique identifier for content in IPFS, generated from the content's
                                                            cryptographic hash to ensure integrity.
                                                        </p>
                                                    </li>
                                                    <!-- IPFS -->
                                                    <li class="border border-0 border-bottom pb-2 mb-2">
                                                        <div>
                                                            <h6 class="hero-subtitle text-white fs-5 mb-1">IPFS - InterPlanetary
                                                                File
                                                                System</h6>
                                                        </div>
                                                        <p>A decentralized, peer-to-peer file storage and sharing system where
                                                            files are distributed across
                                                            multiple nodes.
                                                        </p>
                                                    </li>
                                                    <!-- CDN -->
                                                    <li>
                                                        <div>
                                                            <h6 class="hero-subtitle text-white fs-5 mb-1">CDN - Content
                                                                Delivery
                                                                Network</h6>
                                                        </div>
                                                        <p>A distributed network of servers that uses CIDs to locate and deliver
                                                            IPFS content to users.</p>
                                                    </li>
                                                </ul>
                                            </template>
                                    </pop-vue>
                                </p>
                                    
                            </div>

                            <!-- ReMix dApp Content -->
                            <div v-show="postCustom_json.vrHash == 'remix'">
                                <h6 class="justify-content-center"><i class="fa-solid fa-shuffle fa-fw"></i>ReMix dApp</h6>
                                <p>Create derivative works by remixing existing dApps and templates. Build upon the work of others while
                                    maintaining proper attribution and licensing. A user-friendly dApp builder that loads existing applications for customization.</p>
                            </div>

                            <!-- New dApp Content -->
                            <div v-show="postCustom_json.vrHash == 'dapp'">
                                <h6 class="justify-content-center"><i class="fa-solid fa-mobile-screen-button fa-fw"></i>New
                                    dApp</h6>
                                <p>Build original decentralized applications using any modern web technology you're familiar with.
                                    Deploy your dApp to IPFS and make it accessible through the Hive blockchain. Advanced builder for creating new applications from scratch.</p>
                            </div>

                            <!-- Post Type Selection -->
                            <div class="d-flex justify-content-center mx-auto gap-1 gap-md-2 mt-3">
                                <!-- Blog Post -->
                                <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                    :class="{active: postCustom_json.vrHash == 'blog'}"
                                    @click="postCustom_json.vrHash = 'blog';types='img,vid'">
                                    <i class="fa-solid fa-book fa-fw"></i><span class="d-none d-md-block ms-2">Blog</span>
                                </button>
                                <!-- Video -->
                                <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                    :class="{active: postCustom_json.vrHash == 'video'}"
                                    @click="postCustom_json.vrHash = 'video';types='img,vid'">
                                    <i class="fa-solid fa-film fa-fw"></i><span class="d-none d-md-block ms-2">Video</span>
                                </button>
                                <!-- ReMix dApp -->
                                <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                    :class="{active: postCustom_json.vrHash == 'remix'}"
                                    @click="postCustom_json.vrHash = 'remix';types='ts,obj,img,vid,aud,app,pdf,oth,bin,doc,txt'">
                                    <i class="fa-solid fa-shuffle fa-fw"></i><span
                                        class="d-none d-md-flex ms-2 align-items-center">ReMix<span
                                            class="d-none d-xl-block ms-1">dApp</span></span>
                                </button>
                                <!-- New dApp -->
                                <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                    :class="{active: postCustom_json.vrHash == 'dapp'}"
                                    @click="postCustom_json.vrHash = 'dapp';types='ts,obj,img,vid,aud,app,pdf,oth,bin,doc,txt'">
                                    <i class="fa-solid fa-mobile-screen-button fa-fw"></i><span
                                        class="d-none d-md-flex ms-2 align-items-center"><span
                                            class="d-none d-xl-block me-1">New</span>dApp</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Old Video Transcoding Section - Hidden (content moved to media manager) -->
                <div v-if="false && postCustom_json.vrHash == 'video' && spkapi.pubKey != 'NA'"
                    class="accordion border-white-50 rounded mt-3" id="videoAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#videoTranscode" aria-expanded="true"
                                aria-controls="videoTranscode">
                                <i class="fa-solid fa-film fa-fw me-2"></i>Video Preview
                            </button>
                        </h2>
                        <div id="videoTranscode" class="accordion-collapse collapse show"
                            data-bs-parent="#videoAccordion">
                            <div class="accordion-body">
                                <!-- FFmpeg Status -->
                                <div v-if="!ffmpegReady && !ffmpegSkipped">

                                    <!-- Main Action - install FFmpeg -->
                                    <div class="alert alert-primary mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <!-- alert row -->
                                            <div
                                                class="d-flex flex-grow-1 align-items-center justify-content-center gap-3 flex-wrap">
                                                <!-- alert icon -->
                                                <div class="card d-flex align-items-center justify-content-center rounded-circle fs-2 text-dark-1-muted"
                                                    style="min-width: 120px; min-height: 120px;">
                                                    <i class="fa-solid fa-gears"></i>
                                                </div>
                                                <div class="d-flex flex-grow-1 flex-column">
                                                    <!-- alert title -->
                                                    <h5 class="hero-subtitle fs-4 mb-1 text-center text-lg-start">FFmpeg
                                                        Component</h5>
                                                    <h6 class="lead text-center text-lg-start text-danger fw-bold">
                                                        Status: <strong>Not
                                                            Loaded</strong></h6>
                                                    <p class="text-center text-lg-start">FFmpeg is required to transcode
                                                        video files to M3U8 playlists for streaming.</p>
                                                    <div v-if="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')"
                                                        class="small mt-1">
                                                        {{videoMsg}}
                                                        <!-- FFmpeg Download Progress Bar -->
                                                        <div v-if="ffmpegDownloadProgress > 0" class="mt-2">
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar progress-bar-striped progress-bar-animated"
                                                                    role="progressbar"
                                                                    :style="`width: ${ffmpegDownloadProgress}%`"
                                                                    :aria-valuenow="ffmpegDownloadProgress"
                                                                    aria-valuemin="0" aria-valuemax="100">
                                                                </div>
                                                            </div>
                                                            <div class="text-center mt-1 small text-muted">
                                                                {{ffmpegDownloadProgress}}% - FFmpeg WASM Core (~31MB)
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button class="mx-auto btn btn-primary rounded-pill text-nowrap"
                                                    @click="downloadFFmpeg()" style="min-width: 180px;"
                                                    :disabled="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')"
                                                    class="d-flex w-100 align-items-center">
                                                    <span>
                                                        <span
                                                            v-if="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')">Loading...</span>
                                                        <span v-else>Load FFmpeg</span>
                                                    </span>
                                                    <i class="fa-solid fa-download fa-fw ms-2"></i>
                                                </button>
                                            </div>

                                        </div>
                                    </div>

                                    <!-- Secondary Action - Skip FFmpeg -->
                                    <div class="alert alert-warning">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div
                                                class="d-flex flex-grow-1 align-items-center justify-content-center gap-3 flex-wrap">
                                                <!-- alert icon -->
                                                <div class="card d-flex align-items-center justify-content-center rounded-circle fs-2 text-dark-1-muted"
                                                    style="min-width: 120px; min-height: 120px;">
                                                    <i class="fa-solid fa-exclamation-triangle"></i>
                                                </div>
                                                <div class="d-flex flex-grow-1 flex-column">
                                                    <!-- alert title -->
                                                    <h5 class="hero-subtitle fs-4 mb-1 text-center text-lg-start">Skip
                                                        FFmpeg</h5>
                                                    <p class="text-center text-lg-start" style="max-width: 600px;">You
                                                        can skip FFmpeg and upload your video
                                                        directly. Streaming playback will only be available if your
                                                        video is already in the M3U8 format.</p>
                                                </div>
                                                <button class="btn mx-auto btn-info rounded-pill text-nowrap"
                                                    @click="skipFFmpeg()" style="min-width: 180px;"
                                                    :disabled="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')"><span
                                                        class="d-flex w-100 align-items-center">
                                                        <span>Skip</span>
                                                        <i class="fa-solid fa-arrow-right fa-fw ms-auto"></i></span>
                                                </button>

                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <!-- FFmpeg Error/Alternative -->
                                <div v-if="ffmpegSkipped" class="alert alert-info d-flex align-items-center mb-3"
                                    role="alert">
                                    <i class="fa-solid fa-info-circle fa-fw me-2"></i>
                                    <div class="flex-grow-1">
                                        <strong>Direct Upload Mode:</strong> FFmpeg transcoding is not available. You
                                        can upload pre-processed video files directly.
                                        <div class="small mt-1">
                                            Supported formats: MP4, WebM, AVI, MOV, and most common video formats.
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm ms-2"
                                        @click="ffmpegSkipped = false; ffmpegReady = false; downloadFFmpeg()">
                                        <i class="fa-solid fa-refresh fa-fw me-1"></i>Try FFmpeg Again
                                    </button>
                                </div>

                                <!-- Modern Upload Interface with Video Transcoding -->
                                <div v-if="ffmpegReady || ffmpegSkipped" class="mt-3">
                                    <div class="alert alert-info bg-dark-1 border-info">
                                        <h6 class="mb-1">
                                            <i class="fa-solid fa-upload fa-fw me-1"></i>Upload Files
                                        </h6>
                                        <p class="mb-0 small">
                                            Drop or click to upload any files including videos. Videos will be automatically detected and you'll have the option to transcode them for streaming.
                                        </p>
                                    </div>
                                    <upload-everywhere :account="account" :saccountapi="spkapi" :mypfp="mypfp"
                                        :protocol="protocol" :stats="spkStats" :spkapi="spkapi"
                                        teleportref="#video-upload-area" @tosign="sendIt($event)">
                                    </upload-everywhere>

                                    <!-- Upload area for teleporting -->
                                    <div id="video-upload-area" class="mt-3"></div>
                                </div>

                                    <!-- Upload Everywhere Component for Video Files -->
                                    <div class="alert alert-info bg-dark-1 border-info">
                                        <h6 class="mb-1">
                                            <i class="fa-solid fa-upload fa-fw me-1"></i>Select Files
                                        </h6>
                                        <p class="mb-0 small">
                                            Drop or click to upload transcoded video files, M3U8 playlists, and any
                                            other content.
                                            You can also drop your original video file here for direct upload without
                                            transcoding.
                                        </p>
                                    </div>
                                    <upload-everywhere :account="account" :saccountapi="spkapi" :mypfp="mypfp"
                                        :protocol="protocol" :stats="spkStats" :spkapi="spkapi"
                                        :external-drop="{ files: videoFilesToUpload, targetPath: null }"
                                        teleportref="#video-upload-area" @tosign="sendIt($event)"
                                        @done="handleVideoUploadComplete($event)"
                                        @update:external-drop="videoFilesToUpload = $event.files">
                                    </upload-everywhere>

                                    <!-- Upload area for teleporting -->
                                    <div id="video-upload-area" class="mt-3"></div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Old dApp Asset Management - Hidden (functionality moved to DLUX enhancement hub) -->
                <div v-if="false && showDappBuilder && postCustom_json.vrHash == 'dapp'"
                    class="accordion border-white-50 rounded mt-3" id="dappAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#dappManager" aria-expanded="true"
                                aria-controls="dappManager">
                                <i class="fa-solid fa-mobile-screen-button fa-fw me-2"></i>New dApp Builder
                            </button>
                        </h2>
                        <div id="dappManager" class="accordion-collapse collapse show"
                            data-bs-parent="#dappAccordion">
                            <div class="accordion-body">
                                <!-- Back to Carousel Button -->
                                <div class="text-center mb-3">
                                    <button class="btn btn-secondary btn-sm" @click="backToCarousel()">
                                        <i class="fas fa-chevron-left me-2"></i>Back to Options
                                    </button>
                                </div>
                                <!-- New dApp Manager Component -->
                                <!-- 
                                    Integration Notes:
                                    - This component manages original dApp creation with drag-and-drop organization and custom JSON structure
                                    - Integrates with SPK Drive for file selection and upload
                                    - Outputs dApp structure with licensing and custom JSON data conforming to DLUX API schema
                                    - Includes functionality from former 360° asset manager for immersive content creation
                                    - Data is passed to TipTap editor via @dapp-updated event for blockchain posting
                                    - SPK contract IDs are preserved for proper asset referencing in posts
                                    - Creates original dApp applications that can be remixed by others
                                -->
                                <dapp-manager
                                    v-if="account"
                                    :account="account"
                                    :spk-api="spkapi"
                                    :initial-custom-json="postCustom_json || {}"
                                    :spk-file-to-add="handleSPKFileForAssets"
                                    :mode="'create'"
                                    @dapp-updated="handleDappUpdated($event)"
                                    @tosign="sendIt($event)">
                                </dapp-manager>
                                
                                <!-- Fallback when not logged in -->
                                <div v-else class="text-center text-muted py-5">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to build original dApps.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Old ReMix dApp Management - Hidden (functionality moved to DLUX enhancement hub) -->
                <div v-if="false && showRemixBuilder && postCustom_json.vrHash == 'remix'"
                    class="accordion border-white-50 rounded mt-3" id="remixAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#remixManager" aria-expanded="true"
                                aria-controls="remixManager">
                                <i class="fa-solid fa-shuffle fa-fw me-2"></i>ReMix dApp Builder
                            </button>
                        </h2>
                        <div id="remixManager" class="accordion-collapse collapse show"
                            data-bs-parent="#remixAccordion">
                            <div class="accordion-body">
                                <!-- Back to Carousel Button -->
                                <div class="text-center mb-3">
                                    <button class="btn btn-secondary btn-sm" @click="backToCarousel()">
                                        <i class="fas fa-chevron-left me-2"></i>Back to Options
                                    </button>
                                </div>
                                
                                <!-- ReMix App Browser (collapsed when app is loaded) -->
                                <div v-if="!currentRemixApp || showRemixBrowser">
                                    <!-- Collapse header when app is loaded -->
                                    <div v-if="currentRemixApp" class="mb-3">
                                        <button class="btn btn-sm btn-outline-secondary" @click="showRemixBrowser = false">
                                            <i class="fa-solid fa-chevron-up fa-fw me-1"></i>Hide Browser (Currently remixing: {{currentRemixApp.title || 'Test Application'}})
                                        </button>
                                    </div>
                                    
                                    <!-- Search and Filters -->
                                    <div class="card mb-3">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fa-solid fa-search fa-fw me-2"></i>
                                                Browse ReMix Applications
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label">Search</label>
                                                    <input type="text" class="form-control" v-model="remixSearch" 
                                                           placeholder="Search by title, author, or tags..." 
                                                           @input="searchRemixApps()">
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">License</label>
                                                    <select class="form-select" v-model="selectedLicense" @change="filterRemixApps()">
                                                        <option value="">All Licenses</option>
                                                        <option v-for="license in availableLicenses" :key="license.license" :value="license.license">
                                                            {{license.license}} ({{license.count}})
                                                        </option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Sort By</label>
                                                    <select class="form-select" v-model="sortBy" @change="loadRemixApps()">
                                                        <option value="popular">Most Popular</option>
                                                        <option value="newest">Newest</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <!-- Advanced Options -->
                                            <div class="mt-3">
                                                <button class="btn btn-sm btn-outline-secondary" 
                                                        @click="showAdvancedRemixOptions = !showAdvancedRemixOptions">
                                                    <i class="fa-solid fa-cogs fa-fw me-1"></i>Advanced Options
                                                </button>
                                            </div>
                                            
                                            <!-- Advanced Manual Loading -->
                                            <div v-if="showAdvancedRemixOptions" class="mt-3 p-3 bg-dark-1 rounded">
                                                <h6 class="small text-muted mb-2">Load by CID or URL</h6>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" v-model="manualRemixInput" 
                                                           placeholder="QmReMixCIDExample123456789 or /dlux/@author/permlink">
                                                    <button class="btn btn-outline-primary" @click="loadManualRemix()">
                                                        <i class="fa-solid fa-download fa-fw me-1"></i>Load
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Loading State -->
                                    <div v-if="loadingRemixApps" class="text-center py-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2 text-muted">Loading ReMix applications...</p>
                                    </div>
                                    
                                    <!-- ReMix Apps Grid -->
                                    <div v-else-if="availableRemixApps.length > 0" class="row g-3">
                                        <div v-for="app in availableRemixApps" :key="app.remix_cid" class="col-md-6 col-lg-4">
                                            <div class="card bg-darker h-100 cursor-pointer" @click="selectRemixApp(app)">
                                                <div class="card-body">
                                                    <h6 class="card-title">{{app.title || 'Untitled Application'}}</h6>
                                                    <p class="card-text small text-muted">{{app.description || 'No description available'}}</p>
                                                    <div class="d-flex justify-content-between align-items-end">
                                                        <div class="small">
                                                            <div><strong>@{{app.first_author}}</strong></div>
                                                            <div class="text-muted">{{app.license || 'No license'}}</div>
                                                        </div>
                                                        <div class="text-end small">
                                                            <div class="text-success">{{app.usage_count || 0}} uses</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Test Mode Application -->
                                    <div v-if="!loadingRemixApps" class="row g-3 mt-1">
                                        <div class="col-md-6 col-lg-4">
                                            <div class="card bg-darker h-100 cursor-pointer border-info" @click="selectTestRemixApp()">
                                                <div class="card-body">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <h6 class="card-title mb-0">360° Gallery Template</h6>
                                                        <span class="badge bg-info ms-2 small">Test</span>
                                                    </div>
                                                    <p class="card-text small text-muted">A test application for creating 360° photo galleries with navigation</p>
                                                    <div class="d-flex justify-content-between align-items-end">
                                                        <div class="small">
                                                            <div><strong>@markegiles</strong></div>
                                                            <div class="text-muted">CC BY-SA 4.0</div>
                                                        </div>
                                                        <div class="text-end small">
                                                            <div class="text-info">Test Mode</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- No Results -->
                                    <div v-if="!loadingRemixApps && availableRemixApps.length === 0" class="text-center py-4 text-muted">
                                        <i class="fa-solid fa-search fa-2x mb-3"></i>
                                        <h5>No ReMix Applications Found</h5>
                                        <p>Try adjusting your search criteria or use the test application above.</p>
                                    </div>
                                </div>
                                
                                <!-- Collapsed Browser Button (when app is loaded and browser is hidden) -->
                                <div v-if="currentRemixApp && !showRemixBrowser" class="mb-3">
                                    <button class="btn btn-sm btn-outline-secondary" @click="showRemixBrowser = true">
                                        <i class="fa-solid fa-chevron-down fa-fw me-1"></i>Browse Other Apps (Currently remixing: {{currentRemixApp.title || 'Test Application'}})
                                    </button>
                                </div>
                                
                                <!-- Active ReMix Application (when app is loaded) -->
                                <div v-if="currentRemixApp">
                                    <!-- Status Banner -->
                                    <div class="alert alert-success mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="fa-solid fa-shuffle fa-fw me-2"></i>
                                                <strong>Status:</strong> Remixing "{{currentRemixApp.title || 'Test Application'}}" 
                                                by @{{currentRemixApp.author || currentRemixApp.first_author || 'markegiles'}}
                                            </div>
                                            <button class="btn btn-sm btn-outline-success" @click="closeRemixApp()">
                                                <i class="fa-solid fa-times fa-fw me-1"></i>Change App
                                            </button>
                                        </div>
                                    </div>

                                    <!-- SPK Drive Drop Zone -->
                                    <div class="iframe-drop-zone p-3 mb-3 d-none" 
                                         @drop="handleRemixIframeDrop($event)" 
                                         @dragover.prevent="$event.currentTarget.classList.add('dragover')" 
                                         @dragenter.prevent="$event.currentTarget.classList.add('dragover')"
                                         @dragleave="handleDragLeave($event)">
                                        <div class="d-flex align-items-center bg-darker rounded p-3">
                                            <i class="fa-solid fa-cloud-arrow-up fa-2x text-info me-3"></i>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">Drop Files Here</h6>
                                                <p class="small text-muted mb-0">
                                                    Drag files from SPK Drive or use the context menu "Add to ReMix" option
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ReMix Data Sharing Modal -->
                                    <div class="modal fade" id="remixDataSharingModal" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content bg-dark text-white">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">
                                                        <i class="fa-solid fa-share fa-fw me-2"></i>Share Data with ReMix App
                                                    </h5>
                                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p v-if="remixDataSharingRequest.type === 'share'">
                                                        The ReMix app is requesting access to the following data:
                                                    </p>
                                                    <p v-else-if="remixDataSharingRequest.type === 'update'">
                                                        The ReMix app wants to update the following fields:
                                                    </p>
                                                    <div class="alert alert-info">
                                                        <strong>{{remixDataSharingRequest.field}}</strong>
                                                        <div class="small text-muted mt-1">
                                                            {{getFieldDescription(remixDataSharingRequest.field)}}
                                                        </div>
                                                    </div>
                                                    <div v-if="remixDataSharingRequest.type === 'update' && remixDataSharingRequest.newValue">
                                                        <h6>Proposed changes:</h6>
                                                        <pre class="bg-darker p-2 rounded small">{{JSON.stringify(remixDataSharingRequest.newValue, null, 2)}}</pre>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" @click="denyRemixDataRequest()">
                                                        <i class="fa-solid fa-times fa-fw me-1"></i>Deny
                                                    </button>
                                                    <button type="button" class="btn btn-primary" @click="approveRemixDataRequest()">
                                                        <i class="fa-solid fa-check fa-fw me-1"></i>Allow
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ReMix Application iframe -->
                                    <div class="card mb-4">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h6 class="mb-0">
                                                <i class="fa-solid fa-cube fa-fw me-2"></i>
                                                ReMix Builder: {{currentRemixApp.title || 'Test Application'}}
                                            </h6>
                                            <div>
                                                <button class="btn btn-sm btn-outline-secondary me-2" @click="showRemixDetails = !showRemixDetails">
                                                    <i class="fa-solid fa-info fa-fw"></i>Details
                                                </button>
                                                <span v-if="currentRemixApp.isTest" class="badge bg-info">Test Mode</span>
                                            </div>
                                        </div>
                                        
                                        <!-- ReMix Details (collapsible) -->
                                        <div v-if="showRemixDetails" class="card-body border-bottom">
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <h6>{{currentRemixApp.title || 'Test Application'}}</h6>
                                                    <p class="text-muted small mb-2">{{currentRemixApp.description || 'A test application for creating 360° photo galleries with navigation'}}</p>
                                                    <div class="d-flex gap-3 small">
                                                        <span><strong>Author:</strong> @{{currentRemixApp.author || currentRemixApp.first_author || 'markegiles'}}</span>
                                                        <span><strong>License:</strong> {{currentRemixApp.license || 'CC BY-SA 4.0'}}</span>
                                                        <span v-if="!currentRemixApp.isTest"><strong>Usage:</strong> {{currentRemixApp.usage_count || 0}} derivatives</span>
                                                        <span v-if="currentRemixApp.isTest"><strong>Status:</strong> Test Application</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <div class="small text-muted">
                                                        <div><strong>{{currentRemixApp.isTest ? 'Test' : 'ReMix'}} CID:</strong></div>
                                                        <code class="small">{{currentRemixApp.remix_cid || 'QmTestReMix123456789'}}</code>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- iframe for ReMix application -->
                                        <div style="height: 600px; min-height: 600px;">
                                            <iframe 
                                                ref="remixApplicationIframe"
                                                :src="getRemixIframeSrc()"
                                                width="100%" 
                                                height="100%"
                                                frameborder="0"
                                                style="border-radius: 0 0 8px 8px;"
                                                @load="initRemixApplicationIframe">
                                            </iframe>
                                        </div>
                                    </div>
                                </div>

                                
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Old TipTap Post Editor - Hidden (moved inline to main editor) -->
                <div v-if="false" class="accordion border-white-50 rounded mt-3" id="postEditorAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#postEditor" aria-expanded="true"
                                aria-controls="postEditor">
                                <i class="fa-solid fa-pen-to-square fa-fw me-2"></i>Post Editor
                            </button>
                        </h2>
                        <div id="postEditor" class="accordion-collapse collapse show"
                            data-bs-parent="#postEditorAccordion">
                            <div class="accordion-body p-0">
                                <tiptap-editor-modular ref="tiptapEditor" v-if="account" :username="account"
                                    :auth-headers="collaborationAuthHeaders" :file-to-add="fileToAddToPost"
                                    :post-custom-json="postCustom_json" :initial-content="{
                                        title: postTitle,
                                        body: postBody,
                                        tags: postTags,
                                        permlink: postPermlink,
                                        beneficiaries: postBens,
                                        custom_json: postCustom_json
                                    }" @content-changed="handlePostContentChanged" @publish-post="handlePostPublish"
                                    @update:file-to-add="fileToAddToPost = null" @tosign="sendIt($event)"
                                    @request-auth-headers="ensureCollaborationAuth"></tiptap-editor-modular>
                                <div v-else class="text-center text-muted py-5">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to create and edit posts.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SPK Wallet Modal -->
                <div class="modal modal-xl fade" id="spkWalletModal" tabindex="-1" aria-labelledby="spkWalletModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content bg-dark-90">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="spkWalletModalLabel">SPK Testnet Wallet</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <spk-vue node="false" :account="account" @tosign="sendIt($event);log($event)"
                                    @update-pubkey="updatePubkey" />
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sponsored Contract -->
                <div class="modal fade" id="sponsoredModal" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content bg-darker text-white">
                            <div class="modal-header">
                                <h5 class="modal-title">Sponsored Contracts</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>

                            <div class="modal-body text-start">
                                <div v-for="spon in services">
                                    <button :disabled="spon.channel" @click="petitionForContract(spon.provider)"
                                        class="btn btn-lg text-white btn-outline-primary w-100 border d-flex justify-content-between align-items-center"><span
                                            class="lead">@{{spon.provider}}</span><span
                                            class="small text-warning">{{spon.memo}}</span></button>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                            </div>
                        </div>
                    </div>
                </div>
            </div></main>

    </div>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>function deepLink(link) { }</script>
    <script>
        // Add JavaScript to toggle collapse on <tr> click
        document.addEventListener('DOMContentLoaded', function () {
            var trElements = document.querySelectorAll('.table tbody tr[data-bs-toggle="collapse"]');
            trElements.forEach(function (tr) {
                tr.addEventListener('click', function () {
                    var target = document.querySelector(this.getAttribute('href'));
                    if (target.classList.contains('show')) {
                        target.classList.remove('show');
                        target.setAttribute('aria-expanded', 'false');
                    } else {
                        target.classList.add('show');
                        target.setAttribute('aria-expanded', 'true');
                    }
                });
            });
        });
    </script>
    <script>
        var video_page = true
        
        // Parse URL parameters for remix loading
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                remixAuthor: params.get('remixAuthor'),
                remixPermlink: params.get('remixPermlink')
            };
        }
        
        // Update URL parameters
        function updateUrlParams(remixAuthor, remixPermlink) {
            const url = new URL(window.location);
            if (remixAuthor && remixPermlink) {
                url.searchParams.set('remixAuthor', remixAuthor);
                url.searchParams.set('remixPermlink', remixPermlink);
            } else {
                url.searchParams.delete('remixAuthor');
                url.searchParams.delete('remixPermlink');
            }
            window.history.pushState({}, '', url);
        }
        
        // Global functions for the new consolidated post structure
        window.dappApiHelpers = {
            // Load ReMix application details from DLUX API
            async loadRemixApplicationDetails(remixCid) {
                try {
                    const response = await fetch(`https://data.dlux.io/remix/apps/${remixCid}`);
                    if (response.ok) {
                        const data = await response.json();
                        return data.result;
                    }
                } catch (error) {
                    console.error('Error loading remix application details:', error);
                }
                return null;
            },
            
            // Load popular remix applications
            async loadPopularRemixApplications(limit = 20, offset = 0) {
                try {
                    const response = await fetch(`https://data.dlux.io/remix/apps/popular?a=${limit}&o=${offset}`);
                    if (response.ok) {
                        const data = await response.json();
                        return data.result || [];
                    }
                } catch (error) {
                    console.error('Error loading popular remix applications:', error);
                }
                return [];
            },
            
            // Load newest remix applications
            async loadNewestRemixApplications(limit = 20, offset = 0) {
                try {
                    const response = await fetch(`https://data.dlux.io/remix/apps/newest?a=${limit}&o=${offset}`);
                    if (response.ok) {
                        const data = await response.json();
                        return data.result || [];
                    }
                } catch (error) {
                    console.error('Error loading newest remix applications:', error);
                }
                return [];
            },
            
            // Load available licenses
            async loadRemixLicenses() {
                try {
                    const response = await fetch('https://data.dlux.io/remix/licenses');
                    if (response.ok) {
                        const data = await response.json();
                        return data.result || [];
                    }
                } catch (error) {
                    console.error('Error loading remix licenses:', error);
                }
                return [];
            },
            
            // Load popular tags
            async loadRemixTags() {
                try {
                    const response = await fetch('https://data.dlux.io/remix/tags');
                    if (response.ok) {
                        const data = await response.json();
                        return data.result || [];
                    }
                } catch (error) {
                    console.error('Error loading remix tags:', error);
                }
                return [];
            },
            
            // Search remix applications
            async searchRemixApplications(query, license = '', tag = '', sortBy = 'popular', limit = 20) {
                try {
                    let url = `https://data.dlux.io/remix/${sortBy}?a=${limit}`;
                    if (license) url += `&license=${encodeURIComponent(license)}`;
                    if (tag) url += `&tag=${encodeURIComponent(tag)}`;
                    
                    const response = await fetch(url);
                    if (response.ok) {
                        const data = await response.json();
                        let results = data.result || [];
                        
                        // Client-side search filtering if query provided
                        if (query) {
                            const searchLower = query.toLowerCase();
                            results = results.filter(app => 
                                (app.title && app.title.toLowerCase().includes(searchLower)) ||
                                (app.description && app.description.toLowerCase().includes(searchLower)) ||
                                (app.first_author && app.first_author.toLowerCase().includes(searchLower)) ||
                                (app.tags && app.tags.some(tag => tag.toLowerCase().includes(searchLower)))
                            );
                        }
                        
                        return results;
                    }
                } catch (error) {
                    console.error('Error searching remix applications:', error);
                }
                return [];
            },
            
            // Extract ReMix CID from DLUX post URL
            extractRemixCidFromUrl(url) {
                // Handle both full URLs and short paths
                if (url.includes('/dlux/')) {
                    const match = url.match(/\/dlux\/@([^\/]+)\/([^\/\?#]+)/);
                    if (match) {
                        return { author: match[1], permlink: match[2] };
                    }
                }
                return null;
            },
            
            // Generate proper custom JSON structure based on API schema
            generateCustomJsonForPost(type, data) {
                const customJson = {
                    vrHash: type,
                    ...data
                };
                
                // Ensure required fields based on API schema
                if (type === 'remix' && data.ReMix) {
                    customJson.ReMix = data.ReMix;
                    customJson.originalApp = data.originalApp || null; // For collaborative editing state restoration
                }
                
                if (data.dappCID) {
                    customJson.dappCID = data.dappCID;
                }
                
                if (data.license) {
                    customJson['.lic'] = data.license;
                }
                
                if (data.tags && Array.isArray(data.tags)) {
                    customJson.tags = data.tags;
                }
                
                return customJson;
            },
            
            // Get iframe source for ReMix application
            getRemixIframeSrc(remixCid) {
                // Use IPFS gateway to load the ReMix application
                return `https://ipfs-3speak.b-cdn.net/ipfs/${remixCid}/`;
            }
        };
    </script>
    <!-- DLUX Video Player Bundle (Video.js with HLS quality selector) -->
    <script src="/js/videoPlayer.bundle.js"></script>
    <!-- TipTap Collaboration Bundle (includes Y.js and HocuspocusProvider) -->
    <script src="/js/collaboration.bundle.js?v=20250703-VideoPlayerSeparation"></script>
    <script>
        // Verify that the TipTap collaboration bundle is loaded
        setTimeout(() => {
            if (window.TiptapCollaboration) {
                const bundle = window.TiptapCollaboration.default || window.TiptapCollaboration;

                // Make Y.js globally available for compatibility
                if (bundle?.Y && !window.Y) {
                    window.Y = bundle.Y;
                }
            } else {
                console.error('❌ TiptapCollaboration bundle not loaded - collaboration will not work');
                console.error('Available globals:', Object.keys(window).filter(k => k.includes('Tip') || k.includes('Y') || k.includes('Collab')));
            }
        }, 100);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</body>

</html>