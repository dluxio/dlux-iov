<!doctype html>
<html lang="en" class="h-100">

<head>
    <title>New DLUX Post</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/img/dlux-icon-192.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DLUX">
    <meta name="theme-color" content="#111222" />
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
    <script src="/js/cryptojs.min.js"></script>
    <!-- Bootstrap -->
    <link href="/css/custom.css" rel="stylesheet" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Space+Grotesk:wght@300..700&display=swap"
        rel="stylesheet">
    <script src="https://kit.fontawesome.com/0f693ffc58.js" crossorigin="anonymous"></script>
    <!-- Markdown -->
    <script src="https://unpkg.com/showdown@1.x/dist/showdown.min.js"></script>
    <link rel="stylesheet"
        href="https://cdn.rawgit.com/CoffeePerry/simplemde-theme-bootstrap-dark/master/dist/simplemde-theme-bootstrap-dark.min.css">
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
    <!-- Marked -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/js/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-linkify-it/lib/index.umd.js"></script>
    <!-- Tagify -->
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/hive-tx/dist/hive-tx.min.js"></script>
    <!-- Upload Scripts -->
    <script type="text/javascript" src="/js/onlyhash.js"></script>
    <script src="/js/buffer.js"></script>
    <script src="/js/drag-drop.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <!-- Tiptap Editor Styles -->
    <link href="/css/tiptap-editor.css" rel="stylesheet" />
    <script src="/reg-sw.js"></script>
    <script src="/js/diff.js"></script>
    <script>
        var video_page = true
        marked.use(markedLinkifyIt({
            '@': {
                validate: function (text, pos, self) {
                    var tail = text.slice(pos);

                    if (!self.re.hive) {
                        self.re.hive = new RegExp(
                            '^([a-z0-9\.\-]){1,16}(?!_)(?=$|' + self.re.src_ZPCc + ')'
                        );
                    }
                    if (self.re.hive.test(tail)) {
                        if (pos >= 2 && tail[pos - 2] === '@') {
                            return false;
                        }
                        return tail.match(self.re.hive)[0].length;
                    }
                    return 0;
                },
                normalize: function (match) {
                    if (match.url.endsWith('.')) {
                        match.url = match.url.substring(0, match.url.length - 1);
                    }
                    match.url = '/@' + match.url.replace(/^@/, '');
                }
            }
        }, {}));
    </script>
    <!-- FFmpeg WASM - Local files to avoid CORS issues -->
    <script src="/packages/ffmpeg/package/dist/umd/ffmpeg.js"></script>
    <script src="/packages/util/package/dist/umd/index.js"></script>
    <script src="https://unpkg.com/rxjs@^7/dist/bundles/rxjs.umd.min.js"></script>
    <script src="https://github.com/videojs/mux.js/releases/latest/download/mux.js"></script>
    <!-- HLS.js for M3U8 video playback support in Chrome/Firefox -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- Vue Controller -->
    <script type="module" src="/js/v3-user.js"></script>
    <!-- 360° Asset Manager Component -->
    <script type="module" src="/js/components/360-asset-manager.js"></script>
    <!-- dApp Manager Components -->
    <script type="module" src="/js/components/dapp-manager.js"></script>
    <script type="module" src="/js/components/remix-dapp-manager.js"></script>
    <style>
        .form-switch.form-switch-lg .form-check-input {
            height: 2rem;
            width: calc(3rem + 0.75rem);
            border-radius: 4rem;
        }

        .accordion {
            --bs-accordion-color: rgb(173, 181, 189);
            --bs-accordion-bg: #212529;
            --bs-accordion-border-color: #495057;
            --bs-accordion-btn-color: #000000;
            --bs-accordion-btn-bg: #2f3133;
            --bs-accordion-btn-icon: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%235C94FE'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
            --bs-accordion-btn-active-icon: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%235C94FE'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
            --bs-accordion-active-color: #5C94FE;
            --bs-accordion-active-bg: #001D4C;
            --bs-accordion-icon-color: #000000;

        }

        .selected-div {
            background: #434851;
            border: 0;
        }

        .hover-div:hover {
            background: #434851;
        }

        .v-enter-active,
        .v-leave-active {
            transition: opacity .0s ease;
        }

        .scroll {
            padding-top: 70px;
            padding-bottom: 20px;
        }

        @media (min-width: 1200px) {
            .scroll {
                overflow-y: scroll;
                height: 100%;

            }
        }

        iframe {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        iframe img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .v-enter-from,
        .v-leave-to {
            opacity: 0;
        }

        [data-bs-toggle="collapse"].collapsed .if-not-collapsed {
            display: none;
        }

        [data-bs-toggle="collapse"]:not(.collapsed) .if-collapsed {
            display: none;
        }

        #img-well {
            border-style: dashed;
            border-radius: 10px;
            border-width: 5px;
            border-color: rgba(255, 255, 255, 0.5);
        }

        #img-well.drag {
            background: #8ED2C9;
        }

        .overlay {
            z-index: 1;
            background-color: transparent;
        }

        .frame-360 {
            position: relative;
            z-index: 0;
        }
        /* Page-specific styles that should remain here */
        
        /* 360° Asset Manager Styles */
        .asset-360-manager .drop-zone {
            border: 2px dashed #495057;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #212529;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .asset-360-manager .drop-zone:hover,
        .asset-360-manager .drop-zone.dragover {
            border-color: #4ECDC4;
            background-color: #1e2329;
        }
        
        .asset-360-manager .drop-zone-content {
            color: #6c757d;
        }
        
        .asset-360-manager .list-group-item.active {
            background-color: #4ECDC4;
            border-color: #4ECDC4;
            color: #000;
        }
        
        .asset-360-manager canvas {
            display: block;
            margin: 0 auto;
            background-color: #000;
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .asset-360-manager .card:hover {
            transform: scale(1.02);
            border-color: #4ECDC4;
        }

        /* dApp Manager Styles */
        .dapp-manager .drop-zone {
            border: 2px dashed #495057;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #212529;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .dapp-manager .drop-zone:hover,
        .dapp-manager .drop-zone.dragover {
            border-color: #4ECDC4;
            background-color: #1e2329;
        }
        
        .dapp-manager .card:hover {
            transform: scale(1.02);
            border-color: #4ECDC4;
        }

        /* ReMix dApp Manager Styles */
        .remix-dapp-manager .drop-zone {
            border: 2px dashed #495057;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #212529;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .remix-dapp-manager .drop-zone:hover,
        .remix-dapp-manager .drop-zone.dragover {
            border-color: #4ECDC4;
            background-color: #1e2329;
        }
        
        .remix-dapp-manager .card:hover {
            transform: scale(1.02);
            border-color: #4ECDC4;
        }
   
    </style>
</head>

<body class="d-flex h-100 align-items-stretch text-white bg-img-gradient">
    <div id="app" class="d-flex flex-column w-100" v-cloak>
        <!-- navbar -->
        <div>
            <nav-vue @login="account = $event;newme($event)" @logout="account = '';removeUser()" @ack="removeOp($event)"
                @refresh="run($event)" :op="toSign" :lapi="lapi" />
        </div>
        <main role="main" class="d-flex flex-column flex-grow-1 padmain">


            <div class="container fixed-top navbar-subbar p-0 d-none">
                <div class="navbar-subbar-container">
                    <div class="navbar-subbar-content d-flex flex-wrap gap-1 mt-1">
                        <!-- Post Type Selection -->


                        <!-- blog buttons -->
                        <div class="d-flex justify-content-center ms-auto">
                            <div class="btn-group">
                                <button type="button" class="rounded-start-pill btn btn-secondary px-3"
                                    @click="saveNewToken()"><i class="fa-solid fa-fw fa-floppy-disk me-2"
                                        aria-hidden="true"></i>Save</button>
                                <button type="button" class="btn btn-secondary ms-0 me-0 ps-0 pe-0 disabled"></button>

                                <button type="button" class="rounded-end-pill btn btn-secondary dropdown-toggle px-3"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fa-solid fa-fw fa-folder-open me-2"></i>Open
                                </button>
                                <ul class="dropdown-menu bg-black dropdown-menu-dark">
                                    <li>
                                        <h6 class="dropdown-header">LOCAL STORAGE</h6>
                                    </li>
                                    <li>
                                        <hr class="dropdown-divider mt-0 mb-1">
                                    </li>
                                    <li class="text-center lead mb-2" v-if="!pendingTokens.length">Empty</li>
                                    <li class="d-flex align-items-center justify-content-between"
                                        v-for="pend of pendingTokens">
                                        <a @click="loadNewToken(pend)" class="mx-1 dropdown-item rounded"
                                            role="button">{{pend}}</a>
                                        <a @click="deleteNewToken(pend)" class="mx-1 btn btn-sm btn-outline-danger"
                                            role="button"><i class="fa-solid fa-trash-can fa-fw"></i></a>
                                    </li>
                                </ul>
                                <button type="button" class="btn btn-sm btn-secondary d-none rounded-pill px-2 ms-1"
                                    @click="saveNewToken()"><i class="fa-solid fa-fw fa-flag-checkered me-2"
                                        aria-hidden="true"></i>Publish</button>
                            </div>
                        </div>
                        <!-- 360 toggle buttons -->
                        <div class="d-flex justify-content-center d-none ms-auto"
                            v-if="postCustom_json.vrHash == 'QmcAkxXzczkzUJWrkWNhkJP9FF1L9Lu5sVCrUFtAZvem3k'">
                            <!-- assets button -->
                            <a class="ms-1 no-decoration" data-bs-toggle="collapse" href="#assetMgr">
                                <span class="if-collapsed">
                                    <button class="btn btn-outline-light d-flex align-items-center">
                                        <i class="fa-solid fa-shapes fa-fw force-parent-lh"></i>
                                        <span class="d-none d-md-block ms-1">Assets</span>
                                    </button>
                                </span>
                                <span class="if-not-collapsed">
                                    <button class="btn btn-light d-flex align-items-center">
                                        <i class="fa-solid fa-shapes fa-fw force-parent-lh"></i><span
                                            class="d-none d-md-block ms-1">Assets</span>
                                    </button>
                                </span>
                            </a>
                            <!-- dapp button -->
                            <a class="ms-1 collapsed no-decoration" data-bs-toggle="collapse" href="#dappPreview">
                                <span class="if-collapsed">
                                    <button class="btn btn-outline-light d-flex align-items-center">
                                        <i class="fa-solid fa-up-down-left-right fa-fw force-parent-lh"></i><span
                                            class="d-none d-md-block ms-1">Preview</span>
                                    </button>
                                </span>
                                <span class="if-not-collapsed">
                                    <button class="btn btn-light d-flex align-items-center">
                                        <i class="fa-solid fa-up-down-left-right fa-fw force-parent-lh"></i><span
                                            class="d-none d-md-block ms-1">Preview</span>
                                    </button>
                                </span>
                            </a>
                            <!-- post button -->
                            <a class="ms-1 collapsed no-decoration" data-bs-toggle="collapse" href="#editPost">
                                <span class="if-collapsed">
                                    <button class="btn btn-outline-light d-flex align-items-center">
                                        <i class="fa-solid fa-pen-to-square fa-fw force-parent-lh"></i><span
                                            class="d-none d-md-block ms-1">Description</span>
                                    </button>
                                </span>
                                <span class="if-not-collapsed">
                                    <button class="btn btn-light d-flex align-items-center">
                                        <i class="fa-solid fa-pen-to-square fa-fw force-parent-lh"></i><span
                                            class="d-none d-md-block ms-1">Description</span>
                                    </button>
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container text-center">
                <!-- Post Type Information Banners -->
                <div class="mt-3">
                    <div class="neon-banner pt-3 px-3 pb-2" :class="{
                        'blog': postCustom_json.vrHash == 'blog',
                        'video': postCustom_json.vrHash == 'video',
                        'gallery': postCustom_json.vrHash == 'QmcAkxXzczkzUJWrkWNhkJP9FF1L9Lu5sVCrUFtAZvem3k',
                        'dapp': postCustom_json.vrHash == 'dapp',
                        'remix': postCustom_json.vrHash == 'remix'
                    }">
                        <!-- Blog Post Content -->
                        <div v-show="postCustom_json.vrHash == 'blog'">
                            <h6 class="justify-content-center"><i class="fa-solid fa-book fa-fw"></i>Blog Post</h6>
                            <p>Blogs are the default post type and support publishing image URLs and markdown
                                text to the Hive blockchain. Perfect for articles, tutorials, and general content
                                sharing.</p>
                        </div>

                        <!-- Video Content -->
                        <div v-show="postCustom_json.vrHash == 'video'">
                            <h6 class="justify-content-center"><i class="fa-solid fa-film"></i>Streaming Video</h6>
                            <p>Decentralized video streaming on SPK Network provides multiple quality levels for
                                adaptive playback. To support streaming playback, your file must be converted to an
                                <pop-vue popover-id="streaming-info" title="Streaming Technology Stack">
                                    <template #trigger>
                                        <a class="text-info-50">
                                            <span class="tooltip-text text-nowrap">M3U8 playlist</span>
                                            <i class="fa-solid fa-circle-question fa-fw mx-1"></i>
                                        </a>
                                    </template>
                                    <template #content>
                                        <ul class="text-start list-unstyled mt-2">

                                            <!-- HLS -->
                                            <li class="border border-0 border-bottom pb-2 mb-2">
                                                <div>
                                                    <h6 class="hero-subtitle text-white fs-5 mb-1">HLS - HTTP Live
                                                        Streaming
                                                    </h6>
                                                </div>
                                                <p>A streaming protocol that breaks video into small segmented files and
                                                    creates an M3U8 playlist supporting multiple resolutions.</p>
                                            </li>
                                            <!-- M3U8 -->
                                            <li class="border border-0 border-bottom pb-2 mb-2">
                                                <div>
                                                    <h6 class="hero-subtitle text-white fs-5 mb-1">M3U8 - Media Playlist
                                                    </h6>
                                                </div>
                                                <p>A playlist format that contains a list of video segments and their
                                                    associated CIDs, allowing for adaptive bitrate streaming.</p>
                                            </li>
                                            <!-- CID -->
                                            <li class="border border-0 border-bottom pb-2 mb-2">
                                                <div>
                                                    <h6 class="hero-subtitle text-white fs-5 mb-1">CID - Content
                                                        IDentifier
                                                    </h6>
                                                </div>
                                                <p>A unique identifier for content in IPFS, generated from the content's
                                                    cryptographic hash to ensure integrity.
                                                </p>
                                            </li>
                                            <!-- IPFS -->
                                            <li class="border border-0 border-bottom pb-2 mb-2">
                                                <div>
                                                    <h6 class="hero-subtitle text-white fs-5 mb-1">IPFS - InterPlanetary
                                                        File
                                                        System</h6>
                                                </div>
                                                <p>A decentralized, peer-to-peer file storage and sharing system where
                                                    files are distributed across
                                                    multiple nodes.
                                                </p>
                                            </li>
                                            <!-- CDN -->
                                            <li>
                                                <div>
                                                    <h6 class="hero-subtitle text-white fs-5 mb-1">CDN - Content
                                                        Delivery
                                                        Network</h6>
                                                </div>
                                                <p>A distributed network of servers that uses CIDs to locate and deliver
                                                    IPFS content to users.</p>
                                            </li>
                                        </ul>
                                    </template>
                                </pop-vue>
                            </p>
                        </div>

                        <!-- 360 Image Gallery Content -->
                        <div v-show="postCustom_json.vrHash == 'QmcAkxXzczkzUJWrkWNhkJP9FF1L9Lu5sVCrUFtAZvem3k'">
                            <h6 class="justify-content-center"><i class="fa-solid fa-globe fa-fw"></i>360° Image Gallery
                            </h6>
                            <p>Create immersive 360° experiences using A-Frame to construct user-navigable,
                                headset-enabled
                                virtual environments. Perfect for virtual tours and immersive content.</p>
                        </div>

                        <!-- dApp Content -->
                        <div v-show="postCustom_json.vrHash == 'dapp'">
                            <h6 class="justify-content-center"><i class="fa-solid fa-mobile-screen-button fa-fw"></i>New
                                dApp</span></h6>
                            <p>Build decentralized applications using any modern web technology you're familiar with.
                                Deploy
                                your dApp to IPFS and make it accessible through the Hive blockchain.</p>
                        </div>

                        <!-- ReMix dApp Content -->
                        <div v-show="postCustom_json.vrHash == 'remix'">
                            <h6 class="justify-content-center"><i class="fa-solid fa-shuffle fa-fw"></i>ReMix dApp</h6>
                            <p>Create derivative works by remixing existing dApps. Build upon the work of others while
                                maintaining proper attribution and licensing.</p>
                        </div>

                        <!-- Post Type Selection -->
                        <div class="d-flex justify-content-center mx-auto gap-1 gap-md-2 mt-3">
                            <!-- Blog Post -->
                            <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                :class="{active: postCustom_json.vrHash == 'blog'}"
                                @click="postCustom_json.vrHash = 'blog';types='img,vid'">
                                <i class="fa-solid fa-book fa-fw"></i><span class="d-none d-md-block ms-2">Blog</span>
                            </button>
                            <!-- Video -->
                            <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                :class="{active: postCustom_json.vrHash == 'video'}"
                                @click="postCustom_json.vrHash = 'video';types='img,vid'">
                                <i class="fa-solid fa-film fa-fw"></i><span class="d-none d-md-block ms-2">Video</span>
                            </button>
                            <!-- 360 Image Gallery -->
                            <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                :class="{active: postCustom_json.vrHash == 'QmcAkxXzczkzUJWrkWNhkJP9FF1L9Lu5sVCrUFtAZvem3k'}"
                                @click="postCustom_json.vrHash = 'QmcAkxXzczkzUJWrkWNhkJP9FF1L9Lu5sVCrUFtAZvem3k';types='ts,img'">
                                <i class="fa-solid fa-globe fa-fw"></i><span class="d-none d-md-block ms-2">360°</span>
                            </button>
                            <!-- New dApp -->
                            <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                :class="{active: postCustom_json.vrHash == 'dapp'}"
                                @click="postCustom_json.vrHash = 'dapp';types='ts,obj,img,vid,aud,app,pdf,oth,bin,doc,txt'">
                                <i class="fa-solid fa-mobile-screen-button fa-fw"></i><span
                                    class="d-none d-md-flex ms-2 align-items-center"><span
                                        class="d-none d-xl-block me-1">New</span>dApp</span>
                            </button>
                            <!-- ReMix dApp -->
                            <button class="btn btn-primary bg-card rounded-pill d-flex align-items-center no-wrap"
                                :class="{active: postCustom_json.vrHash == 'remix'}"
                                @click="postCustom_json.vrHash = 'remix';types='ts,obj,img,vid,aud,app,pdf,oth,bin,doc,txt'">
                                <i class="fa-solid fa-shuffle fa-fw"></i><span
                                    class="d-none d-md-flex ms-2 align-items-center">ReMix<span
                                        class="d-none d-xl-block ms-1">dApp</span></span>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <!-- Main Content Container -->
            <div class="container mb-5">
                <!-- SPK Network IPFS Drive -->
                <div class="accordion border-white-50 rounded mt-3" id="accordionExample">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card collapsed hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#ipfsDrive" aria-expanded="false"
                                aria-controls="ipfsDrive">
                                <i class="fa-solid fa-hard-drive fa-fw me-2"></i>Your Files
                            </button>
                        </h2>
                        <div id="ipfsDrive" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                <contract-vue v-if="account" :nodeview="false" :account="account" :mypfp="mypfp"
                                    :protocol="protocol.broca" :stats="spkStats" @tosign="toSign = $event"
                                    :prop_contracts="contracts" :accountinfo="accountinfo" :spkapi="spkapi"
                                    @done="getSapi" :postpage="true" :post-type="postCustom_json.vrHash"
                                    @add-to-post="handleSPKFileForAssets = $event"></contract-vue>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Video Transcoding Section (Only show for video posts) -->
                <div v-if="postCustom_json.vrHash == 'video' && spkapi.pubKey != 'NA'"
                    class="accordion border-white-50 rounded mt-3" id="videoAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#videoTranscode" aria-expanded="true"
                                aria-controls="videoTranscode">
                                <i class="fa-solid fa-film fa-fw me-2"></i>Video Preview
                            </button>
                        </h2>
                        <div id="videoTranscode" class="accordion-collapse collapse show"
                            data-bs-parent="#videoAccordion">
                            <div class="accordion-body">
                                <!-- FFmpeg Status -->
                                <div v-if="!ffmpegReady && !ffmpegSkipped">

                                    <!-- Main Action - install FFmpeg -->
                                    <div class="alert alert-primary mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <!-- alert row -->
                                            <div
                                                class="d-flex flex-grow-1 align-items-center justify-content-center gap-3 flex-wrap">
                                                <!-- alert icon -->
                                                <div class="card d-flex align-items-center justify-content-center rounded-circle fs-2 text-dark-1-muted"
                                                    style="min-width: 120px; min-height: 120px;">
                                                    <i class="fa-solid fa-gears"></i>
                                                </div>
                                                <div class="d-flex flex-grow-1 flex-column">
                                                    <!-- alert title -->
                                                    <h5 class="hero-subtitle fs-4 mb-1 text-center text-lg-start">FFmpeg
                                                        Component</h5>
                                                    <h6 class="lead text-center text-lg-start text-danger fw-bold">
                                                        Status: <strong>Not
                                                            Loaded</strong></h6>
                                                    <p class="text-center text-lg-start">FFmpeg is required to transcode
                                                        video files to M3U8 playlists for streaming.</p>
                                                    <div v-if="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')"
                                                        class="small mt-1">
                                                        {{videoMsg}}
                                                        <!-- FFmpeg Download Progress Bar -->
                                                        <div v-if="ffmpegDownloadProgress > 0" class="mt-2">
                                                            <div class="progress" style="height: 8px;">
                                                                <div class="progress-bar progress-bar-striped progress-bar-animated"
                                                                    role="progressbar"
                                                                    :style="`width: ${ffmpegDownloadProgress}%`"
                                                                    :aria-valuenow="ffmpegDownloadProgress"
                                                                    aria-valuemin="0" aria-valuemax="100">
                                                                </div>
                                                            </div>
                                                            <div class="text-center mt-1 small text-muted">
                                                                {{ffmpegDownloadProgress}}% - FFmpeg WASM Core (~31MB)
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button class="mx-auto btn btn-primary rounded-pill text-nowrap"
                                                    @click="downloadFFmpeg()" style="min-width: 180px;"
                                                    :disabled="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')"
                                                    class="d-flex w-100 align-items-center">
                                                    <span>
                                                        <span
                                                            v-if="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')">Loading...</span>
                                                        <span v-else>Load FFmpeg</span>
                                                    </span>
                                                    <i class="fa-solid fa-download fa-fw ms-2"></i>
                                                </button>
                                            </div>

                                        </div>
                                    </div>

                                    <!-- Secondary Action - Skip FFmpeg -->
                                    <div class="alert alert-warning">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div
                                                class="d-flex flex-grow-1 align-items-center justify-content-center gap-3 flex-wrap">
                                                <!-- alert icon -->
                                                <div class="card d-flex align-items-center justify-content-center rounded-circle fs-2 text-dark-1-muted"
                                                    style="min-width: 120px; min-height: 120px;">
                                                    <i class="fa-solid fa-exclamation-triangle"></i>
                                                </div>
                                                <div class="d-flex flex-grow-1 flex-column">
                                                    <!-- alert title -->
                                                    <h5 class="hero-subtitle fs-4 mb-1 text-center text-lg-start">Skip
                                                        FFmpeg</h5>
                                                    <p class="text-center text-lg-start" style="max-width: 600px;">You
                                                        can skip FFmpeg and upload your video
                                                        directly. Streaming playback will only be available if your
                                                        video is already in the M3U8 format.</p>
                                                </div>
                                                <button class="btn mx-auto btn-info rounded-pill text-nowrap"
                                                    @click="skipFFmpeg()" style="min-width: 180px;"
                                                    :disabled="videoMsg.includes('Loading') || videoMsg.includes('Downloading') || videoMsg.includes('Preparing')"><span
                                                        class="d-flex w-100 align-items-center">
                                                        <span>Skip</span>
                                                        <i class="fa-solid fa-arrow-right fa-fw ms-auto"></i></span>
                                                </button>

                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <!-- FFmpeg Error/Alternative -->
                                <div v-if="ffmpegSkipped" class="alert alert-info d-flex align-items-center mb-3"
                                    role="alert">
                                    <i class="fa-solid fa-info-circle fa-fw me-2"></i>
                                    <div class="flex-grow-1">
                                        <strong>Direct Upload Mode:</strong> FFmpeg transcoding is not available. You
                                        can upload pre-processed video files directly.
                                        <div class="small mt-1">
                                            Supported formats: MP4, WebM, AVI, MOV, and most common video formats.
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm ms-2"
                                        @click="ffmpegSkipped = false; ffmpegReady = false; downloadFFmpeg()">
                                        <i class="fa-solid fa-refresh fa-fw me-1"></i>Try FFmpeg Again
                                    </button>
                                </div>

                                <!-- Video Upload Interface -->
                                <div v-if="ffmpegReady || ffmpegSkipped">
                                    <div class="row">
                                        <div class="col">
                                            <h6><i class="fa-solid fa-video fa-fw me-1"></i>Transcode a Video</h6>
                                            <p class="small text-muted mb-2">
                                                Transcoding creates multiple quality versions of your video, giving
                                                users the best
                                                experience based on their bandwidth while enabling seamless seeking and
                                                smooth playback.
                                            </p>
                                            <input type="file" @change="transcode" accept="video/*"
                                                class="form-control mb-2">
                                            <small class="text-muted">Select a video file to transcode into multiple
                                                resolutions</small>
                                        </div>
                                        <div class="col-md-6" v-if="videosrc">
                                            <h6><i class="fa-solid fa-play fa-fw me-1"></i>Preview</h6>
                                            <video :src="videosrc" controls class="w-100"
                                                style="max-height: 200px;"></video>
                                        </div>
                                    </div>

                                    <!-- Status Message with Progress Bar -->
                                    <div v-if="videoMsg && videoMsg !== 'Drop a video file to transcode'" class="mt-2">
                                        <div class="alert alert-info">
                                            <i class="fa-solid fa-info-circle fa-fw me-1"></i>{{videoMsg}}

                                            <!-- Progress Bar for Transcoding -->
                                            <div v-if="videoMsg.includes('Transcoding:') && videoMsg.includes('%')"
                                                class="mt-2">
                                                <div class="progress" style="height: 8px;">
                                                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                                                        role="progressbar"
                                                        :style="`width: ${extractProgressPercent(videoMsg)}%`"
                                                        :aria-valuenow="extractProgressPercent(videoMsg)"
                                                        aria-valuemin="0" aria-valuemax="100">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Progress Bar for Hashing -->
                                            <div v-if="videoMsg.includes('Hashing') && hashingProgress.total > 0"
                                                class="mt-2">
                                                <div class="progress" style="height: 8px;">
                                                    <div class="progress-bar progress-bar-striped progress-bar-animated bg-info"
                                                        role="progressbar"
                                                        :style="`width: ${hashingProgress.percentage}%`"
                                                        :aria-valuenow="hashingProgress.percentage" aria-valuemin="0"
                                                        aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <small class="text-muted">{{hashingProgress.currentFile}}</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Upload Everywhere Component for Video Files -->
                                    <div class="alert alert-info bg-dark-1 border-info">
                                        <h6 class="mb-1">
                                            <i class="fa-solid fa-upload fa-fw me-1"></i>Upload Files
                                        </h6>
                                        <p class="mb-0 small">
                                            Drop or click to upload transcoded video files, M3U8 playlists, and any
                                            other content.
                                            You can also drop your original video file here for direct upload without
                                            transcoding.
                                        </p>
                                    </div>
                                    <upload-everywhere :account="account" :saccountapi="spkapi" :mypfp="mypfp"
                                        :protocol="protocol" :stats="spkStats" :spkapi="spkapi"
                                        :external-drop="{ files: videoFilesToUpload, targetPath: null }"
                                        teleportref="#video-upload-area" @tosign="sendIt($event)"
                                        @done="handleVideoUploadComplete($event)"
                                        @update:external-drop="videoFilesToUpload = $event.files">
                                    </upload-everywhere>

                                    <!-- Upload area for teleporting -->
                                    <div id="video-upload-area" class="mt-3"></div>

                                    <!-- Video Preview Section -->
                                    <div v-if="transcodePreview.available" class="card mt-3">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fa-solid fa-play fa-fw me-2"></i>
                                                Transcode Preview
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label class="form-label">Select Resolution:</label>
                                                        <select v-model="transcodePreview.selectedResolution"
                                                            @change="onPreviewResolutionChange()" class="form-select">
                                                            <option v-for="res in transcodePreview.resolutions"
                                                                :key="res.resolution" :value="res">
                                                                {{res.resolution}}p
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <video v-if="transcodePreview.videoSrc"
                                                        :src="transcodePreview.videoSrc" controls class="w-100"
                                                        style="max-height: 300px;"
                                                        @loadstart="setupHLSPlayer($event.target)">
                                                        Your browser does not support the video tag.
                                                    </video>
                                                </div>
                                            </div>
                                            <div class="mt-2">
                                                <small class="text-muted">
                                                    <i class="fa-solid fa-info-circle fa-fw me-1"></i>
                                                    This preview shows the transcoded video at the selected resolution.
                                                    Upload to make it available on IPFS.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 360° Asset Management (Only show for 360 posts) -->
                <div v-if="postCustom_json.vrHash == 'QmcAkxXzczkzUJWrkWNhkJP9FF1L9Lu5sVCrUFtAZvem3k'"
                    class="accordion border-white-50 rounded mt-3" id="assetAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#assetManager" aria-expanded="true"
                                aria-controls="assetManager">
                                <i class="fa-solid fa-globe fa-fw me-2"></i>360° Gallery Builder
                            </button>
                        </h2>
                        <div id="assetManager" class="accordion-collapse collapse show"
                            data-bs-parent="#assetAccordion">
                            <div class="accordion-body">
                                <!-- New 360° Asset Manager Component -->
                                <!-- 
                                    Integration Notes:
                                    - This component manages 360° images with canvas-based editing for focus/horizon adjustment
                                    - Integrates with SPK Drive for file selection and upload
                                    - Outputs assets and navigation data according to the 360° gallery format (see readme)
                                    - Data is passed to TipTap editor via @assets-updated event for blockchain posting
                                    - SPK contract IDs are preserved for proper asset referencing in posts
                                -->
                                <asset-360-manager
                                    v-if="account"
                                    :account="account"
                                    :spk-api="spkapi"
                                    :initial-assets="postCustom_json.assets || []"
                                    :initial-navigation="postCustom_json.navigation || []"
                                    :spk-file-to-add="handleSPKFileForAssets"
                                    @assets-updated="handle360AssetsUpdated($event)"
                                    @tosign="sendIt($event)">
                                </asset-360-manager>
                                
                                <!-- Fallback when not logged in -->
                                <div v-else class="text-center text-muted py-5">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to manage 360° gallery assets.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- dApp Asset Management (Only show for dApp posts) -->
                <div v-if="postCustom_json.vrHash == 'dapp'"
                    class="accordion border-white-50 rounded mt-3" id="dappAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#dappManager" aria-expanded="true"
                                aria-controls="dappManager">
                                <i class="fa-solid fa-mobile-screen-button fa-fw me-2"></i>dApp Builder
                            </button>
                        </h2>
                        <div id="dappManager" class="accordion-collapse collapse show"
                            data-bs-parent="#dappAccordion">
                            <div class="accordion-body">
                                <!-- New dApp Manager Component -->
                                <!-- 
                                    Integration Notes:
                                    - This component manages dApp files with drag-and-drop organization and custom JSON structure
                                    - Integrates with SPK Drive for file selection and upload
                                    - Outputs dApp structure with licensing and custom JSON data
                                    - Data is passed to TipTap editor via @dapp-updated event for blockchain posting
                                    - SPK contract IDs are preserved for proper asset referencing in posts
                                -->
                                <dapp-manager
                                    v-if="account"
                                    :account="account"
                                    :spk-api="spkapi"
                                    :initial-custom-json="postCustom_json || {}"
                                    :spk-file-to-add="handleSPKFileForAssets"
                                    @dapp-updated="handleDappUpdated($event)"
                                    @tosign="sendIt($event)">
                                </dapp-manager>
                                
                                <!-- Fallback when not logged in -->
                                <div v-else class="text-center text-muted py-5">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to build dApps.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ReMix dApp Management (Only show for remix posts) -->
                <div v-if="postCustom_json.vrHash == 'remix'"
                    class="accordion border-white-50 rounded mt-3" id="remixAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#remixManager" aria-expanded="true"
                                aria-controls="remixManager">
                                <i class="fa-solid fa-shuffle fa-fw me-2"></i>ReMix dApp Builder
                            </button>
                        </h2>
                        <div id="remixManager" class="accordion-collapse collapse show"
                            data-bs-parent="#remixAccordion">
                            <div class="accordion-body">
                                <!-- ReMix dApp Manager Component -->
                                <!-- 
                                    Integration Notes:
                                    - This component manages remixing of existing dApps with proper licensing attribution
                                    - Integrates with SPK Drive for file selection and upload
                                    - Outputs remix structure with base dApp attribution and licensing trees
                                    - Data is passed to TipTap editor via @remix-updated event for blockchain posting
                                    - SPK contract IDs are preserved for proper asset referencing in posts
                                -->
                                <remix-dapp-manager
                                    v-if="account"
                                    :account="account"
                                    :spk-api="spkapi"
                                    :initial-custom-json="postCustom_json || {}"
                                    :spk-file-to-add="handleSPKFileForAssets"
                                    @remix-updated="handleRemixUpdated($event)"
                                    @tosign="sendIt($event)">
                                </remix-dapp-manager>
                                
                                <!-- Fallback when not logged in -->
                                <div v-else class="text-center text-muted py-5">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to remix dApps.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>




                <!-- TipTap Post Editor -->
                <div class="accordion border-white-50 rounded mt-3" id="postEditorAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#postEditor" aria-expanded="true"
                                aria-controls="postEditor">
                                <i class="fa-solid fa-pen-to-square fa-fw me-2"></i>Post Editor
                            </button>
                        </h2>
                        <div id="postEditor" class="accordion-collapse collapse show"
                            data-bs-parent="#postEditorAccordion">
                            <div class="accordion-body p-0">
                                <tiptap-editor-with-file-menu v-if="account" :username="account"
                                    :auth-headers="collaborationAuthHeaders" :file-to-add="fileToAddToPost"
                                    :post-custom-json="postCustom_json" :initial-content="{
                                        title: postTitle,
                                        body: postBody,
                                        tags: postTags,
                                        permlink: postPermlink,
                                        beneficiaries: postBens,
                                        custom_json: postCustom_json
                                    }" @content-changed="handlePostContentChanged" @publish-post="handlePostPublish"
                                    @update:file-to-add="fileToAddToPost = null" @tosign="sendIt($event)"
                                    @request-auth-headers="ensureCollaborationAuth"></tiptap-editor-with-file-menu>
                                <div v-else class="text-center text-muted py-5">
                                    <i class="fas fa-sign-in-alt fa-3x mb-3"></i>
                                    <h5>Please Log In</h5>
                                    <p>You need to log in to create and edit posts.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SPK Wallet Modal -->
                <div class="modal modal-xl fade" id="spkWalletModal" tabindex="-1" aria-labelledby="spkWalletModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content bg-dark-90">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="spkWalletModalLabel">SPK Testnet Wallet</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <spk-vue node="false" :account="account" @tosign="sendIt($event);log($event)"
                                    @update-pubkey="updatePubkey" />
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sponsored Contract -->
                <div class="modal fade" id="sponsoredModal" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content bg-darker text-white">
                            <div class="modal-header">
                                <h5 class="modal-title">Sponsored Contracts</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>

                            <div class="modal-body text-start">
                                <div v-for="spon in services">
                                    <button :disabled="spon.channel" @click="petitionForContract(spon.provider)"
                                        class="btn btn-lg text-white btn-outline-primary w-100 border d-flex justify-content-between align-items-center"><span
                                            class="lead">@{{spon.provider}}</span><span
                                            class="small text-warning">{{spon.memo}}</span></button>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!-- Footer -->
        <foot-vue />
    </div>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>function deepLink(link) { }</script>
    <script>
        // Add JavaScript to toggle collapse on <tr> click
        document.addEventListener('DOMContentLoaded', function () {
            var trElements = document.querySelectorAll('.table tbody tr[data-bs-toggle="collapse"]');
            trElements.forEach(function (tr) {
                tr.addEventListener('click', function () {
                    var target = document.querySelector(this.getAttribute('href'));
                    if (target.classList.contains('show')) {
                        target.classList.remove('show');
                        target.setAttribute('aria-expanded', 'false');
                    } else {
                        target.classList.add('show');
                        target.setAttribute('aria-expanded', 'true');
                    }
                });
            });
        });
    </script>
    <script>
        var video_page = true
    </script>
    <!-- TipTap Collaboration Bundle (includes Y.js and HocuspocusProvider) -->
    <script src="/js/tiptap-collaboration.bundle.js"></script>
    <script>
        // Verify that the TipTap collaboration bundle is loaded
        setTimeout(() => {
            console.log('TiptapCollaboration bundle available:', !!window.TiptapCollaboration);

            if (window.TiptapCollaboration) {
                const bundle = window.TiptapCollaboration.default || window.TiptapCollaboration;
                console.log('TipTap bundle contents:', Object.keys(bundle || {}));
                console.log('Editor available:', typeof bundle?.Editor);
                console.log('StarterKit available:', typeof bundle?.StarterKit);
                console.log('Y.js available:', typeof bundle?.Y);
                console.log('HocuspocusProvider available:', typeof bundle?.HocuspocusProvider);
                console.log('Collaboration extension available:', typeof bundle?.Collaboration);
                console.log('CollaborationCursor available:', typeof bundle?.CollaborationCursor);
                console.log('TaskList extension available:', typeof bundle?.TaskList);
                console.log('TaskItem extension available:', typeof bundle?.TaskItem);

                // Make Y.js globally available for compatibility
                if (bundle?.Y && !window.Y) {
                    window.Y = bundle.Y;
                    console.log('✅ Y.js made available globally from TipTap bundle');
                }

                console.log('✅ TipTap collaboration bundle loaded successfully');
            } else {
                console.error('❌ TiptapCollaboration bundle not loaded - collaboration will not work');
                console.error('Available globals:', Object.keys(window).filter(k => k.includes('Tip') || k.includes('Y') || k.includes('Collab')));
            }
        }, 100);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</body>

</html>