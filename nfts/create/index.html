<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
    <title>DLUX - Create NFT</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/img/dlux-icon-192.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DLUX">
    <meta name="theme-color" content="#111222" />
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
    <!-- Bootstrap -->
    <link href="/css/custom.css" rel="stylesheet" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Space+Grotesk:wght@300..700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/ipfs-http-client@29.1.1/dist/index.min.js"></script>
    <!-- Font Awesome -->
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://bundle.run/buffer@5.2.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script type="module" src="/js/v3-nfts.js"></script>
    <script src="/reg-sw.js"></script>
    
    <style>
        .drop-zone {
            border: 2px dashed #495057;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #212529;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .drop-zone:hover,
        .drop-zone.dragover {
            border-color: #0d6efd;
            background-color: #1e2329;
        }
        
        .drop-zone-content {
            color: #6c757d;
        }
        
        .trait-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .trait-item {
            background: #343a40;
            border-radius: 8px;
            padding: 0.5rem;
            position: relative;
        }
        
        .trait-preview {
            position: relative;
            width: 100%;
            height: 120px;
            border-radius: 4px;
            overflow: hidden;
            background: #495057;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .trait-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .trait-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .rarity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }
        
        .rarity-controls .form-range {
            flex: 1;
        }
        
        .generation-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .preview-item {
            background: #343a40;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .preview-nft {
            width: 100%;
            height: 200px;
            border-radius: 4px;
            background: #495057;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .preview-layers {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .preview-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        .upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            z-index: 10;
        }
        
        .trait-status {
            position: absolute;
            top: 4px;
            left: 4px;
            z-index: 5;
        }
    </style>
</head>

<body id="explore" class="bg-dark-2">
    <div id="app">
        <div>
            <nav-vue @login="setValue('account', $event);getTokenUser($event);getHiveUser($event);getUserNFTs()"
                @logout="setValue('account', '');removeUser()" @ack="removeOp($event)" @refresh="run($event)"
                :op="toSign" :lapi="lapi" />
        </div>
        <main role="main" class="mb-auto text-white bg-color" style="padding-top: 94px;">
            <div class="container  pt-3">
                <div class="alert alert-danger" role="alert">
                    This page is under construction.
                </div>
                
                <!-- SPK Network IPFS Drive -->
                <div class="accordion border-white-50 rounded mt-3" id="filesAccordion">
                    <div class="accordion-item bg-img-none bg-dark-1">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-card collapsed hero-subtitle fs-3 p-3" type="button"
                                data-bs-toggle="collapse" data-bs-target="#ipfsDrive" aria-expanded="false"
                                aria-controls="ipfsDrive">
                                <i class="fa-solid fa-hard-drive fa-fw me-2"></i>Your Files
                            </button>
                        </h2>
                        <div id="ipfsDrive" class="accordion-collapse collapse" data-bs-parent="#filesAccordion">
                            <div class="accordion-body">
                                <contract-vue v-if="account" :nodeview="false" :account="account" :mypfp="mypfp"
                                    :protocol="protocol.broca" :stats="spkStats" @tosign="toSign = $event"
                                    :prop_contracts="contracts" :accountinfo="accountinfo" :spkapi="spkapi"
                                    @done="getSapi" :nftpage="true"
                                    :file-slots="{
                                        'content': { label: 'Set as NFT Content', icon: 'fa-solid fa-file', description: 'Main content file for your NFT (image, HTML, etc.)' },
                                        'logo': { label: 'Set as Logo Image', icon: 'fa-solid fa-id-badge', description: '350x350 recommended' },
                                        'featured': { label: 'Set as Featured Image', icon: 'fa-solid fa-star', description: '600x400 recommended' },
                                        'banner': { label: 'Set as Banner Image', icon: 'fa-solid fa-image', description: '1400x400 recommended' },
                                        'wrapped': { label: 'Set as Wrapped Image', icon: 'fa-solid fa-gift', description: '350x350 recommended - shown before minting' }
                                    }"
                                    @set-content="handleFileSlot('content', $event)"
                                    @set-logo="handleFileSlot('logo', $event)"
                                    @set-featured="handleFileSlot('featured', $event)"
                                    @set-banner="handleFileSlot('banner', $event)"
                                    @set-wrapped="handleFileSlot('wrapped', $event)"
                                    @add-to-post="handleFileSlot('general', $event)"></contract-vue>
                            </div>
                        </div>
                    </div>
                </div>

                <nav class="navbar navbar-dark navbar-expand-lg nav-blur">
                    <div class="">
                        <ul class="nav nav-tabs navbar" id="nav-tab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="nav-generate-tab" data-bs-toggle="tab"
                                    href="#nav-generate" role="tab" aria-controls="nav-generate" aria-selected="true">1.
                                    Script</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " id="nav-proof-tab" data-bs-toggle="tab" href="#nav-proof"
                                    role="tab" aria-controls="nav-proof" aria-selected="false">2. Preview</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="nav-mint-tab" data-bs-toggle="tab" href="#nav-mint" role="tab"
                                    aria-controls="nav-mint" aria-selected="false">3.
                                    Mint</a>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="tab-content mb-4" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-generate" role="tabpanel"
                        aria-labelledby="nav-generate-tab">
                        <!-- NEW NFT Panel -->
                        <div class="rounded p-3 bg-darker">
                            <h2 class="fw-light mb-2">Create a new NFT Set</h2>
                            <hr />
                            <!-- Existing Script -->
                            <div class="d-flex align-items-center flex-wrap flex-md-nowrap mb-3">
                                <div class="my-1">
                                    <label for="notSFW" class="lead form-label">Existing Script
                                    </label>
                                    <div id="notSFWHelp" class="form-text me-2">Do you already have a script file
                                        uploaded to IPFS?</div>
                                </div>
                                <div class="ms-auto my-1">
                                    <div class="btn-group bg-dark">
                                        <input type="radio" name="existingScript" id="setYesExisting" autocomplete="off"
                                            v-model="newScript.decent" class="btn-check" value="true">
                                        <label for="setYesExisting" class="btn btn-outline-primary">YES</label>
                                        <input type="radio" name="existingScript" id="setNoExisting" autocomplete="off"
                                            v-model="newScript.decent" value="false" class="btn-check">
                                        <label for="setNoExisting" class="btn btn-outline-primary">NO</label>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <div v-show="newScript.decent == 'true'">
                                <!-- Script Hash -->
                                <div class="form-group mb-3">
                                    <label class="form-label lead">Enter the script hash</label>
                                    <input type="text" class="form-control bg-darkg border-0 text-info" 
                                        v-model="testscript"
                                        placeholder="QmIPFShash">
                                </div>
                            </div>
                            <!-- NEW SCRIPT -->
                            <div v-show="newScript.decent == 'false'">
                                <!-- Generation Type Toggle -->
                                <div class="d-flex align-items-center flex-wrap flex-md-nowrap mb-3">
                                    <div class="my-1">
                                        <label class="lead form-label">NFT Type</label>
                                        <div class="form-text me-2">Choose between a simple static NFT or a generative collection</div>
                                    </div>
                                    <div class="ms-auto my-1">
                                        <div class="btn-group bg-dark">
                                            <input type="radio" name="nftType" id="setStatic" autocomplete="off"
                                                v-model="nftCreationType" class="btn-check" value="static">
                                            <label for="setStatic" class="btn btn-outline-primary">Static</label>
                                            <input type="radio" name="nftType" id="setGenerative" autocomplete="off"
                                                v-model="nftCreationType" value="generative" class="btn-check">
                                            <label for="setGenerative" class="btn btn-outline-primary">Generative</label>
                                        </div>
                                    </div>
                                </div>
                                <hr />

                                <!-- Static NFT Section -->
                                <div v-show="nftCreationType === 'static'">
                                    <div class="alert alert-info mb-4">
                                        <i class="fa-solid fa-info-circle me-2"></i>
                                        <strong>Static NFT Content</strong><br>
                                        Upload a single file that will be embedded as the main content of your NFT.
                                    </div>
                                    
                                    <!-- Static Content File Upload -->
                                    <div class="form-group mb-4">
                                        <label class="lead form-label">
                                            <i class="fa-solid fa-upload me-2"></i>Main NFT Content
                                        </label>
                                        <div class="form-text mb-3">
                                            Upload the main content for your NFT (image, video, audio, HTML, etc.). This will be embedded into the generated script.
                                        </div>
                                        
                                        <!-- File Upload Area -->
                                        <div class="drop-zone" 
                                             @click="$refs.staticFileInput.click()"
                                             @dragover.prevent
                                             @dragenter.prevent 
                                             @drop.prevent="handleStaticFileDrop($event)"
                                             :class="{ 'dragover': isDragging }">
                                            <div class="drop-zone-content">
                                                <div v-if="!staticContent.file">
                                                    <i class="fa-solid fa-cloud-upload-alt fa-3x mb-3 text-muted"></i>
                                                    <h5>Drop your main content file here or click to browse</h5>
                                                    <p class="text-muted mb-0">Supports images, videos, audio, HTML, and more</p>
                                                </div>
                                                <div v-else class="text-center">
                                                    <i class="fa-solid fa-file fa-3x mb-3 text-success"></i>
                                                    <h5 class="text-success">{{ staticContent.file.name }}</h5>
                                                    <p class="text-muted">{{ formatFileSize(staticContent.file.size) }}</p>
                                                    <button type="button" class="btn btn-outline-primary btn-sm" @click.stop="clearStaticFile">
                                                        <i class="fa-solid fa-times me-1"></i>Change File
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <input type="file" 
                                               ref="staticFileInput" 
                                               style="display: none;" 
                                               @change="handleStaticFileSelect($event)"
                                               accept="image/*,video/*,audio/*,.html,.htm,.svg,.txt,.json">
                                    </div>

                                    <!-- NFT-Specific Details for Static -->
                                    <div v-if="staticContent.file" class="row mb-4">
                                        <!-- NFT Title -->
                                        <div class="form-group col-md-6 mb-3">
                                            <label class="lead form-label">NFT Title</label>
                                            <div class="form-text mb-2">Title for this specific NFT</div>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="staticContent.title"
                                                placeholder="My Unique Artwork"
                                                @input="generateStaticScript">
                                        </div>
                                        
                                        <!-- NFT Description -->
                                        <div class="form-group col-md-6 mb-3">
                                            <label class="lead form-label">NFT Description</label>
                                            <div class="form-text mb-2">Description for this specific NFT</div>
                                            <textarea class="form-control bg-darkg border-0" rows="2"
                                                placeholder="This unique piece represents..."
                                                v-model="staticContent.description"
                                                @input="generateStaticScript"></textarea>
                                        </div>
                                    </div>

                                    <!-- Generated Script Preview -->
                                    <div v-if="staticContent.script" class="form-group mb-4">
                                        <label class="lead form-label">
                                            <i class="fa-solid fa-code me-2"></i>Generated Script Preview
                                        </label>
                                        <div class="bg-dark p-3 rounded" style="max-height: 150px; overflow-y: auto;">
                                            <pre class="text-info mb-0 small">{{ staticContent.script.substring(0, 500) }}{{ staticContent.script.length > 500 ? '...' : '' }}</pre>
                                        </div>
                                        <div class="form-text">Script will be uploaded to SPK Drive when you proceed</div>
                                    </div>

                                    <!-- Upload Button for Static -->
                                    <div v-if="staticContent.file" class="d-flex justify-content-end mb-4">
                                        <button type="button" 
                                                class="btn btn-primary" 
                                                @click="uploadStaticScript"
                                                :disabled="!canUploadStaticScript || isUploading">
                                            <i class="fa-solid fa-cloud-upload me-2" v-if="!isUploading"></i>
                                            <i class="fa-solid fa-spinner fa-spin me-2" v-if="isUploading"></i>
                                            {{ isUploading ? 'Uploading...' : 'Generate & Upload Script' }}
                                        </button>
                                    </div>
                                </div>

                                <!-- Generative NFT Section -->
                                <div v-show="nftCreationType === 'generative'" class="mb-4">
                                    <generative-nft-builder
                                        :account="account"
                                        :spk-api="spkapi"
                                        :set-attributes="SA"
                                        @script-generated="handleScriptGenerated"
                                        @tosign="sendIt($event)">
                                    </generative-nft-builder>
                                </div>

                                <hr />

                                <!-- SHARED OPTIONS - Available for both Static and Generative -->
                                <div class="mb-4">
                                    <h4 class="lead mb-3">
                                        <i class="fa-solid fa-palette me-2"></i>NFT Set Configuration
                                    </h4>
                                    <div class="form-text mb-4">
                                        These settings apply to your entire NFT set and will be used for branding and display.
                                    </div>

                                    <!-- Set Images from SPK Drive -->
                                    <div class="form-group mb-4">
                                        <h5 class="lead">Set Images</h5>
                                        <div class="form-text mb-3">
                                            Use the SPK Drive above to upload and set these optional images for your NFT collection.
                                        </div>
                                        
                                        <div class="row">
                                            <!-- Logo Image-->
                                            <div class="form-group col-md-6 mb-3">
                                                <label class="form-label">Logo Image CID</label>
                                                <div class="form-text mb-2">
                                                    Collection logo (350x350 recommended)
                                                </div>
                                                <input type="text" 
                                                    class="form-control bg-darkg border-0 text-info" 
                                                    v-model="SA.logo"
                                                    placeholder="QmYourImageCID"
                                                    pattern="(https://[a-z0-9.-/]+)|(Qm[a-zA-Z0-9]+)">
                                            </div>
                                            
                                            <!-- Featured Image-->
                                            <div class="form-group col-md-6 mb-3">
                                                <label class="form-label">Featured Image CID</label>
                                                <div class="form-text mb-2">
                                                    Featured image (600x400 recommended)
                                                </div>
                                                <input type="text" 
                                                    class="form-control bg-darkg border-0 text-info" 
                                                    v-model="SA.featured"
                                                    placeholder="QmYourImageCID"
                                                    pattern="(https://[a-z0-9.-/]+)|(Qm[a-zA-Z0-9]+)">
                                            </div>
                                            
                                            <!-- Banner Image-->
                                            <div class="form-group col-md-6 mb-3">
                                                <label class="form-label">Banner Image CID</label>
                                                <div class="form-text mb-2">
                                                    Banner image (1400x400 recommended)
                                                </div>
                                                <input type="text" 
                                                    class="form-control bg-darkg border-0 text-info" 
                                                    v-model="SA.banner"
                                                    placeholder="QmYourImageCID"
                                                    pattern="(https://[a-z0-9.-/]+)|(Qm[a-zA-Z0-9]+)">
                                            </div>
                                            
                                            <!-- Wrapped Image-->
                                            <div class="form-group col-md-6 mb-3">
                                                <label class="form-label">Wrapped Image CID</label>
                                                <div class="form-text mb-2">
                                                    Pre-mint preview (350x350 recommended)
                                                </div>
                                                <input type="text" 
                                                    class="form-control bg-darkg border-0 text-info" 
                                                    v-model="SA.wrapped"
                                                    placeholder="QmYourImageCID"
                                                    pattern="(https://[a-z0-9.-/]+)|(Qm[a-zA-Z0-9]+)">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Basic Information -->
                                    <div class="row mb-4">
                                        <!-- Set Name -->
                                        <div class="form-group col-md-6 mb-3">
                                            <label class="lead form-label">Set Name</label>
                                            <div class="form-text mb-2">Short name for your NFT set (used in URLs)</div>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.name"
                                                placeholder="my-nft-set"
                                                pattern="[a-z0-9-]+">
                                        </div>
                                        
                                        <!-- Display Name -->
                                        <div class="form-group col-md-6 mb-3">
                                            <label class="lead form-label">Set Display Name</label>
                                            <div class="form-text mb-2">Full display name for your NFT set</div>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.long_name"
                                                placeholder="My NFT Collection">
                                        </div>
                                    </div>

                                    <!-- Set Description -->
                                    <div class="form-group mb-4">
                                        <label class="lead form-label">Set Description</label>
                                        <div class="form-text mb-2">Markdown syntax is supported. Describe your NFT collection.</div>
                                        <textarea class="form-control bg-darkg border-0" rows="3"
                                            placeholder="A unique digital artwork collection..."
                                            v-model="SA.description"></textarea>
                                    </div>

                                    <!-- Announcement Post -->
                                    <div class="form-group mb-4">
                                        <label class="lead form-label">Announcement Post</label>
                                        <div class="form-text mb-2">
                                            Link to your Hive post announcing this NFT set (@username/permlink)
                                        </div>
                                        <input type="text" 
                                            class="form-control bg-darkg border-0" 
                                            v-model="nftData.permlink"
                                            placeholder="@username/my-nft-announcement">
                                    </div>

                                    <!-- Visual Settings -->
                                    <div class="row mb-4">
                                        <!-- Color 1 -->
                                        <div class="form-group col-lg-4 mb-3">
                                            <div class="d-flex align-items-center mb-1">
                                                <label class="form-label lead mb-0">Color 1</label>
                                                <div class="ms-auto">
                                                    <i class="fa-solid fa-square fa-fw fs-3"
                                                        :style="'color: ' + SA.color1"></i>
                                                </div>
                                            </div>
                                            <p class="form-text text-muted">Primary theme color</p>
                                            <div class="d-flex gap-2 align-items-center">
                                                <input type="color" 
                                                    class="form-control form-control-color border-0" 
                                                    :value="SA.color1" 
                                                    @input="SA.color1 = $event.target.value"
                                                    style="width: 50px; height: 38px; padding: 2px;">
                                                <input type="text" 
                                                    class="form-control bg-darkg border-0 flex-grow-1" 
                                                    placeholder="#000000" 
                                                    v-model="SA.color1"
                                                    @input="validateHexColor($event, 'color1')"
                                                    pattern="^#[0-9A-Fa-f]{6}$">
                                            </div>
                                        </div>
                                        
                                        <!-- Color 2 -->
                                        <div class="form-group col-lg-4 mb-3">
                                            <div class="d-flex align-items-center mb-1">
                                                <label class="form-label lead mb-0">Color 2</label>
                                                <div class="ms-auto">
                                                    <i class="fa-solid fa-square fa-fw fs-3"
                                                        :style="'color: ' + SA.color2"></i>
                                                </div>
                                            </div>
                                            <p class="form-text text-muted">Secondary theme color</p>
                                            <div class="d-flex gap-2 align-items-center">
                                                <input type="color" 
                                                    class="form-control form-control-color border-0" 
                                                    :value="SA.color2" 
                                                    @input="SA.color2 = $event.target.value"
                                                    style="width: 50px; height: 38px; padding: 2px;">
                                                <input type="text" 
                                                    class="form-control bg-darkg border-0 flex-grow-1" 
                                                    placeholder="#ffffff" 
                                                    v-model="SA.color2"
                                                    @input="validateHexColor($event, 'color2')"
                                                    pattern="^#[0-9A-Fa-f]{6}$">
                                            </div>
                                        </div>
                                        
                                        <!-- Font Awesome Icon -->
                                        <div class="form-group col-lg-4 mb-3">
                                            <div class="d-flex align-items-center mb-1">
                                                <label class="form-label lead mb-0">Font Awesome Icon</label>
                                                <div class="ms-auto rainbow-text"
                                                    style="background-image: linear-gradient(rgb(194, 255, 182), rgb(255, 163, 182), rgb(221, 169, 255), rgb(162, 209, 255)); background-clip: text; -webkit-text-fill-color: transparent;">
                                                    <i :class="SA.faicon + ' fa-fw fs-3'"></i>
                                                </div>
                                            </div>
                                            <p class="form-text text-muted">Choose from Font Awesome icons</p>
                                            <div class="d-flex gap-2 align-items-center">
                                                <button type="button" 
                                                    class="btn btn-outline-primary d-flex align-items-center" 
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#iconPickerModal"
                                                    style="min-width: 50px; height: 38px;">
                                                    <i :class="SA.faicon + ' fa-fw'"></i>
                                                </button>
                                                <input type="text" 
                                                    class="form-control bg-darkg border-0 flex-grow-1" 
                                                    placeholder="fa fa-gem" 
                                                    v-model="SA.faicon">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Content Rating -->
                                    <div class="d-flex align-items-center flex-wrap flex-md-nowrap mb-4">
                                        <div class="my-1">
                                            <label class="lead form-label">Explicit Content</label>
                                            <div class="form-text me-2">Mark if this content is explicit, sensitive, or NSFW</div>
                                        </div>
                                        <div class="ms-auto my-1">
                                            <div class="btn-group bg-dark">
                                                <input type="radio" name="notSFW" id="setYesNsfw" autocomplete="off"
                                                    v-model="notSfw.decent" class="btn-check" value="true">
                                                <label for="setYesNsfw" class="btn btn-outline-primary">YES</label>
                                                <input type="radio" name="notSFW" id="setNoNsfw" autocomplete="off"
                                                    v-model="notSfw.decent" value="false" class="btn-check">
                                                <label for="setNoNsfw" class="btn btn-outline-primary">NO</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Proceed Button -->
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <small class="text-muted">
                                                <i class="fa-solid fa-info-circle me-1"></i>
                                                <span v-if="nftCreationType === 'static'">This will create a 1 of 1 NFT set</span>
                                                <span v-else>Configure your generative collection settings</span>
                                            </small>
                                        </div>
                                        <div>
                                            <button type="button" 
                                                    class="btn btn-primary" 
                                                    @click="proceedToMint"
                                                    :disabled="!canProceedToMint">
                                                <i class="fa-solid fa-arrow-right me-2"></i>
                                                Proceed to Mint Setup
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="tab-pane fade" id="nav-proof" role="tabpanel" aria-labelledby="nav-proof-tab">
                        <div class="container-fluid bg-dark rounded p-3">
                            <h2 class="fw-light mb-2">Preview NFT Set</h2>
                            <hr />
                            <h4>ALPHA v0.2</h4>
                            <p class="lead">Proof your set before minting</p>
                            <div id="preview">
                                <div class="">
                                    <!-- name -->
                                    <div class="form-group row mb-2">
                                        <label for="testname" class="col-sm-2 col-form-label">Set</label>
                                        <div class="col-sm-10">
                                            <input @change="buildTestItem()" type="text" class="form-control"
                                                v-model="testsetname">
                                        </div>
                                    </div>
                                    <!-- script -->
                                    <div class="form-group row mb-2">
                                        <label for="testscript" class="col-sm-2 col-form-label">Script</label>
                                        <div class="col-sm-10">
                                            <input @change="buildTestItem()" type="text" class="form-control"
                                                v-model="testscript">
                                        </div>
                                    </div>
                                    <!-- min -->
                                    <div class="form-group row mb-2">
                                        <label for="testname" class="col-sm-2 col-form-label">Min</label>
                                        <div class="col-sm-10">
                                            <input v-model="testmin" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <!-- max -->
                                    <div class="form-group row mb-2">
                                        <label for="testname" class="col-sm-2 col-form-label">Max</label>
                                        <div class="col-sm-10">
                                            <input v-model="testmax" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="d-flex">
                                        <button class="ms-auto me-auto btn btn-primary" type="button"
                                            @click="buildTestItem()">Preview</button>
                                    </div>
                                </div>
                                <div class="row my-3" v-if="debounceTestScript">
                                    <!-- banner img -->
                                    <img class="banner-img w-100 img-fluid" v-if="debounceTestScript"
                                        :src="'https://ipfs.dlux.io/ipfs/' + testset.set.banner">
                                </div>
                                <div class="row" v-if="debounceTestScript">
                                    <!-- Set Card -->
                                    <div class="col-md-6 mb-3 mx-auto" style="max-width: 600px;">
                                        <setcard key="1" v-if="debounceTestScript" :set="testset"
                                            :colors="'linear-gradient(' + testset.set.Color1 + ',' + testset.set.Color2 + ')'" />
                                    </div>
                                    <!-- NFT Card -->
                                    <div class="col-md-6 mb-3 mx-auto" style="max-width: 512px;">

                                        <div class="d-flex flex-column h-100">
                                            <div class="flex-shrink-0">
                                                <nftcard key="0" v-if="debounceTestScript" :item="testitem"
                                                    :ocolors="'linear-gradient(' + testset.set.Color1 + ',' + testset.set.Color2 + ')'"
                                                    :oicon="testset.set.faicon" :uid="Base64toNumber(testuid)"
                                                    :inventory="true" :account="account"></nftcard>
                                            </div>
                                            <div class="d-flex flex-grow-1 rounded mt-2 p-3 bg-darkg">
                                                <input type="range" class="form-range my-auto" id="slider"
                                                    :min="testmin" :max="testmax" step="1" value="0" v-model="testnum">
                                            </div>
                                        </div>
                                        <!-- Test UID slider -->
                                        <div class="rounded bg-darkg p-2 d-none" v-if="debounceTestScript">
                                            <div class="form-group row mb-auto">
                                                <div class="d-flex mb-2">
                                                    <label for="slider" class="lead">UID Selector</label>
                                                    <label for="slider" class="ms-auto lead">{{ testnum }} / {{
                                                        testuid }}</label>
                                                </div>
                                                <input type="range" class="form-range mb-2" id="slider" :min="testmin"
                                                    :max="testmax" step="1" value="0" v-model="testnum">
                                                <div id="sliderValue" class="form-label text-center">Scroll the slider
                                                    to preview
                                                    differeint UIDs</div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-mint" role="tabpanel" aria-labelledby="nav-mint-tab">
                        <div class="container-fluid bg-dark rounded p-3">
                            <h2 class="fw-light mb-2">Define NFT Set</h2>
                            <hr />
                            
                            <div class="alert alert-warning mb-4">
                                <i class="fa-solid fa-exclamation-triangle me-2"></i>
                                <strong>Important:</strong> Once you define an NFT set, it cannot be changed. Please review all settings carefully before submitting.
                            </div>

                            <form @submit.prevent="defineNFTSet" class="needs-validation" novalidate>
                                <!-- NFT Type Selection -->
                                <div class="form-group mb-4">
                                    <label class="lead form-label">
                                        <i class="fa-solid fa-cogs me-2"></i>NFT Type
                                    </label>
                                    <div class="form-text mb-3">Choose the type of NFT functionality you want</div>
                                    <div class="row g-3">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="card bg-darker h-100" :class="{'border-primary': nftData.type === 1}">
                                                <div class="card-body text-center">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" v-model="nftData.type" :value="1" id="type1">
                                                        <label class="form-check-label w-100" for="type1">
                                                            <i class="fa-solid fa-image fa-2x d-block mb-2 text-primary"></i>
                                                            <strong>Type 1: Basic</strong>
                                                            <small class="d-block text-muted">Static content only</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="card bg-darker h-100" :class="{'border-primary': nftData.type === 2}">
                                                <div class="card-body text-center">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" v-model="nftData.type" :value="2" id="type2">
                                                        <label class="form-check-label w-100" for="type2">
                                                            <i class="fa-solid fa-code fa-2x d-block mb-2 text-success"></i>
                                                            <strong>Type 2: Executable</strong>
                                                            <small class="d-block text-muted">With updatable code</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="card bg-darker h-100" :class="{'border-primary': nftData.type === 3}">
                                                <div class="card-body text-center">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" v-model="nftData.type" :value="3" id="type3">
                                                        <label class="form-check-label w-100" for="type3">
                                                            <i class="fa-solid fa-plus-circle fa-2x d-block mb-2 text-info"></i>
                                                            <strong>Type 3: Extended</strong>
                                                            <small class="d-block text-muted">With optional content</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="card bg-darker h-100" :class="{'border-primary': nftData.type === 4}">
                                                <div class="card-body text-center">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" v-model="nftData.type" :value="4" id="type4">
                                                        <label class="form-check-label w-100" for="type4">
                                                            <i class="fa-solid fa-rocket fa-2x d-block mb-2 text-warning"></i>
                                                            <strong>Type 4: Full Dynamic</strong>
                                                            <small class="d-block text-muted">Code + optional content</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <hr />

                                <!-- Basic NFT Information -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Set Name <span class="text-danger">*</span></label>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.name"
                                                placeholder="my-nft-set"
                                                pattern="[a-z0-9-]+"
                                                required>
                                            <div class="form-text">Short name for URLs (lowercase, numbers, hyphens only)</div>
                                            <div class="invalid-feedback">Please provide a valid set name.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Display Name</label>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.long_name"
                                                placeholder="My Amazing NFT Collection">
                                            <div class="form-text">Full display name (optional)</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Script/Content IPFS Hash <span class="text-danger">*</span></label>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0 font-monospace" 
                                                v-model="nftData.script"
                                                placeholder="QmYourIPFSHash"
                                                pattern="Qm[a-zA-Z0-9]+"
                                                required>
                                            <div class="form-text">IPFS hash of your NFT content or script</div>
                                            <div class="invalid-feedback">Please provide a valid IPFS hash.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Content Type <span class="text-danger">*</span></label>
                                            <select class="form-select bg-darkg border-0 text-white" v-model="nftData.handling" required>
                                                <option value="">Select content type</option>
                                                <option value="html">HTML</option>
                                                <option value="svg">SVG</option>
                                                <option value="image">Image</option>
                                                <option value="video">Video</option>
                                                <option value="audio">Audio</option>
                                                <option value="text">Text</option>
                                                <option value="other">Other</option>
                                            </select>
                                            <div class="invalid-feedback">Please select a content type.</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group mb-4">
                                    <label class="form-label">Announcement Post <span class="text-danger">*</span></label>
                                    <input type="text" 
                                        class="form-control bg-darkg border-0" 
                                        v-model="nftData.permlink"
                                        placeholder="@username/post-permlink"
                                        pattern="@[a-z0-9.-]+/[a-z0-9-]+"
                                        required>
                                    <div class="form-text">Hive post announcing this NFT set (@username/permlink)</div>
                                    <div class="invalid-feedback">Please provide a valid Hive post link.</div>
                                </div>

                                <!-- Minting Range -->
                                <div class="row mb-4">
                                    <div class="col-md-4">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Range Start <span class="text-danger">*</span></label>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0 font-monospace" 
                                                v-model="nftData.start"
                                                placeholder="00"
                                                required>
                                            <div class="form-text">Base64 encoded start (e.g., "00")</div>
                                            <div class="invalid-feedback">Please provide a start value.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Range End <span class="text-danger">*</span></label>
                                            <input type="text" 
                                                class="form-control bg-darkg border-0 font-monospace" 
                                                v-model="nftData.end"
                                                placeholder="ZZ"
                                                required>
                                            <div class="form-text">Base64 encoded end (e.g., "ZZ")</div>
                                            <div class="invalid-feedback">Please provide an end value.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Total Supply (Optional)</label>
                                            <input type="number" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.total"
                                                placeholder="1000"
                                                min="1">
                                            <div class="form-text">Max NFTs to mint (cannot exceed range)</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Type-specific options -->
                                <div v-if="nftData.type === 2 || nftData.type === 4" class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Executable Code Size Limit <span class="text-danger">*</span></label>
                                            <input type="number" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.exe_size"
                                                placeholder="1024"
                                                min="1"
                                                max="10000"
                                                required>
                                            <div class="form-text">Max bytes for executable code (1-10000)</div>
                                            <div class="invalid-feedback">Please provide a valid size limit.</div>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="nftData.type === 3 || nftData.type === 4" class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Optional Content Size Limit <span class="text-danger">*</span></label>
                                            <input type="number" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.opt_size"
                                                placeholder="1024"
                                                min="1"
                                                max="10000"
                                                required>
                                            <div class="form-text">Max bytes for optional content (1-10000)</div>
                                            <div class="invalid-feedback">Please provide a valid size limit.</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Economic Settings -->
                                <div class="row mb-4">
                                    <div class="col-md-4">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Royalty %</label>
                                            <input type="number" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.royalty"
                                                placeholder="0"
                                                min="0"
                                                max="5000"
                                                step="1">
                                            <div class="form-text">Royalty in basis points (0-5000 = 0-50%)</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Bond Value</label>
                                            <input type="number" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.bond"
                                                placeholder="0"
                                                min="0"
                                                step="0.001">
                                            <div class="form-text">DLUX bonded into each NFT</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group mb-3">
                                            <label class="form-label">Max Fee <span class="text-danger">*</span></label>
                                            <input type="number" 
                                                class="form-control bg-darkg border-0" 
                                                v-model="nftData.max_fee"
                                                placeholder="10000000"
                                                min="1"
                                                required>
                                            <div class="form-text">Maximum fee willing to pay (safety measure)</div>
                                            <div class="invalid-feedback">Please provide a max fee.</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Fee Calculation -->
                                <div class="alert alert-info mb-4" v-if="nftData.name && nftData.end">
                                    <h6><i class="fa-solid fa-calculator me-2"></i>Estimated Costs</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <small>
                                                 Set Definition Fee: ~1000 DLUX<br>
                                                 Name Length: {{ nftData.name.length }} chars<br>
                                                 Range End Length: {{ nftData.end.length }} chars<br>
                                                 Bond per NFT: {{ nftData.bond || 0 }} DLUX
                                            </small>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                Final cost depends on current network fees.<br>
                                                Set max_fee higher than expected cost for safety.
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="d-flex justify-content-between align-items-center">
                                    <button type="button" class="btn btn-outline-secondary" @click="$('.nav-link[href=\'#nav-generate\']').click()">
                                        <i class="fa-solid fa-arrow-left me-2"></i>Back to Script
                                    </button>
                                    <button type="submit" class="btn btn-success btn-lg" :disabled="!isFormValid">
                                        <i class="fa-solid fa-magic me-2"></i>Define NFT Set
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- SPK MODAL -->
            <div class="modal fade modal-xl" id="spkModal" tabindex="-1" aria-labelledby="spkModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="spkModalLabel">SPK Network</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <contract-vue :nodeview="false" :account="account" @tosign="sendIt($event)"
                                :prop_contracts="contracts" :accountinfo="accountinfo" :spkapi="spkapi"
                                @done="getSapi"></contract-vue>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ICON PICKER MODAL -->
            <div class="modal fade" id="iconPickerModal" tabindex="-1" aria-labelledby="iconPickerModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content bg-darker text-white">
                        <div class="modal-header">
                            <h5 class="modal-title" id="iconPickerModalLabel">
                                <i class="fa-solid fa-icons fa-fw me-2"></i>Choose Icon
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Search bar -->
                            <div class="mb-3">
                                <input type="text" 
                                    class="form-control bg-dark text-white border-secondary" 
                                    placeholder="Search icons..." 
                                    v-model="iconSearchTerm"
                                    @input="filterIcons">
                            </div>
                            
                            <!-- Icon categories -->
                            <div class="mb-3">
                                <div class="btn-group flex-wrap" role="group">
                                    <button type="button" 
                                        :class="['btn btn-sm', selectedIconCategory === 'all' ? 'btn-primary' : 'btn-outline-secondary']"
                                        @click="filterIconsByCategory('all')">
                                        All
                                    </button>
                                    <button type="button" 
                                        :class="['btn btn-sm', selectedIconCategory === 'solid' ? 'btn-primary' : 'btn-outline-secondary']"
                                        @click="filterIconsByCategory('solid')">
                                        Popular
                                    </button>
                                    <button type="button" 
                                        :class="['btn btn-sm', selectedIconCategory === 'business' ? 'btn-primary' : 'btn-outline-secondary']"
                                        @click="filterIconsByCategory('business')">
                                        Business
                                    </button>
                                    <button type="button" 
                                        :class="['btn btn-sm', selectedIconCategory === 'nature' ? 'btn-primary' : 'btn-outline-secondary']"
                                        @click="filterIconsByCategory('nature')">
                                        Nature
                                    </button>
                                    <button type="button" 
                                        :class="['btn btn-sm', selectedIconCategory === 'gaming' ? 'btn-primary' : 'btn-outline-secondary']"
                                        @click="filterIconsByCategory('gaming')">
                                        Gaming
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Icon grid -->
                            <div class="row g-2" style="max-height: 400px; overflow-y: auto;">
                                <div v-for="icon in filteredIcons" :key="icon.class" class="col-auto">
                                    <button type="button" 
                                        class="btn btn-outline-light d-flex flex-column align-items-center p-2"
                                        style="width: 80px; height: 80px; border-radius: 8px;"
                                        :class="{ 'btn-primary': SA.faicon === icon.class }"
                                        @click="selectIcon(icon.class)"
                                        :title="icon.name">
                                        <i :class="icon.class + ' fa-fw'" style="font-size: 1.5rem;"></i>
                                        <small class="mt-1 text-truncate w-100 text-center" style="font-size: 0.7rem;">
                                            {{ icon.name }}
                                        </small>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- No results message -->
                            <div v-if="filteredIcons.length === 0" class="text-center py-4">
                                <i class="fa-solid fa-search fa-2x text-muted mb-2"></i>
                                <p class="text-muted">No icons found matching your search.</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="me-auto small text-muted">
                                Selected: <code>{{ SA.faicon }}</code>
                            </div>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Use Selected</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <div>
            <foot-vue />
        </div>
    </div>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        (function () {
            "use strict";
            window.addEventListener(
                "load",
                function () {
                    // Fetch all the forms we want to apply custom Bootstrap validation styles to
                    var forms = document.getElementsByClassName("needs-validation");
                    // Loop over them and prevent submission
                    var validation = Array.prototype.filter.call(
                        forms,
                        function (form) {
                            form.addEventListener(
                                "submit",
                                function (event) {
                                    if (form.checkValidity() === false) {
                                        event.preventDefault();
                                        event.stopPropagation();
                                    }
                                    form.classList.add("was-validated");
                                },
                                false
                            );
                        }
                    );
                },
                false
            );
        })();
        var disabletab = document.getElementsByClassName("disabled-input");
        for (var i = 0; i < disabletab.length; i++) {
            disabletab[i].setAttribute("tabindex", "-1");
        }
        var toastElList = [].slice.call(document.querySelectorAll(".toast"));
        var toastList = toastElList.map(function (toastEl) {
            return new bootstrap.Toast(toastEl, option);
        });
        var tooltipTriggerList = [].slice.call(
            document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
        integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.1.0/uuidv4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

</html>