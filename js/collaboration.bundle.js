/*! For license information please see collaboration.bundle.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.collaborationBundle=e():t.collaborationBundle=e()}(this,()=>(()=>{var t,e,n={540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},1002:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var r=n(1601),o=n.n(r),i=n(6314),s=n.n(i)()(o());s.push([t.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(.54,1.5,.38,1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:transparent;border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]);const a=s},1113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},1601:t=>{"use strict";t.exports=function(t){return t[1]}},1736:(t,e,n)=>{var r,o,i;t.exports=(r=Math.floor,o=Math.abs,i=Math.pow,function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){return o(e[s][1][t]||t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var i=void 0,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";function r(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function o(t){return s[63&t>>18]+s[63&t>>12]+s[63&t>>6]+s[63&t]}function i(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(16711680&t[s]<<16)+(65280&t[s+1]<<8)+(255&t[s+2]),i.push(o(r));return i.join("")}n.byteLength=function(t){var e=r(t),n=e[0],o=e[1];return 3*(n+o)/4-o},n.toByteArray=function(t){var e,n,o=r(t),i=o[0],s=o[1],c=new l(function(t,e,n){return 3*(e+n)/4-n}(0,i,s)),d=0,u=0<s?i-4:i;for(n=0;n<u;n+=4)e=a[t.charCodeAt(n)]<<18|a[t.charCodeAt(n+1)]<<12|a[t.charCodeAt(n+2)]<<6|a[t.charCodeAt(n+3)],c[d++]=255&e>>16,c[d++]=255&e>>8,c[d++]=255&e;return 2===s&&(e=a[t.charCodeAt(n)]<<2|a[t.charCodeAt(n+1)]>>4,c[d++]=255&e),1===s&&(e=a[t.charCodeAt(n)]<<10|a[t.charCodeAt(n+1)]<<4|a[t.charCodeAt(n+2)]>>2,c[d++]=255&e>>8,c[d++]=255&e),c},n.fromByteArray=function(t){for(var e,n=t.length,r=n%3,o=[],a=16383,l=0,c=n-r;l<c;l+=a)o.push(i(t,l,l+a>c?c:l+a));return 1===r?(e=t[n-1],o.push(s[e>>2]+s[63&e<<4]+"==")):2===r&&(e=(t[n-2]<<8)+t[n-1],o.push(s[e>>10]+s[63&e>>4]+s[63&e<<2]+"=")),o.join("")};for(var s=[],a=[],l="undefined"==typeof Uint8Array?Array:Uint8Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0;d<64;++d)s[d]=c[d],a[c.charCodeAt(d)]=d;a[45]=62,a[95]=63},{}],2:[function(){},{}],3:[function(t,e,n){(function(){(function(){"use strict";var e=String.fromCharCode,r=Math.min;function o(t){if(2147483647<t)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=s.prototype,e}function s(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return c(t)}return a(t,e,n)}function a(t,e,n){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!s.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var n=0|h(t,e),r=o(n),i=r.write(t,e);return i!==n&&(r=r.slice(0,i)),r}(t,e);if(ArrayBuffer.isView(t))return d(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(B(t,ArrayBuffer)||t&&B(t.buffer,ArrayBuffer))return function(t,e,n){if(0>e||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return(r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n)).__proto__=s.prototype,r}(t,e,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return s.from(r,e,n);var i=function(t){if(s.isBuffer(t)){var e=0|u(t.length),n=o(e);return 0===n.length||t.copy(n,0,0,e),n}return void 0===t.length?"Buffer"===t.type&&Array.isArray(t.data)?d(t.data):void 0:"number"!=typeof t.length||j(t.length)?o(0):d(t)}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(0>t)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function c(t){return l(t),o(0>t?0:0|u(t))}function d(t){for(var e=0>t.length?0:0|u(t.length),n=o(e),r=0;r<e;r+=1)n[r]=255&t[r];return n}function u(t){if(t>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t}function h(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||B(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,r=2<arguments.length&&!0===arguments[2];if(!r&&0===n)return 0;for(var o=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return P(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return $(t).length;default:if(o)return r?-1:P(t).length;e=(""+e).toLowerCase(),o=!0}}function p(t,e,n){var r=!1;if((void 0===e||0>e)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),0>=n)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return M(this,e,n);case"utf8":case"utf-8":return C(this,e,n);case"ascii":return E(this,e,n);case"latin1":case"binary":return T(this,e,n);case"base64":return x(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function f(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function m(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:-2147483648>n&&(n=-2147483648),j(n=+n)&&(n=o?0:t.length-1),0>n&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(0>n){if(!o)return-1;n=0}if("string"==typeof e&&(e=s.from(e,r)),s.isBuffer(e))return 0===e.length?-1:g(t,e,n,r,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):g(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function g(t,e,n,r,o){function i(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var s,a=1,l=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=(r+"").toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(2>t.length||2>e.length)return-1;a=2,l/=2,c/=2,n/=2}if(o){var d=-1;for(s=n;s<l;s++)if(i(t,s)!==i(e,-1===d?0:s-d))-1!==d&&(s-=s-d),d=-1;else if(-1===d&&(d=s),s-d+1===c)return d*a}else for(n+c>l&&(n=l-c),s=n;0<=s;s--){for(var u=!0,h=0;h<c;h++)if(i(t,s+h)!==i(e,h)){u=!1;break}if(u)return s}return-1}function y(t,e,n,r){n=+n||0;var o=t.length-n;r?(r=+r)>o&&(r=o):r=o;var i=e.length;r>i/2&&(r=i/2);for(var s,a=0;a<r;++a){if(j(s=parseInt(e.substr(2*a,2),16)))return a;t[n+a]=s}return a}function b(t,e,n,r){return H(P(e,t.length-n),t,n,r)}function v(t,e,n,r){return H(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function w(t,e,n,r){return v(t,e,n,r)}function k(t,e,n,r){return H($(e),t,n,r)}function S(t,e,n,r){return H(function(t,e){for(var n,r,o,i=[],s=0;s<t.length&&!(0>(e-=2));++s)r=(n=t.charCodeAt(s))>>8,o=n%256,i.push(o),i.push(r);return i}(e,t.length-n),t,n,r)}function x(t,e,n){return 0===e&&n===t.length?U.fromByteArray(t):U.fromByteArray(t.slice(e,n))}function C(t,e,n){n=r(t.length,n);for(var o=[],i=e;i<n;){var s,a,l,c,d=t[i],u=null,h=239<d?4:223<d?3:191<d?2:1;i+h<=n&&(1===h?128>d&&(u=d):2===h?128==(192&(s=t[i+1]))&&127<(c=(31&d)<<6|63&s)&&(u=c):3===h?(s=t[i+1],a=t[i+2],128==(192&s)&&128==(192&a)&&2047<(c=(15&d)<<12|(63&s)<<6|63&a)&&(55296>c||57343<c)&&(u=c)):4===h&&(s=t[i+1],a=t[i+2],l=t[i+3],128==(192&s)&&128==(192&a)&&128==(192&l)&&65535<(c=(15&d)<<18|(63&s)<<12|(63&a)<<6|63&l)&&1114112>c&&(u=c))),null===u?(u=65533,h=1):65535<u&&(u-=65536,o.push(55296|1023&u>>>10),u=56320|1023&u),o.push(u),i+=h}return _(o)}function _(t){var n=t.length;if(n<=4096)return e.apply(String,t);for(var r="",o=0;o<n;)r+=e.apply(String,t.slice(o,o+=4096));return r}function E(t,n,o){var i="";o=r(t.length,o);for(var s=n;s<o;++s)i+=e(127&t[s]);return i}function T(t,n,o){var i="";o=r(t.length,o);for(var s=n;s<o;++s)i+=e(t[s]);return i}function M(t,e,n){var r=t.length;(!e||0>e)&&(e=0),(!n||0>n||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=I(t[i]);return o}function A(t,n,r){for(var o=t.slice(n,r),i="",s=0;s<o.length;s+=2)i+=e(o[s]+256*o[s+1]);return i}function O(t,e,n){if(0!=t%1||0>t)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,n,r,o,i){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function R(t,e,n,r){if(n+r>t.length)throw new RangeError("Index out of range");if(0>n)throw new RangeError("Index out of range")}function L(t,e,n,r,o){return e=+e,n>>>=0,o||R(t,0,n,4),F.write(t,e,n,r,23,4),n+4}function N(t,e,n,r,o){return e=+e,n>>>=0,o||R(t,0,n,8),F.write(t,e,n,r,52,8),n+8}function I(t){return 16>t?"0"+t.toString(16):t.toString(16)}function P(t,e){e=e||1/0;for(var n,r=t.length,o=null,i=[],s=0;s<r;++s){if(55295<(n=t.charCodeAt(s))&&57344>n){if(!o){if(56319<n){-1<(e-=3)&&i.push(239,191,189);continue}if(s+1===r){-1<(e-=3)&&i.push(239,191,189);continue}o=n;continue}if(56320>n){-1<(e-=3)&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&-1<(e-=3)&&i.push(239,191,189);if(o=null,128>n){if(0>(e-=1))break;i.push(n)}else if(2048>n){if(0>(e-=2))break;i.push(192|n>>6,128|63&n)}else if(65536>n){if(0>(e-=3))break;i.push(224|n>>12,128|63&n>>6,128|63&n)}else{if(!(1114112>n))throw new Error("Invalid code point");if(0>(e-=4))break;i.push(240|n>>18,128|63&n>>12,128|63&n>>6,128|63&n)}}return i}function $(t){return U.toByteArray(function(t){if(2>(t=(t=t.split("=")[0]).trim().replace(V,"")).length)return"";for(;0!=t.length%4;)t+="=";return t}(t))}function H(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}function B(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function j(t){return t!=t}var U=t("base64-js"),F=t("ieee754");n.Buffer=s,n.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},n.INSPECT_MAX_BYTES=50,n.kMaxLength=2147483647,s.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){return s.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){return s.isBuffer(this)?this.byteOffset:void 0}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(t,e,n){return a(t,e,n)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(t,e,n){return function(t,e,n){return l(t),0>=t||void 0===e?o(t):"string"==typeof n?o(t).fill(e,n):o(t).fill(e)}(t,e,n)},s.allocUnsafe=function(t){return c(t)},s.allocUnsafeSlow=function(t){return c(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(B(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),B(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var n=t.length,o=e.length,i=0,a=r(n,o);i<a;++i)if(t[i]!==e[i]){n=t[i],o=e[i];break}return n<o?-1:o<n?1:0},s.isEncoding=function(t){switch((t+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=s.allocUnsafe(e),o=0;for(n=0;n<t.length;++n){var i=t[n];if(B(i,Uint8Array)&&(i=s.from(i)),!s.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,o),o+=i.length}return r},s.byteLength=h,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(0!=t%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)f(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(0!=t%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)f(this,e,e+3),f(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(0!=t%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)f(this,e,e+7),f(this,e+1,e+6),f(this,e+2,e+5),f(this,e+3,e+4);return this},s.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?C(this,0,t):p.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},s.prototype.compare=function(t,e,n,o,i){if(B(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),0>e||n>t.length||0>o||i>this.length)throw new RangeError("out of range index");if(o>=i&&e>=n)return 0;if(o>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var a=(i>>>=0)-(o>>>=0),l=(n>>>=0)-(e>>>=0),c=r(a,l),d=this.slice(o,i),u=t.slice(e,n),h=0;h<c;++h)if(d[h]!==u[h]){a=d[h],l=u[h];break}return a<l?-1:l<a?1:0},s.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},s.prototype.indexOf=function(t,e,n){return m(this,t,e,n,!0)},s.prototype.lastIndexOf=function(t,e,n){return m(this,t,e,n,!1)},s.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),0<t.length&&(0>n||0>e)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return y(this,t,e,n);case"utf8":case"utf-8":return b(this,t,e,n);case"ascii":return v(this,t,e,n);case"latin1":case"binary":return w(this,t,e,n);case"base64":return k(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(t,e){var n=this.length;0>(t=~~t)?0>(t+=n)&&(t=0):t>n&&(t=n),0>(e=void 0===e?n:~~e)?0>(e+=n)&&(e=0):e>n&&(e=n),e<t&&(e=t);var r=this.subarray(t,e);return r.__proto__=s.prototype,r},s.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},s.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=this[t+--e],o=1;0<e&&(o*=256);)r+=this[t+--e]*o;return r},s.prototype.readUInt8=function(t,e){return t>>>=0,e||O(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||O(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||O(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||O(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=this[t],o=1,s=0;++s<e&&(o*=256);)r+=this[t+s]*o;return r>=(o*=128)&&(r-=i(2,8*e)),r},s.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=e,o=1,s=this[t+--r];0<r&&(o*=256);)s+=this[t+--r]*o;return s>=(o*=128)&&(s-=i(2,8*e)),s},s.prototype.readInt8=function(t,e){return t>>>=0,e||O(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||O(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(t,e){t>>>=0,e||O(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return t>>>=0,e||O(t,4,this.length),F.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||O(t,4,this.length),F.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||O(t,8,this.length),F.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||O(t,8,this.length),F.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||D(this,t,e,n,i(2,8*n)-1,0);var o=1,s=0;for(this[e]=255&t;++s<n&&(o*=256);)this[e+s]=255&t/o;return e+n},s.prototype.writeUIntBE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||D(this,t,e,n,i(2,8*n)-1,0);var o=n-1,s=1;for(this[e+o]=255&t;0<=--o&&(s*=256);)this[e+o]=255&t/s;return e+n},s.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var o=i(2,8*n-1);D(this,t,e,n,o-1,-o)}var s=0,a=1,l=0;for(this[e]=255&t;++s<n&&(a*=256);)0>t&&0===l&&0!==this[e+s-1]&&(l=1),this[e+s]=255&(t/a|0)-l;return e+n},s.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var o=i(2,8*n-1);D(this,t,e,n,o-1,-o)}var s=n-1,a=1,l=0;for(this[e+s]=255&t;0<=--s&&(a*=256);)0>t&&0===l&&0!==this[e+s+1]&&(l=1),this[e+s]=255&(t/a|0)-l;return e+n},s.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,1,127,-128),0>t&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeFloatLE=function(t,e,n){return L(this,t,e,!0,n)},s.prototype.writeFloatBE=function(t,e,n){return L(this,t,e,!1,n)},s.prototype.writeDoubleLE=function(t,e,n){return N(this,t,e,!0,n)},s.prototype.writeDoubleBE=function(t,e,n){return N(this,t,e,!1,n)},s.prototype.copy=function(t,e,n,r){if(!s.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("Index out of range");if(0>r)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var o=r-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,n,r);else if(this===t&&n<e&&e<r)for(var i=o-1;0<=i;--i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,r),e);return o},s.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){var o=t.charCodeAt(0);("utf8"===r&&128>o||"latin1"===r)&&(t=o)}}else"number"==typeof t&&(t&=255);if(0>e||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{var a=s.isBuffer(t)?t:s.from(t,r),l=a.length;if(0===l)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<n-e;++i)this[i+e]=a[i%l]}return this};var V=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,t("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(t,e,n){(function(r){(function(){n.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,t=>{"%%"===t||(r++,"%c"===t&&(o=r))}),t.splice(o,0,n)},n.save=function(t){try{t?n.storage.setItem("debug",t):n.storage.removeItem("debug")}catch(t){}},n.load=function(){let t;try{t=n.storage.getItem("debug")}catch(t){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t},n.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},n.storage=function(){try{return localStorage}catch(t){}}(),n.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.log=console.debug||console.log||(()=>{}),e.exports=t("./common")(n);const{formatters:o}=e.exports;o.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this)}).call(this,t("_process"))},{"./common":5,_process:12}],5:[function(t,e){e.exports=function(e){function n(t){function e(...t){if(!e.enabled)return;const r=e,i=+new Date,s=i-(o||i);r.diff=s,r.prev=o,r.curr=i,o=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(e,o)=>{if("%%"===e)return"%";a++;const i=n.formatters[o];if("function"==typeof i){const n=t[a];e=i.call(r,n),t.splice(a,1),a--}return e}),n.formatArgs.call(r,t),(r.log||n.log).apply(r,t)}let o,i=null;return e.namespace=t,e.useColors=n.useColors(),e.color=n.selectColor(t),e.extend=r,e.destroy=n.destroy,Object.defineProperty(e,"enabled",{enumerable:!0,configurable:!1,get:()=>null===i?n.enabled(t):i,set:t=>{i=t}}),"function"==typeof n.init&&n.init(e),e}function r(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function i(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){return t instanceof Error?t.stack||t.message:t},n.disable=function(){const t=[...n.names.map(i),...n.skips.map(i).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),o=r.length;for(e=0;e<o;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")))},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;e<r;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;e<r;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=t("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(t=>{n[t]=e[t]}),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return n.colors[o(e)%n.colors.length]},n.enable(n.load()),n}},{ms:11}],6:[function(t,e){"use strict";function n(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}e.exports=function(t,e,r){if(!t||"string"==typeof t)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof e&&(r=e,e=""),e&&(r.code=e);try{return n(t,r)}catch(e){r.message=t.message,r.stack=t.stack;const o=function(){};return o.prototype=Object.create(Object.getPrototypeOf(t)),n(new o,r)}}},{}],7:[function(t,e){"use strict";function n(){n.init.call(this)}function r(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function o(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function i(t,e,n,i){var s,a,l;if(r(n),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),l=a[e]),void 0===l)l=a[e]=n,++t._eventsCount;else if("function"==typeof l?l=a[e]=i?[n,l]:[l,n]:i?l.unshift(n):l.push(n),0<(s=o(t))&&l.length>s&&!l.warned){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=l.length,function(t){console&&console.warn&&console.warn(t)}(c)}return t}function s(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function a(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=s.bind(r);return o.listener=n,r.wrapFn=o,o}function l(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):d(o,o.length)}function c(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(t,e){for(var n=Array(e),r=0;r<e;++r)n[r]=t[r];return n}function u(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function o(i){r.once&&t.removeEventListener(e,o),n(i)})}}var h,p="object"==typeof Reflect?Reflect:null,f=p&&"function"==typeof p.apply?p.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};h=p&&"function"==typeof p.ownKeys?p.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var m=Number.isNaN||function(t){return t!=t};e.exports=n,e.exports.once=function(t,e){return new Promise(function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}u(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&u(t,"error",e,n)}(t,o,{once:!0})})},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var g=10;Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(t){if("number"!=typeof t||0>t||m(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");g=t}}),n.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||0>t||m(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return o(this)},n.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var i;if(0<e.length&&(i=e[0]),i instanceof Error)throw i;var s=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw s.context=i,s}var a=o[t];if(void 0===a)return!1;if("function"==typeof a)f(a,this,e);else{var l=a.length,c=d(a,l);for(n=0;n<l;++n)f(c[n],this,e)}return!0},n.prototype.addListener=function(t,e){return i(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return i(this,t,e,!0)},n.prototype.once=function(t,e){return r(e),this.on(t,a(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){return r(e),this.prependListener(t,a(this,t,e)),this},n.prototype.removeListener=function(t,e){var n,o,i,s,a;if(r(e),void 0===(o=this._events))return this;if(void 0===(n=o[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,s=n.length-1;0<=s;s--)if(n[s]===e||n[s].listener===e){a=n[s].listener,i=s;break}if(0>i)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(o[t]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",t,a||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;0<=r;r--)this.removeListener(t,e[r]);return this},n.prototype.listeners=function(t){return l(this,t,!0)},n.prototype.rawListeners=function(t){return l(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):c.call(t,e)},n.prototype.listenerCount=c,n.prototype.eventNames=function(){return 0<this._eventsCount?h(this._events):[]}},{}],8:[function(t,e){e.exports=function(){if("undefined"==typeof globalThis)return null;var t={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null}},{}],9:[function(t,e,n){n.read=function(t,e,n,r,o){var s,a,l=8*o-r-1,c=(1<<l)-1,d=c>>1,u=-7,h=n?o-1:0,p=n?-1:1,f=t[e+h];for(h+=p,s=f&(1<<-u)-1,f>>=-u,u+=l;0<u;s=256*s+t[e+h],h+=p,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=r;0<u;a=256*a+t[e+h],h+=p,u-=8);if(0===s)s=1-d;else{if(s===c)return a?NaN:1/0*(f?-1:1);a+=i(2,r),s-=d}return(f?-1:1)*a*i(2,s-r)},n.write=function(t,e,n,s,a,l){var c,d,u,h=Math.LN2,p=Math.log,f=8*l-a-1,m=(1<<f)-1,g=m>>1,y=23===a?i(2,-24)-i(2,-77):0,b=s?0:l-1,v=s?1:-1,w=0>e||0===e&&0>1/e?1:0;for(e=o(e),isNaN(e)||e===1/0?(d=isNaN(e)?1:0,c=m):(c=r(p(e)/h),1>e*(u=i(2,-c))&&(c--,u*=2),2<=(e+=1<=c+g?y/u:y*i(2,1-g))*u&&(c++,u/=2),c+g>=m?(d=0,c=m):1<=c+g?(d=(e*u-1)*i(2,a),c+=g):(d=e*i(2,g-1)*i(2,a),c=0));8<=a;t[n+b]=255&d,b+=v,d/=256,a-=8);for(c=c<<a|d,f+=a;0<f;t[n+b]=255&c,b+=v,c/=256,f-=8);t[n+b-v]|=128*w}},{}],10:[function(t,e){e.exports="function"==typeof Object.create?function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}},{}],11:[function(t,e){var n=Math.round;function r(t){var e=o(t);return 864e5<=e?n(t/864e5)+"d":36e5<=e?n(t/36e5)+"h":6e4<=e?n(t/6e4)+"m":1e3<=e?n(t/1e3)+"s":t+"ms"}function i(t){var e=o(t);return 864e5<=e?s(t,e,864e5,"day"):36e5<=e?s(t,e,36e5,"hour"):6e4<=e?s(t,e,6e4,"minute"):1e3<=e?s(t,e,1e3,"second"):t+" ms"}function s(t,e,r,o){return n(t/r)+" "+o+(e>=1.5*r?"s":"")}e.exports=function(t,e){e=e||{};var n=typeof t;if("string"==n&&0<t.length)return function(t){if(!(100<(t+="").length)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();return"years"===r||"year"===r||"yrs"===r||"yr"===r||"y"===r?315576e5*n:"weeks"===r||"week"===r||"w"===r?6048e5*n:"days"===r||"day"===r||"d"===r?864e5*n:"hours"===r||"hour"===r||"hrs"===r||"hr"===r||"h"===r?36e5*n:"minutes"===r||"minute"===r||"mins"===r||"min"===r||"m"===r?6e4*n:"seconds"===r||"second"===r||"secs"===r||"sec"===r||"s"===r?1e3*n:"milliseconds"===r||"millisecond"===r||"msecs"===r||"msec"===r||"ms"===r?n:void 0}}}(t);if("number"===n&&isFinite(t))return e.long?i(t):r(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},{}],12:[function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function i(){f&&h&&(f=!1,h.length?p=h.concat(p):m=-1,p.length&&s())}function s(){if(!f){var t=o(i);f=!0;for(var e=p.length;e;){for(h=p,p=[];++m<e;)h&&h[m].run();m=-1,e=p.length}h=null,f=!1,function(t){if(d===clearTimeout)return clearTimeout(t);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}(t)}}function a(t,e){this.fun=t,this.array=e}function l(){}var c,d,u=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(t){d=r}}();var h,p=[],f=!1,m=-1;u.nextTick=function(t){var e=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new a(t,e)),1!==p.length||f||o(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=l,u.addListener=l,u.once=l,u.off=l,u.removeListener=l,u.removeAllListeners=l,u.emit=l,u.prependListener=l,u.prependOnceListener=l,u.listeners=function(){return[]},u.binding=function(){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],13:[function(t,e){(function(t){(function(){let n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"==typeof window?t:window):t=>(n||(n=Promise.resolve())).then(t).catch(t=>setTimeout(()=>{throw t},0))}).call(this)}).call(this,void 0===n.g?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:n.g)},{}],14:[function(t,e){(function(n,r){(function(){"use strict";var o=t("safe-buffer").Buffer,i=r.crypto||r.msCrypto;e.exports=i&&i.getRandomValues?function(t,e){if(t>4294967295)throw new RangeError("requested too many random bytes");var r=o.allocUnsafe(t);if(0<t)if(65536<t)for(var s=0;s<t;s+=65536)i.getRandomValues(r.slice(s,s+65536));else i.getRandomValues(r);return"function"==typeof e?n.nextTick(function(){e(null,r)}):r}:function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this)}).call(this,t("_process"),void 0===n.g?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:n.g)},{_process:12,"safe-buffer":30}],15:[function(t,e){"use strict";function n(t,e,n){function r(t,n,r){return"string"==typeof e?e:e(t,n,r)}n||(n=Error);var i=function(t){function e(e,n,o){return t.call(this,r(e,n,o))||this}return function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}(e,t),e}(n);i.prototype.name=n.name,i.prototype.code=t,o[t]=i}function r(t,e){if(Array.isArray(t)){var n=t.length;return t=t.map(function(t){return t+""}),2<n?"one of ".concat(e," ").concat(t.slice(0,n-1).join(", "),", or ")+t[n-1]:2===n?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}return"of ".concat(e," ").concat(t+"")}var o={};n("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError),n("ERR_INVALID_ARG_TYPE",function(t,e,n){var o,i;if("string"==typeof e&&function(t,e,n){return t.substr(!n||0>n?0:+n,e.length)===e}(e,"not ")?(o="must not be",e=e.replace(/^not /,"")):o="must be",function(t,e,n){return(void 0===n||n>t.length)&&(n=t.length),t.substring(n-e.length,n)===e}(t," argument"))i="The ".concat(t," ").concat(o," ").concat(r(e,"type"));else{var s=function(t,e,n){return"number"!=typeof n&&(n=0),!(n+e.length>t.length)&&-1!==t.indexOf(e,n)}(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(o," ").concat(r(e,"type"))}return i+". Received type ".concat(typeof n)},TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"}),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"}),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=o},{}],16:[function(t,e){(function(n){(function(){"use strict";function r(t){return this instanceof r?(a.call(this,t),l.call(this,t),this.allowHalfOpen=!0,void(t&&(!1===t.readable&&(this.readable=!1),!1===t.writable&&(this.writable=!1),!1===t.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",o))))):new r(t)}function o(){this._writableState.ended||n.nextTick(i,this)}function i(t){t.end()}var s=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};e.exports=r;var a=t("./_stream_readable"),l=t("./_stream_writable");t("inherits")(r,a);for(var c,d=s(l.prototype),u=0;u<d.length;u++)c=d[u],r.prototype[c]||(r.prototype[c]=l.prototype[c]);Object.defineProperty(r.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(r.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(r.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(r.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0===this._readableState||void 0===this._writableState||(this._readableState.destroyed=t,this._writableState.destroyed=t)}})}).call(this)}).call(this,t("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(t,e){"use strict";function n(t){return this instanceof n?void r.call(this,t):new n(t)}e.exports=n;var r=t("./_stream_transform");t("inherits")(n,r),n.prototype._transform=function(t,e,n){n(null,t)}},{"./_stream_transform":19,inherits:10}],18:[function(t,e){(function(n,r){(function(){"use strict";function o(e,n,r){S=S||t("./_stream_duplex"),e=e||{},"boolean"!=typeof r&&(r=n instanceof S),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=N(this,e,"readableHighWaterMark",r),this.buffer=new R,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(!A&&(A=t("string_decoder/").StringDecoder),this.decoder=new A(e.encoding),this.encoding=e.encoding)}function i(e){if(S=S||t("./_stream_duplex"),!(this instanceof i))return new i(e);var n=this instanceof S;this._readableState=new o(e,this,n),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),_.call(this)}function s(t,e,n,r,o){x("readableAddChunk",e);var i,s=t._readableState;if(null===e)s.reading=!1,function(t,e){if(x("onEofChunk"),!e.ended){if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,e.sync?d(t):(e.needReadable=!1,!e.emittedReadable&&(e.emittedReadable=!0,u(t)))}}(t,s);else if(o||(i=l(s,e)),i)j(t,i);else if(s.objectMode||e&&0<e.length)if("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===E.prototype||(e=function(t){return E.from(t)}(e)),r)s.endEmitted?j(t,new B):a(t,s,e,!0);else if(s.ended)j(t,new $);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!n?(e=s.decoder.write(e),s.objectMode||0!==e.length?a(t,s,e,!1):h(t,s)):a(t,s,e,!1)}else r||(s.reading=!1,h(t,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function a(t,e,n,r){e.flowing&&0===e.length&&!e.sync?(e.awaitDrain=0,t.emit("data",n)):(e.length+=e.objectMode?1:n.length,r?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&d(t)),h(t,e)}function l(t,e){var n;return function(t){return E.isBuffer(t)||t instanceof T}(e)||"string"==typeof e||void 0===e||t.objectMode||(n=new P("chunk",["string","Buffer","Uint8Array"],e)),n}function c(t,e){return 0>=t||0===e.length&&e.ended?0:e.objectMode?1:t==t?(t>e.highWaterMark&&(e.highWaterMark=function(t){return 1073741824<=t?t=1073741824:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0)):e.flowing&&e.length?e.buffer.head.data.length:e.length}function d(t){var e=t._readableState;x("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(x("emitReadable",e.flowing),e.emittedReadable=!0,n.nextTick(u,t))}function u(t){var e=t._readableState;x("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,y(t)}function h(t,e){e.readingMore||(e.readingMore=!0,n.nextTick(p,t,e))}function p(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&0===e.length);){var n=e.length;if(x("maybeReadMore read 0"),t.read(0),n===e.length)break}e.readingMore=!1}function f(t){var e=t._readableState;e.readableListening=0<t.listenerCount("readable"),e.resumeScheduled&&!e.paused?e.flowing=!0:0<t.listenerCount("data")&&t.resume()}function m(t){x("readable nexttick read 0"),t.read(0)}function g(t,e){x("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),y(t),e.flowing&&!e.reading&&t.read(0)}function y(t){var e=t._readableState;for(x("flow",e.flowing);e.flowing&&null!==t.read(););}function b(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.first():e.buffer.concat(e.length),e.buffer.clear()):n=e.buffer.consume(t,e.decoder),n);var n}function v(t){var e=t._readableState;x("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,n.nextTick(w,e,t))}function w(t,e){if(x("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&0===t.length&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var n=e._writableState;(!n||n.autoDestroy&&n.finished)&&e.destroy()}}function k(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}var S;e.exports=i,i.ReadableState=o,t("events").EventEmitter;var x,C=function(t,e){return t.listeners(e).length},_=t("./internal/streams/stream"),E=t("buffer").Buffer,T=r.Uint8Array||function(){},M=t("util");x=M&&M.debuglog?M.debuglog("stream"):function(){};var A,O,D,R=t("./internal/streams/buffer_list"),L=t("./internal/streams/destroy"),N=t("./internal/streams/state").getHighWaterMark,I=t("../errors").codes,P=I.ERR_INVALID_ARG_TYPE,$=I.ERR_STREAM_PUSH_AFTER_EOF,H=I.ERR_METHOD_NOT_IMPLEMENTED,B=I.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;t("inherits")(i,_);var j=L.errorOrDestroy,U=["error","close","destroy","pause","resume"];Object.defineProperty(i.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),i.prototype.destroy=L.destroy,i.prototype._undestroy=L.undestroy,i.prototype._destroy=function(t,e){e(t)},i.prototype.push=function(t,e){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=E.from(t,e),e=""),n=!0),s(this,t,e,!1,n)},i.prototype.unshift=function(t){return s(this,t,null,!0,!1)},i.prototype.isPaused=function(){return!1===this._readableState.flowing},i.prototype.setEncoding=function(e){A||(A=t("string_decoder/").StringDecoder);var n=new A(e);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,o="";null!==r;)o+=n.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==o&&this._readableState.buffer.push(o),this._readableState.length=o.length,this},i.prototype.read=function(t){x("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&((0===e.highWaterMark?0<e.length:e.length>=e.highWaterMark)||e.ended))return x("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?v(this):d(this),null;if(0===(t=c(t,e))&&e.ended)return 0===e.length&&v(this),null;var r,o=e.needReadable;return x("need readable",o),(0===e.length||e.length-t<e.highWaterMark)&&x("length less than watermark",o=!0),e.ended||e.reading?x("reading or ended",o=!1):o&&(x("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,!e.reading&&(t=c(n,e))),null===(r=0<t?b(t,e):null)?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),0===e.length&&(!e.ended&&(e.needReadable=!0),n!==t&&e.ended&&v(this)),null!==r&&this.emit("data",r),r},i.prototype._read=function(){j(this,new H("_read()"))},i.prototype.pipe=function(t,e){function r(t,e){x("onunpipe"),t===u&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,i())}function o(){x("onend"),t.end()}function i(){x("cleanup"),t.removeListener("close",l),t.removeListener("finish",c),t.removeListener("drain",f),t.removeListener("error",a),t.removeListener("unpipe",r),u.removeListener("end",o),u.removeListener("end",d),u.removeListener("data",s),m=!0,h.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&f()}function s(e){x("ondata");var n=t.write(e);x("dest.write",n),!1===n&&((1===h.pipesCount&&h.pipes===t||1<h.pipesCount&&-1!==k(h.pipes,t))&&!m&&(x("false write response, pause",h.awaitDrain),h.awaitDrain++),u.pause())}function a(e){x("onerror",e),d(),t.removeListener("error",a),0===C(t,"error")&&j(t,e)}function l(){t.removeListener("finish",c),d()}function c(){x("onfinish"),t.removeListener("close",l),d()}function d(){x("unpipe"),u.unpipe(t)}var u=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=t;break;case 1:h.pipes=[h.pipes,t];break;default:h.pipes.push(t)}h.pipesCount+=1,x("pipe count=%d opts=%j",h.pipesCount,e);var p=e&&!1===e.end||t===n.stdout||t===n.stderr?d:o;h.endEmitted?n.nextTick(p):u.once("end",p),t.on("unpipe",r);var f=function(t){return function(){var e=t._readableState;x("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&C(t,"data")&&(e.flowing=!0,y(t))}}(u);t.on("drain",f);var m=!1;return u.on("data",s),function(t,e,n){"function"==typeof t.prependListener?t.prependListener(e,n):t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",a),t.once("close",l),t.once("finish",c),t.emit("pipe",u),h.flowing||(x("pipe resume"),u.resume()),t},i.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,n)),this;if(!t){var r=e.pipes,o=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var i=0;i<o;i++)r[i].emit("unpipe",this,{hasUnpiped:!1});return this}var s=k(e.pipes,t);return-1===s||(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,n)),this},i.prototype.on=function(t,e){var r=_.prototype.on.call(this,t,e),o=this._readableState;return"data"===t?(o.readableListening=0<this.listenerCount("readable"),!1!==o.flowing&&this.resume()):"readable"==t&&!o.endEmitted&&!o.readableListening&&(o.readableListening=o.needReadable=!0,o.flowing=!1,o.emittedReadable=!1,x("on readable",o.length,o.reading),o.length?d(this):!o.reading&&n.nextTick(m,this)),r},i.prototype.addListener=i.prototype.on,i.prototype.removeListener=function(t,e){var r=_.prototype.removeListener.call(this,t,e);return"readable"===t&&n.nextTick(f,this),r},i.prototype.removeAllListeners=function(t){var e=_.prototype.removeAllListeners.apply(this,arguments);return("readable"===t||void 0===t)&&n.nextTick(f,this),e},i.prototype.resume=function(){var t=this._readableState;return t.flowing||(x("resume"),t.flowing=!t.readableListening,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,n.nextTick(g,t,e))}(this,t)),t.paused=!1,this},i.prototype.pause=function(){return x("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(x("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},i.prototype.wrap=function(t){var e=this,n=this._readableState,r=!1;for(var o in t.on("end",function(){if(x("wrapped end"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(o){x("wrapped data"),n.decoder&&(o=n.decoder.write(o)),n.objectMode&&null==o||!(n.objectMode||o&&o.length)||e.push(o)||(r=!0,t.pause())}),t)void 0===this[o]&&"function"==typeof t[o]&&(this[o]=function(e){return function(){return t[e].apply(t,arguments)}}(o));for(var i=0;i<U.length;i++)t.on(U[i],this.emit.bind(this,U[i]));return this._read=function(e){x("wrapped _read",e),r&&(r=!1,t.resume())},this},"function"==typeof Symbol&&(i.prototype[Symbol.asyncIterator]=function(){return void 0===O&&(O=t("./internal/streams/async_iterator")),O(this)}),Object.defineProperty(i.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(i.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(i.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),i._fromList=b,Object.defineProperty(i.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(i.from=function(e,n){return void 0===D&&(D=t("./internal/streams/from")),D(i,e,n)})}).call(this)}).call(this,t("_process"),void 0===n.g?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:n.g)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(t,e){"use strict";function n(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new l);n.writechunk=null,n.writecb=null,null!=e&&this.push(e),r(t);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}function r(t){return this instanceof r?(u.call(this,t),this._transformState={afterTransform:n.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),void this.on("prefinish",o)):new r(t)}function o(){var t=this;"function"!=typeof this._flush||this._readableState.destroyed?i(this,null,null):this._flush(function(e,n){i(t,e,n)})}function i(t,e,n){if(e)return t.emit("error",e);if(null!=n&&t.push(n),t._writableState.length)throw new d;if(t._transformState.transforming)throw new c;return t.push(null)}e.exports=r;var s=t("../errors").codes,a=s.ERR_METHOD_NOT_IMPLEMENTED,l=s.ERR_MULTIPLE_CALLBACK,c=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,d=s.ERR_TRANSFORM_WITH_LENGTH_0,u=t("./_stream_duplex");t("inherits")(r,u),r.prototype.push=function(t,e){return this._transformState.needTransform=!1,u.prototype.push.call(this,t,e)},r.prototype._transform=function(t,e,n){n(new a("_transform()"))},r.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var o=this._readableState;(r.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},r.prototype._read=function(){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},r.prototype._destroy=function(t,e){u.prototype._destroy.call(this,t,function(t){e(t)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(t,e){(function(n,r){(function(){"use strict";function o(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,n){var r=t.entry;for(t.entry=null;r;){var o=r.callback;e.pendingcb--,o(n),r=r.next}e.corkedRequestsFree.next=t}(e,t)}}function i(){}function s(e,n,r){w=w||t("./_stream_duplex"),e=e||{},"boolean"!=typeof r&&(r=n instanceof w),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=T(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){h(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function a(e){var n=this instanceof(w=w||t("./_stream_duplex"));return n||k.call(a,this)?(this._writableState=new s(e,this,n),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),void x.call(this)):new a(e)}function l(t,e){var r=new I;$(t,r),n.nextTick(e,r)}function c(t,e,r,o){var i;return null===r?i=new N:"string"!=typeof r&&!e.objectMode&&(i=new A("chunk",["string","Buffer"],r)),!i||($(t,i),n.nextTick(o,i),!1)}function d(t,e,n,r,o,i){if(!n){var s=function(t,e,n){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=C.from(e,n)),e}(e,r,o);r!==s&&(n=!0,o="buffer",r=s)}var a=e.objectMode?1:r.length;e.length+=a;var l=e.length<e.highWaterMark;if(l||(e.needDrain=!0),e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:o,isBuf:n,callback:i,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else u(t,e,!1,a,r,o,i);return l}function u(t,e,n,r,o,i,s){e.writelen=r,e.writecb=s,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new L("write")):n?t._writev(o,e.onwrite):t._write(o,i,e.onwrite),e.sync=!1}function h(t,e){var r=t._writableState,o=r.sync,i=r.writecb;if("function"!=typeof i)throw new D;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),e)!function(t,e,r,o,i){--e.pendingcb,r?(n.nextTick(i,o),n.nextTick(b,t,e),t._writableState.errorEmitted=!0,$(t,o)):(i(o),t._writableState.errorEmitted=!0,$(t,o),b(t,e))}(t,r,o,e,i);else{var s=m(r)||t.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||f(t,r),o?n.nextTick(p,t,r,s,i):p(t,r,s,i)}}function p(t,e,n,r){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),b(t,e)}function f(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=Array(r),s=e.corkedRequestsFree;s.entry=n;for(var a=0,l=!0;n;)i[a]=n,n.isBuf||(l=!1),n=n.next,a+=1;i.allBuffers=l,u(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new o(e),e.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,d=n.encoding,h=n.callback;if(u(t,e,!1,e.objectMode?1:c.length,c,d,h),n=n.next,e.bufferedRequestCount--,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequest=n,e.bufferProcessing=!1}function m(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function g(t,e){t._final(function(n){e.pendingcb--,n&&$(t,n),e.prefinished=!0,t.emit("prefinish"),b(t,e)})}function y(t,e){e.prefinished||e.finalCalled||("function"!=typeof t._final||e.destroyed?(e.prefinished=!0,t.emit("prefinish")):(e.pendingcb++,e.finalCalled=!0,n.nextTick(g,t,e)))}function b(t,e){var n=m(e);if(n&&(y(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var r=t._readableState;(!r||r.autoDestroy&&r.endEmitted)&&t.destroy()}return n}function v(t,e,r){e.ending=!0,b(t,e),r&&(e.finished?n.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}var w;e.exports=a,a.WritableState=s;var k,S={deprecate:t("util-deprecate")},x=t("./internal/streams/stream"),C=t("buffer").Buffer,_=r.Uint8Array||function(){},E=t("./internal/streams/destroy"),T=t("./internal/streams/state").getHighWaterMark,M=t("../errors").codes,A=M.ERR_INVALID_ARG_TYPE,O=M.ERR_METHOD_NOT_IMPLEMENTED,D=M.ERR_MULTIPLE_CALLBACK,R=M.ERR_STREAM_CANNOT_PIPE,L=M.ERR_STREAM_DESTROYED,N=M.ERR_STREAM_NULL_VALUES,I=M.ERR_STREAM_WRITE_AFTER_END,P=M.ERR_UNKNOWN_ENCODING,$=E.errorOrDestroy;t("inherits")(a,x),s.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(s.prototype,"buffer",{get:S.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(k=Function.prototype[Symbol.hasInstance],Object.defineProperty(a,Symbol.hasInstance,{value:function(t){return!!k.call(this,t)||!(this!==a)&&t&&t._writableState instanceof s}})):k=function(t){return t instanceof this},a.prototype.pipe=function(){$(this,new R)},a.prototype.write=function(t,e,n){var r=this._writableState,o=!1,s=!r.objectMode&&function(t){return C.isBuffer(t)||t instanceof _}(t);return s&&!C.isBuffer(t)&&(t=function(t){return C.from(t)}(t)),"function"==typeof e&&(n=e,e=null),s?e="buffer":!e&&(e=r.defaultEncoding),"function"!=typeof n&&(n=i),r.ending?l(this,n):(s||c(this,r,t,n))&&(r.pendingcb++,o=d(this,r,s,t,e,n)),o},a.prototype.cork=function(){this._writableState.corked++},a.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&f(this,t))},a.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())))throw new P(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),a.prototype._write=function(t,e,n){n(new O("_write()"))},a.prototype._writev=null,a.prototype.end=function(t,e,n){var r=this._writableState;return"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||v(this,r,n),this},Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),a.prototype.destroy=E.destroy,a.prototype._undestroy=E.undestroy,a.prototype._destroy=function(t,e){e(t)}}).call(this)}).call(this,t("_process"),void 0===n.g?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:n.g)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(t,e){(function(n){(function(){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){return{value:t,done:e}}function i(t){var e=t[c];if(null!==e){var n=t[m].read();null!==n&&(t[p]=null,t[c]=null,t[d]=null,e(o(n,!1)))}}function s(t){n.nextTick(i,t)}var a,l=t("./end-of-stream"),c=Symbol("lastResolve"),d=Symbol("lastReject"),u=Symbol("error"),h=Symbol("ended"),p=Symbol("lastPromise"),f=Symbol("handlePromise"),m=Symbol("stream"),g=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((a={get stream(){return this[m]},next:function(){var t=this,e=this[u];if(null!==e)return Promise.reject(e);if(this[h])return Promise.resolve(o(void 0,!0));if(this[m].destroyed)return new Promise(function(e,r){n.nextTick(function(){t[u]?r(t[u]):e(o(void 0,!0))})});var r,i=this[p];if(i)r=new Promise(function(t,e){return function(n,r){t.then(function(){return e[h]?void n(o(void 0,!0)):void e[f](n,r)},r)}}(i,this));else{var s=this[m].read();if(null!==s)return Promise.resolve(o(s,!1));r=new Promise(this[f])}return this[p]=r,r}},r(a,Symbol.asyncIterator,function(){return this}),r(a,"return",function(){var t=this;return new Promise(function(e,n){t[m].destroy(null,function(t){return t?void n(t):void e(o(void 0,!0))})})}),a),g);e.exports=function(t){var e,n=Object.create(y,(r(e={},m,{value:t,writable:!0}),r(e,c,{value:null,writable:!0}),r(e,d,{value:null,writable:!0}),r(e,u,{value:null,writable:!0}),r(e,h,{value:t._readableState.endEmitted,writable:!0}),r(e,f,{value:function(t,e){var r=n[m].read();r?(n[p]=null,n[c]=null,n[d]=null,t(o(r,!1))):(n[c]=t,n[d]=e)},writable:!0}),e));return n[p]=null,l(t,function(t){if(t&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code){var e=n[d];return null!==e&&(n[p]=null,n[c]=null,n[d]=null,e(t)),void(n[u]=t)}var r=n[c];null!==r&&(n[p]=null,n[c]=null,n[d]=null,r(o(void 0,!0))),n[h]=!0}),t.on("readable",s.bind(null,n)),n}}).call(this)}).call(this,t("_process"))},{"./end-of-stream":24,_process:12}],22:[function(t,e){"use strict";function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}function i(t,e,n){s.prototype.copy.call(t,e,n)}var s=t("buffer").Buffer,a=t("util").inspect,l=a&&a.custom||"inspect";e.exports=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.head=null,this.tail=null,this.length=0}return function(t,e,n){e&&o(t.prototype,e),n&&o(t,n)}(t,[{key:"push",value:function(t){var e={data:t,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length}},{key:"unshift",value:function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}},{key:"shift",value:function(){if(0!==this.length){var t=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n}},{key:"concat",value:function(t){if(0===this.length)return s.alloc(0);for(var e=s.allocUnsafe(t>>>0),n=this.head,r=0;n;)i(n.data,e,r),r+=n.data.length,n=n.next;return e}},{key:"consume",value:function(t,e){var n;return t<this.head.data.length?(n=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):n=t===this.head.data.length?this.shift():e?this._getString(t):this._getBuffer(t),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var e=this.head,n=1,r=e.data;for(t-=r.length;e=e.next;){var o=e.data,i=t>o.length?o.length:t;if(r+=i===o.length?o:o.slice(0,t),0===(t-=i)){i===o.length?(++n,this.head=e.next?e.next:this.tail=null):(this.head=e,e.data=o.slice(i));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(t){var e=s.allocUnsafe(t),n=this.head,r=1;for(n.data.copy(e),t-=n.data.length;n=n.next;){var o=n.data,i=t>o.length?o.length:t;if(o.copy(e,e.length-t,0,i),0===(t-=i)){i===o.length?(++r,this.head=n.next?n.next:this.tail=null):(this.head=n,n.data=o.slice(i));break}++r}return this.length-=r,e}},{key:l,value:function(t,e){return a(this,function(t){for(var e,o=1;o<arguments.length;o++)e=null==arguments[o]?{}:arguments[o],o%2?n(Object(e),!0).forEach(function(n){r(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):n(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))});return t}({},e,{depth:0,customInspect:!1}))}}]),t}()},{buffer:3,util:2}],23:[function(t,e){(function(t){(function(){"use strict";function n(t,e){o(t,e),r(t)}function r(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function o(t,e){t.emit("error",e)}e.exports={destroy:function(e,i){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(i?i(e):e&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,t.nextTick(o,this,e)):t.nextTick(o,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!i&&e?s._writableState?s._writableState.errorEmitted?t.nextTick(r,s):(s._writableState.errorEmitted=!0,t.nextTick(n,s,e)):t.nextTick(n,s,e):i?(t.nextTick(r,s),i(e)):t.nextTick(r,s)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(t,e){var n=t._readableState,r=t._writableState;n&&n.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}}}).call(this)}).call(this,t("_process"))},{_process:12}],24:[function(t,e){"use strict";function n(){}var r=t("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;e.exports=function t(e,o,i){if("function"==typeof o)return t(e,null,o);o||(o={}),i=function(t){var e=!1;return function(){if(!e){e=!0;for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];t.apply(this,r)}}}(i||n);var s=o.readable||!1!==o.readable&&e.readable,a=o.writable||!1!==o.writable&&e.writable,l=function(){e.writable||d()},c=e._writableState&&e._writableState.finished,d=function(){a=!1,c=!0,s||i.call(e)},u=e._readableState&&e._readableState.endEmitted,h=function(){s=!1,u=!0,a||i.call(e)},p=function(t){i.call(e,t)},f=function(){var t;return s&&!u?(e._readableState&&e._readableState.ended||(t=new r),i.call(e,t)):a&&!c?(e._writableState&&e._writableState.ended||(t=new r),i.call(e,t)):void 0},m=function(){e.req.on("finish",d)};return function(t){return t.setHeader&&"function"==typeof t.abort}(e)?(e.on("complete",d),e.on("abort",f),e.req?m():e.on("request",m)):a&&!e._writableState&&(e.on("end",l),e.on("close",l)),e.on("end",h),e.on("finish",d),!1!==o.error&&e.on("error",p),e.on("close",f),function(){e.removeListener("complete",d),e.removeListener("abort",f),e.removeListener("request",m),e.req&&e.req.removeListener("finish",d),e.removeListener("end",l),e.removeListener("close",l),e.removeListener("finish",d),e.removeListener("end",h),e.removeListener("error",p),e.removeListener("close",f)}}},{"../../../errors":15}],25:[function(t,e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(t,e){"use strict";function n(t){if(t)throw t}function r(e,n,r,o){o=function(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}(o);var i=!1;e.on("close",function(){i=!0}),void 0===a&&(a=t("./end-of-stream")),a(e,{readable:n,writable:r},function(t){return t?o(t):(i=!0,void o())});var s=!1;return function(t){if(!i)return s?void 0:(s=!0,function(t){return t.setHeader&&"function"==typeof t.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new d("pipe")))}}function o(t){t()}function i(t,e){return t.pipe(e)}function s(t){return t.length&&"function"==typeof t[t.length-1]?t.pop():n}var a,l=t("../../../errors").codes,c=l.ERR_MISSING_ARGS,d=l.ERR_STREAM_DESTROYED;e.exports=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var a=s(e);if(Array.isArray(e[0])&&(e=e[0]),2>e.length)throw new c("streams");var l,d=e.map(function(t,n){var i=n<e.length-1;return r(t,i,0<n,function(t){l||(l=t),t&&d.forEach(o),i||(d.forEach(o),a(l))})});return e.reduce(i)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(t,e){"use strict";var n=t("../../../errors").codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(t,e,o,i){var s=function(t,e,n){return null==t.highWaterMark?e?t[n]:null:t.highWaterMark}(e,i,o);if(null!=s){if(!isFinite(s)||r(s)!==s||0>s)throw new n(i?o:"highWaterMark",s);return r(s)}return t.objectMode?16:16384}}},{"../../../errors":15}],28:[function(t,e){e.exports=t("events").EventEmitter},{events:7}],29:[function(t,e,n){(n=e.exports=t("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=t("./lib/_stream_writable.js"),n.Duplex=t("./lib/_stream_duplex.js"),n.Transform=t("./lib/_stream_transform.js"),n.PassThrough=t("./lib/_stream_passthrough.js"),n.finished=t("./lib/internal/streams/end-of-stream.js"),n.pipeline=t("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(t,e,n){function r(t,e){for(var n in t)e[n]=t[n]}function o(t,e,n){return s(t,e,n)}var i=t("buffer"),s=i.Buffer;s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=i:(r(i,n),n.Buffer=o),o.prototype=Object.create(s.prototype),r(s,o),o.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return s(t,e,n)},o.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=s(t);return void 0===e?r.fill(0):"string"==typeof n?r.fill(e,n):r.fill(e),r},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return s(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i.SlowBuffer(t)}},{buffer:3}],31:[function(t,e,n){"use strict";function r(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(h.isEncoding===p||!p(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=s,this.end=a,e=4;break;case"utf8":this.fillLast=i,e=4;break;case"base64":this.text=l,this.end=c,e=3;break;default:return this.write=d,void(this.end=u)}this.lastNeed=0,this.lastTotal=0,this.lastChar=h.allocUnsafe(e)}function o(t){return 127>=t?0:6==t>>5?2:14==t>>4?3:30==t>>3?4:2==t>>6?-1:-2}function i(t){var e=this.lastTotal-this.lastNeed,n=function(t,e){if(128!=(192&e[0]))return t.lastNeed=0,"";if(1<t.lastNeed&&1<e.length){if(128!=(192&e[1]))return t.lastNeed=1,"";if(2<t.lastNeed&&2<e.length&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0===n?this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length)):n}function s(t,e){if(0==(t.length-e)%2){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(55296<=r&&56319>=r)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function a(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function l(t,e){var n=(t.length-e)%3;return 0==n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1==n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function c(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function d(t){return t.toString(this.encoding)}function u(t){return t&&t.length?this.write(t):""}var h=t("safe-buffer").Buffer,p=h.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};n.StringDecoder=r,r.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},r.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},r.prototype.text=function(t,e){var n=function(t,e,n){var r=e.length-1;if(r<n)return 0;var i=o(e[r]);return 0<=i?(0<i&&(t.lastNeed=i-1),i):--r<n||-2===i?0:0<=(i=o(e[r]))?(0<i&&(t.lastNeed=i-2),i):--r<n||-2===i?0:0<=(i=o(e[r]))?(0<i&&(2===i?i=0:t.lastNeed=i-3),i):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},r.prototype.fillLast=function(t){return this.lastNeed<=t.length?(t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),void(this.lastNeed-=t.length))}},{"safe-buffer":30}],32:[function(t,e){(function(t){(function(){function n(e){try{if(!t.localStorage)return!1}catch(t){return!1}var n=t.localStorage[e];return null!=n&&"true"===(n+"").toLowerCase()}e.exports=function(t,e){if(n("noDeprecation"))return t;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(e);n("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}}).call(this)}).call(this,void 0===n.g?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:n.g)},{}],"/":[function(t,e){function n(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}const r=t("debug")("simple-peer"),o=t("get-browser-rtc"),i=t("randombytes"),s=t("readable-stream"),a=t("queue-microtask"),l=t("err-code"),{Buffer:c}=t("buffer"),d=65536;class u extends s.Duplex{constructor(t){if(super(t=Object.assign({allowHalfOpen:!1},t)),this._id=i(4).toString("hex").slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||i(20).toString("hex"):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||u.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},u.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(t=>t),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=void 0===t.trickle||t.trickle,this.allowHalfTrickle=void 0!==t.allowHalfTrickle&&t.allowHalfTrickle,this.iceCompleteTimeout=t.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=t.wrtc&&"object"==typeof t.wrtc?t.wrtc:o(),!this._wrtc)throw"undefined"==typeof window?l(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):l(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){return void this.destroy(l(t,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch(t=>{this.destroy(l(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this.destroying){if(this.destroyed)throw l(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())}).catch(t=>{this.destroy(l(t,"ERR_SET_REMOTE_DESCRIPTION"))}),t.sdp||t.candidate||t.renegotiate||t.transceiverRequest||this.destroy(l(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const e=new this._wrtc.RTCIceCandidate(t);this._pc.addIceCandidate(e).catch(t=>{!e.address||e.address.endsWith(".local")?function(t){console.warn(t)}("Ignoring unsupported ICE candidate."):this.destroy(l(t,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this.destroying){if(this.destroyed)throw l(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}addTransceiver(t,e){if(!this.destroying){if(this.destroyed)throw l(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(t){this.destroy(l(t,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this.destroying){if(this.destroyed)throw l(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}}addTrack(t,e){if(this.destroying)return;if(this.destroyed)throw l(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const n=this._senderMap.get(t)||new Map;let r=n.get(e);if(r)throw r.removed?l(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):l(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");r=this._pc.addTrack(t,e),n.set(e,r),this._senderMap.set(t,n),this._needsNegotiation()}replaceTrack(t,e,n){if(this.destroying)return;if(this.destroyed)throw l(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(t),o=r?r.get(n):null;if(!o)throw l(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,r),null==o.replaceTrack?this.destroy(l(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):o.replaceTrack(e)}removeTrack(t,e){if(this.destroying)return;if(this.destroyed)throw l(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const n=this._senderMap.get(t),r=n?n.get(e):null;if(!r)throw l(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(t){"NS_ERROR_UNEXPECTED"===t.name?this._sendersAwaitingStable.push(r):this.destroy(l(t,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this.destroying){if(this.destroyed)throw l(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,a(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw l(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(t){this._destroy(t,()=>{})}_destroy(t,e){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),a(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",t&&(t.message||t)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(t){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(t){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t&&this.emit("error",t),this.emit("close"),e()}))}_setupData(t){if(!t.channel)return this.destroy(l(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=d),this.channelName=this._channel.label,this._channel.onmessage=t=>{this._onChannelMessage(t)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=t=>{const e=t.error instanceof Error?t.error:new Error(`Datachannel error: ${t.message} ${t.filename}:${t.lineno}:${t.colno}`);this.destroy(l(e,"ERR_DATA_CHANNEL"))};let e=!1;this._closingInterval=setInterval(()=>{this._channel&&"closing"===this._channel.readyState?(e&&this._onChannelClose(),e=!0):e=!1},5e3)}_read(){}_write(t,e,n){if(this.destroyed)return n(l(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(t){return this.destroy(l(t,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>d?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=t,this._cb=n}_onFinish(){if(!this.destroyed){const t=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?t():this.once("connect",t)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(t=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(t.sdp=n(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(!this.destroyed){const e=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:e.type,sdp:e.sdp})}};this._pc.setLocalDescription(t).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?e():this.once("_iceComplete",e))}).catch(t=>{this.destroy(l(t,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(t=>{this.destroy(l(t,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{t.mid||!t.sender.track||t.requested||(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(t.sdp=n(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(!this.destroyed){const e=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:e.type,sdp:e.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(t).then(()=>{this.destroyed||(this.trickle||this._iceComplete?e():this.once("_iceComplete",e))}).catch(t=>{this.destroy(l(t,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(t=>{this.destroy(l(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(l(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,e=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,e),this.emit("iceStateChange",t,e),("connected"===t||"completed"===t)&&(this._pcReady=!0,this._maybeReady()),"failed"===t&&this.destroy(l(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===t&&this.destroy(l(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const e=t=>("[object Array]"===Object.prototype.toString.call(t.values)&&t.values.forEach(e=>{Object.assign(t,e)}),t);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then(n=>{const r=[];n.forEach(t=>{r.push(e(t))}),t(null,r)},e=>t(e)):0<this._pc.getStats.length?this._pc.getStats(n=>{if(this.destroyed)return;const r=[];n.result().forEach(t=>{const n={};t.names().forEach(e=>{n[e]=t.stat(e)}),n.id=t.id,n.type=t.type,n.timestamp=t.timestamp,r.push(e(n))}),t(null,r)},e=>t(e)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this.getStats((e,n)=>{if(this.destroyed)return;e&&(n=[]);const r={},o={},i={};let s=!1;n.forEach(t=>{("remotecandidate"===t.type||"remote-candidate"===t.type)&&(r[t.id]=t),("localcandidate"===t.type||"local-candidate"===t.type)&&(o[t.id]=t),("candidatepair"===t.type||"candidate-pair"===t.type)&&(i[t.id]=t)});const a=t=>{s=!0;let e=o[t.localCandidateId];e&&(e.ip||e.address)?(this.localAddress=e.ip||e.address,this.localPort=+e.port):e&&e.ipAddress?(this.localAddress=e.ipAddress,this.localPort=+e.portNumber):"string"==typeof t.googLocalAddress&&(e=t.googLocalAddress.split(":"),this.localAddress=e[0],this.localPort=+e[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let n=r[t.remoteCandidateId];n&&(n.ip||n.address)?(this.remoteAddress=n.ip||n.address,this.remotePort=+n.port):n&&n.ipAddress?(this.remoteAddress=n.ipAddress,this.remotePort=+n.portNumber):"string"==typeof t.googRemoteAddress&&(n=t.googRemoteAddress.split(":"),this.remoteAddress=n[0],this.remotePort=+n[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(n.forEach(t=>{"transport"===t.type&&t.selectedCandidatePairId&&a(i[t.selectedCandidatePairId]),("googCandidatePair"===t.type&&"true"===t.googActiveConnection||("candidatepair"===t.type||"candidate-pair"===t.type)&&t.selected)&&a(t)}),s||Object.keys(i).length&&!Object.keys(o).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(l(t,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const t=this._cb;this._cb=null,t(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(t,100)})};t()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>d)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let e=t.data;e instanceof ArrayBuffer&&(e=c.from(e)),this.push(e)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(t){this.destroyed||t.streams.forEach(e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),this._remoteStreams.some(t=>t.id===e.id)||(this._remoteStreams.push(e),a(()=>{this._debug("on stream"),this.emit("stream",e)}))})}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],r.apply(null,t)}}u.WEBRTC_SUPPORT=!!o(),u.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},u.channelConfig={},e.exports=u},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/"))},4617:(t,e,n)=>{"use strict";n.d(e,{P$:()=>d,VA:()=>u,f1:()=>h,ki:()=>c});var r=Object.create,o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,a=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,c=(t=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(t,{get:(t,e)=>("undefined"!=typeof require?require:t)[e]}):t)(function(t){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),d=(t,e)=>function(){return e||(0,t[s(t)[0]])((e={exports:{}}).exports,e),e.exports},u=(t,e)=>{for(var n in e)o(t,n,{get:e[n],enumerable:!0})},h=(t,e,n)=>(n=null!=t?r(a(t)):{},((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let n of s(e))l.call(t,n)||undefined===n||o(t,n,{get:()=>e[n],enumerable:!(r=i(e,n))||r.enumerable});return t})(!e&&t&&t.__esModule?n:o(n,"default",{value:t,enumerable:!0}),t))},5056:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},5072:t=>{"use strict";var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var i={},s=[],a=0;a<t.length;a++){var l=t[a],c=r.base?l[0]+r.base:l[0],d=i[c]||0,u="".concat(c," ").concat(d);i[c]=d+1;var h=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)e[h].references++,e[h].updater(p);else{var f=o(p,r);r.byIndex=a,e.splice(a,0,{identifier:u,updater:f,references:1})}s.push(u)}return s}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var i=r(t=t||[],o=o||{});return function(t){t=t||[];for(var s=0;s<i.length;s++){var a=n(i[s]);e[a].references--}for(var l=r(t,o),c=0;c<i.length;c++){var d=n(i[c]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}i=l}}},6314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n}).join("")},e.i=function(t,n,r,o,i){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<t.length;c++){var d=[].concat(t[c]);r&&s[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),e.push(d))}},e}},7659:t=>{"use strict";var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},7825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={id:t,exports:{}};return n[t].call(i.exports,i,i.exports,o),i.exports}o.m=n,o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce((e,n)=>(o.f[n](t,e),e),[])),o.u=t=>t+".bundle.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="Bundle:",o.l=(n,r,i,s)=>{if(t[n])t[n].push(r);else{var a,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==e+i){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",e+i),a.src=n),t[n]=[r];var h=(e,r)=>{a.onerror=a.onload=null,clearTimeout(p);var o=t[n];if(delete t[n],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach(t=>t(r)),e)return e(r)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.j=482,(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={482:0};o.f.j=(e,n)=>{var r=o.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise((n,o)=>r=t[e]=[n,o]);n.push(r[2]=i);var s=o.p+o.u(e),a=new Error;o.l(s,n=>{if(o.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,r[1](a)}},"chunk-"+e,e)}};var e=(e,n)=>{var r,i,[s,a,l]=n,c=0;if(s.some(e=>0!==t[e])){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);l&&l(o)}for(e&&e(n);c<s.length;c++)i=s[c],o.o(t,i)&&t[i]&&t[i][0](),t[i]=0},n=this.webpackChunkBundle=this.webpackChunkBundle||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),o.nc=void 0;var i={};return(()=>{"use strict";o.r(i),o.d(i,{default:()=>vN});var t={};function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function n(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function s(t,e,n){return(e=function(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}o.r(t),o.d(t,{AbsolutePosition:()=>Yn,AbstractConnector:()=>Xe,AbstractStruct:()=>pi,AbstractType:()=>ko,Array:()=>Fo,ContentAny:()=>xi,ContentBinary:()=>mi,ContentDeleted:()=>gi,ContentDoc:()=>bi,ContentEmbed:()=>vi,ContentFormat:()=>wi,ContentJSON:()=>ki,ContentString:()=>Ci,ContentType:()=>Li,Doc:()=>pn,GC:()=>fi,ID:()=>Hn,Item:()=>Bi,Map:()=>zo,PermanentUserData:()=>qn,RelativePosition:()=>Kn,Skip:()=>Fi,Snapshot:()=>rr,Text:()=>si,Transaction:()=>Er,UndoManager:()=>Hr,UpdateDecoderV1:()=>mn,UpdateDecoderV2:()=>yn,UpdateEncoderV1:()=>vn,UpdateEncoderV2:()=>kn,XmlElement:()=>ci,XmlFragment:()=>li,XmlHook:()=>ui,XmlText:()=>hi,YArrayEvent:()=>Uo,YEvent:()=>uo,YMapEvent:()=>Vo,YTextEvent:()=>ii,YXmlEvent:()=>di,applyUpdate:()=>En,applyUpdateV2:()=>_n,cleanupYTextFormatting:()=>ni,compareIDs:()=>Bn,compareRelativePositions:()=>nr,convertUpdateFormatV1ToV2:()=>ao,convertUpdateFormatV2ToV1:()=>lo,createAbsolutePositionFromRelativePosition:()=>er,createDeleteSet:()=>sn,createDeleteSetFromStructStore:()=>an,createDocFromSnapshot:()=>fr,createID:()=>jn,createRelativePositionFromJSON:()=>Gn,createRelativePositionFromTypeIndex:()=>Qn,createSnapshot:()=>cr,decodeRelativePosition:()=>tr,decodeSnapshot:()=>lr,decodeSnapshotV2:()=>ar,decodeStateVector:()=>On,decodeUpdate:()=>Fr,decodeUpdateV2:()=>Vr,diffUpdate:()=>Zr,diffUpdateV2:()=>Qr,emptySnapshot:()=>dr,encodeRelativePosition:()=>Zn,encodeSnapshot:()=>sr,encodeSnapshotV2:()=>ir,encodeStateAsUpdate:()=>Mn,encodeStateAsUpdateV2:()=>Tn,encodeStateVector:()=>Rn,encodeStateVectorFromUpdate:()=>Kr,encodeStateVectorFromUpdateV2:()=>qr,equalDeleteSets:()=>un,equalSnapshots:()=>or,findIndexSS:()=>wr,findRootTypeKey:()=>Vn,getItem:()=>kr,getItemCleanEnd:()=>Cr,getItemCleanStart:()=>xr,getState:()=>br,getTypeChildren:()=>vo,isDeleted:()=>en,isParentOf:()=>zn,iterateDeletedStructs:()=>tn,logType:()=>Wn,logUpdate:()=>jr,logUpdateV2:()=>Ur,mergeDeleteSets:()=>rn,mergeUpdates:()=>Wr,mergeUpdatesV2:()=>Xr,obfuscateUpdate:()=>io,obfuscateUpdateV2:()=>so,parseUpdateMeta:()=>Gr,parseUpdateMetaV2:()=>Jr,readUpdate:()=>Cn,readUpdateV2:()=>xn,relativePositionToJSON:()=>Jn,snapshot:()=>ur,snapshotContainsUpdate:()=>mr,transact:()=>Nr,tryGc:()=>Rr,typeListToArraySnapshot:()=>Co,typeMapGetAllSnapshot:()=>Bo,typeMapGetSnapshot:()=>Ho});const a=Math.floor,l=127,c=Number.MAX_SAFE_INTEGER,d="undefined"!=typeof TextEncoder?new TextEncoder:null,u=d?t=>d.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.codePointAt(t);return r};let h="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});h&&1===h.decode(new Uint8Array).length&&(h=null);const p=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},f=(t,e)=>{for(;e>l;)p(t,128|l&e),e=a(e/128);p(t,l&e)},m=new Uint8Array(3e4),g=m.length/3,y=d&&d.encodeInto?(t,e)=>{if(e.length<g){const n=d.encodeInto(e,m).written||0;f(t,n);for(let e=0;e<n;e++)p(t,m[e])}else b(t,u(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;f(t,r);for(let e=0;e<r;e++)p(t,n.codePointAt(e))},b=(t,e)=>{f(t,e.byteLength),((t,e)=>{const n=t.cbuf.length,r=t.cpos,o=(i=n-r)<(s=e.length)?i:s;var i,s;const a=e.length-o;t.cbuf.set(e.subarray(0,o),r),t.cpos+=o,a>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(((t,e)=>t>e?t:e)(2*n,a)),t.cbuf.set(e.subarray(o)),t.cpos=a)})(t,e)},v=t=>new Error(t),w=v("Unexpected end of array"),k=v("Integer out of Range"),S=t=>t.arr[t.pos++],x=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const r=t.arr[t.pos++];if(e+=(r&l)*n,n*=128,r<128)return e;if(e>c)throw k}throw w},C=h?t=>h.decode((t=>((t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n})(t,x(t)))(t)):t=>{let e=x(t);if(0===e)return"";{let n=String.fromCodePoint(S(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(S(t));else for(;e>0;){const r=e<1e4?e:1e4,o=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,o),e-=r}return decodeURIComponent(escape(n))}};var _;!function(t){t[t.Token=0]="Token",t[t.PermissionDenied=1]="PermissionDenied",t[t.Authenticated=2]="Authenticated"}(_||(_={}));const E=t=>Array.from(t.entries()).map(([t,e])=>({clientId:t,...e}));var T;!function(t){t[t.Connecting=0]="Connecting",t[t.Open=1]="Open",t[t.Closing=2]="Closing",t[t.Closed=3]="Closed"}(T||(T={}));const M=()=>new Map,A=t=>{const e=M();return t.forEach((t,n)=>{e.set(n,t)}),e},O=(t,e,n)=>{let r=t.get(e);return void 0===r&&t.set(e,r=n()),r},D=()=>new Set,R=t=>t[t.length-1],L=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},N=Array.from,I=Array.isArray;class P{constructor(){this._observers=M()}on(t,e){return O(this._observers,t,D).add(e),e}once(t,e){const n=(...r)=>{this.off(t,n),e(...r)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return N((this._observers.get(t)||M()).values()).forEach(t=>t(...e))}destroy(){this._observers=M()}}class ${constructor(){this._observers=M()}on(t,e){O(this._observers,t,D).add(e)}once(t,e){const n=(...r)=>{this.off(t,n),e(...r)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return N((this._observers.get(t)||M()).values()).forEach(t=>t(...e))}destroy(){this._observers=M()}}const H=Math.floor,B=(Math.ceil,Math.abs),j=(Math.imul,Math.round,Math.log10),U=(Math.log2,Math.log,Math.sqrt,(t,e)=>t<e?t:e),F=(t,e)=>t>e?t:e,V=(Number.isNaN,Math.pow,Math.sign,t=>0!==t?t<0:1/t<0),z=64,W=128,q=127,K=Number.MAX_SAFE_INTEGER,J=(Number.MIN_SAFE_INTEGER,Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&H(t)===t)),G=(Number.isNaN,Number.parseInt,String.fromCharCode),Y=(String.fromCodePoint,G(65535),/^\s*/g),X=/([A-Z])/g,Q=(t,e)=>(t=>t.replace(Y,""))(t.replace(X,t=>`${e}${(t=>t.toLowerCase())(t)}`)),Z="undefined"!=typeof TextEncoder?new TextEncoder:null,tt=Z?t=>Z.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.codePointAt(t);return r};let et="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});et&&1===et.decode(new Uint8Array).length&&(et=null);class nt{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const rt=()=>new nt,ot=t=>{const e=new Uint8Array((t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e})(t));let n=0;for(let r=0;r<t.bufs.length;r++){const o=t.bufs[r];e.set(o,n),n+=o.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},it=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},st=it,at=(t,e)=>{for(;e>q;)it(t,W|q&e),e=H(e/128);it(t,q&e)},lt=(t,e)=>{const n=V(e);for(n&&(e=-e),it(t,(e>63?W:0)|(n?z:0)|63&e),e=H(e/64);e>0;)it(t,(e>q?W:0)|q&e),e=H(e/128)},ct=new Uint8Array(3e4),dt=ct.length/3,ut=Z&&Z.encodeInto?(t,e)=>{if(e.length<dt){const n=Z.encodeInto(e,ct).written||0;at(t,n);for(let e=0;e<n;e++)it(t,ct[e])}else pt(t,tt(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;at(t,r);for(let e=0;e<r;e++)it(t,n.codePointAt(e))},ht=(t,e)=>{const n=t.cbuf.length,r=t.cpos,o=U(n-r,e.length),i=e.length-o;t.cbuf.set(e.subarray(0,o),r),t.cpos+=o,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(F(2*n,i)),t.cbuf.set(e.subarray(o)),t.cpos=i)},pt=(t,e)=>{at(t,e.byteLength),ht(t,e)},ft=(t,e)=>{((t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*F(n,e)),t.cpos=0)})(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},mt=new DataView(new ArrayBuffer(4)),gt=(t,e)=>{switch(typeof e){case"string":it(t,119),ut(t,e);break;case"number":J(e)&&B(e)<=2147483647?(it(t,125),lt(t,e)):(n=e,mt.setFloat32(0,n),mt.getFloat32(0)===n?(it(t,124),((t,e)=>{ft(t,4).setFloat32(0,e,!1)})(t,e)):(it(t,123),((t,e)=>{ft(t,8).setFloat64(0,e,!1)})(t,e)));break;case"bigint":it(t,122),((t,e)=>{ft(t,8).setBigInt64(0,e,!1)})(t,e);break;case"object":if(null===e)it(t,126);else if(I(e)){it(t,117),at(t,e.length);for(let n=0;n<e.length;n++)gt(t,e[n])}else if(e instanceof Uint8Array)it(t,116),pt(t,e);else{it(t,118);const n=Object.keys(e);at(t,n.length);for(let r=0;r<n.length;r++){const o=n[r];ut(t,o),gt(t,e[o])}}break;case"boolean":it(t,e?120:121);break;default:it(t,127)}var n};class yt extends nt{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&at(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const bt=t=>{t.count>0&&(lt(t.encoder,1===t.count?t.s:-t.s),t.count>1&&at(t.encoder,t.count-2))};class vt{constructor(){this.encoder=new nt,this.s=0,this.count=0}write(t){this.s===t?this.count++:(bt(this),this.count=1,this.s=t)}toUint8Array(){return bt(this),ot(this.encoder)}}const wt=t=>{if(t.count>0){const e=2*t.diff+(1===t.count?0:1);lt(t.encoder,e),t.count>1&&at(t.encoder,t.count-2)}};class kt{constructor(){this.encoder=new nt,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(wt(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return wt(this),ot(this.encoder)}}class St{constructor(){this.sarr=[],this.s="",this.lensE=new vt}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new nt;return this.sarr.push(this.s),this.s="",ut(t,this.sarr.join("")),ht(t,this.lensE.toUint8Array()),ot(t)}}const xt=t=>new Error(t),Ct=()=>{throw xt("Method unimplemented")},_t=()=>{throw xt("Unexpected case")},Et=xt("Unexpected end of array"),Tt=xt("Integer out of Range");class Mt{constructor(t){this.arr=t,this.pos=0}}const At=t=>new Mt(t),Ot=t=>t.pos!==t.arr.length,Dt=t=>((t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n})(t,Lt(t)),Rt=t=>t.arr[t.pos++],Lt=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const r=t.arr[t.pos++];if(e+=(r&q)*n,n*=128,r<W)return e;if(e>K)throw Tt}throw Et},Nt=t=>{let e=t.arr[t.pos++],n=63&e,r=64;const o=(e&z)>0?-1:1;if(0===(e&W))return o*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n+=(e&q)*r,r*=128,e<W)return o*n;if(n>K)throw Tt}throw Et},It=et?t=>et.decode(Dt(t)):t=>{let e=Lt(t);if(0===e)return"";{let n=String.fromCodePoint(Rt(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Rt(t));else for(;e>0;){const r=e<1e4?e:1e4,o=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,o),e-=r}return decodeURIComponent(escape(n))}},Pt=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},$t=[t=>{},t=>null,Nt,t=>Pt(t,4).getFloat32(0,!1),t=>Pt(t,8).getFloat64(0,!1),t=>Pt(t,8).getBigInt64(0,!1),t=>!1,t=>!0,It,t=>{const e=Lt(t),n={};for(let r=0;r<e;r++)n[It(t)]=Ht(t);return n},t=>{const e=Lt(t),n=[];for(let r=0;r<e;r++)n.push(Ht(t));return n},Dt],Ht=t=>$t[127-Rt(t)](t);class Bt extends Mt{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),Ot(this)?this.count=Lt(this)+1:this.count=-1),this.count--,this.s}}class jt extends Mt{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=Nt(this);const t=V(this.s);this.count=1,t&&(this.s=-this.s,this.count=Lt(this)+2)}return this.count--,this.s}}class Ut extends Mt{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=Nt(this),e=1&t;this.diff=H(t/2),this.count=1,e&&(this.count=Lt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ft{constructor(t){this.decoder=new jt(t),this.str=It(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}crypto.subtle;const Vt=crypto.getRandomValues.bind(crypto),zt=Math.random,Wt=()=>Vt(new Uint32Array(1))[0],qt=[1e7]+-1e3+-4e3+-8e3+-1e11,Kt=()=>qt.replace(/[018]/g,t=>(t^Wt()&15>>t/4).toString(16)),Jt=t=>new Promise(t),Gt=(Promise.all.bind(Promise),t=>Promise.resolve(t));let Yt=new class{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}},Xt=!0;try{"undefined"!=typeof localStorage&&localStorage&&(Yt=localStorage,Xt=!1)}catch(t){}const Qt=Yt,Zt=Object.assign,te=Object.keys,ee=(Object.values,t=>te(t).length),ne=t=>te(t).length,re=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},oe=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),ie=Object.freeze,se=t=>{for(const e in t){const n=t[e];"object"!=typeof n&&"function"!=typeof n||se(t[e])}return ie(t)},ae=Symbol("Equality"),le=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&le(t,e,n+1)}},ce=()=>{},de=t=>t,ue=(t,e)=>{if(t===e)return!0;if(null==t||null==e||t.constructor!==e.constructor)return!1;if(null!=t[ae])return t[ae](e);switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break;case Set:if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break;case Map:if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!ue(t.get(n),e.get(n)))return!1;break;case Object:if(ee(t)!==ee(e))return!1;for(const n in t)if(!oe(t,n)||!ue(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!ue(t[n],e[n]))return!1;break;default:return!1}return!0},he="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0),pe="undefined"!=typeof window&&"undefined"!=typeof document&&!he;let fe;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const me=[],ge=t=>(()=>{if(void 0===fe)if(he){fe=M();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];"-"===r[0]?(null!==e&&fe.set(e,""),e=r):null!==e?(fe.set(e,r),e=null):me.push(r)}null!==e&&fe.set(e,"")}else"object"==typeof location?(fe=M(),(location.search||"?").slice(1).split("&").forEach(t=>{if(0!==t.length){const[e,n]=t.split("=");fe.set(`--${Q(e,"-")}`,n),fe.set(`-${Q(e,"-")}`,n)}})):fe=M();return fe})().has(t),ye=t=>{return void 0===(e=he?process.env[t.toUpperCase().replaceAll("-","_")]:Qt.getItem(t))?null:e;var e},be=t=>ge("--"+t)||null!==ye(t),ve=(be("production"),he&&(Ce=process.env.FORCE_COLOR,["true","1","2"].includes(Ce)))||!ge("--no-colors")&&!be("no-color")&&(!he||process.stdout.isTTY)&&(!he||ge("--color")||null!==ye("COLORTERM")||(ye("TERM")||"").includes("color")),we=t=>new Uint8Array(t),ke=pe?t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=G(t[n]);return btoa(e)}:t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),Se=pe?t=>{const e=atob(t),n=we(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}:t=>{const e=Buffer.from(t,"base64");return((t,e,n)=>new Uint8Array(t,e,n))(e.buffer,e.byteOffset,e.byteLength)},xe=t=>(()=>{const e=rt();return(e=>{gt(e,t)})(e),ot(e)})();var Ce;class _e{constructor(t,e){this.left=t,this.right=e}}const Ee=(t,e)=>new _e(t,e),Te="undefined"!=typeof document?document:{},Me=("undefined"!=typeof DOMParser&&new DOMParser,t=>((t,e)=>{const n=[];for(const[r,o]of t)n.push(e(o,r));return n})(t,(t,e)=>`${e}:${t};`).join("")),Ae=(Te.ELEMENT_NODE,Te.TEXT_NODE,Te.CDATA_SECTION_NODE,Te.COMMENT_NODE,Te.DOCUMENT_NODE,Te.DOCUMENT_TYPE_NODE,Te.DOCUMENT_FRAGMENT_NODE,Symbol),Oe=Date.now,De=JSON.stringify,Re=(JSON.parse,Ae()),Le=Ae(),Ne=Ae(),Ie=Ae(),Pe=Ae(),$e=Ae(),He=Ae(),Be=Ae(),je=Ae(),Ue=[Pe,He,Be,Ne];let Fe=0,Ve=Oe();const ze={[Re]:Ee("font-weight","bold"),[Le]:Ee("font-weight","normal"),[Ne]:Ee("color","blue"),[Pe]:Ee("color","green"),[Ie]:Ee("color","grey"),[$e]:Ee("color","red"),[He]:Ee("color","purple"),[Be]:Ee("color","orange"),[je]:Ee("color","black")},We=ve?t=>{1===t.length&&t[0]?.constructor===Function&&(t=t[0]());const e=[],n=[],r=M();let o=[],i=0;for(;i<t.length;i++){const o=t[i],s=ze[o];if(void 0!==s)r.set(s.left,s.right);else{if(void 0===o)break;if(o.constructor!==String&&o.constructor!==Number)break;{const t=Me(r);i>0||t.length>0?(e.push("%c"+o),n.push(t)):e.push(o)}}}for(i>0&&(o=n,o.unshift(e.join("")));i<t.length;i++){const e=t[i];e instanceof Symbol||o.push(e)}return o}:t=>{1===t.length&&t[0]?.constructor===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const n=t[r];if(void 0===n)break;if(n.constructor===String||n.constructor===Number)e.push(n);else if(n.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const e=t[r];e instanceof Symbol||n.push(e)}return n},qe=(...t)=>{console.log(...We(t)),Je.forEach(e=>e.print(t))},Ke=(...t)=>{console.warn(...We(t)),t.unshift(Be),Je.forEach(e=>e.print(t))},Je=D(),Ge=t=>({[Symbol.iterator](){return this},next:t}),Ye=(t,e)=>Ge(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Xe extends P{constructor(t,e){super(),this.doc=t,this.awareness=e}}class Qe{constructor(t,e){this.clock=t,this.len=e}}class Ze{constructor(){this.clients=new Map}}const tn=(t,e,n)=>e.clients.forEach((e,r)=>{const o=t.doc.store.clients.get(r);if(null!=o){const r=o[o.length-1],i=r.id.clock+r.length;for(let r=0,s=e[r];r<e.length&&s.clock<i;s=e[++r])_r(t,o,s.clock,s.len,n)}}),en=(t,e)=>{const n=t.clients.get(e.client);return void 0!==n&&null!==((t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const o=H((n+r)/2),i=t[o],s=i.clock;if(s<=e){if(e<s+i.len)return o;n=o+1}else r=o-1}return null})(n,e.clock)},nn=t=>{t.clients.forEach(t=>{let e,n;for(t.sort((t,e)=>t.clock-e.clock),e=1,n=1;e<t.length;e++){const r=t[n-1],o=t[e];r.clock+r.len>=o.clock?r.len=F(r.len,o.clock+o.len-r.clock):(n<e&&(t[n]=o),n++)}t.length=n})},rn=t=>{const e=new Ze;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,o)=>{if(!e.clients.has(o)){const i=r.slice();for(let e=n+1;e<t.length;e++)L(i,t[e].clients.get(o)||[]);e.clients.set(o,i)}});return nn(e),e},on=(t,e,n,r)=>{O(t.clients,e,()=>[]).push(new Qe(n,r))},sn=()=>new Ze,an=t=>{const e=sn();return t.clients.forEach((t,n)=>{const r=[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted){const o=n.id.clock;let i=n.length;if(e+1<t.length)for(let n=t[e+1];e+1<t.length&&n.deleted;n=t[1+ ++e])i+=n.length;r.push(new Qe(o,i))}}r.length>0&&e.clients.set(n,r)}),e},ln=(t,e)=>{at(t.restEncoder,e.clients.size),N(e.clients.entries()).sort((t,e)=>e[0]-t[0]).forEach(([e,n])=>{t.resetDsCurVal(),at(t.restEncoder,e);const r=n.length;at(t.restEncoder,r);for(let e=0;e<r;e++){const r=n[e];t.writeDsClock(r.clock),t.writeDsLen(r.len)}})},cn=t=>{const e=new Ze,n=Lt(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const n=Lt(t.restDecoder),r=Lt(t.restDecoder);if(r>0){const o=O(e.clients,n,()=>[]);for(let e=0;e<r;e++)o.push(new Qe(t.readDsClock(),t.readDsLen()))}}return e},dn=(t,e,n)=>{const r=new Ze,o=Lt(t.restDecoder);for(let i=0;i<o;i++){t.resetDsCurVal();const o=Lt(t.restDecoder),i=Lt(t.restDecoder),s=n.clients.get(o)||[],a=br(n,o);for(let n=0;n<i;n++){const n=t.readDsClock(),i=n+t.readDsLen();if(n<a){a<i&&on(r,o,a,i-a);let t=wr(s,n),l=s[t];for(!l.deleted&&l.id.clock<n&&(s.splice(t+1,0,Pi(e,l,n-l.id.clock)),t++);t<s.length&&(l=s[t++],l.id.clock<i);)l.deleted||(i<l.id.clock+l.length&&s.splice(t,0,Pi(e,l,i-l.id.clock)),l.delete(e))}else on(r,o,n,i-n)}}if(r.clients.size>0){const t=new kn;return at(t.restEncoder,0),ln(t,r),t.toUint8Array()}return null},un=(t,e)=>{if(t.clients.size!==e.clients.size)return!1;for(const[n,r]of t.clients.entries()){const t=e.clients.get(n);if(void 0===t||r.length!==t.length)return!1;for(let e=0;e<r.length;e++){const n=r[e],o=t[e];if(n.clock!==o.clock||n.len!==o.len)return!1}}return!0},hn=Wt;class pn extends P{constructor({guid:t=Kt(),collectionid:e=null,gc:n=!0,gcFilter:r=()=>!0,meta:o=null,autoLoad:i=!1,shouldLoad:s=!0}={}){super(),this.gc=n,this.gcFilter=r,this.clientID=hn(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new gr,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=s,this.autoLoad=i,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Jt(t=>{this.on("load",()=>{this.isLoaded=!0,t(this)})});const a=()=>Jt(t=>{const e=n=>{void 0!==n&&!0!==n||(this.off("sync",e),t())};this.on("sync",e)});this.on("sync",t=>{!1===t&&this.isSynced&&(this.whenSynced=a()),this.isSynced=void 0===t||!0===t,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=a()}load(){const t=this._item;null===t||this.shouldLoad||Nr(t.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(N(this.subdocs).map(t=>t.guid))}transact(t,e=null){return Nr(this,t,e)}get(t,e=ko){const n=O(this.share,t,()=>{const t=new e;return t._integrate(this,null),t}),r=n.constructor;if(e!==ko&&r!==e){if(r===ko){const r=new e;r._map=n._map,n._map.forEach(t=>{for(;null!==t;t=t.left)t.parent=r}),r._start=n._start;for(let t=r._start;null!==t;t=t.right)t.parent=r;return r._length=n._length,this.share.set(t,r),r._integrate(this,null),r}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return n}getArray(t=""){return this.get(t,Fo)}getText(t=""){return this.get(t,si)}getMap(t=""){return this.get(t,zo)}getXmlElement(t=""){return this.get(t,ci)}getXmlFragment(t=""){return this.get(t,li)}toJSON(){const t={};return this.share.forEach((e,n)=>{t[n]=e.toJSON()}),t}destroy(){this.isDestroyed=!0,N(this.subdocs).forEach(t=>t.destroy());const t=this._item;if(null!==t){this._item=null;const e=t.content;e.doc=new pn({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,Nr(t.parent.doc,n=>{const r=e.doc;t.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class fn{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Lt(this.restDecoder)}readDsLen(){return Lt(this.restDecoder)}}class mn extends fn{readLeftID(){return jn(Lt(this.restDecoder),Lt(this.restDecoder))}readRightID(){return jn(Lt(this.restDecoder),Lt(this.restDecoder))}readClient(){return Lt(this.restDecoder)}readInfo(){return Rt(this.restDecoder)}readString(){return It(this.restDecoder)}readParentInfo(){return 1===Lt(this.restDecoder)}readTypeRef(){return Lt(this.restDecoder)}readLen(){return Lt(this.restDecoder)}readAny(){return Ht(this.restDecoder)}readBuf(){return(t=>{const e=we(t.byteLength);return e.set(t),e})(Dt(this.restDecoder))}readJSON(){return JSON.parse(It(this.restDecoder))}readKey(){return It(this.restDecoder)}}class gn{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Lt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Lt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class yn extends gn{constructor(t){super(t),this.keys=[],Lt(t),this.keyClockDecoder=new Ut(Dt(t)),this.clientDecoder=new jt(Dt(t)),this.leftClockDecoder=new Ut(Dt(t)),this.rightClockDecoder=new Ut(Dt(t)),this.infoDecoder=new Bt(Dt(t),Rt),this.stringDecoder=new Ft(Dt(t)),this.parentInfoDecoder=new Bt(Dt(t),Rt),this.typeRefDecoder=new jt(Dt(t)),this.lenDecoder=new jt(Dt(t))}readLeftID(){return new Hn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Hn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ht(this.restDecoder)}readBuf(){return Dt(this.restDecoder)}readJSON(){return Ht(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class bn{constructor(){this.restEncoder=rt()}toUint8Array(){return ot(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){at(this.restEncoder,t)}writeDsLen(t){at(this.restEncoder,t)}}class vn extends bn{writeLeftID(t){at(this.restEncoder,t.client),at(this.restEncoder,t.clock)}writeRightID(t){at(this.restEncoder,t.client),at(this.restEncoder,t.clock)}writeClient(t){at(this.restEncoder,t)}writeInfo(t){st(this.restEncoder,t)}writeString(t){ut(this.restEncoder,t)}writeParentInfo(t){at(this.restEncoder,t?1:0)}writeTypeRef(t){at(this.restEncoder,t)}writeLen(t){at(this.restEncoder,t)}writeAny(t){gt(this.restEncoder,t)}writeBuf(t){pt(this.restEncoder,t)}writeJSON(t){ut(this.restEncoder,JSON.stringify(t))}writeKey(t){ut(this.restEncoder,t)}}class wn{constructor(){this.restEncoder=rt(),this.dsCurrVal=0}toUint8Array(){return ot(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,at(this.restEncoder,e)}writeDsLen(t){0===t&&_t(),at(this.restEncoder,t-1),this.dsCurrVal+=t}}class kn extends wn{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new kt,this.clientEncoder=new vt,this.leftClockEncoder=new kt,this.rightClockEncoder=new kt,this.infoEncoder=new yt(st),this.stringEncoder=new St,this.parentInfoEncoder=new yt(st),this.typeRefEncoder=new vt,this.lenEncoder=new vt}toUint8Array(){const t=rt();return at(t,0),pt(t,this.keyClockEncoder.toUint8Array()),pt(t,this.clientEncoder.toUint8Array()),pt(t,this.leftClockEncoder.toUint8Array()),pt(t,this.rightClockEncoder.toUint8Array()),pt(t,ot(this.infoEncoder)),pt(t,this.stringEncoder.toUint8Array()),pt(t,ot(this.parentInfoEncoder)),pt(t,this.typeRefEncoder.toUint8Array()),pt(t,this.lenEncoder.toUint8Array()),ht(t,ot(this.restEncoder)),ot(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){gt(this.restEncoder,t)}writeBuf(t){pt(this.restEncoder,t)}writeJSON(t){gt(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Sn=(t,e,n)=>{const r=new Map;n.forEach((t,n)=>{br(e,n)>t&&r.set(n,t)}),yr(e).forEach((t,e)=>{n.has(e)||r.set(e,0)}),at(t.restEncoder,r.size),N(r.entries()).sort((t,e)=>e[0]-t[0]).forEach(([n,r])=>{((t,e,n,r)=>{r=F(r,e[0].id.clock);const o=wr(e,r);at(t.restEncoder,e.length-o),t.writeClient(n),at(t.restEncoder,r);const i=e[o];i.write(t,r-i.id.clock);for(let n=o+1;n<e.length;n++)e[n].write(t,0)})(t,e.clients.get(n),n,r)})},xn=(t,e,n,r=new yn(t))=>Nr(e,t=>{t.local=!1;let e=!1;const n=t.doc,o=n.store,i=((t,e)=>{const n=M(),r=Lt(t.restDecoder);for(let o=0;o<r;o++){const r=Lt(t.restDecoder),o=new Array(r),i=t.readClient();let s=Lt(t.restDecoder);n.set(i,{i:0,refs:o});for(let n=0;n<r;n++){const r=t.readInfo();switch(31&r){case 0:{const e=t.readLen();o[n]=new fi(jn(i,s),e),s+=e;break}case 10:{const e=Lt(t.restDecoder);o[n]=new Fi(jn(i,s),e),s+=e;break}default:{const a=!(192&r),l=new Bi(jn(i,s),null,(r&W)===W?t.readLeftID():null,null,(r&z)===z?t.readRightID():null,a?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,!a||32&~r?null:t.readString(),ji(t,r));o[n]=l,s+=l.length}}}}return n})(r,n),s=((t,e,n)=>{const r=[];let o=N(n.keys()).sort((t,e)=>t-e);if(0===o.length)return null;const i=()=>{if(0===o.length)return null;let t=n.get(o[o.length-1]);for(;t.refs.length===t.i;){if(o.pop(),!(o.length>0))return null;t=n.get(o[o.length-1])}return t};let s=i();if(null===s)return null;const a=new gr,l=new Map,c=(t,e)=>{const n=l.get(t);(null==n||n>e)&&l.set(t,e)};let d=s.refs[s.i++];const u=new Map,h=()=>{for(const t of r){const e=t.id.client,r=n.get(e);r?(r.i--,a.clients.set(e,r.refs.slice(r.i)),n.delete(e),r.i=0,r.refs=[]):a.clients.set(e,[t]),o=o.filter(t=>t!==e)}r.length=0};for(;;){if(d.constructor!==Fi){const o=O(u,d.id.client,()=>br(e,d.id.client))-d.id.clock;if(o<0)r.push(d),c(d.id.client,d.id.clock-1),h();else{const i=d.getMissing(t,e);if(null!==i){r.push(d);const t=n.get(i)||{refs:[],i:0};if(t.refs.length!==t.i){d=t.refs[t.i++];continue}c(i,br(e,i)),h()}else(0===o||o<d.length)&&(d.integrate(t,o),u.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(null!==s&&s.i<s.refs.length)d=s.refs[s.i++];else{if(s=i(),null===s)break;d=s.refs[s.i++]}}if(a.clients.size>0){const t=new kn;return Sn(t,a,new Map),at(t.restEncoder,0),{missing:l,update:t.toUint8Array()}}return null})(t,o,i),a=o.pendingStructs;if(a){for(const[t,n]of a.missing)if(n<br(o,t)){e=!0;break}if(s){for(const[t,e]of s.missing){const n=a.missing.get(t);(null==n||n>e)&&a.missing.set(t,e)}a.update=Xr([a.update,s.update])}}else o.pendingStructs=s;const l=dn(r,t,o);if(o.pendingDs){const e=new yn(At(o.pendingDs));Lt(e.restDecoder);const n=dn(e,t,o);o.pendingDs=l&&n?Xr([l,n]):l||n}else o.pendingDs=l;if(e){const e=o.pendingStructs.update;o.pendingStructs=null,_n(t.doc,e)}},n,!1),Cn=(t,e,n)=>xn(t,e,n,new mn(t)),_n=(t,e,n,r=yn)=>{const o=At(e);xn(o,t,n,new r(o))},En=(t,e,n)=>_n(t,e,n,mn),Tn=(t,e=new Uint8Array([0]),n=new kn)=>{((t,e,n=new Map)=>{Sn(t,e.store,n),ln(t,an(e.store))})(n,t,On(e));const r=[n.toUint8Array()];if(t.store.pendingDs&&r.push(t.store.pendingDs),t.store.pendingStructs&&r.push(Qr(t.store.pendingStructs.update,e)),r.length>1){if(n.constructor===vn)return Wr(r.map((t,e)=>0===e?t:lo(t)));if(n.constructor===kn)return Xr(r)}return r[0]},Mn=(t,e)=>Tn(t,e,new vn),An=t=>{const e=new Map,n=Lt(t.restDecoder);for(let r=0;r<n;r++){const n=Lt(t.restDecoder),r=Lt(t.restDecoder);e.set(n,r)}return e},On=t=>An(new fn(At(t))),Dn=(t,e)=>(at(t.restEncoder,e.size),N(e.entries()).sort((t,e)=>e[0]-t[0]).forEach(([e,n])=>{at(t.restEncoder,e),at(t.restEncoder,n)}),t),Rn=t=>((t,e=new wn)=>(t instanceof Map?Dn(e,t):((t,e)=>{Dn(t,yr(e.store))})(e,t),e.toUint8Array()))(t,new bn);class Ln{constructor(){this.l=[]}}const Nn=()=>new Ln,In=(t,e)=>t.l.push(e),Pn=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(t=>e!==t),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},$n=(t,e,n)=>le(t.l,[e,n]);class Hn{constructor(t,e){this.client=t,this.clock=e}}const Bn=(t,e)=>t===e||null!==t&&null!==e&&t.client===e.client&&t.clock===e.clock,jn=(t,e)=>new Hn(t,e),Un=(t,e)=>{at(t,e.client),at(t,e.clock)},Fn=t=>jn(Lt(t),Lt(t)),Vn=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw _t()},zn=(t,e)=>{for(;null!==e;){if(e.parent===t)return!0;e=e.parent._item}return!1},Wn=t=>{const e=[];let n=t._start;for(;n;)e.push(n),n=n.right;console.log("Children: ",e),console.log("Children content: ",e.filter(t=>!t.deleted).map(t=>t.content))};class qn{constructor(t,e=t.getMap("users")){const n=new Map;this.yusers=e,this.doc=t,this.clients=new Map,this.dss=n;const r=(t,e)=>{const n=t.get("ds"),r=t.get("ids"),o=t=>this.clients.set(t,e);n.observe(t=>{t.changes.added.forEach(t=>{t.content.getContent().forEach(t=>{t instanceof Uint8Array&&this.dss.set(e,rn([this.dss.get(e)||sn(),cn(new fn(At(t)))]))})})}),this.dss.set(e,rn(n.map(t=>cn(new fn(At(t)))))),r.observe(t=>t.changes.added.forEach(t=>t.content.getContent().forEach(o))),r.forEach(o)};e.observe(t=>{t.keysChanged.forEach(t=>r(e.get(t),t))}),e.forEach(r)}setUserMapping(t,e,n,{filter:r=()=>!0}={}){const o=this.yusers;let i=o.get(n);i||(i=new zo,i.set("ids",new Fo),i.set("ds",new Fo),o.set(n,i)),i.get("ids").push([e]),o.observe(t=>{setTimeout(()=>{const t=o.get(n);if(t!==i){i=t,this.clients.forEach((t,e)=>{n===t&&i.get("ids").push([e])});const e=new bn,r=this.dss.get(n);r&&(ln(e,r),i.get("ds").push([e.toUint8Array()]))}},0)}),t.on("afterTransaction",t=>{setTimeout(()=>{const e=i.get("ds"),n=t.deleteSet;if(t.local&&n.clients.size>0&&r(t,n)){const t=new bn;ln(t,n),e.push([t.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[e,n]of this.dss.entries())if(en(n,t))return e;return null}}class Kn{constructor(t,e,n,r=0){this.type=t,this.tname=e,this.item=n,this.assoc=r}}const Jn=t=>{const e={};return t.type&&(e.type=t.type),t.tname&&(e.tname=t.tname),t.item&&(e.item=t.item),null!=t.assoc&&(e.assoc=t.assoc),e},Gn=t=>new Kn(null==t.type?null:jn(t.type.client,t.type.clock),t.tname??null,null==t.item?null:jn(t.item.client,t.item.clock),null==t.assoc?0:t.assoc);class Yn{constructor(t,e,n=0){this.type=t,this.index=e,this.assoc=n}}const Xn=(t,e,n)=>{let r=null,o=null;return null===t._item?o=Vn(t):r=jn(t._item.id.client,t._item.id.clock),new Kn(r,o,e,n)},Qn=(t,e,n=0)=>{let r=t._start;if(n<0){if(0===e)return Xn(t,null,n);e--}for(;null!==r;){if(!r.deleted&&r.countable){if(r.length>e)return Xn(t,jn(r.id.client,r.id.clock+e),n);e-=r.length}if(null===r.right&&n<0)return Xn(t,r.lastId,n);r=r.right}return Xn(t,null,n)},Zn=t=>{const e=rt();return((t,e)=>{const{type:n,tname:r,item:o,assoc:i}=e;if(null!==o)at(t,0),Un(t,o);else if(null!==r)st(t,1),ut(t,r);else{if(null===n)throw _t();st(t,2),Un(t,n)}lt(t,i)})(e,t),ot(e)},tr=t=>(t=>{let e=null,n=null,r=null;switch(Lt(t)){case 0:r=Fn(t);break;case 1:n=It(t);break;case 2:e=Fn(t)}const o=Ot(t)?Nt(t):0;return new Kn(e,n,r,o)})(At(t)),er=(t,e,n=!0)=>{const r=e.store,o=t.item,i=t.type,s=t.tname,a=t.assoc;let l=null,c=0;if(null!==o){if(br(r,o.client)<=o.clock)return null;const t=n?Ni(r,o):((t,e)=>{const n=kr(t,e);return{item:n,diff:e.clock-n.id.clock}})(r,o),e=t.item;if(!(e instanceof Bi))return null;if(l=e.parent,null===l._item||!l._item.deleted){c=e.deleted||!e.countable?0:t.diff+(a>=0?0:1);let n=e.left;for(;null!==n;)!n.deleted&&n.countable&&(c+=n.length),n=n.left}}else{if(null!==s)l=e.get(s);else{if(null===i)throw _t();{if(br(r,i.client)<=i.clock)return null;const{item:t}=n?Ni(r,i):{item:kr(r,i)};if(!(t instanceof Bi&&t.content instanceof Li))return null;l=t.content.type}}c=a>=0?l._length:0}return((t,e,n=0)=>new Yn(t,e,n))(l,c,t.assoc)},nr=(t,e)=>t===e||null!==t&&null!==e&&t.tname===e.tname&&Bn(t.item,e.item)&&Bn(t.type,e.type)&&t.assoc===e.assoc;class rr{constructor(t,e){this.ds=t,this.sv=e}}const or=(t,e)=>{const n=t.ds.clients,r=e.ds.clients,o=t.sv,i=e.sv;if(o.size!==i.size||n.size!==r.size)return!1;for(const[t,e]of o.entries())if(i.get(t)!==e)return!1;for(const[t,e]of n.entries()){const n=r.get(t)||[];if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++){const r=e[t],o=n[t];if(r.clock!==o.clock||r.len!==o.len)return!1}}return!0},ir=(t,e=new wn)=>(ln(e,t.ds),Dn(e,t.sv),e.toUint8Array()),sr=t=>ir(t,new bn),ar=(t,e=new gn(At(t)))=>new rr(cn(e),An(e)),lr=t=>ar(t,new fn(At(t))),cr=(t,e)=>new rr(t,e),dr=cr(sn(),new Map),ur=t=>cr(an(t.store),yr(t.store)),hr=(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!en(e.ds,t.id),pr=(t,e)=>{const n=O(t.meta,pr,D),r=t.doc.store;n.has(e)||(e.sv.forEach((e,n)=>{e<br(r,n)&&xr(t,jn(n,e))}),tn(t,e.ds,t=>{}),n.add(e))},fr=(t,e,n=new pn)=>{if(t.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:r,ds:o}=e,i=new kn;return t.transact(e=>{let n=0;r.forEach(t=>{t>0&&n++}),at(i.restEncoder,n);for(const[n,o]of r){if(0===o)continue;o<br(t.store,n)&&xr(e,jn(n,o));const r=t.store.clients.get(n)||[],s=wr(r,o-1);at(i.restEncoder,s+1),i.writeClient(n),at(i.restEncoder,0);for(let t=0;t<=s;t++)r[t].write(i,0)}ln(i,o)}),_n(n,i.toUint8Array(),"snapshot"),n},mr=(t,e)=>((t,e,n=yn)=>{const r=new n(At(e)),o=new Br(r,!1);for(let e=o.curr;null!==e;e=o.next())if((t.sv.get(e.id.client)||0)<e.id.clock+e.length)return!1;const i=rn([t.ds,cn(r)]);return un(t.ds,i)})(t,e,mn);class gr{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const yr=t=>{const e=new Map;return t.clients.forEach((t,n)=>{const r=t[t.length-1];e.set(n,r.id.clock+r.length)}),e},br=(t,e)=>{const n=t.clients.get(e);if(void 0===n)return 0;const r=n[n.length-1];return r.id.clock+r.length},vr=(t,e)=>{let n=t.clients.get(e.id.client);if(void 0===n)n=[],t.clients.set(e.id.client,n);else{const t=n[n.length-1];if(t.id.clock+t.length!==e.id.clock)throw _t()}n.push(e)},wr=(t,e)=>{let n=0,r=t.length-1,o=t[r],i=o.id.clock;if(i===e)return r;let s=H(e/(i+o.length-1)*r);for(;n<=r;){if(o=t[s],i=o.id.clock,i<=e){if(e<i+o.length)return s;n=s+1}else r=s-1;s=H((n+r)/2)}throw _t()},kr=(t,e)=>{const n=t.clients.get(e.client);return n[wr(n,e.clock)]},Sr=(t,e,n)=>{const r=wr(e,n),o=e[r];return o.id.clock<n&&o instanceof Bi?(e.splice(r+1,0,Pi(t,o,n-o.id.clock)),r+1):r},xr=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Sr(t,n,e.clock)]},Cr=(t,e,n)=>{const r=e.clients.get(n.client),o=wr(r,n.clock),i=r[o];return n.clock!==i.id.clock+i.length-1&&i.constructor!==fi&&r.splice(o+1,0,Pi(t,i,n.clock-i.id.clock+1)),i},_r=(t,e,n,r,o)=>{if(0===r)return;const i=n+r;let s,a=Sr(t,e,n);do{s=e[a++],i<s.id.clock+s.length&&Sr(t,e,i),o(s)}while(a<e.length&&e[a].id.clock<i)};class Er{constructor(t,e,n){this.doc=t,this.deleteSet=new Ze,this.beforeState=yr(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Tr=(t,e)=>!(0===e.deleteSet.clients.size&&!((t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1})(e.afterState,(t,n)=>e.beforeState.get(n)!==t)||(nn(e.deleteSet),((t,e)=>{Sn(t,e.doc.store,e.beforeState)})(t,e),ln(t,e.deleteSet),0)),Mr=(t,e,n)=>{const r=e._item;(null===r||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&O(t.changed,e,D).add(n)},Ar=(t,e)=>{let n=t[e],r=t[e-1],o=e;for(;o>0&&r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n);n=r,r=t[--o-1])n instanceof Bi&&null!==n.parentSub&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);const i=e-o;return i&&t.splice(e+1-i,i),i},Or=(t,e,n)=>{for(const[r,o]of t.clients.entries()){const t=e.clients.get(r);for(let r=o.length-1;r>=0;r--){const i=o[r],s=i.clock+i.len;for(let r=wr(t,i.clock),o=t[r];r<t.length&&o.id.clock<s;o=t[++r]){const o=t[r];if(i.clock+i.len<=o.id.clock)break;o instanceof Bi&&o.deleted&&!o.keep&&n(o)&&o.gc(e,!1)}}}},Dr=(t,e)=>{t.clients.forEach((t,n)=>{const r=e.clients.get(n);for(let e=t.length-1;e>=0;e--){const n=t[e];for(let t=U(r.length-1,1+wr(r,n.clock+n.len-1)),e=r[t];t>0&&e.id.clock>=n.clock;e=r[t])t-=1+Ar(r,t)}})},Rr=(t,e,n)=>{Or(t,e,n),Dr(t,e)},Lr=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,o=r.store,i=n.deleteSet,s=n._mergeStructs;try{nn(i),n.afterState=yr(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const t=[];n.changed.forEach((e,r)=>t.push(()=>{null!==r._item&&r._item.deleted||r._callObserver(n,e)})),t.push(()=>{n.changedParentTypes.forEach((t,e)=>{e._dEH.l.length>0&&(null===e._item||!e._item.deleted)&&((t=t.filter(t=>null===t.target._item||!t.target._item.deleted)).forEach(t=>{t.currentTarget=e,t._path=null}),t.sort((t,e)=>t.path.length-e.path.length),$n(e._dEH,t,n))})}),t.push(()=>r.emit("afterTransaction",[n,r])),le(t,[]),n._needFormattingCleanup&&ri(n)}finally{r.gc&&Or(i,o,r.gcFilter),Dr(i,o),n.afterState.forEach((t,e)=>{const r=n.beforeState.get(e)||0;if(r!==t){const t=o.clients.get(e),n=F(wr(t,r),1);for(let e=t.length-1;e>=n;)e-=1+Ar(t,e)}});for(let t=s.length-1;t>=0;t--){const{client:e,clock:n}=s[t].id,r=o.clients.get(e),i=wr(r,n);i+1<r.length&&Ar(r,i+1)>1||i>0&&Ar(r,i)}if(n.local||n.afterState.get(r.clientID)===n.beforeState.get(r.clientID)||(qe(Be,Re,"[yjs] ",Le,$e,"Changed the client-id because another client seems to be using it."),r.clientID=hn()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const t=new vn;Tr(t,n)&&r.emit("update",[t.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const t=new kn;Tr(t,n)&&r.emit("updateV2",[t.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=n;(a.size>0||c.size>0||l.size>0)&&(a.forEach(t=>{t.clientID=r.clientID,null==t.collectionid&&(t.collectionid=r.collectionid),r.subdocs.add(t)}),c.forEach(t=>r.subdocs.delete(t)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,n]),c.forEach(t=>t.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Lr(t,e+1)}}},Nr=(t,e,n=null,r=!0)=>{const o=t._transactionCleanups;let i=!1,s=null;null===t._transaction&&(i=!0,t._transaction=new Er(t,n,r),o.push(t._transaction),1===o.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{s=e(t._transaction)}finally{if(i){const e=t._transaction===o[0];t._transaction=null,e&&Lr(o,0)}}return s};class Ir{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const Pr=(t,e,n)=>{tn(t,n.deletions,n=>{n instanceof Bi&&e.scope.some(e=>e===t.doc||zn(e,n))&&Ii(n,!1)})},$r=(t,e,n)=>{let r=null;const o=t.doc,i=t.scope;Nr(o,n=>{for(;e.length>0&&null===t.currStackItem;){const r=o.store,s=e.pop(),a=new Set,l=[];let c=!1;tn(n,s.insertions,t=>{if(t instanceof Bi){if(null!==t.redone){let{item:e,diff:o}=Ni(r,t.id);o>0&&(e=xr(n,jn(e.id.client,e.id.clock+o))),t=e}!t.deleted&&i.some(e=>e===n.doc||zn(e,t))&&l.push(t)}}),tn(n,s.deletions,t=>{t instanceof Bi&&i.some(e=>e===n.doc||zn(e,t))&&!en(s.insertions,t.id)&&a.add(t)}),a.forEach(e=>{c=null!==Hi(n,e,a,s.insertions,t.ignoreRemoteMapChanges,t)||c});for(let e=l.length-1;e>=0;e--){const r=l[e];t.deleteFilter(r)&&(r.delete(n),c=!0)}t.currStackItem=c?s:null}n.changed.forEach((t,e)=>{t.has(null)&&e._searchMarker&&(e._searchMarker.length=0)}),r=n},t);const s=t.currStackItem;if(null!=s){const e=r.changedParentTypes;t.emit("stack-item-popped",[{stackItem:s,type:n,changedParentTypes:e,origin:t},t]),t.currStackItem=null}return s};class Hr extends P{constructor(t,{captureTimeout:e=500,captureTransaction:n=t=>!0,deleteFilter:r=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:i=!1,doc:s=(I(t)?t[0].doc:t instanceof pn?t:t.doc)}={}){super(),this.scope=[],this.doc=s,this.addToScope(t),this.deleteFilter=r,o.add(this),this.trackedOrigins=o,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=i,this.captureTimeout=e,this.afterTransactionHandler=t=>{if(!(this.captureTransaction(t)&&this.scope.some(e=>t.changedParentTypes.has(e)||e===this.doc)&&(this.trackedOrigins.has(t.origin)||t.origin&&this.trackedOrigins.has(t.origin.constructor))))return;const e=this.undoing,n=this.redoing,r=e?this.redoStack:this.undoStack;e?this.stopCapturing():n||this.clear(!1,!0);const o=new Ze;t.afterState.forEach((e,n)=>{const r=t.beforeState.get(n)||0,i=e-r;i>0&&on(o,n,r,i)});const i=Oe();let s=!1;if(this.lastChange>0&&i-this.lastChange<this.captureTimeout&&r.length>0&&!e&&!n){const e=r[r.length-1];e.deletions=rn([e.deletions,t.deleteSet]),e.insertions=rn([e.insertions,o])}else r.push(new Ir(t.deleteSet,o)),s=!0;e||n||(this.lastChange=i),tn(t,t.deleteSet,e=>{e instanceof Bi&&this.scope.some(n=>n===t.doc||zn(n,e))&&Ii(e,!0)});const a=[{stackItem:r[r.length-1],origin:t.origin,type:e?"redo":"undo",changedParentTypes:t.changedParentTypes},this];s?this.emit("stack-item-added",a):this.emit("stack-item-updated",a)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){const e=new Set(this.scope);(t=I(t)?t:[t]).forEach(t=>{e.has(t)||(e.add(t),(t instanceof ko?t.doc!==this.doc:t!==this.doc)&&Ke("[yjs#509] Not same Y.Doc"),this.scope.push(t))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(n=>{t&&(this.undoStack.forEach(t=>Pr(n,this,t)),this.undoStack=[]),e&&(this.redoStack.forEach(t=>Pr(n,this,t)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){let t;this.undoing=!0;try{t=$r(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){let t;this.redoing=!0;try{t=$r(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class Br{constructor(t,e){this.gen=function*(t){const e=Lt(t.restDecoder);for(let n=0;n<e;n++){const e=Lt(t.restDecoder),n=t.readClient();let r=Lt(t.restDecoder);for(let o=0;o<e;o++){const e=t.readInfo();if(10===e){const e=Lt(t.restDecoder);yield new Fi(jn(n,r),e),r+=e}else if(31&e){const o=!(192&e),i=new Bi(jn(n,r),null,(e&W)===W?t.readLeftID():null,null,(e&z)===z?t.readRightID():null,o?t.readParentInfo()?t.readString():t.readLeftID():null,!o||32&~e?null:t.readString(),ji(t,e));yield i,r+=i.length}else{const e=t.readLen();yield new fi(jn(n,r),e),r+=e}}}}(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Fi);return this.curr}}const jr=t=>Ur(t,mn),Ur=(t,e=yn)=>{const n=[],r=new e(At(t)),o=new Br(r,!1);for(let t=o.curr;null!==t;t=o.next())n.push(t);qe("Structs: ",n);const i=cn(r);qe("DeleteSet: ",i)},Fr=t=>Vr(t,mn),Vr=(t,e=yn)=>{const n=[],r=new e(At(t)),o=new Br(r,!1);for(let t=o.curr;null!==t;t=o.next())n.push(t);return{structs:n,ds:cn(r)}};class zr{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Wr=t=>Xr(t,mn,vn),qr=(t,e=wn,n=yn)=>{const r=new e,o=new Br(new n(At(t)),!1);let i=o.curr;if(null!==i){let t=0,e=i.id.client,n=0!==i.id.clock,s=n?0:i.id.clock+i.length;for(;null!==i;i=o.next())e!==i.id.client&&(0!==s&&(t++,at(r.restEncoder,e),at(r.restEncoder,s)),e=i.id.client,s=0,n=0!==i.id.clock),i.constructor===Fi&&(n=!0),n||(s=i.id.clock+i.length);0!==s&&(t++,at(r.restEncoder,e),at(r.restEncoder,s));const a=rt();return at(a,t),((t,e)=>{ht(t,ot(e))})(a,r.restEncoder),r.restEncoder=a,r.toUint8Array()}return at(r.restEncoder,0),r.toUint8Array()},Kr=t=>qr(t,bn,mn),Jr=(t,e=yn)=>{const n=new Map,r=new Map,o=new Br(new e(At(t)),!1);let i=o.curr;if(null!==i){let t=i.id.client,e=i.id.clock;for(n.set(t,e);null!==i;i=o.next())t!==i.id.client&&(r.set(t,e),n.set(i.id.client,i.id.clock),t=i.id.client),e=i.id.clock+i.length;r.set(t,e)}return{from:n,to:r}},Gr=t=>Jr(t,mn),Yr=(t,e)=>{if(t.constructor===fi){const{client:n,clock:r}=t.id;return new fi(jn(n,r+e),t.length-e)}if(t.constructor===Fi){const{client:n,clock:r}=t.id;return new Fi(jn(n,r+e),t.length-e)}{const n=t,{client:r,clock:o}=n.id;return new Bi(jn(r,o+e),null,jn(r,o+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Xr=(t,e=yn,n=kn)=>{if(1===t.length)return t[0];const r=t.map(t=>new e(At(t)));let o=r.map(t=>new Br(t,!0)),i=null;const s=new n,a=new zr(s);for(;o=o.filter(t=>null!==t.curr),o.sort((t,e)=>{if(t.curr.id.client===e.curr.id.client){const n=t.curr.id.clock-e.curr.id.clock;return 0===n?t.curr.constructor===e.curr.constructor?0:t.curr.constructor===Fi?1:-1:n}return e.curr.id.client-t.curr.id.client}),0!==o.length;){const t=o[0],e=t.curr.id.client;if(null!==i){let n=t.curr,r=!1;for(;null!==n&&n.id.clock+n.length<=i.struct.id.clock+i.struct.length&&n.id.client>=i.struct.id.client;)n=t.next(),r=!0;if(null===n||n.id.client!==e||r&&n.id.clock>i.struct.id.clock+i.struct.length)continue;if(e!==i.struct.id.client)eo(a,i.struct,i.offset),i={struct:n,offset:0},t.next();else if(i.struct.id.clock+i.struct.length<n.id.clock)if(i.struct.constructor===Fi)i.struct.length=n.id.clock+n.length-i.struct.id.clock;else{eo(a,i.struct,i.offset);const t=n.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Fi(jn(e,i.struct.id.clock+i.struct.length),t),offset:0}}else{const e=i.struct.id.clock+i.struct.length-n.id.clock;e>0&&(i.struct.constructor===Fi?i.struct.length-=e:n=Yr(n,e)),i.struct.mergeWith(n)||(eo(a,i.struct,i.offset),i={struct:n,offset:0},t.next())}}else i={struct:t.curr,offset:0},t.next();for(let n=t.curr;null!==n&&n.id.client===e&&n.id.clock===i.struct.id.clock+i.struct.length&&n.constructor!==Fi;n=t.next())eo(a,i.struct,i.offset),i={struct:n,offset:0}}null!==i&&(eo(a,i.struct,i.offset),i=null),no(a);const l=r.map(t=>cn(t)),c=rn(l);return ln(s,c),s.toUint8Array()},Qr=(t,e,n=yn,r=kn)=>{const o=On(e),i=new r,s=new zr(i),a=new n(At(t)),l=new Br(a,!1);for(;l.curr;){const t=l.curr,e=t.id.client,n=o.get(e)||0;if(l.curr.constructor!==Fi)if(t.id.clock+t.length>n)for(eo(s,t,F(n-t.id.clock,0)),l.next();l.curr&&l.curr.id.client===e;)eo(s,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===e&&l.curr.id.clock+l.curr.length<=n;)l.next();else l.next()}no(s);const c=cn(a);return ln(i,c),i.toUint8Array()},Zr=(t,e)=>Qr(t,e,mn,vn),to=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:ot(t.encoder.restEncoder)}),t.encoder.restEncoder=rt(),t.written=0)},eo=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&to(t),0===t.written&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),at(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},no=t=>{to(t);const e=t.encoder.restEncoder;at(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];at(e,r.written),ht(e,r.restEncoder)}},ro=(t,e,n,r)=>{const o=new n(At(t)),i=new Br(o,!1),s=new r,a=new zr(s);for(let t=i.curr;null!==t;t=i.next())eo(a,e(t),0);no(a);const l=cn(o);return ln(s,l),s.toUint8Array()},oo=({formatting:t=!0,subdocs:e=!0,yxml:n=!0}={})=>{let r=0;const o=M(),i=M(),s=M(),a=M();return a.set(null,null),l=>{switch(l.constructor){case fi:case Fi:return l;case Bi:{const d=l,u=d.content;switch(u.constructor){case gi:break;case Li:if(n){const t=u.type;t instanceof ci&&(t.nodeName=O(i,t.nodeName,()=>"node-"+r)),t instanceof ui&&(t.hookName=O(i,t.hookName,()=>"hook-"+r))}break;case xi:{const t=u;t.arr=t.arr.map(()=>r);break}case mi:u.content=new Uint8Array([r]);break;case bi:{const t=u;e&&(t.opts={},t.doc.guid=r+"");break}case vi:u.embed={};break;case wi:{const e=u;t&&(e.key=O(s,e.key,()=>r+""),e.value=O(a,e.value,()=>({i:r})));break}case ki:{const t=u;t.arr=t.arr.map(()=>r);break}case Ci:{const t=u;t.str=(c=r%10+"",((t,e)=>{const n=new Array(t);for(let r=0;r<t;r++)n[r]=e();return n})(t.str.length,()=>c).join(""));break}default:_t()}return d.parentSub&&(d.parentSub=O(o,d.parentSub,()=>r+"")),r++,l}default:_t()}var c}},io=(t,e)=>ro(t,oo(e),mn,vn),so=(t,e)=>ro(t,oo(e),yn,kn),ao=t=>ro(t,de,mn,kn),lo=t=>ro(t,de,yn,vn),co="You must not compute changes after the event-handler fired.";class uo{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ho(this.currentTarget,this.target))}deletes(t){return en(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw xt(co);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(n=>{if(null!==n){const r=e._map.get(n);let o,i;if(this.adds(r)){let t=r.left;for(;null!==t&&this.adds(t);)t=t.left;if(this.deletes(r)){if(null===t||!this.deletes(t))return;o="delete",i=R(t.content.getContent())}else null!==t&&this.deletes(t)?(o="update",i=R(t.content.getContent())):(o="add",i=void 0)}else{if(!this.deletes(r))return;o="delete",i=R(r.content.getContent())}t.set(n,{action:o,oldValue:i})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){if(0===this.transaction.doc._transactionCleanups.length)throw xt(co);const e=this.target,n=D(),r=D(),o=[];if(t={added:n,deleted:r,delta:o,keys:this.keys},this.transaction.changed.get(e).has(null)){let t=null;const i=()=>{t&&o.push(t)};for(let o=e._start;null!==o;o=o.right)o.deleted?this.deletes(o)&&!this.adds(o)&&(null!==t&&void 0!==t.delete||(i(),t={delete:0}),t.delete+=o.length,r.add(o)):this.adds(o)?(null!==t&&void 0!==t.insert||(i(),t={insert:[]}),t.insert=t.insert.concat(o.content.getContent()),n.add(o)):(null!==t&&void 0!==t.retain||(i(),t={retain:0}),t.retain+=o.length);null!==t&&void 0===t.retain&&i()}this._changes=t}return t}}const ho=(t,e)=>{const n=[];for(;null!==e._item&&e!==t;){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,r=e._item.parent._start;for(;r!==e._item&&null!==r;)!r.deleted&&r.countable&&(t+=r.length),r=r.right;n.unshift(t)}e=e._item.parent}return n},po=()=>{Ke("Invalid access: Add Yjs type to a document before reading data.")};let fo=0;class mo{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=fo++}}const go=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=fo++},yo=(t,e)=>{if(null===t._start||0===e||null===t._searchMarker)return null;const n=0===t._searchMarker.length?null:t._searchMarker.reduce((t,n)=>B(e-t.index)<B(e-n.index)?t:n);let r=t._start,o=0;for(null!==n&&(r=n.p,o=n.index,(t=>{t.timestamp=fo++})(n));null!==r.right&&o<e;){if(!r.deleted&&r.countable){if(e<o+r.length)break;o+=r.length}r=r.right}for(;null!==r.left&&o>e;)r=r.left,!r.deleted&&r.countable&&(o-=r.length);for(;null!==r.left&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(o-=r.length);return null!==n&&B(n.index-o)<r.parent.length/80?(go(n,r,o),n):((t,e,n)=>{if(t.length>=80){const r=t.reduce((t,e)=>t.timestamp<e.timestamp?t:e);return go(r,e,n),r}{const r=new mo(e,n);return t.push(r),r}})(t._searchMarker,r,o)},bo=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const o=t[r];if(n>0){let e=o.p;for(e.marker=!1;e&&(e.deleted||!e.countable);)e=e.left,e&&!e.deleted&&e.countable&&(o.index-=e.length);if(null===e||!0===e.marker){t.splice(r,1);continue}o.p=e,e.marker=!0}(e<o.index||n>0&&e===o.index)&&(o.index=F(e,o.index+n))}},vo=t=>{t.doc??po();let e=t._start;const n=[];for(;e;)n.push(e),e=e.right;return n},wo=(t,e,n)=>{const r=t,o=e.changedParentTypes;for(;O(o,t,()=>[]).push(n),null!==t._item;)t=t._item.parent;$n(r._eH,n,e)};class ko{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Nn(),this._dEH=Nn(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw Ct()}clone(){throw Ct()}_write(t){}get _first(){let t=this._start;for(;null!==t&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){In(this._eH,t)}observeDeep(t){In(this._dEH,t)}unobserve(t){Pn(this._eH,t)}unobserveDeep(t){Pn(this._dEH,t)}toJSON(){}}const So=(t,e,n)=>{t.doc??po(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const o=[];let i=t._start;for(;null!==i&&r>0;){if(i.countable&&!i.deleted){const t=i.content.getContent();if(t.length<=e)e-=t.length;else{for(let n=e;n<t.length&&r>0;n++)o.push(t[n]),r--;e=0}}i=i.right}return o},xo=t=>{t.doc??po();const e=[];let n=t._start;for(;null!==n;){if(n.countable&&!n.deleted){const t=n.content.getContent();for(let n=0;n<t.length;n++)e.push(t[n])}n=n.right}return e},Co=(t,e)=>{const n=[];let r=t._start;for(;null!==r;){if(r.countable&&hr(r,e)){const t=r.content.getContent();for(let e=0;e<t.length;e++)n.push(t[e])}r=r.right}return n},_o=(t,e)=>{let n=0,r=t._start;for(t.doc??po();null!==r;){if(r.countable&&!r.deleted){const o=r.content.getContent();for(let r=0;r<o.length;r++)e(o[r],n++,t)}r=r.right}},Eo=(t,e)=>{const n=[];return _o(t,(r,o)=>{n.push(e(r,o,t))}),n},To=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const t=n[r++];return n.length<=r&&(n=null),{done:!1,value:t}}}},Mo=(t,e)=>{t.doc??po();const n=yo(t,e);let r=t._start;for(null!==n&&(r=n.p,e-=n.index);null!==r;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ao=(t,e,n,r)=>{let o=n;const i=t.doc,s=i.clientID,a=i.store,l=null===n?e._start:n.right;let c=[];const d=()=>{c.length>0&&(o=new Bi(jn(s,br(a,s)),o,o&&o.lastId,l,l&&l.id,e,null,new xi(c)),o.integrate(t,0),c=[])};r.forEach(n=>{if(null===n)c.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(n);break;default:switch(d(),n.constructor){case Uint8Array:case ArrayBuffer:o=new Bi(jn(s,br(a,s)),o,o&&o.lastId,l,l&&l.id,e,null,new mi(new Uint8Array(n))),o.integrate(t,0);break;case pn:o=new Bi(jn(s,br(a,s)),o,o&&o.lastId,l,l&&l.id,e,null,new bi(n)),o.integrate(t,0);break;default:if(!(n instanceof ko))throw new Error("Unexpected content type in insert operation");o=new Bi(jn(s,br(a,s)),o,o&&o.lastId,l,l&&l.id,e,null,new Li(n)),o.integrate(t,0)}}}),d()},Oo=()=>xt("Length exceeded!"),Do=(t,e,n,r)=>{if(n>e._length)throw Oo();if(0===n)return e._searchMarker&&bo(e._searchMarker,n,r.length),Ao(t,e,null,r);const o=n,i=yo(e,n);let s=e._start;for(null!==i&&(s=i.p,0===(n-=i.index)&&(s=s.prev,n+=s&&s.countable&&!s.deleted?s.length:0));null!==s;s=s.right)if(!s.deleted&&s.countable){if(n<=s.length){n<s.length&&xr(t,jn(s.id.client,s.id.clock+n));break}n-=s.length}return e._searchMarker&&bo(e._searchMarker,o,r.length),Ao(t,e,s,r)},Ro=(t,e,n,r)=>{if(0===r)return;const o=n,i=r,s=yo(e,n);let a=e._start;for(null!==s&&(a=s.p,n-=s.index);null!==a&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&xr(t,jn(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&null!==a;)a.deleted||(r<a.length&&xr(t,jn(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Oo();e._searchMarker&&bo(e._searchMarker,o,-i+r)},Lo=(t,e,n)=>{const r=e._map.get(n);void 0!==r&&r.delete(t)},No=(t,e,n,r)=>{const o=e._map.get(n)||null,i=t.doc,s=i.clientID;let a;if(null==r)a=new xi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new xi([r]);break;case Uint8Array:a=new mi(r);break;case pn:a=new bi(r);break;default:if(!(r instanceof ko))throw new Error("Unexpected content type");a=new Li(r)}new Bi(jn(s,br(i.store,s)),o,o&&o.lastId,null,null,e,n,a).integrate(t,0)},Io=(t,e)=>{t.doc??po();const n=t._map.get(e);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},Po=t=>{const e={};return t.doc??po(),t._map.forEach((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])}),e},$o=(t,e)=>{t.doc??po();const n=t._map.get(e);return void 0!==n&&!n.deleted},Ho=(t,e,n)=>{let r=t._map.get(e)||null;for(;null!==r&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return null!==r&&hr(r,n)?r.content.getContent()[r.length-1]:void 0},Bo=(t,e)=>{const n={};return t._map.forEach((t,r)=>{let o=t;for(;null!==o&&(!e.sv.has(o.id.client)||o.id.clock>=(e.sv.get(o.id.client)||0));)o=o.left;null!==o&&hr(o,e)&&(n[r]=o.content.getContent()[o.length-1])}),n},jo=t=>(t.doc??po(),((t,e)=>Ge(()=>{let n;do{n=t.next()}while(!n.done&&!e(n.value));return n}))(t._map.entries(),t=>!t[1].deleted));class Uo extends uo{}class Fo extends ko{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Fo;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Fo}clone(){const t=new Fo;return t.insert(0,this.toArray().map(t=>t instanceof ko?t.clone():t)),t}get length(){return this.doc??po(),this._length}_callObserver(t,e){super._callObserver(t,e),wo(this,t,new Uo(this,t))}insert(t,e){null!==this.doc?Nr(this.doc,n=>{Do(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){null!==this.doc?Nr(this.doc,e=>{((t,e,n)=>{let r=(e._searchMarker||[]).reduce((t,e)=>e.index>t.index?e:t,{index:0,p:e._start}).p;if(r)for(;r.right;)r=r.right;Ao(t,e,r,n)})(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){null!==this.doc?Nr(this.doc,n=>{Ro(n,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return Mo(this,t)}toArray(){return xo(this)}slice(t=0,e=this.length){return So(this,t,e)}toJSON(){return this.map(t=>t instanceof ko?t.toJSON():t)}map(t){return Eo(this,t)}forEach(t){_o(this,t)}[Symbol.iterator](){return To(this)}_write(t){t.writeTypeRef(Ei)}}class Vo extends uo{constructor(t,e,n){super(t,e),this.keysChanged=n}}class zo extends ko{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((t,e)=>{this.set(e,t)}),this._prelimContent=null}_copy(){return new zo}clone(){const t=new zo;return this.forEach((e,n)=>{t.set(n,e instanceof ko?e.clone():e)}),t}_callObserver(t,e){wo(this,t,new Vo(this,t,e))}toJSON(){this.doc??po();const t={};return this._map.forEach((e,n)=>{if(!e.deleted){const r=e.content.getContent()[e.length-1];t[n]=r instanceof ko?r.toJSON():r}}),t}get size(){return[...jo(this)].length}keys(){return Ye(jo(this),t=>t[0])}values(){return Ye(jo(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ye(jo(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??po(),this._map.forEach((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?Nr(this.doc,e=>{Lo(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return null!==this.doc?Nr(this.doc,n=>{No(n,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return Io(this,t)}has(t){return $o(this,t)}clear(){null!==this.doc?Nr(this.doc,t=>{this.forEach(function(e,n,r){Lo(t,r,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ti)}}const Wo=(t,e)=>t===e||"object"==typeof t&&"object"==typeof e&&t&&e&&((t,e)=>t===e||ne(t)===ne(e)&&re(t,(t,n)=>(void 0!==t||oe(e,n))&&e[n]===t))(t,e);class qo{constructor(t,e,n,r){this.left=t,this.right=e,this.index=n,this.currentAttributes=r}forward(){null===this.right&&_t(),this.right.content.constructor===wi?this.right.deleted||Yo(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}const Ko=(t,e,n)=>{for(;null!==e.right&&n>0;)e.right.content.constructor===wi?e.right.deleted||Yo(e.currentAttributes,e.right.content):e.right.deleted||(n<e.right.length&&xr(t,jn(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length),e.left=e.right,e.right=e.right.right;return e},Jo=(t,e,n,r)=>{const o=new Map,i=r?yo(e,n):null;if(i){const e=new qo(i.p.left,i.p,i.index,o);return Ko(t,e,n-i.index)}{const r=new qo(null,e._start,0,o);return Ko(t,r,n)}},Go=(t,e,n,r)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===wi&&Wo(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const o=t.doc,i=o.clientID;r.forEach((r,s)=>{const a=n.left,l=n.right,c=new Bi(jn(i,br(o.store,i)),a,a&&a.lastId,l,l&&l.id,e,null,new wi(s,r));c.integrate(t,0),n.right=c,n.forward()})},Yo=(t,e)=>{const{key:n,value:r}=e;null===r?t.delete(n):t.set(n,r)},Xo=(t,e)=>{for(;null!==t.right&&(t.right.deleted||t.right.content.constructor===wi&&Wo(e[t.right.content.key]??null,t.right.content.value));)t.forward()},Qo=(t,e,n,r)=>{const o=t.doc,i=o.clientID,s=new Map;for(const a in r){const l=r[a],c=n.currentAttributes.get(a)??null;if(!Wo(c,l)){s.set(a,c);const{left:r,right:d}=n;n.right=new Bi(jn(i,br(o.store,i)),r,r&&r.lastId,d,d&&d.id,e,null,new wi(a,l)),n.right.integrate(t,0),n.forward()}}return s},Zo=(t,e,n,r,o)=>{n.currentAttributes.forEach((t,e)=>{void 0===o[e]&&(o[e]=null)});const i=t.doc,s=i.clientID;Xo(n,o);const a=Qo(t,e,n,o),l=r.constructor===String?new Ci(r):r instanceof ko?new Li(r):new vi(r);let{left:c,right:d,index:u}=n;e._searchMarker&&bo(e._searchMarker,n.index,l.getLength()),d=new Bi(jn(s,br(i.store,s)),c,c&&c.lastId,d,d&&d.id,e,null,l),d.integrate(t,0),n.right=d,n.index=u,n.forward(),Go(t,e,n,a)},ti=(t,e,n,r,o)=>{const i=t.doc,s=i.clientID;Xo(n,o);const a=Qo(t,e,n,o);t:for(;null!==n.right&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===wi));){if(!n.right.deleted)switch(n.right.content.constructor){case wi:{const{key:e,value:i}=n.right.content,s=o[e];if(void 0!==s){if(Wo(s,i))a.delete(e);else{if(0===r)break t;a.set(e,i)}n.right.delete(t)}else n.currentAttributes.set(e,i);break}default:r<n.right.length&&xr(t,jn(n.right.id.client,n.right.id.clock+r)),r-=n.right.length}n.forward()}if(r>0){let o="";for(;r>0;r--)o+="\n";n.right=new Bi(jn(s,br(i.store,s)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Ci(o)),n.right.integrate(t,0),n.forward()}Go(t,e,n,a)},ei=(t,e,n,r,o)=>{let i=e;const s=M();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===wi){const t=i.content;s.set(t.key,t)}i=i.right}let a=0,l=!1;for(;e!==i;){if(n===e&&(l=!0),!e.deleted){const n=e.content;switch(n.constructor){case wi:{const{key:i,value:c}=n,d=r.get(i)??null;s.get(i)===n&&d!==c||(e.delete(t),a++,l||(o.get(i)??null)!==c||d===c||(null===d?o.delete(i):o.set(i,d))),l||e.deleted||Yo(o,n);break}}}e=e.right}return a},ni=t=>{let e=0;return Nr(t.doc,n=>{let r=t._start,o=t._start,i=M();const s=A(i);for(;o;)!1===o.deleted&&(o.content.constructor===wi?Yo(s,o.content):(e+=ei(n,r,o,i,s),i=A(s),r=o)),o=o.right}),e},ri=t=>{const e=new Set,n=t.doc;for(const[r,o]of t.afterState.entries()){const i=t.beforeState.get(r)||0;o!==i&&_r(t,n.store.clients.get(r),i,o,t=>{t.deleted||t.content.constructor!==wi||t.constructor===fi||e.add(t.parent)})}Nr(n,n=>{tn(t,t.deleteSet,t=>{if(t instanceof fi||!t.parent._hasFormatting||e.has(t.parent))return;const r=t.parent;t.content.constructor===wi?e.add(r):((t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===wi){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}})(n,t)});for(const t of e)ni(t)})},oi=(t,e,n)=>{const r=n,o=A(e.currentAttributes),i=e.right;for(;n>0&&null!==e.right;){if(!1===e.right.deleted)switch(e.right.content.constructor){case Li:case vi:case Ci:n<e.right.length&&xr(t,jn(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t)}e.forward()}i&&ei(t,i,e.right,o,e.currentAttributes);const s=(e.left||e.right).parent;return s._searchMarker&&bo(s._searchMarker,e.index,-r+n),e};class ii extends uo{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)})}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,e=[];Nr(t,t=>{const n=new Map,r=new Map;let o=this.target._start,i=null;const s={};let a="",l=0,c=0;const d=()=>{if(null!==i){let t=null;switch(i){case"delete":c>0&&(t={delete:c}),c=0;break;case"insert":("object"==typeof a||a.length>0)&&(t={insert:a},n.size>0&&(t.attributes={},n.forEach((e,n)=>{null!==e&&(t.attributes[n]=e)}))),a="";break;case"retain":l>0&&(t={retain:l},(t=>{for(const e in t)return!1;return!0})(s)||(t.attributes=Zt({},s))),l=0}t&&e.push(t),i=null}};for(;null!==o;){switch(o.content.constructor){case Li:case vi:this.adds(o)?this.deletes(o)||(d(),i="insert",a=o.content.getContent()[0],d()):this.deletes(o)?("delete"!==i&&(d(),i="delete"),c+=1):o.deleted||("retain"!==i&&(d(),i="retain"),l+=1);break;case Ci:this.adds(o)?this.deletes(o)||("insert"!==i&&(d(),i="insert"),a+=o.content.str):this.deletes(o)?("delete"!==i&&(d(),i="delete"),c+=o.length):o.deleted||("retain"!==i&&(d(),i="retain"),l+=o.length);break;case wi:{const{key:e,value:a}=o.content;if(this.adds(o)){if(!this.deletes(o)){const l=n.get(e)??null;Wo(l,a)?null!==a&&o.delete(t):("retain"===i&&d(),Wo(a,r.get(e)??null)?delete s[e]:s[e]=a)}}else if(this.deletes(o)){r.set(e,a);const t=n.get(e)??null;Wo(t,a)||("retain"===i&&d(),s[e]=t)}else if(!o.deleted){r.set(e,a);const n=s[e];void 0!==n&&(Wo(n,a)?null!==n&&o.delete(t):("retain"===i&&d(),null===a?delete s[e]:s[e]=a))}o.deleted||("insert"===i&&d(),Yo(n,o.content));break}}o=o.right}for(d();e.length>0;){const t=e[e.length-1];if(void 0===t.retain||void 0!==t.attributes)break;e.pop()}}),this._delta=e}return this._delta}}class si extends ko{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??po(),this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(t=>t())}catch(t){console.error(t)}this._pending=null}_copy(){return new si}clone(){const t=new si;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new ii(this,t,e);wo(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??po();let t="",e=this._start;for(;null!==e;)!e.deleted&&e.countable&&e.content.constructor===Ci&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){null!==this.doc?Nr(this.doc,n=>{const r=new qo(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const i=t[o];if(void 0!==i.insert){const s=e||"string"!=typeof i.insert||o!==t.length-1||null!==r.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!=typeof s||s.length>0)&&Zo(n,this,r,s,i.attributes||{})}else void 0!==i.retain?ti(n,this,r,i.retain,i.attributes||{}):void 0!==i.delete&&oi(n,r,i.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,n){this.doc??po();const r=[],o=new Map,i=this.doc;let s="",a=this._start;function l(){if(s.length>0){const t={};let e=!1;o.forEach((n,r)=>{e=!0,t[r]=n});const n={insert:s};e&&(n.attributes=t),r.push(n),s=""}}const c=()=>{for(;null!==a;){if(hr(a,t)||void 0!==e&&hr(a,e))switch(a.content.constructor){case Ci:{const r=o.get("ychange");void 0===t||hr(a,t)?void 0===e||hr(a,e)?void 0!==r&&(l(),o.delete("ychange")):void 0!==r&&r.user===a.id.client&&"added"===r.type||(l(),o.set("ychange",n?n("added",a.id):{type:"added"})):void 0!==r&&r.user===a.id.client&&"removed"===r.type||(l(),o.set("ychange",n?n("removed",a.id):{type:"removed"})),s+=a.content.str;break}case Li:case vi:{l();const t={insert:a.content.getContent()[0]};if(o.size>0){const e={};t.attributes=e,o.forEach((t,n)=>{e[n]=t})}r.push(t);break}case wi:hr(a,t)&&(l(),Yo(o,a.content))}a=a.right}l()};return t||e?Nr(i,n=>{t&&pr(n,t),e&&pr(n,e),c()},"cleanup"):c(),r}insert(t,e,n){if(e.length<=0)return;const r=this.doc;null!==r?Nr(r,r=>{const o=Jo(r,this,t,!n);n||(n={},o.currentAttributes.forEach((t,e)=>{n[e]=t})),Zo(r,this,o,e,n)}):this._pending.push(()=>this.insert(t,e,n))}insertEmbed(t,e,n){const r=this.doc;null!==r?Nr(r,r=>{const o=Jo(r,this,t,!n);Zo(r,this,o,e,n||{})}):this._pending.push(()=>this.insertEmbed(t,e,n||{}))}delete(t,e){if(0===e)return;const n=this.doc;null!==n?Nr(n,n=>{oi(n,Jo(n,this,t,!0),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,n){if(0===e)return;const r=this.doc;null!==r?Nr(r,r=>{const o=Jo(r,this,t,!1);null!==o.right&&ti(r,this,o,e,n)}):this._pending.push(()=>this.format(t,e,n))}removeAttribute(t){null!==this.doc?Nr(this.doc,e=>{Lo(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){null!==this.doc?Nr(this.doc,n=>{No(n,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return Io(this,t)}getAttributes(){return Po(this)}_write(t){t.writeTypeRef(Mi)}}class ai{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??po()}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(e)))do{if(e=t.content.type,t.deleted||e.constructor!==ci&&e.constructor!==li||null===e._start)for(;null!==t;){const e=t.next;if(null!==e){t=e;break}t=t.parent===this._root?null:t.parent._item}else t=e._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class li extends ko{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new li}clone(){const t=new li;return t.insert(0,this.toArray().map(t=>t instanceof ko?t.clone():t)),t}get length(){return this.doc??po(),null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new ai(this,t)}querySelector(t){t=t.toUpperCase();const e=new ai(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t).next();return e.done?null:e.value}querySelectorAll(t){return t=t.toUpperCase(),N(new ai(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){wo(this,t,new di(this,e,t))}toString(){return Eo(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const r=t.createDocumentFragment();return void 0!==n&&n._createAssociation(r,this),_o(this,o=>{r.insertBefore(o.toDOM(t,e,n),null)}),r}insert(t,e){null!==this.doc?Nr(this.doc,n=>{Do(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(null!==this.doc)Nr(this.doc,n=>{const r=t&&t instanceof ko?t._item:t;Ao(n,this,r,e)});else{const n=this._prelimContent,r=null===t?0:n.findIndex(e=>e===t)+1;if(0===r&&null!==t)throw xt("Reference item not found");n.splice(r,0,...e)}}delete(t,e=1){null!==this.doc?Nr(this.doc,n=>{Ro(n,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return xo(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Mo(this,t)}slice(t=0,e=this.length){return So(this,t,e)}forEach(t){_o(this,t)}_write(t){t.writeTypeRef(Oi)}}class ci extends li{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((t,e)=>{this.setAttribute(e,t)}),this._prelimAttrs=null}_copy(){return new ci(this.nodeName)}clone(){const t=new ci(this.nodeName);return((t,e)=>{for(const n in t)e(t[n],n)})(this.getAttributes(),(e,n)=>{"string"==typeof e&&t.setAttribute(n,e)}),t.insert(0,this.toArray().map(t=>t instanceof ko?t.clone():t)),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const e in t)n.push(e);n.sort();const r=n.length;for(let o=0;o<r;o++){const r=n[o];e.push(r+'="'+t[r]+'"')}const o=this.nodeName.toLocaleLowerCase();return`<${o}${e.length>0?" "+e.join(" "):""}>${super.toString()}</${o}>`}removeAttribute(t){null!==this.doc?Nr(this.doc,e=>{Lo(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){null!==this.doc?Nr(this.doc,n=>{No(n,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return Io(this,t)}hasAttribute(t){return $o(this,t)}getAttributes(t){return t?Bo(this,t):Po(this)}toDOM(t=document,e={},n){const r=t.createElement(this.nodeName),o=this.getAttributes();for(const t in o){const e=o[t];"string"==typeof e&&r.setAttribute(t,e)}return _o(this,o=>{r.appendChild(o.toDOM(t,e,n))}),void 0!==n&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(Ai),t.writeKey(this.nodeName)}}class di extends uo{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)})}}class ui extends zo{constructor(t){super(),this.hookName=t}_copy(){return new ui(this.hookName)}clone(){const t=new ui(this.hookName);return this.forEach((e,n)=>{t.set(n,e)}),t}toDOM(t=document,e={},n){const r=e[this.hookName];let o;return o=void 0!==r?r.createDom(this):document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(o,this),o}_write(t){t.writeTypeRef(Di),t.writeKey(this.hookName)}}class hi extends si{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new hi}clone(){const t=new hi;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const r=t.createTextNode(this.toString());return void 0!==n&&n._createAssociation(r,this),r}toString(){return this.toDelta().map(t=>{const e=[];for(const n in t.attributes){const r=[];for(const e in t.attributes[n])r.push({key:e,value:t.attributes[n][e]});r.sort((t,e)=>t.key<e.key?-1:1),e.push({nodeName:n,attrs:r})}e.sort((t,e)=>t.nodeName<e.nodeName?-1:1);let n="";for(let t=0;t<e.length;t++){const r=e[t];n+=`<${r.nodeName}`;for(let t=0;t<r.attrs.length;t++){const e=r.attrs[t];n+=` ${e.key}="${e.value}"`}n+=">"}n+=t.insert;for(let t=e.length-1;t>=0;t--)n+=`</${e[t].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ri)}}class pi{constructor(t,e){this.id=t,this.length=e}get deleted(){throw Ct()}mergeWith(t){return!1}write(t,e,n){throw Ct()}integrate(t,e){throw Ct()}}class fi extends pi{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),vr(t.doc.store,this)}write(t,e){t.writeInfo(0),t.writeLen(this.length-e)}getMissing(t,e){return null}}class mi{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new mi(this.content)}splice(t){throw Ct()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class gi{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new gi(this.len)}splice(t){const e=new gi(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){on(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const yi=(t,e)=>new pn({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class bi{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),null!==t.meta&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new bi(yi(this.doc.guid,this.opts))}splice(t){throw Ct()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class vi{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new vi(this.embed)}splice(t){throw Ct()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class wi{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new wi(this.key,this.value)}splice(t){throw Ct()}mergeWith(t){return!1}integrate(t,e){const n=e.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class ki{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ki(this.arr)}splice(t){const e=new ki(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}const Si="development"===ye("node_env");class xi{constructor(t){this.arr=t,Si&&se(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xi(this.arr)}splice(t){const e=new xi(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeAny(e)}}getRef(){return 8}}class Ci{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ci(this.str)}splice(t){const e=new Ci(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"",e.str=""+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}const _i=[t=>new Fo,t=>new zo,t=>new si,t=>new ci(t.readKey()),t=>new li,t=>new ui(t.readKey()),t=>new hi],Ei=0,Ti=1,Mi=2,Ai=3,Oi=4,Di=5,Ri=6;class Li{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Li(this.type._copy())}splice(t){throw Ct()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;null!==e;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(e=>{e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;null!==e;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(e=>{for(;null!==e;)e.gc(t,!0),e=e.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Ni=(t,e)=>{let n,r=e,o=0;do{o>0&&(r=jn(r.client,r.clock+o)),n=kr(t,r),o=r.clock-n.id.clock,r=n.redone}while(null!==r&&n instanceof Bi);return{item:n,diff:o}},Ii=(t,e)=>{for(;null!==t&&t.keep!==e;)t.keep=e,t=t.parent._item},Pi=(t,e,n)=>{const{client:r,clock:o}=e.id,i=new Bi(jn(r,o+n),e,jn(r,o+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),null!==e.redone&&(i.redone=jn(e.redone.client,e.redone.clock+n)),e.right=i,null!==i.right&&(i.right.left=i),t._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),e.length=n,i},$i=(t,e)=>((t,e)=>{for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1})(t,t=>en(t.deletions,e)),Hi=(t,e,n,r,o,i)=>{const s=t.doc,a=s.store,l=s.clientID,c=e.redone;if(null!==c)return xr(t,c);let d,u=e.parent._item,h=null;if(null!==u&&!0===u.deleted){if(null===u.redone&&(!n.has(u)||null===Hi(t,u,n,r,o,i)))return null;for(;null!==u.redone;)u=xr(t,u.redone)}const p=null===u?e.parent:u.content.type;if(null===e.parentSub){for(h=e.left,d=e;null!==h;){let e=h;for(;null!==e&&e.parent._item!==u;)e=null===e.redone?null:xr(t,e.redone);if(null!==e&&e.parent._item===u){h=e;break}h=h.left}for(;null!==d;){let e=d;for(;null!==e&&e.parent._item!==u;)e=null===e.redone?null:xr(t,e.redone);if(null!==e&&e.parent._item===u){d=e;break}d=d.right}}else if(d=null,e.right&&!o){for(h=e;null!==h&&null!==h.right&&(h.right.redone||en(r,h.right.id)||$i(i.undoStack,h.right.id)||$i(i.redoStack,h.right.id));)for(h=h.right;h.redone;)h=xr(t,h.redone);if(h&&null!==h.right)return null}else h=p._map.get(e.parentSub)||null;const f=br(a,l),m=jn(l,f),g=new Bi(m,h,h&&h.lastId,d,d&&d.id,p,e.parentSub,e.content.copy());return e.redone=m,Ii(g,!0),g.integrate(t,0),g};class Bi extends pi{constructor(t,e,n,r,o,i,s,a){super(t,a.getLength()),this.origin=n,this.left=e,this.right=r,this.rightOrigin=o,this.parent=i,this.parentSub=s,this.redone=null,this.content=a,this.info=this.content.isCountable()?2:0}set marker(t){(8&this.info)>0!==t&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=br(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=br(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Hn&&this.id.client!==this.parent.client&&this.parent.clock>=br(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Cr(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=xr(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===fi||this.right&&this.right.constructor===fi)this.parent=null;else if(this.parent){if(this.parent.constructor===Hn){const t=kr(e,this.parent);t.constructor===fi?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===Bi?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Bi&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=Cr(t,t.doc.store,jn(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let e,n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start;const r=new Set,o=new Set;for(;null!==e&&e!==this.right;){if(o.add(e),r.add(e),Bn(this.origin,e.origin)){if(e.id.client<this.id.client)n=e,r.clear();else if(Bn(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!o.has(kr(t.doc.store,e.origin)))break;r.has(kr(t.doc.store,e.origin))||(n=e,r.clear())}e=e.right}this.left=n}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),vr(t.doc.store,this),this.content.integrate(t,this),Mr(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new fi(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;null!==t&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;null!==t&&t.deleted;)t=t.left;return t}get lastId(){return 1===this.length?this.id:jn(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Bn(t.origin,this.lastId)&&this.right===t&&Bn(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(e=>{e.p===t&&(e.p=this,!this.deleted&&this.countable&&(e.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length),this.markDeleted(),on(t.deleteSet,this.id.client,this.id.clock,this.length),Mr(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw _t();this.content.gc(t),e?((t,e,n)=>{const r=t.clients.get(e.id.client);r[wr(r,e.id.clock)]=n})(t,this,new fi(this.id,this.length)):this.content=new gi(this.length)}write(t,e){const n=e>0?jn(this.id.client,this.id.clock+e-1):this.origin,r=this.rightOrigin,o=this.parentSub,i=31&this.content.getRef()|(null===n?0:W)|(null===r?0:z)|(null===o?0:32);if(t.writeInfo(i),null!==n&&t.writeLeftID(n),null!==r&&t.writeRightID(r),null===n&&null===r){const e=this.parent;if(void 0!==e._item){const n=e._item;if(null===n){const n=Vn(e);t.writeParentInfo(!0),t.writeString(n)}else t.writeParentInfo(!1),t.writeLeftID(n.id)}else e.constructor===String?(t.writeParentInfo(!0),t.writeString(e)):e.constructor===Hn?(t.writeParentInfo(!1),t.writeLeftID(e)):_t();null!==o&&t.writeString(o)}this.content.write(t,e)}}const ji=(t,e)=>Ui[31&e](t),Ui=[()=>{_t()},t=>new gi(t.readLen()),t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const e=t.readString();"undefined"===e?n.push(void 0):n.push(JSON.parse(e))}return new ki(n)},t=>new mi(t.readBuf()),t=>new Ci(t.readString()),t=>new vi(t.readJSON()),t=>new wi(t.readKey(),t.readJSON()),t=>new Li(_i[t.readTypeRef()](t)),t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new xi(n)},t=>new bi(yi(t.readString(),t.readAny())),()=>{_t()}];class Fi extends pi{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){_t()}write(t,e){t.writeInfo(10),at(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const Vi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},zi="__ $YJS$ __";async function Wi(t){return new Promise(e=>setTimeout(e,t))}function qi(t,e){let n=e.delay;if(0===n)return 0;if(e.factor&&(n*=Math.pow(e.factor,t.attemptNum-1),0!==e.maxDelay&&(n=Math.min(n,e.maxDelay))),e.jitter){const t=Math.ceil(e.minDelay),r=Math.floor(n);n=Math.floor(Math.random()*(r-t+1))+t}return Math.round(n)}!0===Vi[zi]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Vi[zi]=!0;const Ki=Math.floor,Ji=128,Gi=127,Yi=Number.MAX_SAFE_INTEGER,Xi=()=>new Set,Qi=Array.from,Zi="undefined"!=typeof TextEncoder?new TextEncoder:null,ts=Zi?t=>Zi.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.codePointAt(t);return r};let es="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});es&&1===es.decode(new Uint8Array).length&&(es=null);class ns{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const rs=()=>new ns,is=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},ss=t=>{const e=new Uint8Array(is(t));let n=0;for(let r=0;r<t.bufs.length;r++){const o=t.bufs[r];e.set(o,n),n+=o.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},as=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},ls=(t,e)=>{for(;e>Gi;)as(t,Ji|Gi&e),e=Ki(e/128);as(t,Gi&e)},cs=new Uint8Array(3e4),ds=cs.length/3,us=Zi&&Zi.encodeInto?(t,e)=>{if(e.length<ds){const n=Zi.encodeInto(e,cs).written||0;ls(t,n);for(let e=0;e<n;e++)as(t,cs[e])}else hs(t,ts(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ls(t,r);for(let e=0;e<r;e++)as(t,n.codePointAt(e))},hs=(t,e)=>{ls(t,e.byteLength),((t,e)=>{const n=t.cbuf.length,r=t.cpos,o=(i=n-r)<(s=e.length)?i:s;var i,s;const a=e.length-o;t.cbuf.set(e.subarray(0,o),r),t.cpos+=o,a>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(((t,e)=>t>e?t:e)(2*n,a)),t.cbuf.set(e.subarray(o)),t.cpos=a)})(t,e)},ps=t=>new Error(t),fs=ps("Unexpected end of array"),ms=ps("Integer out of Range");class gs{constructor(t){this.arr=t,this.pos=0}}const ys=t=>new gs(t),bs=t=>((t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n})(t,ws(t)),vs=t=>t.arr[t.pos++],ws=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const r=t.arr[t.pos++];if(e+=(r&Gi)*n,n*=128,r<Ji)return e;if(e>Yi)throw ms}throw fs},ks=es?t=>es.decode(bs(t)):t=>{let e=ws(t);if(0===e)return"";{let n=String.fromCodePoint(vs(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(vs(t));else for(;e>0;){const r=e<1e4?e:1e4,o=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,o),e-=r}return decodeURIComponent(escape(n))}},Ss=Date.now,xs=()=>new Map;class Cs{constructor(){this._observers=xs()}on(t,e){((t,e,n)=>{let r=t.get(e);return void 0===r&&t.set(e,r=n()),r})(this._observers,t,Xi).add(e)}once(t,e){const n=(...r)=>{this.off(t,n),e(...r)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return Qi((this._observers.get(t)||xs()).values()).forEach(t=>t(...e))}destroy(){this._observers=xs()}}const _s=Object.keys,Es=t=>_s(t).length,Ts=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Ms=(t,e)=>{if(null==t||null==e)return((t,e)=>t===e)(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break;case Set:if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break;case Map:if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!Ms(t.get(n),e.get(n)))return!1;break;case Object:if(Es(t)!==Es(e))return!1;for(const n in t)if(!Ts(t,n)||!Ms(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Ms(t[n],e[n]))return!1;break;default:return!1}return!0};class As extends Cs{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const t=Ss();null!==this.getLocalState()&&15e3<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const e=[];this.meta.forEach((n,r)=>{r!==this.clientID&&3e4<=t-n.lastUpdated&&this.states.has(r)&&e.push(r)}),e.length>0&&Os(this,e,"timeout")},Ki(3e3)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,n=this.meta.get(e),r=void 0===n?0:n.clock+1,o=this.states.get(e);null===t?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:r,lastUpdated:Ss()});const i=[],s=[],a=[],l=[];null===t?l.push(e):null==o?null!=t&&i.push(e):(s.push(e),Ms(o,t)||a.push(e)),(i.length>0||a.length>0||l.length>0)&&this.emit("change",[{added:i,updated:a,removed:l},"local"]),this.emit("update",[{added:i,updated:s,removed:l},"local"])}setLocalStateField(t,e){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[t]:e})}getStates(){return this.states}}const Os=(t,e,n)=>{const r=[];for(let n=0;n<e.length;n++){const o=e[n];if(t.states.has(o)){if(t.states.delete(o),o===t.clientID){const e=t.meta.get(o);t.meta.set(o,{clock:e.clock+1,lastUpdated:Ss()})}r.push(o)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},Ds=(t,e,n=t.states)=>{const r=e.length,o=rs();ls(o,r);for(let i=0;i<r;i++){const r=e[i],s=n.get(r)||null,a=t.meta.get(r).clock;ls(o,r),ls(o,a),us(o,JSON.stringify(s))}return ss(o)};class Rs{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(t=>t.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(t=>t!==e):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}}class Ls{constructor(t){this.data=t,this.encoder=rs(),this.decoder=ys(new Uint8Array(this.data))}peekVarString(){return(t=>{const e=t.pos,n=ks(t);return t.pos=e,n})(this.decoder)}readVarUint(){return ws(this.decoder)}readVarString(){return ks(this.decoder)}readVarUint8Array(){return bs(this.decoder)}writeVarUint(t){return ls(this.encoder,t)}writeVarString(t){return us(this.encoder,t)}writeVarUint8Array(t){return hs(this.encoder,t)}length(){return is(this.encoder)}}var Ns,Is;!function(t){t[t.Sync=0]="Sync",t[t.Awareness=1]="Awareness",t[t.Auth=2]="Auth",t[t.QueryAwareness=3]="QueryAwareness",t[t.Stateless=5]="Stateless",t[t.CLOSE=7]="CLOSE",t[t.SyncStatus=8]="SyncStatus"}(Ns||(Ns={})),function(t){t.Connecting="connecting",t.Connected="connected",t.Disconnected="disconnected"}(Is||(Is={}));class Ps{constructor(){this.encoder=rs()}get(t){return t.encoder}toUint8Array(){return ss(this.encoder)}}class $s extends Ps{constructor(){super(...arguments),this.type=Ns.CLOSE,this.description="Ask the server to close the connection"}get(t){return us(this.encoder,t.documentName),ls(this.encoder,this.type),this.encoder}}class Hs extends Rs{constructor(t){super(),this.messageQueue=[],this.configuration={url:"",document:void 0,WebSocketPolyfill:void 0,messageReconnectTimeout:3e4,delay:1e3,initialDelay:0,factor:2,maxAttempts:0,minDelay:1e3,maxDelay:3e4,jitter:!0,timeout:0,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,providerMap:new Map},this.webSocket=null,this.webSocketHandlers={},this.shouldConnect=!0,this.status=Is.Disconnected,this.lastMessageReceived=0,this.identifier=0,this.intervals={connectionChecker:null},this.connectionAttempt=null,this.receivedOnOpenPayload=void 0,this.closeTries=0,this.setConfiguration(t),this.configuration.WebSocketPolyfill=t.WebSocketPolyfill?t.WebSocketPolyfill:WebSocket,this.on("open",this.configuration.onOpen),this.on("open",this.onOpen.bind(this)),this.on("connect",this.configuration.onConnect),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("status",this.configuration.onStatus),this.on("disconnect",this.configuration.onDisconnect),this.on("close",this.configuration.onClose),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("close",this.onClose.bind(this)),this.on("message",this.onMessage.bind(this)),this.intervals.connectionChecker=setInterval(this.checkConnection.bind(this),this.configuration.messageReconnectTimeout/10),this.shouldConnect&&this.connect()}async onOpen(t){this.cancelWebsocketRetry=void 0,this.receivedOnOpenPayload=t}attach(t){this.configuration.providerMap.set(t.configuration.name,t),this.status===Is.Disconnected&&this.shouldConnect&&this.connect(),this.receivedOnOpenPayload&&this.status===Is.Connected&&t.onOpen(this.receivedOnOpenPayload)}detach(t){this.configuration.providerMap.has(t.configuration.name)&&(t.send($s,{documentName:t.configuration.name}),this.configuration.providerMap.delete(t.configuration.name))}setConfiguration(t={}){this.configuration={...this.configuration,...t}}async connect(){if(this.status===Is.Connected)return;this.cancelWebsocketRetry&&(this.cancelWebsocketRetry(),this.cancelWebsocketRetry=void 0),this.receivedOnOpenPayload=void 0,this.shouldConnect=!0;const{retryPromise:t,cancelFunc:e}=(()=>{let t=!1;const e=async function(t,e){const n=function(t){return t||(t={}),{delay:void 0===t.delay?200:t.delay,initialDelay:void 0===t.initialDelay?0:t.initialDelay,minDelay:void 0===t.minDelay?0:t.minDelay,maxDelay:void 0===t.maxDelay?0:t.maxDelay,factor:void 0===t.factor?0:t.factor,maxAttempts:void 0===t.maxAttempts?3:t.maxAttempts,timeout:void 0===t.timeout?0:t.timeout,jitter:!0===t.jitter,initialJitter:!0===t.initialJitter,handleError:void 0===t.handleError?null:t.handleError,handleTimeout:void 0===t.handleTimeout?null:t.handleTimeout,beforeAttempt:void 0===t.beforeAttempt?null:t.beforeAttempt,calculateDelay:void 0===t.calculateDelay?null:t.calculateDelay}}(e);for(const t of["delay","initialDelay","minDelay","maxDelay","maxAttempts","timeout"]){const e=n[t];if(!Number.isInteger(e)||e<0)throw new Error(`Value for ${t} must be an integer greater than or equal to 0`)}if(n.factor.constructor!==Number||n.factor<0)throw new Error("Value for factor must be a number greater than or equal to 0");if(n.delay<n.minDelay)throw new Error(`delay cannot be less than minDelay (delay: ${n.delay}, minDelay: ${n.minDelay}`);const r={attemptNum:0,attemptsRemaining:n.maxAttempts?n.maxAttempts:-1,aborted:!1,abort(){r.aborted=!0}},o=n.calculateDelay||qi,i=n.calculateDelay?n.calculateDelay(r,n):n.initialDelay;if(i&&await Wi(i),r.attemptNum<1&&n.initialJitter){const t=o(r,n);t&&await Wi(t)}return async function e(){if(n.beforeAttempt&&n.beforeAttempt(r,n),r.aborted){const t=new Error("Attempt aborted");throw t.code="ATTEMPT_ABORTED",t}const i=async t=>{if(n.handleError&&await n.handleError(t,r,n),r.aborted||0===r.attemptsRemaining)throw t;r.attemptNum++;const i=o(r,n);return i&&await Wi(i),e()};return r.attemptsRemaining>0&&r.attemptsRemaining--,n.timeout?new Promise((e,o)=>{const s=setTimeout(()=>{if(n.handleTimeout)try{e(n.handleTimeout(r,n))}catch(t){o(t)}else{const t=new Error(`Retry timeout (attemptNum: ${r.attemptNum}, timeout: ${n.timeout})`);t.code="ATTEMPT_TIMEOUT",o(t)}},n.timeout);t(r,n).then(t=>{clearTimeout(s),e(t)}).catch(t=>{clearTimeout(s),i(t).then(e).catch(o)})}):t(r,n).catch(i)}()}(this.createWebSocketConnection.bind(this),{delay:this.configuration.delay,initialDelay:this.configuration.initialDelay,factor:this.configuration.factor,maxAttempts:this.configuration.maxAttempts,minDelay:this.configuration.minDelay,maxDelay:this.configuration.maxDelay,jitter:this.configuration.jitter,timeout:this.configuration.timeout,beforeAttempt:e=>{this.shouldConnect&&!t||e.abort()}}).catch(t=>{if(t&&"ATTEMPT_ABORTED"!==t.code)throw t});return{retryPromise:e,cancelFunc:()=>{t=!0}}})();return this.cancelWebsocketRetry=e,t}attachWebSocketListeners(t,e){const{identifier:n}=t;this.webSocketHandlers[n]={message:t=>this.emit("message",t),close:t=>this.emit("close",{event:t}),open:t=>this.emit("open",t),error:t=>{e(t)}};const r=this.webSocketHandlers[t.identifier];Object.keys(r).forEach(e=>{t.addEventListener(e,r[e])})}cleanupWebSocket(){if(!this.webSocket)return;const{identifier:t}=this.webSocket,e=this.webSocketHandlers[t];Object.keys(e).forEach(n=>{var r;null===(r=this.webSocket)||void 0===r||r.removeEventListener(n,e[n]),delete this.webSocketHandlers[t]}),this.webSocket.close(),this.webSocket=null}createWebSocketConnection(){return new Promise((t,e)=>{this.webSocket&&(this.messageQueue=[],this.cleanupWebSocket()),this.lastMessageReceived=0,this.identifier+=1;const n=new this.configuration.WebSocketPolyfill(this.url);n.binaryType="arraybuffer",n.identifier=this.identifier,this.attachWebSocketListeners(n,e),this.webSocket=n,this.status=Is.Connecting,this.emit("status",{status:Is.Connecting}),this.connectionAttempt={resolve:t,reject:e}})}onMessage(t){var e;this.resolveConnectionAttempt(),this.lastMessageReceived=Ss();const n=new Ls(t.data).peekVarString();null===(e=this.configuration.providerMap.get(n))||void 0===e||e.onMessage(t)}resolveConnectionAttempt(){this.connectionAttempt&&(this.connectionAttempt.resolve(),this.connectionAttempt=null,this.status=Is.Connected,this.emit("status",{status:Is.Connected}),this.emit("connect"),this.messageQueue.forEach(t=>this.send(t)),this.messageQueue=[])}stopConnectionAttempt(){this.connectionAttempt=null}rejectConnectionAttempt(){var t;null===(t=this.connectionAttempt)||void 0===t||t.reject(),this.connectionAttempt=null}checkConnection(){var t;this.status===Is.Connected&&this.lastMessageReceived&&(this.configuration.messageReconnectTimeout>=Ss()-this.lastMessageReceived||(this.closeTries+=1,this.closeTries>2?(this.onClose({event:{code:4408,reason:"forced"}}),this.closeTries=0):(null===(t=this.webSocket)||void 0===t||t.close(),this.messageQueue=[])))}get serverUrl(){for(;"/"===this.configuration.url[this.configuration.url.length-1];)return this.configuration.url.slice(0,this.configuration.url.length-1);return this.configuration.url}get url(){return this.serverUrl}disconnect(){if(this.shouldConnect=!1,null!==this.webSocket)try{this.webSocket.close(),this.messageQueue=[]}catch(t){console.error(t)}}send(t){var e;(null===(e=this.webSocket)||void 0===e?void 0:e.readyState)===T.Open?this.webSocket.send(t):this.messageQueue.push(t)}onClose({event:t}){this.closeTries=0,this.cleanupWebSocket(),this.connectionAttempt&&this.rejectConnectionAttempt(),this.status=Is.Disconnected,this.emit("status",{status:Is.Disconnected}),this.emit("disconnect",{event:t}),!this.cancelWebsocketRetry&&this.shouldConnect&&setTimeout(()=>{this.connect()},this.configuration.delay)}destroy(){this.emit("destroy"),clearInterval(this.intervals.connectionChecker),this.stopConnectionAttempt(),this.disconnect(),this.removeAllListeners(),this.cleanupWebSocket()}}const Bs=(t,e,n)=>{try{En(e,bs(t),n)}catch(t){console.error("Caught error while handling a Yjs update",t)}},js=Bs;class Us{constructor(t){this.message=t}apply(t,e){const{message:n}=this,r=n.readVarUint(),o=n.length();switch(r){case Ns.Sync:this.applySyncMessage(t,e);break;case Ns.Awareness:this.applyAwarenessMessage(t);break;case Ns.Auth:this.applyAuthMessage(t);break;case Ns.QueryAwareness:this.applyQueryAwarenessMessage(t);break;case Ns.Stateless:t.receiveStateless(ks(n.decoder));break;case Ns.SyncStatus:this.applySyncStatusMessage(t,1===(t=>{let e=t.arr[t.pos++],n=63&e,r=64;const o=(64&e)>0?-1:1;if(0===(e&Ji))return o*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n+=(e&Gi)*r,r*=128,e<Ji)return o*n;if(n>Yi)throw ms}throw fs})(n.decoder));break;case Ns.CLOSE:const o={code:1e3,reason:ks(n.decoder),target:t.configuration.websocketProvider.webSocket,type:"close"};t.onClose(),t.configuration.onClose({event:o}),t.forwardClose(o);break;default:throw new Error(`Cant apply message of unknown type: ${r}`)}n.length()>o+1&&t.send(Ps,{encoder:n.encoder})}applySyncMessage(t,e){const{message:n}=this;n.writeVarUint(Ns.Sync);const r=((t,e,n,r)=>{const o=ws(t);switch(o){case 0:((t,e,n)=>{((t,e,n)=>{ls(t,1),hs(t,Mn(e,n))})(e,n,bs(t))})(t,e,n);break;case 1:Bs(t,n,r);break;case 2:js(t,n,r);break;default:throw new Error("Unknown message type")}return o})(n.decoder,n.encoder,t.document,t);e&&1===r&&(t.synced=!0)}applySyncStatusMessage(t,e){e&&t.decrementUnsyncedChanges()}applyAwarenessMessage(t){if(!t.awareness)return;const{message:e}=this;((t,e,n)=>{const r=ys(e),o=Ss(),i=[],s=[],a=[],l=[],c=ws(r);for(let e=0;e<c;e++){const e=ws(r);let n=ws(r);const c=JSON.parse(ks(r)),d=t.meta.get(e),u=t.states.get(e),h=void 0===d?0:d.clock;(h<n||h===n&&null===c&&t.states.has(e))&&(null===c?e===t.clientID&&null!=t.getLocalState()?n++:t.states.delete(e):t.states.set(e,c),t.meta.set(e,{clock:n,lastUpdated:o}),void 0===d&&null!==c?i.push(e):void 0!==d&&null===c?l.push(e):null!==c&&(Ms(c,u)||a.push(e),s.push(e)))}(i.length>0||a.length>0||l.length>0)&&t.emit("change",[{added:i,updated:a,removed:l},n]),(i.length>0||s.length>0||l.length>0)&&t.emit("update",[{added:i,updated:s,removed:l},n])})(t.awareness,e.readVarUint8Array(),t)}applyAuthMessage(t){const{message:e}=this;((t,e,n)=>{switch(x(t)){case _.PermissionDenied:e(C(t));break;case _.Authenticated:n(C(t))}})(e.decoder,t.permissionDeniedHandler.bind(t),t.authenticatedHandler.bind(t))}applyQueryAwarenessMessage(t){if(!t.awareness)return;const{message:e}=this;e.writeVarUint(Ns.Awareness),e.writeVarUint8Array(Ds(t.awareness,Array.from(t.awareness.getStates().keys())))}}class Fs{constructor(t,e={}){this.message=new t,this.encoder=this.message.get(e)}create(){return ss(this.encoder)}send(t){null==t||t.send(this.create())}}class Vs extends Ps{constructor(){super(...arguments),this.type=Ns.Auth,this.description="Authentication"}get(t){if(void 0===t.token)throw new Error("The authentication message requires `token` as an argument.");var e,n;return us(this.encoder,t.documentName),ls(this.encoder,this.type),e=this.encoder,n=t.token,f(e,_.Token),y(e,n),this.encoder}}class zs extends Ps{constructor(){super(...arguments),this.type=Ns.Awareness,this.description="Awareness states update"}get(t){if(void 0===t.awareness)throw new Error("The awareness message requires awareness as an argument");if(void 0===t.clients)throw new Error("The awareness message requires clients as an argument");let e;return us(this.encoder,t.documentName),ls(this.encoder,this.type),e=void 0===t.states?Ds(t.awareness,t.clients):Ds(t.awareness,t.clients,t.states),hs(this.encoder,e),this.encoder}}class Ws extends Ps{constructor(){super(...arguments),this.type=Ns.Stateless,this.description="A stateless message"}get(t){var e;return us(this.encoder,t.documentName),ls(this.encoder,this.type),us(this.encoder,null!==(e=t.payload)&&void 0!==e?e:""),this.encoder}}class qs extends Ps{constructor(){super(...arguments),this.type=Ns.Sync,this.description="First sync step"}get(t){if(void 0===t.document)throw new Error("The sync step one message requires document as an argument");return us(this.encoder,t.documentName),ls(this.encoder,this.type),((t,e)=>{ls(t,0);const n=Rn(e);hs(t,n)})(this.encoder,t.document),this.encoder}}class Ks extends Ps{constructor(){super(...arguments),this.type=Ns.Sync,this.description="A document update"}get(t){return us(this.encoder,t.documentName),ls(this.encoder,this.type),e=this.encoder,n=t.update,ls(e,2),hs(e,n),this.encoder;var e,n}}class Js extends Error{constructor(){super(...arguments),this.code=1001}}class Gs extends Rs{constructor(t){var e,n,r;super(),this.configuration={name:"",document:void 0,awareness:void 0,token:null,forceSyncInterval:!1,onAuthenticated:()=>null,onAuthenticationFailed:()=>null,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onSynced:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,onStateless:()=>null,onUnsyncedChanges:()=>null},this.isSynced=!1,this.unsyncedChanges=0,this.isAuthenticated=!1,this.authorizedScope=void 0,this.manageSocket=!1,this._isAttached=!1,this.intervals={forceSync:null},this.boundDocumentUpdateHandler=this.documentUpdateHandler.bind(this),this.boundAwarenessUpdateHandler=this.awarenessUpdateHandler.bind(this),this.boundPageHide=this.pageHide.bind(this),this.boundOnOpen=this.onOpen.bind(this),this.boundOnClose=this.onClose.bind(this),this.forwardConnect=t=>this.emit("connect",t),this.forwardClose=t=>this.emit("close",t),this.forwardDisconnect=t=>this.emit("disconnect",t),this.forwardDestroy=t=>this.emit("destroy",t),this.setConfiguration(t),this.configuration.document=t.document?t.document:new pn,this.configuration.awareness=void 0!==t.awareness?t.awareness:new As(this.document),this.on("open",this.configuration.onOpen),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("synced",this.configuration.onSynced),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("stateless",this.configuration.onStateless),this.on("unsyncedChanges",this.configuration.onUnsyncedChanges),this.on("authenticated",this.configuration.onAuthenticated),this.on("authenticationFailed",this.configuration.onAuthenticationFailed),null===(e=this.awareness)||void 0===e||e.on("update",()=>{this.emit("awarenessUpdate",{states:E(this.awareness.getStates())})}),null===(n=this.awareness)||void 0===n||n.on("change",()=>{this.emit("awarenessChange",{states:E(this.awareness.getStates())})}),this.document.on("update",this.boundDocumentUpdateHandler),null===(r=this.awareness)||void 0===r||r.on("update",this.boundAwarenessUpdateHandler),this.registerEventListeners(),this.configuration.forceSyncInterval&&"number"==typeof this.configuration.forceSyncInterval&&(this.intervals.forceSync=setInterval(this.forceSync.bind(this),this.configuration.forceSyncInterval)),this.manageSocket&&this.attach()}setConfiguration(t={}){if(!t.websocketProvider){const e=t;this.manageSocket=!0,this.configuration.websocketProvider=new Hs({url:e.url})}this.configuration={...this.configuration,...t}}get document(){return this.configuration.document}get isAttached(){return this._isAttached}get awareness(){return this.configuration.awareness}get hasUnsyncedChanges(){return this.unsyncedChanges>0}resetUnsyncedChanges(){this.unsyncedChanges=1,this.emit("unsyncedChanges",{number:this.unsyncedChanges})}incrementUnsyncedChanges(){this.unsyncedChanges+=1,this.emit("unsyncedChanges",{number:this.unsyncedChanges})}decrementUnsyncedChanges(){this.unsyncedChanges>0&&(this.unsyncedChanges-=1),0===this.unsyncedChanges&&(this.synced=!0),this.emit("unsyncedChanges",{number:this.unsyncedChanges})}forceSync(){this.resetUnsyncedChanges(),this.send(qs,{document:this.document,documentName:this.configuration.name})}pageHide(){this.awareness&&Os(this.awareness,[this.document.clientID],"page hide")}registerEventListeners(){"undefined"!=typeof window&&"addEventListener"in window&&window.addEventListener("pagehide",this.boundPageHide)}sendStateless(t){this.send(Ws,{documentName:this.configuration.name,payload:t})}documentUpdateHandler(t,e){e!==this&&(this.incrementUnsyncedChanges(),this.send(Ks,{update:t,documentName:this.configuration.name}))}awarenessUpdateHandler({added:t,updated:e,removed:n},r){const o=t.concat(e).concat(n);this.send(zs,{awareness:this.awareness,clients:o,documentName:this.configuration.name})}get synced(){return this.isSynced}set synced(t){this.isSynced!==t&&(this.isSynced=t,t&&this.emit("synced",{state:t}))}receiveStateless(t){this.emit("stateless",{payload:t})}async connect(){if(this.manageSocket)return this.configuration.websocketProvider.connect();console.warn("HocuspocusProvider::connect() is deprecated and does not do anything. Please connect/disconnect on the websocketProvider, or attach/deattach providers.")}disconnect(){if(this.manageSocket)return this.configuration.websocketProvider.disconnect();console.warn("HocuspocusProvider::disconnect() is deprecated and does not do anything. Please connect/disconnect on the websocketProvider, or attach/deattach providers.")}async onOpen(t){let e;this.isAuthenticated=!1,this.emit("open",{event:t});try{e=await this.getToken()}catch(t){return void this.permissionDeniedHandler(`Failed to get token: ${t}`)}this.send(Vs,{token:null!=e?e:"",documentName:this.configuration.name}),this.startSync()}async getToken(){return"function"==typeof this.configuration.token?await this.configuration.token():this.configuration.token}startSync(){this.resetUnsyncedChanges(),this.send(qs,{document:this.document,documentName:this.configuration.name}),this.awareness&&null!==this.awareness.getLocalState()&&this.send(zs,{awareness:this.awareness,clients:[this.document.clientID],documentName:this.configuration.name})}send(t,e){if(!this._isAttached)return;const n=new Fs(t,e);this.emit("outgoingMessage",{message:n.message}),n.send(this.configuration.websocketProvider)}onMessage(t){const e=new Ls(t.data),n=e.readVarString();e.writeVarString(n),this.emit("message",{event:t,message:new Ls(t.data)}),new Us(e).apply(this,!0)}onClose(){this.isAuthenticated=!1,this.synced=!1,this.awareness&&Os(this.awareness,Array.from(this.awareness.getStates().keys()).filter(t=>t!==this.document.clientID),this)}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),this.awareness&&(Os(this.awareness,[this.document.clientID],"provider destroy"),this.awareness.off("update",this.boundAwarenessUpdateHandler),this.awareness.destroy()),this.document.off("update",this.boundDocumentUpdateHandler),this.removeAllListeners(),this.detach(),this.manageSocket&&this.configuration.websocketProvider.destroy(),"undefined"!=typeof window&&"removeEventListener"in window&&window.removeEventListener("pagehide",this.boundPageHide)}detach(){this.configuration.websocketProvider.off("connect",this.configuration.onConnect),this.configuration.websocketProvider.off("connect",this.forwardConnect),this.configuration.websocketProvider.off("open",this.boundOnOpen),this.configuration.websocketProvider.off("close",this.boundOnClose),this.configuration.websocketProvider.off("close",this.configuration.onClose),this.configuration.websocketProvider.off("close",this.forwardClose),this.configuration.websocketProvider.off("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.off("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.off("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.off("destroy",this.forwardDestroy),this.configuration.websocketProvider.detach(this),this._isAttached=!1}attach(){this._isAttached||(this.configuration.websocketProvider.on("connect",this.configuration.onConnect),this.configuration.websocketProvider.on("connect",this.forwardConnect),this.configuration.websocketProvider.on("open",this.boundOnOpen),this.configuration.websocketProvider.on("close",this.boundOnClose),this.configuration.websocketProvider.on("close",this.configuration.onClose),this.configuration.websocketProvider.on("close",this.forwardClose),this.configuration.websocketProvider.on("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.on("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.on("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.on("destroy",this.forwardDestroy),this.configuration.websocketProvider.attach(this),this._isAttached=!0)}permissionDeniedHandler(t){this.emit("authenticationFailed",{reason:t}),this.isAuthenticated=!1}authenticatedHandler(t){this.isAuthenticated=!0,this.authorizedScope=t,this.emit("authenticated",{scope:t})}setAwarenessField(t,e){if(!this.awareness)throw new Js(`Cannot set awareness field "${t}" to ${JSON.stringify(e)}. You have disabled Awareness for this provider by explicitly passing awareness: null in the provider configuration.`);this.awareness.setLocalStateField(t,e)}}const Ys=t=>{if(t.shouldConnect&&null===t.ws){const e=new WebSocket(t.url),n=t.binaryType;let r=null;n&&(e.binaryType=n),t.ws=e,t.connecting=!0,t.connected=!1,e.onmessage=e=>{t.lastMessageReceived=Oe();const n=e.data,o="string"==typeof n?JSON.parse(n):n;o&&"pong"===o.type&&(clearTimeout(r),r=setTimeout(i,15e3)),t.emit("message",[o,t])};const o=e=>{null!==t.ws&&(t.ws=null,t.connecting=!1,t.connected?(t.connected=!1,t.emit("disconnect",[{type:"disconnect",error:e},t])):t.unsuccessfulReconnects++,setTimeout(Ys,U(1200*j(t.unsuccessfulReconnects+1),2500),t)),clearTimeout(r)},i=()=>{t.ws===e&&t.send({type:"ping"})};e.onclose=()=>o(null),e.onerror=t=>o(t),e.onopen=()=>{t.lastMessageReceived=Oe(),t.connecting=!1,t.connected=!0,t.unsuccessfulReconnects=0,t.emit("connect",[{type:"connect"},t]),r=setTimeout(i,15e3)}}};class Xs extends ${constructor(t,{binaryType:e}={}){super(),this.url=t,this.ws=null,this.binaryType=e||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&3e4<Oe()-this.lastMessageReceived&&this.ws.close()},15e3),Ys(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.connected||null!==this.ws||Ys(this)}}const Qs=new Map,Zs="undefined"==typeof BroadcastChannel?class{constructor(t){var e;this.room=t,this.onmessage=null,this._onChange=e=>e.key===t&&null!==this.onmessage&&this.onmessage({data:Se(e.newValue||"")}),e=this._onChange,Xt||addEventListener("storage",e)}postMessage(t){Qt.setItem(this.room,ke((t=>new Uint8Array(t))(t)))}close(){var t;t=this._onChange,Xt||removeEventListener("storage",t)}}:BroadcastChannel,ta=t=>O(Qs,t,()=>{const e=D(),n=new Zs(t);return n.onmessage=t=>e.forEach(e=>e(t.data,"broadcastchannel")),{bc:n,subs:e}}),ea=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else void 0!==n&&n()}};var na=o(1736);const ra=(t,e)=>{at(t,0);const n=Rn(e);pt(t,n)},oa=(t,e,n)=>{at(t,1),pt(t,Mn(e,n))},ia=(t,e,n)=>{try{En(e,Dt(t),n)}catch(t){console.error("Caught error while handling a Yjs update",t)}},sa=ia;class aa extends ${constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const t=Oe();null!==this.getLocalState()&&15e3<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const e=[];this.meta.forEach((n,r)=>{r!==this.clientID&&3e4<=t-n.lastUpdated&&this.states.has(r)&&e.push(r)}),e.length>0&&la(this,e,"timeout")},H(3e3)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,n=this.meta.get(e),r=void 0===n?0:n.clock+1,o=this.states.get(e);null===t?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:r,lastUpdated:Oe()});const i=[],s=[],a=[],l=[];null===t?l.push(e):null==o?null!=t&&i.push(e):(s.push(e),ue(o,t)||a.push(e)),(i.length>0||a.length>0||l.length>0)&&this.emit("change",[{added:i,updated:a,removed:l},"local"]),this.emit("update",[{added:i,updated:s,removed:l},"local"])}setLocalStateField(t,e){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[t]:e})}getStates(){return this.states}}const la=(t,e,n)=>{const r=[];for(let n=0;n<e.length;n++){const o=e[n];if(t.states.has(o)){if(t.states.delete(o),o===t.clientID){const e=t.meta.get(o);t.meta.set(o,{clock:e.clock+1,lastUpdated:Oe()})}r.push(o)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},ca=(t,e,n=t.states)=>{const r=e.length,o=rt();at(o,r);for(let i=0;i<r;i++){const r=e[i],s=n.get(r)||null,a=t.meta.get(r).clock;at(o,r),at(o,a),ut(o,JSON.stringify(s))}return ot(o)},da=(t,e)=>{if(!e)return Gt(t);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},e,t).then(t=>{const e=rt();return ut(e,"AES-GCM"),pt(e,n),pt(e,new Uint8Array(t)),ot(e)})},ua=(t,e)=>{if(!e)return Gt(t);const n=At(t);var r;"AES-GCM"!==It(n)&&(r=xt("Unknown encryption algorithm"),Promise.reject(r));const o=Dt(n),i=Dt(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:o},e,i).then(t=>new Uint8Array(t))},ha=((t,e)=>{const n=Ue[Fe],r=ye("log"),o=null!==r&&("*"===r||"true"===r||new RegExp(r,"gi").test(e));return Fe=(Fe+1)%Ue.length,e+=": ",o?(...r)=>{1===r.length&&r[0]?.constructor===Function&&(r=r[0]());const o=Oe(),i=o-Ve;Ve=o,t(n,e,je,...r.map(t=>{switch(null!=t&&t.constructor===Uint8Array&&(t=Array.from(t)),typeof t){case"string":case"symbol":return t;default:return De(t)}}),n," +"+i+"ms")}:ce})(qe,"y-webrtc"),pa=new Map,fa=new Map,ma=t=>{let e=!0;t.webrtcConns.forEach(t=>{t.synced||(e=!1)}),(!e&&t.synced||e&&!t.synced)&&(t.synced=e,t.provider.emit("synced",[{synced:e}]),ha("synced ",Re,t.name,Le," with all peers"))},ga=(t,e,n)=>{const r=At(e),o=rt(),i=Lt(r);if(void 0===t)return null;const s=t.awareness,a=t.doc;let l=!1;switch(i){case 0:{at(o,0);const e=((t,e,n,r)=>{const o=Lt(t);switch(o){case 0:((t,e,n)=>{oa(e,n,Dt(t))})(t,e,n);break;case 1:ia(t,n,r);break;case 2:sa(t,n,r);break;default:throw new Error("Unknown message type")}return o})(r,o,a,t);1!==e||t.synced||n(),0===e&&(l=!0);break}case 3:at(o,1),pt(o,ca(s,Array.from(s.getStates().keys()))),l=!0;break;case 1:((t,e,n)=>{const r=At(e),o=Oe(),i=[],s=[],a=[],l=[],c=Lt(r);for(let e=0;e<c;e++){const e=Lt(r);let n=Lt(r);const c=JSON.parse(It(r)),d=t.meta.get(e),u=t.states.get(e),h=void 0===d?0:d.clock;(h<n||h===n&&null===c&&t.states.has(e))&&(null===c?e===t.clientID&&null!=t.getLocalState()?n++:t.states.delete(e):t.states.set(e,c),t.meta.set(e,{clock:n,lastUpdated:o}),void 0===d&&null!==c?i.push(e):void 0!==d&&null===c?l.push(e):null!==c&&(ue(c,u)||a.push(e),s.push(e)))}(i.length>0||a.length>0||l.length>0)&&t.emit("change",[{added:i,updated:a,removed:l},n]),(i.length>0||s.length>0||l.length>0)&&t.emit("update",[{added:i,updated:s,removed:l},n])})(s,Dt(r),t);break;case 4:{const e=1===Rt(r),n=It(r);if(n!==t.peerId&&(t.bcConns.has(n)&&!e||!t.bcConns.has(n)&&e)){const r=[],o=[];e?(t.bcConns.add(n),o.push(n)):(t.bcConns.delete(n),r.push(n)),t.provider.emit("peers",[{added:o,removed:r,webrtcPeers:Array.from(t.webrtcConns.keys()),bcPeers:Array.from(t.bcConns)}]),Sa(t)}break}default:return console.error("Unable to compute message"),o}return l?o:null},ya=(t,e)=>{ha("send message to ",Re,t.remotePeerId,Le,Ie," (",t.room.name,")",je);try{t.peer.send(ot(e))}catch(t){}};class ba{constructor(t,e,n,r){ha("establishing connection to ",Re,n),this.room=r,this.remotePeerId=n,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new na({initiator:e,...r.provider.peerOpts}),this.peer.on("signal",e=>{void 0===this.glareToken&&(this.glareToken=Date.now()+Math.random()),Ca(t,r,{to:n,from:r.peerId,type:"signal",token:this.glareToken,signal:e})}),this.peer.on("connect",()=>{ha("connected to ",Re,n),this.connected=!0;const t=r.provider.doc,e=r.awareness,o=rt();at(o,0),ra(o,t),ya(this,o);const i=e.getStates();if(i.size>0){const t=rt();at(t,1),pt(t,ca(e,Array.from(i.keys()))),ya(this,t)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,r.webrtcConns.has(this.remotePeerId)&&(r.webrtcConns.delete(this.remotePeerId),r.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(r.webrtcConns.keys()),bcPeers:Array.from(r.bcConns)}])),ma(r),this.peer.destroy(),ha("closed connection to ",Re,n),ka(r)}),this.peer.on("error",t=>{ha("Error in connection to ",Re,n,": ",t),ka(r)}),this.peer.on("data",t=>{const e=((t,e)=>{const n=t.room;return ha("received message from ",Re,t.remotePeerId,Ie," (",n.name,")",Le,je),ga(n,e,()=>{t.synced=!0,ha("synced ",Re,n.name,Le," with ",Re,t.remotePeerId),ma(n)})})(this,t);null!==e&&ya(this,e)})}destroy(){this.peer.destroy()}}const va=(t,e)=>da(e,t.key).then(e=>t.mux(()=>((t,e,n=null)=>{const r=ta(t);r.bc.postMessage(e),r.subs.forEach(t=>t(e,n))})(t.name,e))),wa=(t,e)=>{t.bcconnected&&va(t,e),((t,e)=>{ha("broadcast message in ",Re,t.name,Le),t.webrtcConns.forEach(t=>{try{t.peer.send(e)}catch(t){}})})(t,e)},ka=t=>{pa.forEach(e=>{e.connected&&(e.send({type:"subscribe",topics:[t.name]}),t.webrtcConns.size<t.provider.maxConns&&Ca(e,t,{type:"announce",from:t.peerId}))})},Sa=t=>{if(t.provider.filterBcConns){const e=rt();at(e,4),st(e,1),ut(e,t.peerId),va(t,ot(e))}};class xa{constructor(t,e,n,r){this.peerId=Kt(),this.doc=t,this.awareness=e.awareness,this.provider=e,this.synced=!1,this.name=n,this.key=r,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=ea(),this.bcconnected=!1,this._bcSubscriber=t=>ua(new Uint8Array(t),r).then(t=>this.mux(()=>{const e=ga(this,t,()=>{});e&&va(this,ot(e))})),this._docUpdateHandler=(t,e)=>{const n=rt();at(n,0),((t,e)=>{at(t,2),pt(t,e)})(n,t),wa(this,ot(n))},this._awarenessUpdateHandler=({added:t,updated:e,removed:n},r)=>{const o=t.concat(e).concat(n),i=rt();at(i,1),pt(i,ca(this.awareness,o)),wa(this,ot(i))},this._beforeUnloadHandler=()=>{la(this.awareness,[t.clientID],"window unload"),fa.forEach(t=>{t.disconnect()})},"undefined"!=typeof window?window.addEventListener("beforeunload",this._beforeUnloadHandler):"undefined"!=typeof process&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),ka(this);var t,e;t=this.name,e=this._bcSubscriber,ta(t).subs.add(e),this.bcconnected=!0,Sa(this);const n=rt();at(n,0),ra(n,this.doc),va(this,ot(n));const r=rt();at(r,0),oa(r,this.doc),va(this,ot(r));const o=rt();at(o,3),va(this,ot(o));const i=rt();at(i,1),pt(i,ca(this.awareness,[this.doc.clientID])),va(this,ot(i))}disconnect(){pa.forEach(t=>{t.connected&&t.send({type:"unsubscribe",topics:[this.name]})}),la(this.awareness,[this.doc.clientID],"disconnect");const t=rt();at(t,4),st(t,0),ut(t,this.peerId),va(this,ot(t)),((t,e)=>{const n=ta(t);n.subs.delete(e)&&0===n.subs.size&&(n.bc.close(),Qs.delete(t))})(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(t=>t.destroy())}destroy(){this.disconnect(),"undefined"!=typeof window?window.removeEventListener("beforeunload",this._beforeUnloadHandler):"undefined"!=typeof process&&process.off("exit",this._beforeUnloadHandler)}}const Ca=(t,e,n)=>{e.key?((t,e)=>{const n=rt();return gt(n,t),da(ot(n),e)})(n,e.key).then(n=>{t.send({type:"publish",topic:e.name,data:ke(n)})}):t.send({type:"publish",topic:e.name,data:n})};class _a extends Xs{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{ha(`connected (${t})`);const e=Array.from(fa.keys());this.send({type:"subscribe",topics:e}),fa.forEach(t=>Ca(this,t,{type:"announce",from:t.peerId}))}),this.on("message",t=>{if("publish"===t.type){const r=t.topic,o=fa.get(r);if(null==o||"string"!=typeof r)return;const i=t=>{const e=o.webrtcConns,n=o.peerId;if(null==t||t.from===n||void 0!==t.to&&t.to!==n||o.bcConns.has(t.from))return;const r=e.has(t.from)?()=>{}:()=>o.provider.emit("peers",[{removed:[],added:[t.from],webrtcPeers:Array.from(o.webrtcConns.keys()),bcPeers:Array.from(o.bcConns)}]);switch(t.type){case"announce":e.size<o.provider.maxConns&&(O(e,t.from,()=>new ba(this,!0,t.from,o)),r());break;case"signal":if("offer"===t.signal.type){const n=e.get(t.from);if(n){const e=t.token,r=n.glareToken;if(r&&r>e)return void ha("offer rejected: ",t.from);n.glareToken=void 0}}"answer"===t.signal.type&&(ha("offer answered by: ",t.from),e.get(t.from).glareToken=void 0),t.to===n&&(O(e,t.from,()=>new ba(this,!1,t.from,o)).peer.signal(t.signal),r())}};o.key?"string"==typeof t.data&&(e=Se(t.data),n=o.key,ua(e,n).then(t=>Ht(At(new Uint8Array(t))))).then(i):i(t.data)}var e,n}),this.on("disconnect",()=>ha(`disconnect (${t})`))}}const Ea=t=>{t.emit("status",[{connected:t.connected}])},Ta=t=>Jt((e,n)=>{t.onerror=t=>n(new Error(t.target.error)),t.onsuccess=t=>e(t.target.result)}),Ma=(t,e,n="readwrite")=>{const r=t.transaction(e,n);return e.map(t=>La(r,t))},Aa=(t,e)=>Ta(t.count(e)),Oa=(t,e)=>Ta(t.delete(e)),Da=(t,e)=>Ta(t.add(e)),Ra=(t,e,n,r="next")=>((t,e)=>Jt((n,r)=>{t.onerror=r,t.onsuccess=async t=>{const r=t.target.result;if(null===r||!1===await e(r))return n();r.continue()}}))(t.openKeyCursor(e,r),t=>n(t.key)),La=(t,e)=>t.objectStore(e),Na="custom",Ia="updates",Pa=(t,e=()=>{},n=()=>{})=>{const[r]=Ma(t.db,[Ia]);return(o=r,a=t._dbref,i=IDBKeyRange.lowerBound(a,!1),Ta(o.getAll(i,s))).then(o=>{t._destroyed||(e(r),Nr(t.doc,()=>{o.forEach(e=>En(t.doc,e))},t,!1),n(r))}).then(()=>((t,e=null)=>((t,e,n)=>{let r=null;return Ra(t,e,t=>(r=t,!1),n).then(()=>r)})(t,e,"prev"))(r).then(e=>{t._dbref=e+1})).then(()=>Aa(r).then(e=>{t._dbsize=e})).then(()=>r);var o,i,s,a};var $a=o(4617);function Ha(t){this.content=t}Ha.prototype={constructor:Ha,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,o=r.find(t),i=r.content.slice();return-1==o?i.push(n||t,e):(i[o+1]=e,n&&(i[o]=n)),new Ha(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new Ha(n)},addToStart:function(t,e){return new Ha([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Ha(n)},addBefore:function(t,e,n){var r=this.remove(e),o=r.content.slice(),i=r.find(t);return o.splice(-1==i?o.length:i,0,e,n),new Ha(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=Ha.from(t)).size?new Ha(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=Ha.from(t)).size?new Ha(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Ha.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}},Ha.from=function(t){if(t instanceof Ha)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Ha(e)};const Ba=Ha;function ja(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(let t=0;o.text[t]==i.text[t];t++)n++;return n}if(o.content.size||i.content.size){let t=ja(o.content,i.content,n+1);if(null!=t)return t}n+=o.nodeSize}else n+=o.nodeSize}}function Ua(t,e,n,r){for(let o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};let s=t.child(--o),a=e.child(--i),l=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){let t=0,e=Math.min(s.text.length,a.text.length);for(;t<e&&s.text[s.text.length-t-1]==a.text[a.text.length-t-1];)t++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){let t=Ua(s.content,a.content,n-1,r-1);if(t)return t}n-=l,r-=l}else n-=l,r-=l}}class Fa{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let e=0;e<t.length;e++)this.size+=t[e].nodeSize}nodesBetween(t,e,n,r=0,o){for(let i=0,s=0;s<e;i++){let a=this.content[i],l=s+a.nodeSize;if(l>t&&!1!==n(a,r+s,o||null,i)&&a.content.size){let o=s+1;a.nodesBetween(Math.max(0,t-o),Math.min(a.content.size,e-o),n,r+o)}s=l}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let o="",i=!0;return this.nodesBetween(t,e,(s,a)=>{let l=s.isText?s.text.slice(Math.max(t,a)-a,e-a):s.isLeaf?r?"function"==typeof r?r(s):r:s.type.spec.leafText?s.type.spec.leafText(s):"":"";s.isBlock&&(s.isLeaf&&l||s.isTextblock)&&n&&(i?i=!1:o+=n),o+=l},0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new Fa(r,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let n=[],r=0;if(e>t)for(let o=0,i=0;i<e;o++){let s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new Fa(n,r)}cutByIndex(t,e){return t==e?Fa.empty:0==t&&e==this.content.length?this:new Fa(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new Fa(r,o)}addToStart(t){return new Fa([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new Fa(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return ja(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return Ua(this,t,e,n)}findIndex(t,e=-1){if(0==t)return za(0,t);if(t==this.size)return za(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,r=0;;n++){let o=r+this.child(n).nodeSize;if(o>=t)return o==t||e>0?za(n+1,o):za(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return Fa.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fa(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return Fa.empty;let e,n=0;for(let r=0;r<t.length;r++){let o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new Fa(e||t,n)}static from(t){if(!t)return Fa.empty;if(t instanceof Fa)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new Fa([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fa.empty=new Fa([],0);const Va={index:0,offset:0};function za(t,e){return Va.index=t,Va.offset=e,Va}function Wa(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!Wa(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!Wa(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}class qa{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let r=0;r<t.length;r++){let o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&Wa(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);let r=n.create(e.attrs);return n.checkAttrs(r.attrs),r}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return qa.none;if(t instanceof qa)return[t];let e=t.slice();return e.sort((t,e)=>t.type.rank-e.type.rank),e}}qa.none=[];class Ka extends Error{}class Ja{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=Ya(this.content,t+this.openStart,e);return n&&new Ja(n,this.openStart,this.openEnd)}removeBetween(t,e){return new Ja(Ga(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return Ja.empty;let n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new Ja(Fa.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let n=t.lastChild;n&&!n.isLeaf&&(e||!n.type.spec.isolating);n=n.lastChild)r++;return new Ja(t,n,r)}}function Ga(t,e,n){let{index:r,offset:o}=t.findIndex(e),i=t.maybeChild(r),{index:s,offset:a}=t.findIndex(n);if(o==e||i.isText){if(a!=n&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(Ga(i.content,e-o-1,n-o-1)))}function Ya(t,e,n,r){let{index:o,offset:i}=t.findIndex(e),s=t.maybeChild(o);if(i==e||s.isText)return r&&!r.canReplace(o,o,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=Ya(s.content,e-i-1,n);return a&&t.replaceChild(o,s.copy(a))}function Xa(t,e,n){if(n.openStart>t.depth)throw new Ka("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Ka("Inconsistent open depths");return Qa(t,e,n,0)}function Qa(t,e,n,r){let o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){let s=Qa(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){let{start:o,end:s}=function(t,e){let n=e.depth-t.openStart,r=e.node(n).copy(t.content);for(let t=n-1;t>=0;t--)r=e.node(t).copy(Fa.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t);return rl(i,ol(t,o,s,e,r))}{let r=t.parent,o=r.content;return rl(r,o.cut(0,t.parentOffset).append(n.content).append(o.cut(e.parentOffset)))}}return rl(i,il(t,e,r))}function Za(t,e){if(!e.type.compatibleContent(t.type))throw new Ka("Cannot join "+e.type.name+" onto "+t.type.name)}function tl(t,e,n){let r=t.node(n);return Za(r,e.node(n)),r}function el(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function nl(t,e,n,r){let o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(el(t.nodeAfter,r),i++));for(let t=i;t<s;t++)el(o.child(t),r);e&&e.depth==n&&e.textOffset&&el(e.nodeBefore,r)}function rl(t,e){return t.type.checkContent(e),t.copy(e)}function ol(t,e,n,r,o){let i=t.depth>o&&tl(t,e,o+1),s=r.depth>o&&tl(n,r,o+1),a=[];return nl(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(Za(i,s),el(rl(i,ol(t,e,n,r,o+1)),a)):(i&&el(rl(i,il(t,e,o+1)),a),nl(e,n,o,a),s&&el(rl(s,il(n,r,o+1)),a)),nl(r,null,o,a),new Fa(a)}function il(t,e,n){let r=[];return nl(null,t,n,r),t.depth>n&&el(rl(tl(t,e,n+1),il(t,e,n+1)),r),nl(e,null,n,r),new Fa(r)}Ja.empty=new Ja(Fa.empty,0,0);class sl{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return null==t?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[3*this.resolveDepth(t)]}index(t){return this.path[3*this.resolveDepth(t)+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}start(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}after(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1;for(let e=0;e<t;e++)r+=n.child(e).nodeSize;return r}marks(){let t=this.parent,e=this.index();if(0==t.content.size)return qa.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){let t=n;n=r,r=t}let o=n.marks;for(var i=0;i<o.length;i++)!1!==o[i].type.spec.inclusive||r&&o[i].isInSet(r.marks)||(o=o[i--].removeFromSet(o));return o}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,r=t.parent.maybeChild(t.index());for(var o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new dl(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],r=0,o=e;for(let e=t;;){let{index:t,offset:i}=e.content.findIndex(o),s=o-i;if(n.push(e,t,r+i),!s)break;if(e=e.child(t),e.isText)break;o=s-1,r+=i+1}return new sl(e,n,o)}static resolveCached(t,e){let n=cl.get(t);if(n)for(let t=0;t<n.elts.length;t++){let r=n.elts[t];if(r.pos==e)return r}else cl.set(t,n=new al);let r=n.elts[n.i]=sl.resolve(t,e);return n.i=(n.i+1)%ll,r}}class al{constructor(){this.elts=[],this.i=0}}const ll=12,cl=new WeakMap;class dl{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const ul=Object.create(null);class hl{constructor(t,e,n,r=qa.none){this.type=t,this.attrs=e,this.marks=r,this.content=n||Fa.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,r=0){this.content.nodesBetween(t,e,n,r,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,r){return this.content.textBetween(t,e,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&Wa(this.attrs,e||t.defaultAttrs||ul)&&qa.sameSet(this.marks,n||qa.none)}copy(t=null){return t==this.content?this:new hl(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new hl(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return Ja.empty;let r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i).content.cut(r.pos-s,o.pos-s);return new Ja(a,r.depth-i,o.depth-i)}replace(t,e,n){return Xa(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:r}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(r==t||e.isText)return e;t-=r+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(0==t)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let r=this.content.child(e-1);return{node:r,index:e-1,offset:n-r.nodeSize}}resolve(t){return sl.resolveCached(this,t)}resolveNoCache(t){return sl.resolve(this,t)}rangeHasMark(t,e,n){let r=!1;return e>t&&this.nodesBetween(t,e,t=>(n.isInSet(t.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),fl(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=Fa.empty,r=0,o=n.childCount){let i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(let t=r;t<o;t++)if(!this.type.allowsMarks(n.child(t).marks))return!1;return!0}canReplaceWith(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;let o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=qa.none;for(let e=0;e<this.marks.length;e++){let n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!qa.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(t=>t.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let r=Fa.fromJSON(t,e.content),o=t.nodeType(e.type).create(e.attrs,r,n);return o.type.checkAttrs(o.attrs),o}}hl.prototype.text=void 0;class pl extends hl{constructor(t,e,n,r){if(super(t,e,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):fl(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new pl(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new pl(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return 0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function fl(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class ml{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new gl(t,e);if(null==n.next)return ml.empty;let r=yl(n);n.next&&n.err("Unexpected trailing text");let o=function(t){let e=Object.create(null);return function n(r){let o=[];r.forEach(e=>{t[e].forEach(({term:e,to:n})=>{if(!e)return;let r;for(let t=0;t<o.length;t++)o[t][0]==e&&(r=o[t][1]);xl(t,n).forEach(t=>{r||o.push([e,r=[]]),-1==r.indexOf(t)&&r.push(t)})})});let i=e[r.join(",")]=new ml(r.indexOf(t.length-1)>-1);for(let t=0;t<o.length;t++){let r=o[t][1].sort(Sl);i.next.push({type:o[t][0],next:e[r.join(",")]||n(r)})}return i}(xl(t,0))}(function(t){let e=[[]];return o(function t(e,i){if("choice"==e.type)return e.exprs.reduce((e,n)=>e.concat(t(n,i)),[]);if("seq"!=e.type){if("star"==e.type){let s=n();return r(i,s),o(t(e.expr,s),s),[r(s)]}if("plus"==e.type){let s=n();return o(t(e.expr,i),s),o(t(e.expr,s),s),[r(s)]}if("opt"==e.type)return[r(i)].concat(t(e.expr,i));if("range"==e.type){let s=i;for(let r=0;r<e.min;r++){let r=n();o(t(e.expr,s),r),s=r}if(-1==e.max)o(t(e.expr,s),s);else for(let i=e.min;i<e.max;i++){let i=n();r(s,i),o(t(e.expr,s),i),s=i}return[r(s)]}if("name"==e.type)return[r(i,void 0,e.value)];throw new Error("Unknown expr type")}for(let r=0;;r++){let s=t(e.exprs[r],i);if(r==e.exprs.length-1)return s;o(s,i=n())}}(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){let o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach(t=>t.to=e)}}(r));return function(t,e){for(let n=0,r=[t];n<r.length;n++){let t=r[n],o=!t.validEnd,i=[];for(let e=0;e<t.next.length;e++){let{type:n,next:s}=t.next[e];i.push(n.name),!o||n.isText||n.hasRequiredAttrs()||(o=!1),-1==r.indexOf(s)&&r.push(s)}o&&e.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(o,n),o}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let r=this;for(let o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let r=[this];return function o(i,s){let a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return Fa.from(s.map(t=>t.createAndFill()));for(let t=0;t<i.next.length;t++){let{type:e,next:n}=i.next[t];if(!e.isText&&!e.hasRequiredAttrs()&&-1==r.indexOf(n)){r.push(n);let t=o(n,s.concat(e));if(t)return t}}return null}(this,[])}findWrapping(t){for(let e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),o=r.match;if(o.matchType(t)){let t=[];for(let e=r;e.type;e=e.via)t.push(e.type);return t.reverse()}for(let t=0;t<o.next.length;t++){let{type:i,next:s}=o.next[t];i.isLeaf||i.hasRequiredAttrs()||i.name in e||r.type&&!s.validEnd||(n.push({match:i.contentMatch,type:i,via:r}),e[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];return function e(n){t.push(n);for(let r=0;r<n.next.length;r++)-1==t.indexOf(n.next[r].next)&&e(n.next[r].next)}(this),t.map((e,n)=>{let r=n+(e.validEnd?"*":" ")+" ";for(let n=0;n<e.next.length;n++)r+=(n?", ":"")+e.next[n].type.name+"->"+t.indexOf(e.next[n].next);return r}).join("\n")}}ml.empty=new ml(!0);class gl{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function yl(t){let e=[];do{e.push(bl(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function bl(t){let e=[];do{e.push(vl(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function vl(t){let e=function(t){if(t.eat("(")){let e=yl(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){let e=function(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let o=[];for(let t in n){let r=n[t];r.isInGroup(e)&&o.push(r)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}(t,t.next).map(e=>(null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}));return t.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}t.err("Unexpected token '"+t.next+"'")}(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=kl(t,e)}return e}function wl(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function kl(t,e){let n=wl(t),r=n;return t.eat(",")&&(r="}"!=t.next?wl(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Sl(t,e){return e-t}function xl(t,e){let n=[];return function e(r){let o=t[r];if(1==o.length&&!o[0].term)return e(o[0].to);n.push(r);for(let t=0;t<o.length;t++){let{term:r,to:i}=o[t];r||-1!=n.indexOf(i)||e(i)}}(e),n.sort(Sl)}function Cl(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function _l(t,e){let n=Object.create(null);for(let r in t){let o=e&&e[r];if(void 0===o){let e=t[r];if(!e.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=e.default}n[r]=o}return n}function El(t,e,n,r){for(let r in e)if(!(r in t))throw new RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let n in t){let r=t[n];r.validate&&r.validate(e[n])}}function Tl(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Al(t,r,e[r]);return n}class Ml{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Tl(t,n.attrs),this.defaultAttrs=Cl(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ml.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:_l(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new hl(this,this.computeAttrs(t),Fa.from(e),qa.setFrom(n))}createChecked(t=null,e,n){return e=Fa.from(e),this.checkContent(e),new hl(this,this.computeAttrs(t),e,qa.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),(e=Fa.from(e)).size){let t=this.contentMatch.fillBefore(e);if(!t)return null;e=t.append(e)}let r=this.contentMatch.matchFragment(e),o=r&&r.fillBefore(Fa.empty,!0);return o?new hl(this,t,e.append(o),qa.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let e=0;e<t.childCount;e++)if(!this.allowsMarks(t.child(e).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){El(this.attrs,t,"node",this.name)}allowsMarkType(t){return null==this.markSet||this.markSet.indexOf(t)>-1}allowsMarks(t){if(null==this.markSet)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(null==this.markSet)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:qa.none:t}static compile(t,e){let n=Object.create(null);t.forEach((t,r)=>n[t]=new Ml(t,e,r));let r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let t in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}class Al{constructor(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate="string"==typeof n.validate?function(t,e,n){let r=n.split("|");return n=>{let o=null===n?"null":typeof n;if(r.indexOf(o)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${o}`)}}(t,e,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class Ol{constructor(t,e,n,r){this.name=t,this.rank=e,this.schema=n,this.spec=r,this.attrs=Tl(t,r.attrs),this.excluded=null;let o=Cl(this.attrs);this.instance=o?new qa(this,o):null}create(t=null){return!t&&this.instance?this.instance:new qa(this,_l(this.attrs,t))}static compile(t,e){let n=Object.create(null),r=0;return t.forEach((t,o)=>n[t]=new Ol(t,r++,e,o)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){El(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class Dl{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let n in t)e[n]=t[n];e.nodes=Ba.from(t.nodes),e.marks=Ba.from(t.marks||{}),this.nodes=Ml.compile(this.spec.nodes,this),this.marks=Ol.compile(this.spec.marks,this);let n=Object.create(null);for(let t in this.nodes){if(t in this.marks)throw new RangeError(t+" can not be both a node and a mark");let e=this.nodes[t],r=e.spec.content||"",o=e.spec.marks;if(e.contentMatch=n[r]||(n[r]=ml.parse(r,this.nodes)),e.inlineContent=e.contentMatch.inlineContent,e.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!e.isInline||!e.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=e}e.markSet="_"==o?null:o?Rl(this,o.split(" ")):""!=o&&e.inlineContent?null:[]}for(let t in this.marks){let e=this.marks[t],n=e.spec.excludes;e.excluded=null==n?[e]:""==n?[]:Rl(this,n.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof Ml))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)}text(t,e){let n=this.nodes.text;return new pl(n,n.defaultAttrs,t,qa.setFrom(e))}mark(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)}nodeFromJSON(t){return hl.fromJSON(this,t)}markFromJSON(t){return qa.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function Rl(t,e){let n=[];for(let r=0;r<e.length;r++){let o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(let e in t.marks){let r=t.marks[e];("_"==o||r.spec.group&&r.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=r)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}class Ll{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let n=this.matchedStyles=[];e.forEach(t=>{if(function(t){return null!=t.tag}(t))this.tags.push(t);else if(function(t){return null!=t.style}(t)){let e=/[^=]*/.exec(t.style)[0];n.indexOf(e)<0&&n.push(e),this.styles.push(t)}}),this.normalizeLists=!this.tags.some(e=>{if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;let n=t.nodes[e.node];return n.contentMatch.matchType(n)})}parse(t,e={}){let n=new Bl(this,e,!1);return n.addAll(t,qa.none,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new Bl(this,e,!0);return n.addAll(t,qa.none,e.from,e.to),Ja.maxOpen(n.finish())}matchTag(t,e,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(jl(t,n.tag)&&(void 0===n.namespace||t.namespaceURI==n.namespace)&&(!n.context||e.matchesContext(n.context))){if(n.getAttrs){let e=n.getAttrs(t);if(!1===e)continue;n.attrs=e||void 0}return n}}}matchStyle(t,e,n,r){for(let o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){let r=this.styles[o],i=r.style;if(!(0!=i.indexOf(t)||r.context&&!n.matchesContext(r.context)||i.length>t.length&&(61!=i.charCodeAt(t.length)||i.slice(t.length+1)!=e))){if(r.getAttrs){let t=r.getAttrs(e);if(!1===t)continue;r.attrs=t||void 0}return r}}}static schemaRules(t){let e=[];function n(t){let n=null==t.priority?50:t.priority,r=0;for(;r<e.length;r++){let t=e[r];if((null==t.priority?50:t.priority)<n)break}e.splice(r,0,t)}for(let e in t.marks){let r=t.marks[e].spec.parseDOM;r&&r.forEach(t=>{n(t=Ul(t)),t.mark||t.ignore||t.clearMark||(t.mark=e)})}for(let e in t.nodes){let r=t.nodes[e].spec.parseDOM;r&&r.forEach(t=>{n(t=Ul(t)),t.node||t.ignore||t.mark||(t.node=e)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Ll(t,Ll.schemaRules(t)))}}const Nl={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Il={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Pl={ol:!0,ul:!0};function $l(t,e,n){return null!=e?(e?1:0)|("full"===e?2:0):t&&"pre"==t.whitespace?3:-5&n}class Hl{constructor(t,e,n,r,o,i){this.type=t,this.attrs=e,this.marks=n,this.solid=r,this.options=i,this.content=[],this.activeMarks=qa.none,this.match=o||(4&i?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(Fa.from(t));if(!e){let e,n=this.type.contentMatch;return(e=n.findWrapping(t.type))?(this.match=n,e):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)}finish(t){if(!(1&this.options)){let t,e=this.content[this.content.length-1];if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let e=Fa.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(Fa.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Nl.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class Bl{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r,o=e.topNode,i=$l(null,e.preserveWhitespace,0)|(n?4:0);r=o?new Hl(o.type,o.attrs,qa.none,!0,e.topMatch||o.type.contentMatch,i):new Hl(n?null:t.schema.topNodeType,null,qa.none,!0,null,i),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){3==t.nodeType?this.addTextNode(t,e):1==t.nodeType&&this.addElement(t,e)}addTextNode(t,e){let n=t.nodeValue,r=this.top,o=2&r.options?"full":this.localPreserveWS||(1&r.options)>0;if("full"===o||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(o)n="full"!==o?n.replace(/\r?\n|\r/g," "):n.replace(/\r\n?/g,"\n");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let e=r.content[r.content.length-1],o=t.previousSibling;(!e||o&&"BR"==o.nodeName||e.isText&&/[ \t\r\n\u000c]$/.test(e.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),e,!/\S/.test(n)),this.findInText(t)}else this.findInside(t)}addElement(t,e,n){let r=this.localPreserveWS,o=this.top;("PRE"==t.tagName||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let i,s=t.nodeName.toLowerCase();Pl.hasOwnProperty(s)&&this.parser.normalizeLists&&function(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let t=1==e.nodeType?e.nodeName.toLowerCase():null;t&&Pl.hasOwnProperty(t)&&n?(n.appendChild(e),e=n):"li"==t?n=e:t&&(n=null)}}(t);let a=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,n));t:if(a?a.ignore:Il.hasOwnProperty(s))this.findInside(t),this.ignoreFallback(t,e);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(t=a.skip);let n,r=this.needsBlock;if(Nl.hasOwnProperty(s))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),n=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break t}let i=a&&a.skip?e:this.readStyles(t,e);i&&this.addAll(t,i),n&&this.sync(o),this.needsBlock=r}else{let n=this.readStyles(t,e);n&&this.addElementByRule(t,a,n,!1===a.consuming?i:void 0)}this.localPreserveWS=r}leafFallback(t,e){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"),e)}ignoreFallback(t,e){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let n=t.style;if(n&&n.length)for(let t=0;t<this.parser.matchedStyles.length;t++){let r=this.parser.matchedStyles[t],o=n.getPropertyValue(r);if(o)for(let t;;){let n=this.parser.matchStyle(r,o,this,t);if(!n)break;if(n.ignore)return null;if(e=n.clearMark?e.filter(t=>!n.clearMark(t)):e.concat(this.parser.schema.marks[n.mark].create(n.attrs)),!1!==n.consuming)break;t=n}}return e}addElementByRule(t,e,n,r){let o,i;if(e.node)if(i=this.parser.schema.nodes[e.node],i.isLeaf)this.insertNode(i.create(e.attrs),n,"BR"==t.nodeName)||this.leafFallback(t,n);else{let t=this.enter(i,e.attrs||null,n,e.preserveWhitespace);t&&(o=!0,n=t)}else{let t=this.parser.schema.marks[e.mark];n=n.concat(t.create(e.attrs))}let s=this.top;if(i&&i.isLeaf)this.findInside(t);else if(r)this.addElement(t,n,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(t=>this.insertNode(t,n,!1));else{let r=t;"string"==typeof e.contentElement?r=t.querySelector(e.contentElement):"function"==typeof e.contentElement?r=e.contentElement(t):e.contentElement&&(r=e.contentElement),this.findAround(t,r,!0),this.addAll(r,n),this.findAround(t,r,!1)}o&&this.sync(s)&&this.open--}addAll(t,e,n,r){let o=n||0;for(let i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i,e);this.findAtPoint(t,o)}findPlace(t,e,n){let r,o;for(let e=this.open,i=0;e>=0;e--){let s=this.nodes[e],a=s.findWrapping(t);if(a&&(!r||r.length>a.length+i)&&(r=a,o=s,!a.length))break;if(s.solid){if(n)break;i+=2}}if(!r)return null;this.sync(o);for(let t=0;t<r.length;t++)e=this.enterInner(r[t],null,e,!1);return e}insertNode(t,e,n){if(t.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&(e=this.enterInner(t,null,e))}let r=this.findPlace(t,e,n);if(r){this.closeExtra();let e=this.top;e.match&&(e.match=e.match.matchType(t.type));let n=qa.none;for(let o of r.concat(t.marks))(e.type?e.type.allowsMarkType(o.type):Fl(o.type,t.type))&&(n=o.addToSet(n));return e.content.push(t.mark(n)),!0}return!1}enter(t,e,n,r){let o=this.findPlace(t.create(e),n,!1);return o&&(o=this.enterInner(t,e,n,!0,r)),o}enterInner(t,e,n,r=!1,o){this.closeExtra();let i=this.top;i.match=i.match&&i.match.matchType(t);let s=$l(t,o,i.options);4&i.options&&0==i.content.length&&(s|=4);let a=qa.none;return n=n.filter(e=>!(i.type?i.type.allowsMarkType(e.type):Fl(e.type,t))||(a=e.addToSet(a),!1)),this.nodes.push(new Hl(t,e,a,r,null,s)),this.open++,n}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!(!this.isOpen&&!this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=1)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let e=n.length-1;e>=0;e--)t+=n[e].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let r=0;r<this.find.length;r++)null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)&&e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,r=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),o=-(n?n.depth+1:0)+(r?0:1),i=(t,s)=>{for(;t>=0;t--){let a=e[t];if(""==a){if(t==e.length-1||0==t)continue;for(;s>=o;s--)if(i(t-1,s))return!0;return!1}{let t=s>0||0==s&&r?this.nodes[s].type:n&&s>=o?n.node(s-o).type:null;if(!t||t.name!=a&&!t.isInGroup(a))return!1;s--}}return!0};return i(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}}function jl(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Ul(t){let e={};for(let n in t)e[n]=t[n];return e}function Fl(t,e){let n=e.schema.nodes;for(let r in n){let o=n[r];if(!o.allowsMarkType(t))continue;let i=[],s=t=>{i.push(t);for(let n=0;n<t.edgeCount;n++){let{type:r,next:o}=t.edge(n);if(r==e)return!0;if(i.indexOf(o)<0&&s(o))return!0}};if(s(o.contentMatch))return!0}}class Vl{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=Wl(e).createDocumentFragment());let r=n,o=[];return t.forEach(t=>{if(o.length||t.marks.length){let n=0,i=0;for(;n<o.length&&i<t.marks.length;){let e=t.marks[i];if(this.marks[e.type.name]){if(!e.eq(o[n][0])||!1===e.type.spec.spanning)break;n++,i++}else i++}for(;n<o.length;)r=o.pop()[1];for(;i<t.marks.length;){let n=t.marks[i++],s=this.serializeMark(n,t.isInline,e);s&&(o.push([n,r]),r.appendChild(s.dom),r=s.contentDOM||s.dom)}}r.appendChild(this.serializeNodeInner(t,e))}),n}serializeNodeInner(t,e){let{dom:n,contentDOM:r}=Kl(Wl(e),this.nodes[t.type.name](t),null,t.attrs);if(r){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,r)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let r=t.marks.length-1;r>=0;r--){let o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n}serializeMark(t,e,n={}){let r=this.marks[t.type.name];return r&&Kl(Wl(n),r(t,e),null,t.attrs)}static renderSpec(t,e,n=null,r){return Kl(t,e,n,r)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new Vl(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=zl(t.nodes);return e.text||(e.text=t=>t.text),e}static marksFromSchema(t){return zl(t.marks)}}function zl(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Wl(t){return t.document||window.document}const ql=new WeakMap;function Kl(t,e,n,r){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;let o,i=e[0];if("string"!=typeof i)throw new RangeError("Invalid array passed to renderSpec");if(r&&(o=function(t){let e=ql.get(t);return void 0===e&&ql.set(t,e=function(t){let e=null;return function t(n){if(n&&"object"==typeof n)if(Array.isArray(n))if("string"==typeof n[0])e||(e=[]),e.push(n);else for(let e=0;e<n.length;e++)t(n[e]);else for(let e in n)t(n[e])}(t),e}(t)),e}(r))&&o.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s,a=i.indexOf(" ");a>0&&(n=i.slice(0,a),i=i.slice(a+1));let l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],d=1;if(c&&"object"==typeof c&&null==c.nodeType&&!Array.isArray(c)){d=2;for(let t in c)if(null!=c[t]){let e=t.indexOf(" ");e>0?l.setAttributeNS(t.slice(0,e),t.slice(e+1),c[t]):l.setAttribute(t,c[t])}}for(let o=d;o<e.length;o++){let i=e[o];if(0===i){if(o<e.length-1||o>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}{let{dom:e,contentDOM:o}=Kl(t,i,n,r);if(l.appendChild(e),o){if(s)throw new RangeError("Multiple content holes");s=o}}}return{dom:l,contentDOM:s}}const Jl=Math.pow(2,16);function Gl(t,e){return t+e*Jl}function Yl(t){return 65535&t}class Xl{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class Ql{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&Ql.empty)return Ql.empty}recover(t){let e=0,n=Yl(t);if(!this.inverted)for(let t=0;t<n;t++)e+=this.ranges[3*t+2]-this.ranges[3*t+1];return this.ranges[3*n]+e+function(t){return(t-(65535&t))/Jl}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,o=this.inverted?2:1,i=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;let l=this.ranges[s+o],c=this.ranges[s+i],d=a+l;if(t<=d){let o=a+r+((l?t==a?-1:t==d?1:e:e)<0?0:c);if(n)return o;let i=t==(e<0?a:d)?null:Gl(s/3,t-a),u=t==a?2:t==d?1:4;return(e<0?t!=a:t!=d)&&(u|=8),new Xl(o,u,i)}r+=c-l}return n?t+r:new Xl(t+r,0,null)}touches(t,e){let n=0,r=Yl(e),o=this.inverted?2:1,i=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let s=this.ranges[e]-(this.inverted?n:0);if(s>t)break;let a=this.ranges[e+o];if(t<=s+a&&e==3*r)return!0;n+=this.ranges[e+i]-a}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,o=0;r<this.ranges.length;r+=3){let i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),l=this.ranges[r+e],c=this.ranges[r+n];t(s,s+l,a,a+c),o+=c-l}}invert(){return new Ql(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?Ql.empty:new Ql(t<0?[0,-t,0]:[0,0,t])}}Ql.empty=new Ql([]);class Zl{constructor(t,e,n=0,r=(t?t.length:0)){this.mirror=e,this.from=n,this.to=r,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new Zl(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),null!=e&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,n=this._maps.length;e<t._maps.length;e++){let r=t.getMirror(e);this.appendMap(t._maps[e],null!=r&&r<e?n+r:void 0)}}getMirror(t){if(this.mirror)for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this._maps.length+t._maps.length;e>=0;e--){let r=t.getMirror(e);this.appendMap(t._maps[e].invert(),null!=r&&r>e?n-r-1:void 0)}}invert(){let t=new Zl;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this._maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let r=0;for(let n=this.from;n<this.to;n++){let o=this._maps[n].mapResult(t,e);if(null!=o.recover){let e=this.getMirror(n);if(null!=e&&e>n&&e<this.to){n=e,t=this._maps[e].recover(o.recover);continue}}r|=o.delInfo,t=o.pos}return n?t:new Xl(t,r,null)}}const tc=Object.create(null);class ec{getMap(){return Ql.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=tc[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in tc)throw new RangeError("Duplicate use of step JSON ID "+t);return tc[t]=e,e.prototype.jsonID=t,e}}class nc{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new nc(t,null)}static fail(t){return new nc(null,t)}static fromReplace(t,e,n,r){try{return nc.ok(t.replace(e,n,r))}catch(t){if(t instanceof Ka)return nc.fail(t.message);throw t}}}function rc(t,e,n){let r=[];for(let o=0;o<t.childCount;o++){let i=t.child(o);i.content.size&&(i=i.copy(rc(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return Fa.fromArray(r)}class oc extends ec{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),r=n.node(n.sharedDepth(this.to)),o=new Ja(rc(e.content,(t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t,r),e.openStart,e.openEnd);return nc.fromReplace(t,this.from,this.to,o)}invert(){return new ic(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new oc(e.pos,n.pos,this.mark)}merge(t){return t instanceof oc&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new oc(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new oc(e.from,e.to,t.markFromJSON(e.mark))}}ec.jsonID("addMark",oc);class ic extends ec{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new Ja(rc(e.content,t=>t.mark(this.mark.removeFromSet(t.marks)),t),e.openStart,e.openEnd);return nc.fromReplace(t,this.from,this.to,n)}invert(){return new oc(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new ic(e.pos,n.pos,this.mark)}merge(t){return t instanceof ic&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new ic(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ic(e.from,e.to,t.markFromJSON(e.mark))}}ec.jsonID("removeMark",ic);class sc extends ec{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return nc.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return nc.fromReplace(t,this.pos,this.pos+1,new Ja(Fa.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let n=0;n<e.marks.length;n++)if(!e.marks[n].isInSet(t))return new sc(this.pos,e.marks[n]);return new sc(this.pos,this.mark)}}return new ac(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new sc(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new sc(e.pos,t.markFromJSON(e.mark))}}ec.jsonID("addNodeMark",sc);class ac extends ec{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return nc.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return nc.fromReplace(t,this.pos,this.pos+1,new Ja(Fa.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new sc(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new ac(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ac(e.pos,t.markFromJSON(e.mark))}}ec.jsonID("removeNodeMark",ac);class lc extends ec{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&dc(t,this.from,this.to)?nc.fail("Structure replace would overwrite content"):nc.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new Ql([this.from,this.to-this.from,this.slice.size])}invert(t){return new lc(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new lc(e.pos,Math.max(e.pos,n.pos),this.slice,this.structure)}merge(t){if(!(t instanceof lc)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?Ja.empty:new Ja(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new lc(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?Ja.empty:new Ja(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new lc(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new lc(e.from,e.to,Ja.fromJSON(t,e.slice),!!e.structure)}}ec.jsonID("replace",lc);class cc extends ec{constructor(t,e,n,r,o,i,s=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=o,this.insert=i,this.structure=s}apply(t){if(this.structure&&(dc(t,this.from,this.gapFrom)||dc(t,this.gapTo,this.to)))return nc.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return nc.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?nc.fromReplace(t,this.from,this.to,n):nc.fail("Content does not fit in gap")}getMap(){return new Ql([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new cc(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),o=this.to==this.gapTo?n.pos:t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||o>n.pos?null:new cc(e.pos,n.pos,r,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new cc(e.from,e.to,e.gapFrom,e.gapTo,Ja.fromJSON(t,e.slice),e.insert,!!e.structure)}}function dc(t,e,n){let r=t.resolve(e),o=n-e,i=r.depth;for(;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0){let t=r.node(i).maybeChild(r.indexAfter(i));for(;o>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,o--}}return!1}function uc(t,e,n,r=n.contentMatch,o=!0){let i=t.doc.nodeAt(e),s=[],a=e+1;for(let e=0;e<i.childCount;e++){let l=i.child(e),c=a+l.nodeSize,d=r.matchType(l.type);if(d){r=d;for(let e=0;e<l.marks.length;e++)n.allowsMarkType(l.marks[e].type)||t.step(new ic(a,c,l.marks[e]));if(o&&l.isText&&"pre"!=n.whitespace){let t,e,r=/\r?\n|\r/g;for(;t=r.exec(l.text);)e||(e=new Ja(Fa.from(n.schema.text(" ",n.allowedMarks(l.marks))),0,0)),s.push(new lc(a+t.index,a+t.index+t[0].length,e))}}else s.push(new lc(a,c,Ja.empty));a=c}if(!r.validEnd){let e=r.fillBefore(Fa.empty,!0);t.replace(a,a,new Ja(e,0,0))}for(let e=s.length-1;e>=0;e--)t.step(s[e])}function hc(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function pc(t){let e=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth;;--n){let r=t.$from.node(n),o=t.$from.index(n),i=t.$to.indexAfter(n);if(n<t.depth&&r.canReplace(o,i,e))return n;if(0==n||r.type.spec.isolating||!hc(r,o,i))break}return null}function fc(t,e,n=null,r=t){let o=function(t,e){let{parent:n,startIndex:r,endIndex:o}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let s=i.length?i[0]:e;return n.canReplaceWith(r,o,s)?i:null}(t,e),i=o&&function(t,e){let{parent:n,startIndex:r,endIndex:o}=t,i=n.child(r),s=e.contentMatch.findWrapping(i.type);if(!s)return null;let a=(s.length?s[s.length-1]:e).contentMatch;for(let t=r;a&&t<o;t++)a=a.matchType(n.child(t).type);return a&&a.validEnd?s:null}(r,e);return i?o.map(mc).concat({type:e,attrs:n}).concat(i.map(mc)):null}function mc(t){return{type:t,attrs:null}}function gc(t,e,n,r){e.forEach((o,i)=>{if(o.isText){let s,a=/\r?\n|\r/g;for(;s=a.exec(o.text);){let o=t.mapping.slice(r).map(n+1+i+s.index);t.replaceWith(o,o+1,e.type.schema.linebreakReplacement.create())}}})}function yc(t,e,n,r){e.forEach((o,i)=>{if(o.type==o.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text("\n"))}})}function bc(t,e,n=1,r){let o=t.resolve(e),i=o.depth-n,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let t=o.depth-1,e=n-2;t>i;t--,e--){let n=o.node(t),i=o.index(t);if(n.type.spec.isolating)return!1;let s=n.content.cutByIndex(i,n.childCount),a=r&&r[e+1];a&&(s=s.replaceChild(0,a.type.create(a.attrs)));let l=r&&r[e]||n;if(!n.canReplace(i+1,n.childCount)||!l.type.validContent(s))return!1}let a=o.indexAfter(i),l=r&&r[0];return o.node(i).canReplaceWith(a,a,l?l.type:o.node(i+1).type)}function vc(t,e){let n=t.resolve(e),r=n.index();return wc(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function wc(t,e){return!(!t||!e||t.isLeaf||!function(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let o=0;o<e.childCount;o++){let i=e.child(o),s=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(s),!n)return!1;if(!t.type.allowsMarks(i.marks))return!1}return n.validEnd}(t,e))}function kc(t,e,n=-1){let r=t.resolve(e);for(let t=r.depth;;t--){let o,i,s=r.index(t);if(t==r.depth?(o=r.nodeBefore,i=r.nodeAfter):n>0?(o=r.node(t+1),s++,i=r.node(t).maybeChild(s)):(o=r.node(t).maybeChild(s-1),i=r.node(t+1)),o&&!o.isTextblock&&wc(o,i)&&r.node(t).canReplace(s,s+1))return e;if(0==t)break;e=n<0?r.before(t):r.after(t)}}function Sc(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let o=n.content;for(let t=0;t<n.openStart;t++)o=o.firstChild.content;for(let t=1;t<=(0==n.openStart&&n.size?2:1);t++)for(let e=r.depth;e>=0;e--){let n=e==r.depth?0:r.pos<=(r.start(e+1)+r.end(e+1))/2?-1:1,i=r.index(e)+(n>0?1:0),s=r.node(e),a=!1;if(1==t)a=s.canReplace(i,i,o);else{let t=s.contentMatchAt(i).findWrapping(o.firstChild.type);a=t&&s.canReplaceWith(i,i,t[0])}if(a)return 0==n?r.pos:n<0?r.before(e+1):r.after(e+1)}return null}function xc(t,e,n=e,r=Ja.empty){if(e==n&&!r.size)return null;let o=t.resolve(e),i=t.resolve(n);return Cc(o,i,r)?new lc(e,n,r):new _c(o,i,r).fit()}function Cc(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}ec.jsonID("replaceAround",cc);class _c{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=Fa.empty;for(let e=0;e<=t.depth;e++){let n=t.node(e);this.frontier.push({type:n.type,match:n.contentMatchAt(t.indexAfter(e))})}for(let e=t.depth;e>0;e--)this.placed=Fa.from(t.node(e).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(t<0?this.$to:n.doc.resolve(t));if(!r)return null;let o=this.placed,i=n.depth,s=r.depth;for(;i&&s&&1==o.childCount;)o=o.firstChild.content,i--,s--;let a=new Ja(o,i,s);return t>-1?new cc(n.pos,t,this.$to.pos,this.$to.end(),a,e):a.size||n.pos!=this.$to.pos?new lc(n.pos,r.pos,a):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<t;n++){let o=e.firstChild;if(e.childCount>1&&(r=0),o.type.spec.isolating&&r<=n){t=n;break}e=o.content}for(let e=1;e<=2;e++)for(let n=1==e?t:this.unplaced.openStart;n>=0;n--){let t,r=null;n?(r=Mc(this.unplaced.content,n-1).firstChild,t=r.content):t=this.unplaced.content;let o=t.firstChild;for(let t=this.depth;t>=0;t--){let i,{type:s,match:a}=this.frontier[t],l=null;if(1==e&&(o?a.matchType(o.type)||(l=a.fillBefore(Fa.from(o),!1)):r&&s.compatibleContent(r.type)))return{sliceDepth:n,frontierDepth:t,parent:r,inject:l};if(2==e&&o&&(i=a.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:t,parent:r,wrap:i};if(r&&a.matchType(r.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,r=Mc(t,e);return!(!r.childCount||r.firstChild.isLeaf||(this.unplaced=new Ja(t,e+1,Math.max(n,r.size+e>=t.size-n?e+1:0)),0))}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,r=Mc(t,e);if(r.childCount<=1&&e>0){let o=t.size-e<=e+r.size;this.unplaced=new Ja(Ec(t,e-1,1),e-1,o?e-1:n)}else this.unplaced=new Ja(Ec(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:r,wrap:o}){for(;this.depth>e;)this.closeFrontierNode();if(o)for(let t=0;t<o.length;t++)this.openFrontierNode(o[t]);let i=this.unplaced,s=n?n.content:i.content,a=i.openStart-t,l=0,c=[],{match:d,type:u}=this.frontier[e];if(r){for(let t=0;t<r.childCount;t++)c.push(r.child(t));d=d.matchFragment(r)}let h=s.size+t-(i.content.size-i.openEnd);for(;l<s.childCount;){let t=s.child(l),e=d.matchType(t.type);if(!e)break;l++,(l>1||0==a||t.content.size)&&(d=e,c.push(Ac(t.mark(u.allowedMarks(t.marks)),1==l?a:0,l==s.childCount?h:-1)))}let p=l==s.childCount;p||(h=-1),this.placed=Tc(this.placed,e,Fa.from(c)),this.frontier[e].match=d,p&&h<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let t=0,e=s;t<h;t++){let t=e.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)}),e=t.content}this.unplaced=p?0==t?Ja.empty:new Ja(Ec(i.content,t-1,1),t-1,h<0?i.openEnd:t-1):new Ja(Ec(i.content,t,l),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t,e=this.frontier[this.depth];if(!e.type.isTextblock||!Oc(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:r}=this.frontier[e],o=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),i=Oc(t,e,r,n,o);if(i){for(let n=e-1;n>=0;n--){let{match:e,type:r}=this.frontier[n],o=Oc(t,n,r,e,!0);if(!o||o.childCount)continue t}return{depth:e,fit:i,move:o?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Tc(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let e=t.node(n),r=e.type.contentMatch.fillBefore(e.content,!0,t.index(n));this.openFrontierNode(e.type,e.attrs,r)}return t}openFrontierNode(t,e=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=Tc(this.placed,this.depth,Fa.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(Fa.empty,!0);t.childCount&&(this.placed=Tc(this.placed,this.frontier.length,t))}}function Ec(t,e,n){return 0==e?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Ec(t.firstChild.content,e-1,n)))}function Tc(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Tc(t.lastChild.content,e-1,n)))}function Mc(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function Ac(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,Ac(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Fa.empty,!0)))),t.copy(r)}function Oc(t,e,n,r,o){let i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,s);return a&&!function(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}(n,i.content,s)?a:null}function Dc(t){return t.spec.defining||t.spec.definingForContent}function Rc(t,e,n,r,o){if(e<n){let o=t.firstChild;t=t.replaceChild(0,o.copy(Rc(o.content,e+1,n,r,o)))}if(e>r){let e=o.contentMatchAt(0),n=e.fillBefore(t).append(t);t=n.append(e.matchFragment(n).fillBefore(Fa.empty,!0))}return t}function Lc(t,e){let n=[];for(let r=Math.min(t.depth,e.depth);r>=0;r--){let o=t.start(r);if(o<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(o==e.start(r)||r==t.depth&&r==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==o-1)&&n.push(r)}return n}class Nc extends ec{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return nc.fail("No node at attribute step's position");let n=Object.create(null);for(let t in e.attrs)n[t]=e.attrs[t];n[this.attr]=this.value;let r=e.type.create(n,null,e.marks);return nc.fromReplace(t,this.pos,this.pos+1,new Ja(Fa.from(r),0,e.isLeaf?0:1))}getMap(){return Ql.empty}invert(t){return new Nc(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Nc(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new Nc(e.pos,e.attr,e.value)}}ec.jsonID("attr",Nc);class Ic extends ec{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let n in t.attrs)e[n]=t.attrs[n];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return nc.ok(n)}getMap(){return Ql.empty}invert(t){return new Ic(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if("string"!=typeof e.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Ic(e.attr,e.value)}}ec.jsonID("docAttr",Ic);let Pc=class extends Error{};Pc=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},(Pc.prototype=Object.create(Error.prototype)).constructor=Pc,Pc.prototype.name="TransformError";class $c{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Zl}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new Pc(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=Ja.empty){let r=xc(this.doc,t,e,n);return r&&this.step(r),this}replaceWith(t,e,n){return this.replace(t,e,new Ja(Fa.from(n),0,0))}delete(t,e){return this.replace(t,e,Ja.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return function(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let o=t.doc.resolve(e),i=t.doc.resolve(n);if(Cc(o,i,r))return t.step(new lc(e,n,r));let s=Lc(o,t.doc.resolve(n));0==s[s.length-1]&&s.pop();let a=-(o.depth+1);s.unshift(a);for(let t=o.depth,e=o.pos-1;t>0;t--,e--){let n=o.node(t).type.spec;if(n.defining||n.definingAsContext||n.isolating)break;s.indexOf(t)>-1?a=t:o.before(t)==e&&s.splice(1,0,-t)}let l=s.indexOf(a),c=[],d=r.openStart;for(let t=r.content,e=0;;e++){let n=t.firstChild;if(c.push(n),e==r.openStart)break;t=n.content}for(let t=d-1;t>=0;t--){let e=c[t],n=Dc(e.type);if(n&&!e.sameMarkup(o.node(Math.abs(a)-1)))d=t;else if(n||!e.type.isTextblock)break}for(let e=r.openStart;e>=0;e--){let a=(e+d+1)%(r.openStart+1),u=c[a];if(u)for(let e=0;e<s.length;e++){let c=s[(e+l)%s.length],d=!0;c<0&&(d=!1,c=-c);let h=o.node(c-1),p=o.index(c-1);if(h.canReplaceWith(p,p,u.type,u.marks))return t.replace(o.before(c),d?i.after(c):n,new Ja(Rc(r.content,0,r.openStart,a),a,r.openEnd))}}let u=t.steps.length;for(let a=s.length-1;a>=0&&(t.replace(e,n,r),!(t.steps.length>u));a--){let t=s[a];t<0||(e=o.before(t),n=i.after(t))}}(this,t,e,n),this}replaceRangeWith(t,e,n){return function(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let o=function(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(let t=r.depth-1;t>=0;t--){let e=r.index(t);if(r.node(t).canReplaceWith(e,e,n))return r.before(t+1);if(e>0)return null}if(r.parentOffset==r.parent.content.size)for(let t=r.depth-1;t>=0;t--){let e=r.indexAfter(t);if(r.node(t).canReplaceWith(e,e,n))return r.after(t+1);if(e<r.node(t).childCount)return null}return null}(t.doc,e,r.type);null!=o&&(e=n=o)}t.replaceRange(e,n,new Ja(Fa.from(r),0,0))}(this,t,e,n),this}deleteRange(t,e){return function(t,e,n){let r=t.doc.resolve(e),o=t.doc.resolve(n),i=Lc(r,o);for(let e=0;e<i.length;e++){let n=i[e],s=e==i.length-1;if(s&&0==n||r.node(n).type.contentMatch.validEnd)return t.delete(r.start(n),o.end(n));if(n>0&&(s||r.node(n-1).canReplace(r.index(n-1),o.indexAfter(n-1))))return t.delete(r.before(n),o.after(n))}for(let i=1;i<=r.depth&&i<=o.depth;i++)if(e-r.start(i)==r.depth-i&&n>r.end(i)&&o.end(i)-n!=o.depth-i&&r.start(i-1)==o.start(i-1)&&r.node(i-1).canReplace(r.index(i-1),o.index(i-1)))return t.delete(r.before(i),n);t.delete(e,n)}(this,t,e),this}lift(t,e){return function(t,e,n){let{$from:r,$to:o,depth:i}=e,s=r.before(i+1),a=o.after(i+1),l=s,c=a,d=Fa.empty,u=0;for(let t=i,e=!1;t>n;t--)e||r.index(t)>0?(e=!0,d=Fa.from(r.node(t).copy(d)),u++):l--;let h=Fa.empty,p=0;for(let t=i,e=!1;t>n;t--)e||o.after(t+1)<o.end(t)?(e=!0,h=Fa.from(o.node(t).copy(h)),p++):c++;t.step(new cc(l,c,s,a,new Ja(d.append(h),u,p),d.size-u,!0))}(this,t,e),this}join(t,e=1){return function(t,e,n){let r=null,{linebreakReplacement:o}=t.doc.type.schema,i=t.doc.resolve(e-n),s=i.node().type;if(o&&s.inlineContent){let t="pre"==s.whitespace,e=!!s.contentMatch.matchType(o);t&&!e?r=!1:!t&&e&&(r=!0)}let a=t.steps.length;if(!1===r){let r=t.doc.resolve(e+n);yc(t,r.node(),r.before(),a)}s.inlineContent&&uc(t,e+n-1,s,i.node().contentMatchAt(i.index()),null==r);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new lc(c,l.map(e+n,-1),Ja.empty,!0)),!0===r){let e=t.doc.resolve(c);gc(t,e.node(),e.before(),t.steps.length)}}(this,t,e),this}wrap(t,e){return function(t,e,n){let r=Fa.empty;for(let t=n.length-1;t>=0;t--){if(r.size){let e=n[t].type.contentMatch.matchFragment(r);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Fa.from(n[t].type.create(n[t].attrs,r))}let o=e.start,i=e.end;t.step(new cc(o,i,o,i,new Ja(r,0,0),n.length,!0))}(this,t,e),this}setBlockType(t,e=t,n,r=null){return function(t,e,n,r,o){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(e,n)=>{let s="function"==typeof o?o(e):o;if(e.isTextblock&&!e.hasMarkup(r,s)&&function(t,e,n){let r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(t.doc,t.mapping.slice(i).map(n),r)){let o=null;if(r.schema.linebreakReplacement){let t="pre"==r.whitespace,e=!!r.contentMatch.matchType(r.schema.linebreakReplacement);t&&!e?o=!1:!t&&e&&(o=!0)}!1===o&&yc(t,e,n,i),uc(t,t.mapping.slice(i).map(n,1),r,void 0,null===o);let a=t.mapping.slice(i),l=a.map(n,1),c=a.map(n+e.nodeSize,1);return t.step(new cc(l,c,l+1,c-1,new Ja(Fa.from(r.create(s,null,e.marks)),0,0),1,!0)),!0===o&&gc(t,e,n,i),!1}})}(this,t,e,n,r),this}setNodeMarkup(t,e,n=null,r){return function(t,e,n,r,o){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let s=n.create(r,null,o||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,s);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new cc(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new Ja(Fa.from(s),0,0),1,!0))}(this,t,e,n,r),this}setNodeAttribute(t,e,n){return this.step(new Nc(t,e,n)),this}setDocAttribute(t,e){return this.step(new Ic(t,e)),this}addNodeMark(t,e){return this.step(new sc(t,e)),this}removeNodeMark(t,e){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e instanceof qa)e.isInSet(n.marks)&&this.step(new ac(t,e));else{let r,o=n.marks,i=[];for(;r=e.isInSet(o);)i.push(new ac(t,r)),o=r.removeFromSet(o);for(let t=i.length-1;t>=0;t--)this.step(i[t])}return this}split(t,e=1,n){return function(t,e,n=1,r){let o=t.doc.resolve(e),i=Fa.empty,s=Fa.empty;for(let t=o.depth,e=o.depth-n,a=n-1;t>e;t--,a--){i=Fa.from(o.node(t).copy(i));let e=r&&r[a];s=Fa.from(e?e.type.create(e.attrs,s):o.node(t).copy(s))}t.step(new lc(e,e,new Ja(i.append(s),n,n),!0))}(this,t,e,n),this}addMark(t,e,n){return function(t,e,n,r){let o,i,s=[],a=[];t.doc.nodesBetween(e,n,(t,l,c)=>{if(!t.isInline)return;let d=t.marks;if(!r.isInSet(d)&&c.type.allowsMarkType(r.type)){let c=Math.max(l,e),u=Math.min(l+t.nodeSize,n),h=r.addToSet(d);for(let t=0;t<d.length;t++)d[t].isInSet(h)||(o&&o.to==c&&o.mark.eq(d[t])?o.to=u:s.push(o=new ic(c,u,d[t])));i&&i.to==c?i.to=u:a.push(i=new oc(c,u,r))}}),s.forEach(e=>t.step(e)),a.forEach(e=>t.step(e))}(this,t,e,n),this}removeMark(t,e,n){return function(t,e,n,r){let o=[],i=0;t.doc.nodesBetween(e,n,(t,s)=>{if(!t.isInline)return;i++;let a=null;if(r instanceof Ol){let e,n=t.marks;for(;e=r.isInSet(n);)(a||(a=[])).push(e),n=e.removeFromSet(n)}else r?r.isInSet(t.marks)&&(a=[r]):a=t.marks;if(a&&a.length){let r=Math.min(s+t.nodeSize,n);for(let t=0;t<a.length;t++){let n,l=a[t];for(let t=0;t<o.length;t++){let e=o[t];e.step==i-1&&l.eq(o[t].style)&&(n=e)}n?(n.to=r,n.step=i):o.push({style:l,from:Math.max(s,e),to:r,step:i})}}}),o.forEach(e=>t.step(new ic(e.from,e.to,e.style)))}(this,t,e,n),this}clearIncompatible(t,e,n){return uc(this,t,e,n),this}}const Hc=Object.create(null);class Bc{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new jc(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=Ja.empty){let n=e.content.lastChild,r=null;for(let t=0;t<e.openEnd;t++)r=n,n=n.lastChild;let o=t.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:a,$to:l}=i[s],c=t.mapping.slice(o);t.replaceRange(c.map(a.pos),c.map(l.pos),s?Ja.empty:e),0==s&&Yc(t,o,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){let{$from:i,$to:s}=r[o],a=t.mapping.slice(n),l=a.map(i.pos),c=a.map(s.pos);o?t.deleteRange(l,c):(t.replaceRangeWith(l,c,e),Yc(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let r=t.parent.inlineContent?new Vc(t):Gc(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(let r=t.depth-1;r>=0;r--){let o=e<0?Gc(t.node(0),t.node(r),t.before(r+1),t.index(r),e,n):Gc(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,n);if(o)return o}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new Kc(t.node(0))}static atStart(t){return Gc(t,t,0,0,1)||new Kc(t)}static atEnd(t){return Gc(t,t,t.content.size,t.childCount,-1)||new Kc(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=Hc[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in Hc)throw new RangeError("Duplicate use of selection JSON ID "+t);return Hc[t]=e,e.prototype.jsonID=t,e}getBookmark(){return Vc.between(this.$anchor,this.$head).getBookmark()}}Bc.prototype.visible=!0;class jc{constructor(t,e){this.$from=t,this.$to=e}}let Uc=!1;function Fc(t){Uc||t.parent.inlineContent||(Uc=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class Vc extends Bc{constructor(t,e=t){Fc(t),Fc(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return Bc.near(n);let r=t.resolve(e.map(this.anchor));return new Vc(r.parent.inlineContent?r:n,n)}replace(t,e=Ja.empty){if(super.replace(t,e),e==Ja.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof Vc&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new zc(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new Vc(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}static between(t,e,n){let r=t.pos-e.pos;if(n&&!r||(n=r>=0?1:-1),!e.parent.inlineContent){let t=Bc.findFrom(e,n,!0)||Bc.findFrom(e,-n,!0);if(!t)return Bc.near(e,n);e=t.$head}return t.parent.inlineContent||(0==r||(t=(Bc.findFrom(t,-n,!0)||Bc.findFrom(t,n,!0)).$anchor).pos<e.pos!=r<0)&&(t=e),new Vc(t,e)}}Bc.jsonID("text",Vc);class zc{constructor(t,e){this.anchor=t,this.head=e}map(t){return new zc(t.map(this.anchor),t.map(this.head))}resolve(t){return Vc.between(t.resolve(this.anchor),t.resolve(this.head))}}class Wc extends Bc{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:r}=e.mapResult(this.anchor),o=t.resolve(r);return n?Bc.near(o):new Wc(o)}content(){return new Ja(Fa.from(this.node),0,0)}eq(t){return t instanceof Wc&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new qc(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Wc(t.resolve(e.anchor))}static create(t,e){return new Wc(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}Wc.prototype.visible=!1,Bc.jsonID("node",Wc);class qc{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new zc(n,n):new qc(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&Wc.isSelectable(n)?new Wc(e):Bc.near(e)}}class Kc extends Bc{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=Ja.empty){if(e==Ja.empty){t.delete(0,t.doc.content.size);let e=Bc.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new Kc(t)}map(t){return new Kc(t)}eq(t){return t instanceof Kc}getBookmark(){return Jc}}Bc.jsonID("all",Kc);const Jc={map(){return this},resolve:t=>new Kc(t)};function Gc(t,e,n,r,o,i=!1){if(e.inlineContent)return Vc.create(t,n);for(let s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){let r=e.child(s);if(r.isAtom){if(!i&&Wc.isSelectable(r))return Wc.create(t,n-(o<0?r.nodeSize:0))}else{let e=Gc(t,r,n+o,o<0?r.childCount:0,o,i);if(e)return e}n+=r.nodeSize*o}return null}function Yc(t,e,n){let r=t.steps.length-1;if(r<e)return;let o,i=t.steps[r];(i instanceof lc||i instanceof cc)&&(t.mapping.maps[r].forEach((t,e,n,r)=>{null==o&&(o=r)}),t.setSelection(Bc.near(t.doc.resolve(o),n)))}class Xc extends $c{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=2,this}ensureMarks(t){return qa.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(t,e){super.addStep(t,e),this.updated=-3&this.updated,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||qa.none))),n.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,n){let r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();{if(null==n&&(n=e),n=null==n?e:n,!t)return this.deleteRange(e,n);let o=this.storedMarks;if(!o){let t=this.doc.resolve(e);o=n==e?t.marks():t.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(Bc.near(this.selection.$to)),this}}setMeta(t,e){return this.meta["string"==typeof t?t:t.key]=e,this}getMeta(t){return this.meta["string"==typeof t?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function Qc(t,e){return e&&t?t.bind(e):t}class Zc{constructor(t,e,n){this.name=t,this.init=Qc(e.init,n),this.apply=Qc(e.apply,n)}}const td=[new Zc("doc",{init:t=>t.doc||t.schema.topNodeType.createAndFill(),apply:t=>t.doc}),new Zc("selection",{init:(t,e)=>t.selection||Bc.atStart(e.doc),apply:t=>t.selection}),new Zc("storedMarks",{init:t=>t.storedMarks||null,apply:(t,e,n,r)=>r.selection.$cursor?t.storedMarks:null}),new Zc("scrollToSelection",{init:()=>0,apply:(t,e)=>t.scrolledIntoView?e+1:e})];class ed{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=td.slice(),e&&e.forEach(t=>{if(this.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");this.plugins.push(t),this.pluginsByKey[t.key]=t,t.spec.state&&this.fields.push(new Zc(t.key,t.spec.state,t))})}}class nd{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=e){let e=this.config.plugins[n];if(e.spec.filterTransaction&&!e.spec.filterTransaction.call(e,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],n=this.applyInner(t),r=null;for(;;){let o=!1;for(let i=0;i<this.config.plugins.length;i++){let s=this.config.plugins[i];if(s.spec.appendTransaction){let a=r?r[i].n:0,l=r?r[i].state:this,c=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,l,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",t),!r){r=[];for(let t=0;t<this.config.plugins.length;t++)r.push(t<i?{state:n,n:e.length}:{state:this,n:0})}e.push(c),n=n.applyInner(c),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new nd(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}return e}get tr(){return new Xc(this)}static create(t){let e=new ed(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new nd(e);for(let r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n}reconfigure(t){let e=new ed(this.schema,t.plugins),n=e.fields,r=new nd(e);for(let e=0;e<n.length;e++){let o=n[e].name;r[o]=this.hasOwnProperty(o)?this[o]:n[e].init(t,r)}return r}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(t=>t.toJSON())),t&&"object"==typeof t)for(let n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e}static fromJSON(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let r=new ed(t.schema,t.plugins),o=new nd(r);return r.fields.forEach(r=>{if("doc"==r.name)o.doc=hl.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=Bc.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(let i in n){let s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}}),o}}function rd(t,e,n){for(let r in t){let o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=rd(o,e,{})),n[r]=o}return n}class od{constructor(t){this.spec=t,this.props={},t.props&&rd(t.props,this,this.props),this.key=t.key?t.key.key:sd("plugin")}getState(t){return t[this.key]}}const id=Object.create(null);function sd(t){return t in id?t+"$"+ ++id[t]:(id[t]=0,t+"$")}class ad{constructor(t="key"){this.key=sd(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const ld=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},cd=function(t){let e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e};let dd=null;const ud=function(t,e,n){let r=dd||(dd=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},hd=function(t,e,n,r){return n&&(fd(t,e,n,r,-1)||fd(t,e,n,r,1))},pd=/^(img|br|input|textarea|hr)$/i;function fd(t,e,n,r,o){for(var i;;){if(t==n&&e==r)return!0;if(e==(o<0?0:md(t))){let n=t.parentNode;if(!n||1!=n.nodeType||gd(t)||pd.test(t.nodeName)||"false"==t.contentEditable)return!1;e=ld(t)+(o<0?0:1),t=n}else{if(1!=t.nodeType)return!1;{let n=t.childNodes[e+(o<0?-1:0)];if(1==n.nodeType&&"false"==n.contentEditable){if(!(null===(i=n.pmViewDesc)||void 0===i?void 0:i.ignoreForSelection))return!1;e+=o}else t=n,e=o<0?md(t):0}}}}function md(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function gd(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const yd=function(t){return t.focusNode&&hd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function bd(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}const vd="undefined"!=typeof navigator?navigator:null,wd="undefined"!=typeof document?document:null,kd=vd&&vd.userAgent||"",Sd=/Edge\/(\d+)/.exec(kd),xd=/MSIE \d/.exec(kd),Cd=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(kd),_d=!!(xd||Cd||Sd),Ed=xd?document.documentMode:Cd?+Cd[1]:Sd?+Sd[1]:0,Td=!_d&&/gecko\/(\d+)/i.test(kd);Td&&(/Firefox\/(\d+)/.exec(kd)||[0,0])[1];const Md=!_d&&/Chrome\/(\d+)/.exec(kd),Ad=!!Md,Od=Md?+Md[1]:0,Dd=!_d&&!!vd&&/Apple Computer/.test(vd.vendor),Rd=Dd&&(/Mobile\/\w+/.test(kd)||!!vd&&vd.maxTouchPoints>2),Ld=Rd||!!vd&&/Mac/.test(vd.platform),Nd=!!vd&&/Win/.test(vd.platform),Id=/Android \d/.test(kd),Pd=!!wd&&"webkitFontSmoothing"in wd.documentElement.style,$d=Pd?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Hd(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Bd(t,e){return"number"==typeof t?t:t[e]}function jd(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function Ud(t,e,n){let r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let s=n||t.dom;s;){if(1!=s.nodeType){s=cd(s);continue}let t=s,n=t==i.body,a=n?Hd(i):jd(t),l=0,c=0;if(e.top<a.top+Bd(r,"top")?c=-(a.top-e.top+Bd(o,"top")):e.bottom>a.bottom-Bd(r,"bottom")&&(c=e.bottom-e.top>a.bottom-a.top?e.top+Bd(o,"top")-a.top:e.bottom-a.bottom+Bd(o,"bottom")),e.left<a.left+Bd(r,"left")?l=-(a.left-e.left+Bd(o,"left")):e.right>a.right-Bd(r,"right")&&(l=e.right-a.right+Bd(o,"right")),l||c)if(n)i.defaultView.scrollBy(l,c);else{let n=t.scrollLeft,r=t.scrollTop;c&&(t.scrollTop+=c),l&&(t.scrollLeft+=l);let o=t.scrollLeft-n,i=t.scrollTop-r;e={left:e.left-o,top:e.top-i,right:e.right-o,bottom:e.bottom-i}}let d=n?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(d))break;s="absolute"==d?s.offsetParent:cd(s)}}function Fd(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=cd(r));return e}function Vd(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:o,left:i}=t[n];r.scrollTop!=o+e&&(r.scrollTop=o+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let zd=null;function Wd(t,e){let n,r,o,i,s=2e8,a=0,l=e.top,c=e.top;for(let d=t.firstChild,u=0;d;d=d.nextSibling,u++){let t;if(1==d.nodeType)t=d.getClientRects();else{if(3!=d.nodeType)continue;t=ud(d).getClientRects()}for(let h=0;h<t.length;h++){let p=t[h];if(p.top<=l&&p.bottom>=c){l=Math.max(p.bottom,l),c=Math.min(p.top,c);let t=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(t<s){n=d,s=t,r=t&&3==n.nodeType?{left:p.right<e.left?p.right:p.left,top:e.top}:e,1==d.nodeType&&t&&(a=u+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!o&&p.left<=e.left&&p.right>=e.left&&(o=d,i={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(a=u+1)}}return!n&&o&&(n=o,r=i,s=0),n&&3==n.nodeType?function(t,e){let n=t.nodeValue.length,r=document.createRange();for(let o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);let n=Yd(r,1);if(n.top!=n.bottom&&qd(e,n))return{node:t,offset:o+(e.left>=(n.left+n.right)/2?1:0)}}return{node:t,offset:0}}(n,r):!n||s&&1==n.nodeType?{node:t,offset:a}:Wd(n,r)}function qd(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Kd(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=o;;){let n=t.childNodes[i];if(1==n.nodeType){let t=n.getClientRects();for(let r=0;r<t.length;r++){let o=t[r];if(qd(e,o))return Kd(n,e,o)}}if((i=(i+1)%r)==o)break}return t}function Jd(t,e){let n,r=t.dom.ownerDocument,o=0,i=function(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(md(r.offsetNode),r.offset)}}catch(t){}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(md(r.startContainer),r.startOffset)}}}(r,e.left,e.top);i&&({node:n,offset:o}=i);let s,a=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top);if(!a||!t.dom.contains(1!=a.nodeType?a.parentNode:a)){let n=t.dom.getBoundingClientRect();if(!qd(e,n))return null;if(a=Kd(t.dom,e,n),!a)return null}if(Dd)for(let t=a;n&&t;t=cd(t))t.draggable&&(n=void 0);if(a=function(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(a,e),n){if(Td&&1==n.nodeType&&(o=Math.min(o,n.childNodes.length),o<n.childNodes.length)){let t,r=n.childNodes[o];"IMG"==r.nodeName&&(t=r.getBoundingClientRect()).right<=e.left&&t.bottom>e.top&&o++}let r;Pd&&o&&1==n.nodeType&&1==(r=n.childNodes[o-1]).nodeType&&"false"==r.contentEditable&&r.getBoundingClientRect().top>=e.top&&o--,n==t.dom&&o==n.childNodes.length-1&&1==n.lastChild.nodeType&&e.top>n.lastChild.getBoundingClientRect().bottom?s=t.state.doc.content.size:0!=o&&1==n.nodeType&&"BR"==n.childNodes[o-1].nodeName||(s=function(t,e,n,r){let o=-1;for(let n=e,i=!1;n!=t.dom;){let e,s=t.docView.nearestDesc(n,!0);if(!s)return null;if(1==s.dom.nodeType&&(s.node.isBlock&&s.parent||!s.contentDOM)&&((e=s.dom.getBoundingClientRect()).width||e.height)&&(s.node.isBlock&&s.parent&&(!i&&e.left>r.left||e.top>r.top?o=s.posBefore:(!i&&e.right<r.left||e.bottom<r.top)&&(o=s.posAfter),i=!0),!s.contentDOM&&o<0&&!s.node.isText))return(s.node.isBlock?r.top<(e.top+e.bottom)/2:r.left<(e.left+e.right)/2)?s.posBefore:s.posAfter;n=s.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n,-1)}(t,n,o,e))}null==s&&(s=function(t,e,n){let{node:r,offset:o}=Wd(e,n),i=-1;if(1==r.nodeType&&!r.firstChild){let t=r.getBoundingClientRect();i=t.left!=t.right&&n.left>(t.left+t.right)/2?1:-1}return t.docView.posFromDOM(r,o,i)}(t,a,e));let l=t.docView.nearestDesc(a,!0);return{pos:s,inside:l?l.posAtStart-l.border:-1}}function Gd(t){return t.top<t.bottom||t.left<t.right}function Yd(t,e){let n=t.getClientRects();if(n.length){let t=n[e<0?0:n.length-1];if(Gd(t))return t}return Array.prototype.find.call(n,Gd)||t.getBoundingClientRect()}const Xd=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Qd(t,e,n){let{node:r,offset:o,atom:i}=t.docView.domFromPos(e,n<0?-1:1),s=Pd||Td;if(3==r.nodeType){if(!s||!Xd.test(r.nodeValue)&&(n<0?o:o!=r.nodeValue.length)){let t=o,e=o,i=n<0?1:-1;return n<0&&!o?(e++,i=-1):n>=0&&o==r.nodeValue.length?(t--,i=1):n<0?t--:e++,Zd(Yd(ud(r,t,e),i),i<0)}{let t=Yd(ud(r,o,o),n);if(Td&&o&&/\s/.test(r.nodeValue[o-1])&&o<r.nodeValue.length){let e=Yd(ud(r,o-1,o-1),-1);if(e.top==t.top){let n=Yd(ud(r,o,o+1),-1);if(n.top!=t.top)return Zd(n,n.left<e.left)}}return t}}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(null==i&&o&&(n<0||o==md(r))){let t=r.childNodes[o-1];if(1==t.nodeType)return tu(t.getBoundingClientRect(),!1)}if(null==i&&o<md(r)){let t=r.childNodes[o];if(1==t.nodeType)return tu(t.getBoundingClientRect(),!0)}return tu(r.getBoundingClientRect(),n>=0)}if(null==i&&o&&(n<0||o==md(r))){let t=r.childNodes[o-1],e=3==t.nodeType?ud(t,md(t)-(s?0:1)):1!=t.nodeType||"BR"==t.nodeName&&t.nextSibling?null:t;if(e)return Zd(Yd(e,1),!1)}if(null==i&&o<md(r)){let t=r.childNodes[o];for(;t.pmViewDesc&&t.pmViewDesc.ignoreForCoords;)t=t.nextSibling;let e=t?3==t.nodeType?ud(t,0,s?0:1):1==t.nodeType?t:null:null;if(e)return Zd(Yd(e,-1),!0)}return Zd(Yd(3==r.nodeType?ud(r):r,-n),n>=0)}function Zd(t,e){if(0==t.width)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function tu(t,e){if(0==t.height)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function eu(t,e,n){let r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}const nu=/[\u0590-\u08ac]/;let ru=null,ou=null,iu=!1;class su{constructor(t,e,n,r){this.parent=t,this.children=e,this.dom=n,this.contentDOM=r,this.dirty=0,n.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,n){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,n=this.posAtStart;;e++){let r=this.children[e];if(r==t)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){let n,r;if(t==this.contentDOM)n=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;n=t.previousSibling}for(;n&&(!(r=n.pmViewDesc)||r.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(r)+r.size:this.posAtStart}{let n,r;if(t==this.contentDOM)n=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;n=t.nextSibling}for(;n&&(!(r=n.pmViewDesc)||r.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(r):this.posAtEnd}}let r;if(t==this.dom&&this.contentDOM)r=e>ld(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(let e=t;;e=e.parentNode){if(e==this.dom){r=!1;break}if(e.previousSibling)break}if(null==r&&e==t.childNodes.length)for(let e=t;;e=e.parentNode){if(e==this.dom){r=!0;break}if(e.nextSibling)break}}return(null==r?n>0:r)?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let n=!0,r=t;r;r=r.parentNode){let o,i=this.getDesc(r);if(i&&(!e||i.node)){if(!n||!(o=i.nodeDOM)||(1==o.nodeType?o.contains(1==t.nodeType?t:t.parentNode):o==t))return i;n=!1}}}getDesc(t){let e=t.pmViewDesc;for(let t=e;t;t=t.parent)if(t==this)return e}posFromDOM(t,e,n){for(let r=t;r;r=r.parentNode){let o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}return-1}descAt(t){for(let e=0,n=0;e<this.children.length;e++){let r=this.children[e],o=n+r.size;if(n==t&&o!=n){for(;!r.border&&r.children.length;)for(let t=0;t<r.children.length;t++){let e=r.children[t];if(e.size){r=e;break}}return r}if(t<o)return r.descAt(t-n-r.border);n=o}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let n=0,r=0;for(let e=0;n<this.children.length;n++){let o=this.children[n],i=e+o.size;if(i>t||o instanceof pu){r=t-e;break}e=i}if(r)return this.children[n].domFromPos(r-this.children[n].border,e);for(let t;n&&!(t=this.children[n-1]).size&&t instanceof au&&t.side>=0;n--);if(e<=0){let t,r=!0;for(;t=n?this.children[n-1]:null,t&&t.dom.parentNode!=this.contentDOM;n--,r=!1);return t&&e&&r&&!t.border&&!t.domAtom?t.domFromPos(t.size,e):{node:this.contentDOM,offset:t?ld(t.dom)+1:0}}{let t,r=!0;for(;t=n<this.children.length?this.children[n]:null,t&&t.dom.parentNode!=this.contentDOM;n++,r=!1);return t&&r&&!t.border&&!t.domAtom?t.domFromPos(0,e):{node:this.contentDOM,offset:t?ld(t.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,n=0){if(0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,o=-1;for(let i=n,s=0;;s++){let n=this.children[s],a=i+n.size;if(-1==r&&t<=a){let o=i+n.border;if(t>=o&&e<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(t,e,o);t=i;for(let e=s;e>0;e--){let n=this.children[e-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){r=ld(n.dom)+1;break}t-=n.size}-1==r&&(r=0)}if(r>-1&&(a>e||s==this.children.length-1)){e=a;for(let t=s+1;t<this.children.length;t++){let n=this.children[t];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){o=ld(n.dom);break}e+=n.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=a}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:n}=this.domFromPos(t,0);if(1!=e.nodeType||n==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[n]}setSelection(t,e,n,r=!1){let o=Math.min(t,e),i=Math.max(t,e);for(let s=0,a=0;s<this.children.length;s++){let l=this.children[s],c=a+l.size;if(o>a&&i<c)return l.setSelection(t-a-l.border,e-a-l.border,n,r);a=c}let s=this.domFromPos(t,t?-1:1),a=e==t?s:this.domFromPos(e,e?-1:1),l=n.root.getSelection(),c=n.domSelectionRange(),d=!1;if((Td||Dd)&&t==e){let{node:t,offset:e}=s;if(3==t.nodeType){if(d=!(!e||"\n"!=t.nodeValue[e-1]),d&&e==t.nodeValue.length)for(let e,n=t;n;n=n.parentNode){if(e=n.nextSibling){"BR"==e.nodeName&&(s=a={node:e.parentNode,offset:ld(e)+1});break}let t=n.pmViewDesc;if(t&&t.node&&t.node.isBlock)break}}else{let n=t.childNodes[e-1];d=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(Td&&c.focusNode&&c.focusNode!=a.node&&1==c.focusNode.nodeType){let t=c.focusNode.childNodes[c.focusOffset];t&&"false"==t.contentEditable&&(r=!0)}if(!(r||d&&Dd)&&hd(s.node,s.offset,c.anchorNode,c.anchorOffset)&&hd(a.node,a.offset,c.focusNode,c.focusOffset))return;let u=!1;if((l.extend||t==e)&&!d){l.collapse(s.node,s.offset);try{t!=e&&l.extend(a.node,a.offset),u=!0}catch(t){}}if(!u){if(t>e){let t=s;s=a,a=t}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(s.node,s.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(t){return!this.contentDOM&&"selection"!=t.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let n=0,r=0;r<this.children.length;r++){let o=this.children[r],i=n+o.size;if(n==i?t<=i&&e>=n:t<i&&e>n){let r=n+o.border,s=i-o.border;if(t>=r&&e<=s)return this.dirty=t==n||e==i?2:1,void(t!=r||e!=s||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(t-r,e-r):o.dirty=3);o.dirty=o.dom!=o.contentDOM||o.dom.parentNode!=this.contentDOM||o.children.length?3:2}n=i}this.dirty=2}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let n=1==t?2:1;e.dirty<n&&(e.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}}class au extends su{constructor(t,e,n,r){let o,i=e.type.toDOM;if("function"==typeof i&&(i=i(n,()=>o?o.parent?o.parent.posBeforeChild(o):void 0:r)),!e.type.spec.raw){if(1!=i.nodeType){let t=document.createElement("span");t.appendChild(i),i=t}i.contentEditable="false",i.classList.add("ProseMirror-widget")}super(t,[],i,null),this.widget=e,this.widget=e,o=this}matchesWidget(t){return 0==this.dirty&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return!!e&&e(t)}ignoreMutation(t){return"selection"!=t.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class lu extends su{constructor(t,e,n,r){super(t,[],e,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue}}class cu extends su{constructor(t,e,n,r,o){super(t,[],n,r),this.mark=e,this.spec=o}static create(t,e,n,r){let o=r.nodeViews[e.type.name],i=o&&o(e,r,n);return i&&i.dom||(i=Vl.renderSpec(document,e.type.spec.toDOM(e,n),null,e.attrs)),new cu(t,e,i.dom,i.contentDOM||i.dom,i)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return 3!=this.dirty&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),0!=this.dirty){let t=this.parent;for(;!t.node;)t=t.parent;t.dirty<this.dirty&&(t.dirty=this.dirty),this.dirty=0}}slice(t,e,n){let r=cu.create(this.parent,this.mark,!0,n),o=this.children,i=this.size;e<i&&(o=Eu(o,e,i,n)),t>0&&(o=Eu(o,0,t,n));for(let t=0;t<o.length;t++)o[t].parent=r;return r.children=o,r}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class du extends su{constructor(t,e,n,r,o,i,s,a,l){super(t,[],o,i),this.node=e,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=s}static create(t,e,n,r,o,i){let s,a=o.nodeViews[e.type.name],l=a&&a(e,o,()=>s?s.parent?s.parent.posBeforeChild(s):void 0:i,n,r),c=l&&l.dom,d=l&&l.contentDOM;if(e.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(e.text);else if(!c){let t=Vl.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs);({dom:c,contentDOM:d}=t)}d||e.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),e.type.spec.draggable&&(c.draggable=!0));let u=c;return c=ku(c,n,e),l?s=new fu(t,e,n,r,c,d||null,u,l,o,i+1):e.isText?new hu(t,e,n,r,c,u,o):new du(t,e,n,r,c,d||null,u,o,i+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(t.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let e=this.children.length-1;e>=0;e--){let n=this.children[e];if(this.dom.contains(n.dom.parentNode)){t.contentElement=n.dom.parentNode;break}}t.contentElement||(t.getContent=()=>Fa.empty)}else t.contentElement=this.contentDOM;else t.getContent=()=>this.node.content;return t}matchesNode(t,e,n){return 0==this.dirty&&t.eq(this.node)&&Su(e,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let n=this.node.inlineContent,r=e,o=t.composing?this.localCompositionInfo(t,e):null,i=o&&o.pos>-1?o:null,s=o&&o.pos<0,a=new Cu(this,i&&i.node,t);!function(t,e,n,r){let o=e.locals(t),i=0;if(0==o.length){for(let n=0;n<t.childCount;n++){let s=t.child(n);r(s,o,e.forChild(i,s),n),i+=s.nodeSize}return}let s=0,a=[],l=null;for(let c=0;;){let d,u,h,p;for(;s<o.length&&o[s].to==i;){let t=o[s++];t.widget&&(d?(u||(u=[d])).push(t):d=t)}if(d)if(u){u.sort(_u);for(let t=0;t<u.length;t++)n(u[t],c,!!l)}else n(d,c,!!l);if(l)p=-1,h=l,l=null;else{if(!(c<t.childCount))break;p=c,h=t.child(c++)}for(let t=0;t<a.length;t++)a[t].to<=i&&a.splice(t--,1);for(;s<o.length&&o[s].from<=i&&o[s].to>i;)a.push(o[s++]);let f=i+h.nodeSize;if(h.isText){let t=f;s<o.length&&o[s].from<t&&(t=o[s].from);for(let e=0;e<a.length;e++)a[e].to<t&&(t=a[e].to);t<f&&(l=h.cut(t-i),h=h.cut(0,t-i),f=t,p=-1)}else for(;s<o.length&&o[s].to<f;)s++;r(h,h.isInline&&!h.isLeaf?a.filter(t=>!t.inline):a.slice(),e.forChild(i,h),p),i=f}}(this.node,this.innerDeco,(e,o,i)=>{e.spec.marks?a.syncToMarks(e.spec.marks,n,t):e.type.side>=0&&!i&&a.syncToMarks(o==this.node.childCount?qa.none:this.node.child(o).marks,n,t),a.placeWidget(e,t,r)},(e,i,l,c)=>{let d;a.syncToMarks(e.marks,n,t),a.findNodeMatch(e,i,l,c)||s&&t.state.selection.from>r&&t.state.selection.to<r+e.nodeSize&&(d=a.findIndexWithChild(o.node))>-1&&a.updateNodeAt(e,i,l,d,t)||a.updateNextNode(e,i,l,t,c,r)||a.addNode(e,i,l,t,r),r+=e.nodeSize}),a.syncToMarks([],n,t),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(i&&this.protectLocalComposition(t,i),mu(this.contentDOM,this.children,t),Rd&&function(t){if("UL"==t.nodeName||"OL"==t.nodeName){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}(this.dom))}localCompositionInfo(t,e){let{from:n,to:r}=t.state.selection;if(!(t.state.selection instanceof Vc)||n<e||r>e+this.node.content.size)return null;let o=t.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let t=o.nodeValue,i=function(t,e,n,r){for(let o=0,i=0;o<t.childCount&&i<=r;){let s=t.child(o++),a=i;if(i+=s.nodeSize,!s.isText)continue;let l=s.text;for(;o<t.childCount;){let e=t.child(o++);if(i+=e.nodeSize,!e.isText)break;l+=e.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let t=a<r?l.lastIndexOf(e,r-a-1):-1;if(t>=0&&t+e.length+a>=n)return a+t;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}(this.node.content,t,n-e,r-e);return i<0?null:{node:o,pos:i,text:t}}return{node:o,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:n,text:r}){if(this.getDesc(e))return;let o=e;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let i=new lu(this,o,e,r);t.input.compositionNodes.push(i),this.children=Eu(this.children,n,n+r.length,t,i)}update(t,e,n,r){return!(3==this.dirty||!t.sameMarkup(this.node)||(this.updateInner(t,e,n,r),0))}updateInner(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=0}updateOuterDeco(t){if(Su(t,this.outerDeco))return;let e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=vu(this.dom,this.nodeDOM,bu(this.outerDeco,this.node,e),bu(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function uu(t,e,n,r,o){ku(r,e,t);let i=new du(void 0,t,e,n,r,r,r,o,0);return i.contentDOM&&i.updateChildren(o,0),i}class hu extends du{constructor(t,e,n,r,o,i,s){super(t,e,n,r,o,null,i,s,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,n,r){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!t.sameMarkup(this.node)||(this.updateOuterDeco(e),0==this.dirty&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=0,0))}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,n){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,n)}ignoreMutation(t){return"characterData"!=t.type&&"selection"!=t.type}slice(t,e,n){let r=this.node.cut(t,e),o=document.createTextNode(r.text);return new hu(this.parent,r,this.outerDeco,this.innerDeco,o,o,n)}markDirty(t,e){super.markDirty(t,e),this.dom==this.nodeDOM||0!=t&&e!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(t){return this.node.text==t}}class pu extends su{parseRule(){return{ignore:!0}}matchesHack(t){return 0==this.dirty&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class fu extends du{constructor(t,e,n,r,o,i,s,a,l,c){super(t,e,n,r,o,i,s,l,c),this.spec=a}update(t,e,n,r){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let o=this.spec.update(t,e,n);return o&&this.updateInner(t,e,n,r),o}return!(!this.contentDOM&&!t.isLeaf)&&super.update(t,e,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,n,r){this.spec.setSelection?this.spec.setSelection(t,e,n.root):super.setSelection(t,e,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function mu(t,e,n){let r=t.firstChild,o=!1;for(let i=0;i<e.length;i++){let s=e[i],a=s.dom;if(a.parentNode==t){for(;a!=r;)r=xu(r),o=!0;r=r.nextSibling}else o=!0,t.insertBefore(a,r);if(s instanceof cu){let e=r?r.previousSibling:t.lastChild;mu(s.contentDOM,s.children,n),r=e?e.nextSibling:t.firstChild}}for(;r;)r=xu(r),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}const gu=function(t){t&&(this.nodeName=t)};gu.prototype=Object.create(null);const yu=[new gu];function bu(t,e,n){if(0==t.length)return yu;let r=n?yu[0]:new gu,o=[r];for(let i=0;i<t.length;i++){let s=t[i].type.attrs;if(s){s.nodeName&&o.push(r=new gu(s.nodeName));for(let t in s){let i=s[t];null!=i&&(n&&1==o.length&&o.push(r=new gu(e.isInline?"span":"div")),"class"==t?r.class=(r.class?r.class+" ":"")+i:"style"==t?r.style=(r.style?r.style+";":"")+i:"nodeName"!=t&&(r[t]=i))}}}return o}function vu(t,e,n,r){if(n==yu&&r==yu)return e;let o=e;for(let e=0;e<r.length;e++){let i=r[e],s=n[e];if(e){let e;s&&s.nodeName==i.nodeName&&o!=t&&(e=o.parentNode)&&e.nodeName.toLowerCase()==i.nodeName||(e=document.createElement(i.nodeName),e.pmIsDeco=!0,e.appendChild(o),s=yu[0]),o=e}wu(o,s||yu[0],i)}return o}function wu(t,e,n){for(let r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(let r in n)"class"!=r&&"style"!=r&&"nodeName"!=r&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],o=n.class?n.class.split(" ").filter(Boolean):[];for(let e=0;e<r.length;e++)-1==o.indexOf(r[e])&&t.classList.remove(r[e]);for(let e=0;e<o.length;e++)-1==r.indexOf(o[e])&&t.classList.add(o[e]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let n,r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=r.exec(e.style);)t.style.removeProperty(n[1])}n.style&&(t.style.cssText+=n.style)}}function ku(t,e,n){return vu(t,t,yu,bu(e,n,1!=t.nodeType))}function Su(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function xu(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Cu{constructor(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=function(t,e){let n=e,r=n.children.length,o=t.childCount,i=new Map,s=[];t:for(;o>0;){let a;for(;;)if(r){let t=n.children[r-1];if(!(t instanceof cu)){a=t,r--;break}n=t,r=t.children.length}else{if(n==e)break t;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,n){let r=0,o=this.stack.length>>1,i=Math.min(o,t.length);for(;r<i&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&!1!==t[r].type.spec.spanning;)r++;for(;r<o;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<t.length;){this.stack.push(this.top,this.index+1);let r=-1;for(let e=this.index;e<Math.min(this.index+3,this.top.children.length);e++){let n=this.top.children[e];if(n.matchesMark(t[o])&&!this.isLocked(n.dom)){r=e;break}}if(r>-1)r>this.index&&(this.changed=!0,this.destroyBetween(this.index,r)),this.top=this.top.children[this.index];else{let r=cu.create(this.top,t[o],e,n);this.top.children.splice(this.index,0,r),this.top=r,this.changed=!0}this.index=0,o++}}findNodeMatch(t,e,n,r){let o,i=-1;if(r>=this.preMatch.index&&(o=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&o.matchesNode(t,e,n))i=this.top.children.indexOf(o,this.index);else for(let r=this.index,o=Math.min(this.top.children.length,r+5);r<o;r++){let o=this.top.children[r];if(o.matchesNode(t,e,n)&&!this.preMatch.matched.has(o)){i=r;break}}return!(i<0||(this.destroyBetween(this.index,i),this.index++,0))}updateNodeAt(t,e,n,r,o){let i=this.top.children[r];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(t,e,n,o)&&(this.destroyBetween(this.index,r),this.index++,!0)}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let e=t.pmViewDesc;if(e)for(let t=this.index;t<this.top.children.length;t++)if(this.top.children[t]==e)return t;return-1}t=e}}updateNextNode(t,e,n,r,o,i){for(let s=this.index;s<this.top.children.length;s++){let a=this.top.children[s];if(a instanceof du){let l=this.preMatch.matched.get(a);if(null!=l&&l!=o)return!1;let c,d=a.dom,u=this.isLocked(d)&&!(t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&3!=a.dirty&&Su(e,a.outerDeco));if(!u&&a.update(t,e,n,r))return this.destroyBetween(this.index,s),a.dom!=d&&(this.changed=!0),this.index++,!0;if(!u&&(c=this.recreateWrapper(a,t,e,n,r,i)))return this.destroyBetween(this.index,s),this.top.children[this.index]=c,c.contentDOM&&(c.dirty=2,c.updateChildren(r,i+1),c.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,n,r,o,i){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!Su(n,t.outerDeco)||!r.eq(t.innerDeco))return null;let s=du.create(this.top,e,n,r,o,i);if(s.contentDOM){s.children=t.children,t.children=[];for(let t of s.children)t.parent=s}return t.destroy(),s}addNode(t,e,n,r,o){let i=du.create(this.top,t,e,n,r,o);i.contentDOM&&i.updateChildren(r,o+1),this.top.children.splice(this.index++,0,i),this.changed=!0}placeWidget(t,e,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){let r=new au(this.top,t,e,n);this.top.children.splice(this.index++,0,r),this.changed=!0}else this.index++}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof cu;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof hu)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((Dd||Ad)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let n=document.createElement(t);"IMG"==t&&(n.className="ProseMirror-separator",n.alt=""),"BR"==t&&(n.className="ProseMirror-trailingBreak");let r=new pu(this.top,[],n,null);e!=this.top?e.children.push(r):e.children.splice(this.index++,0,r),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||1==t.nodeType&&t.contains(this.lock.parentNode))}}function _u(t,e){return t.type.side-e.type.side}function Eu(t,e,n,r,o){let i=[];for(let s=0,a=0;s<t.length;s++){let l=t[s],c=a,d=a+=l.size;c>=n||d<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,r)),o&&(i.push(o),o=void 0),d>n&&i.push(l.slice(n-c,l.size,r)))}return i}function Tu(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let o=t.docView.nearestDesc(n.focusNode),i=o&&0==o.size,s=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;let a,l,c=r.resolve(s);if(yd(n)){for(a=s;o&&!o.node;)o=o.parent;let t=o.node;if(o&&t.isAtom&&Wc.isSelectable(t)&&o.parent&&(!t.isInline||!function(t,e,n){for(let r=0==e,o=e==md(t);r||o;){if(t==n)return!0;let e=ld(t);if(!(t=t.parentNode))return!1;r=r&&0==e,o=o&&e==md(t)}}(n.focusNode,n.focusOffset,o.dom))){let t=o.posBefore;l=new Wc(s==t?c:r.resolve(t))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let e=s,o=s;for(let r=0;r<n.rangeCount;r++){let i=n.getRangeAt(r);e=Math.min(e,t.docView.posFromDOM(i.startContainer,i.startOffset,1)),o=Math.max(o,t.docView.posFromDOM(i.endContainer,i.endOffset,-1))}if(e<0)return null;[a,s]=o==t.state.selection.anchor?[o,e]:[e,o],c=r.resolve(s)}else a=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(a<0)return null}let d=r.resolve(a);return l||(l=Pu(t,d,c,"pointer"==e||t.state.selection.head<c.pos&&!i?1:-1)),l}function Mu(t){return t.editable?t.hasFocus():Hu(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Au(t,e=!1){let n=t.state.selection;if(Nu(t,n),Mu(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Ad){let e=t.domSelectionRange(),n=t.domObserver.currentSelection;if(e.anchorNode&&n.anchorNode&&hd(e.anchorNode,e.anchorOffset,n.anchorNode,n.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function(t){let e=t.domSelection(),n=document.createRange();if(!e)return;let r=t.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setStart(r.parentNode,ld(r)+1):n.setStart(r,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!o&&!t.state.selection.visible&&_d&&Ed<=11&&(r.disabled=!0,r.disabled=!1)}(t);else{let r,o,{anchor:i,head:s}=n;!Ou||n instanceof Vc||(n.$from.parent.inlineContent||(r=Du(t,n.from)),n.empty||n.$from.parent.inlineContent||(o=Du(t,n.to))),t.docView.setSelection(i,s,t,e),Ou&&(r&&Lu(r),o&&Lu(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{n.anchorNode==r&&n.anchorOffset==o||(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{Mu(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")},20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Ou=Dd||Ad&&Od<63;function Du(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),o=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(Dd&&o&&"false"==o.contentEditable)return Ru(o);if(!(o&&"false"!=o.contentEditable||i&&"false"!=i.contentEditable)){if(o)return Ru(o);if(i)return Ru(i)}}function Ru(t){return t.contentEditable="true",Dd&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Lu(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Nu(t,e){if(e instanceof Wc){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Iu(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Iu(t)}function Iu(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Pu(t,e,n,r){return t.someProp("createSelectionBetween",r=>r(t,e,n))||Vc.between(e,n,r)}function $u(t){return!(t.editable&&!t.hasFocus())&&Hu(t)}function Hu(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(t){return!1}}function Bu(t,e){let{$anchor:n,$head:r}=t.selection,o=e>0?n.max(r):n.min(r),i=o.parent.inlineContent?o.depth?t.doc.resolve(e>0?o.after():o.before()):null:o;return i&&Bc.findFrom(i,e)}function ju(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Uu(t,e,n){let r=t.state.selection;if(!(r instanceof Vc)){if(r instanceof Wc&&r.node.isInline)return ju(t,new Vc(e>0?r.$to:r.$from));{let n=Bu(t.state,e);return!!n&&ju(t,n)}}if(n.indexOf("s")>-1){let{$head:n}=r,o=n.textOffset?null:e<0?n.nodeBefore:n.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let i=t.state.doc.resolve(n.pos+o.nodeSize*(e<0?-1:1));return ju(t,new Vc(r.$anchor,i))}if(!r.empty)return!1;if(t.endOfTextblock(e>0?"forward":"backward")){let n=Bu(t.state,e);return!!(n&&n instanceof Wc)&&ju(t,n)}if(!(Ld&&n.indexOf("m")>-1)){let n,o=r.$head,i=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter;if(!i||i.isText)return!1;let s=e<0?o.pos-i.nodeSize:o.pos;return!!(i.isAtom||(n=t.docView.descAt(s))&&!n.contentDOM)&&(Wc.isSelectable(i)?ju(t,new Wc(e<0?t.state.doc.resolve(o.pos-i.nodeSize):o)):!!Pd&&ju(t,new Vc(t.state.doc.resolve(e<0?s:s+i.nodeSize))))}}function Fu(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function Vu(t,e){let n=t.pmViewDesc;return n&&0==n.size&&(e<0||t.nextSibling||"BR"!=t.nodeName)}function zu(t,e){return e<0?function(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o,i,s=!1;for(Td&&1==n.nodeType&&r<Fu(n)&&Vu(n.childNodes[r],-1)&&(s=!0);;)if(r>0){if(1!=n.nodeType)break;{let t=n.childNodes[r-1];if(Vu(t,-1))o=n,i=--r;else{if(3!=t.nodeType)break;n=t,r=n.nodeValue.length}}}else{if(Wu(n))break;{let e=n.previousSibling;for(;e&&Vu(e,-1);)o=n.parentNode,i=ld(e),e=e.previousSibling;if(e)n=e,r=Fu(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}s?qu(t,n,r):o&&qu(t,o,i)}(t):function(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let o,i,s=Fu(n);for(;;)if(r<s){if(1!=n.nodeType)break;if(!Vu(n.childNodes[r],1))break;o=n,i=++r}else{if(Wu(n))break;{let e=n.nextSibling;for(;e&&Vu(e,1);)o=e.parentNode,i=ld(e)+1,e=e.nextSibling;if(e)n=e,r=0,s=Fu(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}o&&qu(t,o,i)}(t)}function Wu(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function qu(t,e,n){if(3!=e.nodeType){let t,r;(r=function(t,e){for(;t&&e==t.childNodes.length&&!gd(t);)e=ld(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=n,e=0}}(e,n))?(e=r,n=0):(t=function(t,e){for(;t&&!e&&!gd(t);)e=ld(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=(t=n).childNodes.length}}(e,n))&&(e=t,n=t.nodeValue.length)}let r=t.domSelection();if(!r)return;if(yd(r)){let t=document.createRange();t.setEnd(e,n),t.setStart(e,n),r.removeAllRanges(),r.addRange(t)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:o}=t;setTimeout(()=>{t.state==o&&Au(t)},50)}function Ku(t,e){let n=t.state.doc.resolve(e);if(!Ad&&!Nd&&n.parent.inlineContent){let r=t.coordsAtPos(e);if(e>n.start()){let n=t.coordsAtPos(e-1),o=(n.top+n.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(n.left-r.left)>1)return n.left<r.left?"ltr":"rtl"}if(e<n.end()){let n=t.coordsAtPos(e+1),o=(n.top+n.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(n.left-r.left)>1)return n.left>r.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(t.dom).direction?"rtl":"ltr"}function Ju(t,e,n){let r=t.state.selection;if(r instanceof Vc&&!r.empty||n.indexOf("s")>-1)return!1;if(Ld&&n.indexOf("m")>-1)return!1;let{$from:o,$to:i}=r;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let n=Bu(t.state,e);if(n&&n instanceof Wc)return ju(t,n)}if(!o.parent.inlineContent){let n=e<0?o:i,s=r instanceof Kc?Bc.near(n,e):Bc.findFrom(n,e);return!!s&&ju(t,s)}return!1}function Gu(t,e){if(!(t.state.selection instanceof Vc))return!0;let{$head:n,$anchor:r,empty:o}=t.state.selection;if(!n.sameParent(r))return!0;if(!o)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let r=t.state.tr;return e<0?r.delete(n.pos-i.nodeSize,n.pos):r.delete(n.pos,n.pos+i.nodeSize),t.dispatch(r),!0}return!1}function Yu(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Xu(t,e){t.someProp("transformCopied",n=>{e=n(e,t)});let n=[],{content:r,openStart:o,openEnd:i}=e;for(;o>1&&i>1&&1==r.childCount&&1==r.firstChild.childCount;){o--,i--;let t=r.firstChild;n.push(t.type.name,t.attrs!=t.type.defaultAttrs?t.attrs:null),r=t.content}let s=t.someProp("clipboardSerializer")||Vl.fromSchema(t.state.schema),a=ah(),l=a.createElement("div");l.appendChild(s.serializeFragment(r,{document:a}));let c,d=l.firstChild,u=0;for(;d&&1==d.nodeType&&(c=ih[d.nodeName.toLowerCase()]);){for(let t=c.length-1;t>=0;t--){let e=a.createElement(c[t]);for(;l.firstChild;)e.appendChild(l.firstChild);l.appendChild(e),u++}d=l.firstChild}return d&&1==d.nodeType&&d.setAttribute("data-pm-slice",`${o} ${i}${u?` -${u}`:""} ${JSON.stringify(n)}`),{dom:l,text:t.someProp("clipboardTextSerializer",n=>n(e,t))||e.content.textBetween(0,e.content.size,"\n\n"),slice:e}}function Qu(t,e,n,r,o){let i,s,a=o.parent.type.spec.code;if(!n&&!e)return null;let l=e&&(r||a||!n);if(l){if(t.someProp("transformPastedText",n=>{e=n(e,a||r,t)}),a)return e?new Ja(Fa.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):Ja.empty;let n=t.someProp("clipboardTextParser",n=>n(e,o,r,t));if(n)s=n;else{let n=o.marks(),{schema:r}=t.state,s=Vl.fromSchema(r);i=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(t=>{let e=i.appendChild(document.createElement("p"));t&&e.appendChild(s.serializeNode(r.text(t,n)))})}}else t.someProp("transformPastedHTML",e=>{n=e(n,t)}),i=function(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n,r=ah().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(t);if((n=o&&ih[o[1].toLowerCase()])&&(t=n.map(t=>"<"+t+">").join("")+t+n.map(t=>"</"+t+">").reverse().join("")),r.innerHTML=function(t){let e=window.trustedTypes;return e?(lh||(lh=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),lh.createHTML(t)):t}(t),n)for(let t=0;t<n.length;t++)r=r.querySelector(n[t])||r;return r}(n),Pd&&function(t){let e=t.querySelectorAll(Ad?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];1==r.childNodes.length&&""==r.textContent&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}(i);let c=i&&i.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let t=+d[3];t>0;t--){let t=i.firstChild;for(;t&&1!=t.nodeType;)t=t.nextSibling;if(!t)break;i=t}if(!s){let e=t.someProp("clipboardParser")||t.someProp("domParser")||Ll.fromSchema(t.state.schema);s=e.parseSlice(i,{preserveWhitespace:!(!l&&!d),context:o,ruleFromNode:t=>"BR"!=t.nodeName||t.nextSibling||!t.parentNode||Zu.test(t.parentNode.nodeName)?null:{ignore:!0}})}if(d)s=function(t,e){if(!t.size)return t;let n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(e){return t}let{content:o,openStart:i,openEnd:s}=t;for(let t=n.length-2;t>=0;t-=2){let e=r.nodes[n[t]];if(!e||e.hasRequiredAttrs())break;o=Fa.from(e.create(n[t+1],o)),i++,s++}return new Ja(o,i,s)}(oh(s,+d[1],+d[2]),d[4]);else if(s=Ja.maxOpen(function(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let r,o=e.node(n).contentMatchAt(e.index(n)),i=[];if(t.forEach(t=>{if(!i)return;let e,n=o.findWrapping(t.type);if(!n)return i=null;if(e=i.length&&r.length&&eh(n,r,t,i[i.length-1],0))i[i.length-1]=e;else{i.length&&(i[i.length-1]=nh(i[i.length-1],r.length));let e=th(t,n);i.push(e),o=o.matchType(e.type),r=n}}),i)return Fa.from(i)}return t}(s.content,o),!0),s.openStart||s.openEnd){let t=0,e=0;for(let e=s.content.firstChild;t<s.openStart&&!e.type.spec.isolating;t++,e=e.firstChild);for(let t=s.content.lastChild;e<s.openEnd&&!t.type.spec.isolating;e++,t=t.lastChild);s=oh(s,t,e)}return t.someProp("transformPasted",e=>{s=e(s,t)}),s}const Zu=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function th(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Fa.from(t));return t}function eh(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){let i=eh(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(Fa.from(th(n,t,o+1))))}}function nh(t,e){if(0==e)return t;let n=t.content.replaceChild(t.childCount-1,nh(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Fa.empty,!0);return t.copy(n.append(r))}function rh(t,e,n,r,o,i){let s=e<0?t.firstChild:t.lastChild,a=s.content;return t.childCount>1&&(i=0),o<r-1&&(a=rh(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(Fa.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function oh(t,e,n){return e<t.openStart&&(t=new Ja(rh(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Ja(rh(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const ih={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let sh=null;function ah(){return sh||(sh=document.implementation.createHTMLDocument("title"))}let lh=null;const ch={},dh={},uh={touchstart:!0,touchmove:!0};class hh{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function ph(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function fh(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=e=>mh(t,e))})}function mh(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)})}function gh(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function yh(t){return{left:t.clientX,top:t.clientY}}function bh(t,e,n,r,o){if(-1==r)return!1;let i=t.state.doc.resolve(r);for(let r=i.depth+1;r>0;r--)if(t.someProp(e,e=>r>i.depth?e(t,n,i.nodeAfter,i.before(r),o,!0):e(t,n,i.node(r),i.before(r),o,!1)))return!0;return!1}function vh(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function wh(t,e,n,r){return bh(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",n=>n(t,e,r))}function kh(t,e,n,r){return bh(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",n=>n(t,e,r))||function(t,e,n){if(0!=n.button)return!1;let r=t.state.doc;if(-1==e)return!!r.inlineContent&&(vh(t,Vc.create(r,0,r.content.size),"pointer"),!0);let o=r.resolve(e);for(let e=o.depth+1;e>0;e--){let n=e>o.depth?o.nodeAfter:o.node(e),i=o.before(e);if(n.inlineContent)vh(t,Vc.create(r,i+1,i+1+n.content.size),"pointer");else{if(!Wc.isSelectable(n))continue;vh(t,Wc.create(r,i),"pointer")}return!0}}(t,n,r)}function Sh(t){return Ah(t)}dh.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!_h(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!Id||!Ad||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!Rd||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",e=>e(t,n))||function(t,e){let n=e.keyCode,r=function(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);if(8==n||Ld&&72==n&&"c"==r)return Gu(t,-1)||zu(t,-1);if(46==n&&!e.shiftKey||Ld&&68==n&&"c"==r)return Gu(t,1)||zu(t,1);if(13==n||27==n)return!0;if(37==n||Ld&&66==n&&"c"==r){let e=37==n?"ltr"==Ku(t,t.state.selection.from)?-1:1:-1;return Uu(t,e,r)||zu(t,e)}if(39==n||Ld&&70==n&&"c"==r){let e=39==n?"ltr"==Ku(t,t.state.selection.from)?1:-1:1;return Uu(t,e,r)||zu(t,e)}return 38==n||Ld&&80==n&&"c"==r?Ju(t,-1,r)||zu(t,-1):40==n||Ld&&78==n&&"c"==r?function(t){if(!Dd||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&1==e.nodeType&&0==n&&e.firstChild&&"false"==e.firstChild.contentEditable){let n=e.firstChild;Yu(t,n,"true"),setTimeout(()=>Yu(t,n,"false"),20)}return!1}(t)||Ju(t,1,r)||zu(t,1):r==(Ld?"m":"c")&&(66==n||73==n||89==n||90==n)}(t,n)?n.preventDefault():ph(t,"key");else{let e=Date.now();t.input.lastIOSEnter=e,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==e&&(t.someProp("handleKeyDown",e=>e(t,bd(13,"Enter"))),t.input.lastIOSEnter=0)},200)}},dh.keyup=(t,e)=>{16==e.keyCode&&(t.input.shiftKey=!1)},dh.keypress=(t,e)=>{let n=e;if(_h(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ld&&n.metaKey)return;if(t.someProp("handleKeyPress",e=>e(t,n)))return void n.preventDefault();let r=t.state.selection;if(!(r instanceof Vc&&r.$from.sameParent(r.$to))){let e=String.fromCharCode(n.charCode),o=()=>t.state.tr.insertText(e).scrollIntoView();/[\r\n]/.test(e)||t.someProp("handleTextInput",n=>n(t,r.$from.pos,r.$to.pos,e,o))||t.dispatch(o()),n.preventDefault()}};const xh=Ld?"metaKey":"ctrlKey";ch.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Sh(t),o=Date.now(),i="singleClick";o-t.input.lastClick.time<500&&function(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}(n,t.input.lastClick)&&!n[xh]&&t.input.lastClick.button==n.button&&("singleClick"==t.input.lastClick.type?i="doubleClick":"doubleClick"==t.input.lastClick.type&&(i="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:i,button:n.button};let s=t.posAtCoords(yh(n));s&&("singleClick"==i?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new Ch(t,s,n,!!r)):("doubleClick"==i?wh:kh)(t,s.pos,s.inside,n)?n.preventDefault():ph(t,"pointer"))};class Ch{constructor(t,e,n,r){let o,i;if(this.view=t,this.pos=e,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[xh],this.allowDefault=n.shiftKey,e.inside>-1)o=t.state.doc.nodeAt(e.inside),i=e.inside;else{let n=t.state.doc.resolve(e.pos);o=n.parent,i=n.depth?n.before():0}const s=r?null:n.target,a=s?t.docView.nearestDesc(s,!0):null;this.target=a&&1==a.dom.nodeType?a.dom:null;let{selection:l}=t.state;(0==n.button&&o.type.spec.draggable&&!1!==o.type.spec.selectable||l instanceof Wc&&l.from<=i&&l.to>i)&&(this.mightDrag={node:o,pos:i,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!Td||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),ph(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Au(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(yh(t))),this.updateAllowDefault(t),this.allowDefault||!e?ph(this.view,"pointer"):function(t,e,n,r,o){return bh(t,"handleClickOn",e,n,r)||t.someProp("handleClick",n=>n(t,e,r))||(o?function(t,e){if(-1==e)return!1;let n,r,o=t.state.selection;o instanceof Wc&&(n=o.node);let i=t.state.doc.resolve(e);for(let t=i.depth+1;t>0;t--){let e=t>i.depth?i.nodeAfter:i.node(t);if(Wc.isSelectable(e)){r=n&&o.$from.depth>0&&t>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(t);break}}return null!=r&&(vh(t,Wc.create(t.state.doc,r),"pointer"),!0)}(t,n):function(t,e){if(-1==e)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&Wc.isSelectable(r))&&(vh(t,new Wc(n),"pointer"),!0)}(t,n))}(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||Dd&&this.mightDrag&&!this.mightDrag.node.isAtom||Ad&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(vh(this.view,Bc.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):ph(this.view,"pointer")}move(t){this.updateAllowDefault(t),ph(this.view,"pointer"),0==t.buttons&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}function _h(t,e){return!!t.composing||!!(Dd&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}ch.touchstart=t=>{t.input.lastTouch=Date.now(),Sh(t),ph(t,"pointer")},ch.touchmove=t=>{t.input.lastTouch=Date.now(),ph(t,"pointer")},ch.contextmenu=t=>Sh(t);const Eh=Id?5e3:-1;function Th(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Ah(t),e))}function Mh(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=function(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function Ah(t,e=!1){if(!(Id&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Mh(t),e||t.docView&&t.docView.dirty){let n=Tu(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):!t.markCursor&&!e||r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.updateState(t.state):t.dispatch(t.state.tr.deleteSelection()),!0}return!1}}dh.compositionstart=dh.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof Vc&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(t=>!1===t.type.spec.inclusive)))t.markCursor=t.state.storedMarks||n.marks(),Ah(t,!0),t.markCursor=null;else if(Ah(t,!e.selection.empty),Td&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let e=t.domSelectionRange();for(let n=e.focusNode,r=e.focusOffset;n&&1==n.nodeType&&0!=r;){let e=r<0?n.lastChild:n.childNodes[r-1];if(!e)break;if(3==e.nodeType){let n=t.domSelection();n&&n.collapse(e,e.nodeValue.length);break}n=e,r=-1}}t.input.composing=!0}Th(t,Eh)},dh.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,Th(t,20))};const Oh=_d&&Ed<15||Rd&&$d<604;function Dh(t,e,n,r,o){let i=Qu(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",e=>e(t,o,i||Ja.empty)))return!0;if(!i)return!1;let s=function(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(i),a=s?t.state.tr.replaceSelectionWith(s,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Rh(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}ch.copy=dh.cut=(t,e)=>{let n=e,r=t.state.selection,o="cut"==n.type;if(r.empty)return;let i=Oh?null:n.clipboardData,s=r.content(),{dom:a,text:l}=Xu(t,s);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):function(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}(t,a),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},dh.paste=(t,e)=>{let n=e;if(t.composing&&!Id)return;let r=Oh?null:n.clipboardData,o=t.input.shiftKey&&45!=t.input.lastKeyCode;r&&Dh(t,Rh(r),r.getData("text/html"),o,n)?n.preventDefault():function(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let o=t.input.shiftKey&&45!=t.input.lastKeyCode;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Dh(t,r.value,null,o,e):Dh(t,r.textContent,r.innerHTML,o,e)},50)}(t,n)};class Lh{constructor(t,e,n){this.slice=t,this.move=e,this.node=n}}const Nh=Ld?"altKey":"ctrlKey";function Ih(t,e){let n=t.someProp("dragCopies",t=>!t(e));return null!=n?n:!e[Nh]}ch.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let o,i=t.state.selection,s=i.empty?null:t.posAtCoords(yh(n));if(s&&s.pos>=i.from&&s.pos<=(i instanceof Wc?i.to-1:i.to));else if(r&&r.mightDrag)o=Wc.create(t.state.doc,r.mightDrag.pos);else if(n.target&&1==n.target.nodeType){let e=t.docView.nearestDesc(n.target,!0);e&&e.node.type.spec.draggable&&e!=t.docView&&(o=Wc.create(t.state.doc,e.posBefore))}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:d}=Xu(t,a);(!n.dataTransfer.files.length||!Ad||Od>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Oh?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Oh||n.dataTransfer.setData("text/plain",c),t.dragging=new Lh(d,Ih(t,n),o)},ch.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)},dh.dragover=dh.dragenter=(t,e)=>e.preventDefault(),dh.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let o=t.posAtCoords(yh(n));if(!o)return;let i=t.state.doc.resolve(o.pos),s=r&&r.slice;s?t.someProp("transformPasted",e=>{s=e(s,t)}):s=Qu(t,Rh(n.dataTransfer),Oh?null:n.dataTransfer.getData("text/html"),!1,i);let a=!(!r||!Ih(t,n));if(t.someProp("handleDrop",e=>e(t,n,s||Ja.empty,a)))return void n.preventDefault();if(!s)return;n.preventDefault();let l=s?Sc(t.state.doc,i.pos,s):i.pos;null==l&&(l=i.pos);let c=t.state.tr;if(a){let{node:t}=r;t?t.replace(c):c.deleteSelection()}let d=c.mapping.map(l),u=0==s.openStart&&0==s.openEnd&&1==s.content.childCount,h=c.doc;if(u?c.replaceRangeWith(d,d,s.content.firstChild):c.replaceRange(d,d,s),c.doc.eq(h))return;let p=c.doc.resolve(d);if(u&&Wc.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new Wc(p));else{let e=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((t,n,r,o)=>e=o),c.setSelection(Pu(t,p,c.doc.resolve(e)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))},ch.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Au(t)},20))},ch.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},ch.beforeinput=(t,e)=>{if(Ad&&Id&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();let{domChangeCount:e}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=e)return;if(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",e=>e(t,bd(8,"Backspace"))))return;let{$cursor:n}=t.state.selection;n&&n.pos>0&&t.dispatch(t.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}};for(let t in dh)ch[t]=dh[t];function Ph(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class $h{constructor(t,e){this.toDOM=t,this.spec=e||Fh,this.side=this.spec.side||0}map(t,e,n,r){let{pos:o,deleted:i}=t.mapResult(e.from+r,this.side<0?-1:1);return i?null:new jh(o-n,o-n,this)}valid(){return!0}eq(t){return this==t||t instanceof $h&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Ph(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class Hh{constructor(t,e){this.attrs=t,this.spec=e||Fh}map(t,e,n,r){let o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new jh(o,i,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof Hh&&Ph(this.attrs,t.attrs)&&Ph(this.spec,t.spec)}static is(t){return t.type instanceof Hh}destroy(){}}class Bh{constructor(t,e){this.attrs=t,this.spec=e||Fh}map(t,e,n,r){let o=t.mapResult(e.from+r,1);if(o.deleted)return null;let i=t.mapResult(e.to+r,-1);return i.deleted||i.pos<=o.pos?null:new jh(o.pos-n,i.pos-n,this)}valid(t,e){let n,{index:r,offset:o}=t.content.findIndex(e.from);return o==e.from&&!(n=t.child(r)).isText&&o+n.nodeSize==e.to}eq(t){return this==t||t instanceof Bh&&Ph(this.attrs,t.attrs)&&Ph(this.spec,t.spec)}destroy(){}}class jh{constructor(t,e,n){this.from=t,this.to=e,this.type=n}copy(t,e){return new jh(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,n){return this.type.map(t,this,e,n)}static widget(t,e,n){return new jh(t,t,new $h(e,n))}static inline(t,e,n,r){return new jh(t,e,new Hh(n,r))}static node(t,e,n,r){return new jh(t,e,new Bh(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof Hh}get widget(){return this.type instanceof $h}}const Uh=[],Fh={};class Vh{constructor(t,e){this.local=t.length?t:Uh,this.children=e.length?e:Uh}static create(t,e){return e.length?Gh(e,t,0,Fh):zh}find(t,e,n){let r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r}findInner(t,e,n,r,o){for(let i=0;i<this.local.length;i++){let s=this.local[i];s.from<=e&&s.to>=t&&(!o||o(s.spec))&&n.push(s.copy(s.from+r,s.to+r))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<e&&this.children[i+1]>t){let s=this.children[i]+1;this.children[i+2].findInner(t-s,e-s,n,r+s,o)}}map(t,e,n){return this==zh||0==t.maps.length?this:this.mapInner(t,e,0,0,n||Fh)}mapInner(t,e,n,r,o){let i;for(let s=0;s<this.local.length;s++){let a=this.local[s].map(t,n,r);a&&a.type.valid(e,a)?(i||(i=[])).push(a):o.onRemove&&o.onRemove(this.local[s].spec)}return this.children.length?function(t,e,n,r,o,i,s){let a=t.slice();for(let t=0,e=i;t<n.maps.length;t++){let r=0;n.maps[t].forEach((t,n,o,i)=>{let s=i-o-(n-t);for(let o=0;o<a.length;o+=3){let i=a[o+1];if(i<0||t>i+e-r)continue;let l=a[o]+e-r;n>=l?a[o+1]=t<=l?-2:-1:t>=e&&s&&(a[o]+=s,a[o+1]+=s)}r+=s}),e=n.maps[t].map(e,-1)}let l=!1;for(let e=0;e<a.length;e+=3)if(a[e+1]<0){if(-2==a[e+1]){l=!0,a[e+1]=-1;continue}let c=n.map(t[e]+i),d=c-o;if(d<0||d>=r.content.size){l=!0;continue}let u=n.map(t[e+1]+i,-1)-o,{index:h,offset:p}=r.content.findIndex(d),f=r.maybeChild(h);if(f&&p==d&&p+f.nodeSize==u){let r=a[e+2].mapInner(n,f,c+1,t[e]+i+1,s);r!=zh?(a[e]=d,a[e+1]=u,a[e+2]=r):(a[e+1]=-2,l=!0)}else l=!0}if(l){let l=function(t,e,n,r,o,i,s){function a(t,e){for(let i=0;i<t.local.length;i++){let a=t.local[i].map(r,o,e);a?n.push(a):s.onRemove&&s.onRemove(t.local[i].spec)}for(let n=0;n<t.children.length;n+=3)a(t.children[n+2],t.children[n]+e+1)}for(let n=0;n<t.length;n+=3)-1==t[n+1]&&a(t[n+2],e[n]+i+1);return n}(a,t,e,n,o,i,s),c=Gh(l,r,0,s);e=c.local;for(let t=0;t<a.length;t+=3)a[t+1]<0&&(a.splice(t,3),t-=3);for(let t=0,e=0;t<c.children.length;t+=3){let n=c.children[t];for(;e<a.length&&a[e]<n;)e+=3;a.splice(e,0,c.children[t],c.children[t+1],c.children[t+2])}}return new Vh(e.sort(Yh),a)}(this.children,i||[],t,e,n,r,o):i?new Vh(i.sort(Yh),Uh):zh}add(t,e){return e.length?this==zh?Vh.create(t,e):this.addInner(t,e,0):this}addInner(t,e,n){let r,o=0;t.forEach((t,i)=>{let s,a=i+n;if(s=Kh(e,t,a)){for(r||(r=this.children.slice());o<r.length&&r[o]<i;)o+=3;r[o]==i?r[o+2]=r[o+2].addInner(t,s,a+1):r.splice(o,0,i,i+t.nodeSize,Gh(s,t,a+1,Fh)),o+=3}});let i=qh(o?Jh(e):e,-n);for(let e=0;e<i.length;e++)i[e].type.valid(t,i[e])||i.splice(e--,1);return new Vh(i.length?this.local.concat(i).sort(Yh):this.local,r||this.children)}remove(t){return 0==t.length||this==zh?this:this.removeInner(t,0)}removeInner(t,e){let n=this.children,r=this.local;for(let r=0;r<n.length;r+=3){let o,i=n[r]+e,s=n[r+1]+e;for(let e,n=0;n<t.length;n++)(e=t[n])&&e.from>i&&e.to<s&&(t[n]=null,(o||(o=[])).push(e));if(!o)continue;n==this.children&&(n=this.children.slice());let a=n[r+2].removeInner(o,i+1);a!=zh?n[r+2]=a:(n.splice(r,3),r-=3)}if(r.length)for(let n,o=0;o<t.length;o++)if(n=t[o])for(let t=0;t<r.length;t++)r[t].eq(n,e)&&(r==this.local&&(r=this.local.slice()),r.splice(t--,1));return n==this.children&&r==this.local?this:r.length||n.length?new Vh(r,n):zh}forChild(t,e){if(this==zh)return this;if(e.isLeaf)return Vh.empty;let n,r;for(let e=0;e<this.children.length;e+=3)if(this.children[e]>=t){this.children[e]==t&&(n=this.children[e+2]);break}let o=t+1,i=o+e.content.size;for(let t=0;t<this.local.length;t++){let e=this.local[t];if(e.from<i&&e.to>o&&e.type instanceof Hh){let t=Math.max(o,e.from)-o,n=Math.min(i,e.to)-o;t<n&&(r||(r=[])).push(e.copy(t,n))}}if(r){let t=new Vh(r.sort(Yh),Uh);return n?new Wh([t,n]):t}return n||zh}eq(t){if(this==t)return!0;if(!(t instanceof Vh)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return Xh(this.localsInner(t))}localsInner(t){if(this==zh)return Uh;if(t.inlineContent||!this.local.some(Hh.is))return this.local;let e=[];for(let t=0;t<this.local.length;t++)this.local[t].type instanceof Hh||e.push(this.local[t]);return e}forEachSet(t){t(this)}}Vh.empty=new Vh([],[]),Vh.removeOverlap=Xh;const zh=Vh.empty;class Wh{constructor(t){this.members=t}map(t,e){const n=this.members.map(n=>n.map(t,e,Fh));return Wh.from(n)}forChild(t,e){if(e.isLeaf)return Vh.empty;let n=[];for(let r=0;r<this.members.length;r++){let o=this.members[r].forChild(t,e);o!=zh&&(o instanceof Wh?n=n.concat(o.members):n.push(o))}return Wh.from(n)}eq(t){if(!(t instanceof Wh)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,n=!0;for(let r=0;r<this.members.length;r++){let o=this.members[r].localsInner(t);if(o.length)if(e){n&&(e=e.slice(),n=!1);for(let t=0;t<o.length;t++)e.push(o[t])}else e=o}return e?Xh(n?e:e.sort(Yh)):Uh}static from(t){switch(t.length){case 0:return zh;case 1:return t[0];default:return new Wh(t.every(t=>t instanceof Vh)?t:t.reduce((t,e)=>t.concat(e instanceof Vh?e:e.members),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}}function qh(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let o=t[r];n.push(new jh(o.from+e,o.to+e,o.type))}return n}function Kh(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,o=null;for(let e,i=0;i<t.length;i++)(e=t[i])&&e.from>n&&e.to<r&&((o||(o=[])).push(e),t[i]=null);return o}function Jh(t){let e=[];for(let n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function Gh(t,e,n,r){let o=[],i=!1;e.forEach((e,s)=>{let a=Kh(t,e,s+n);if(a){i=!0;let t=Gh(a,e,n+s+1,r);t!=zh&&o.push(s,s+e.nodeSize,t)}});let s=qh(i?Jh(t):t,-n).sort(Yh);for(let t=0;t<s.length;t++)s[t].type.valid(e,s[t])||(r.onRemove&&r.onRemove(s[t].spec),s.splice(t--,1));return s.length||o.length?new Vh(s,o):zh}function Yh(t,e){return t.from-e.from||t.to-e.to}function Xh(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let o=n+1;o<e.length;o++){let i=e[o];if(i.from!=r.from){i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),Qh(e,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),Qh(e,o+1,i.copy(r.to,i.to)))}}return e}function Qh(t,e,n){for(;e<t.length&&Yh(n,t[e])>0;)e++;t.splice(e,0,n)}function Zh(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=zh&&e.push(r)}),t.cursorWrapper&&e.push(Vh.create(t.state.doc,[t.cursorWrapper.deco])),Wh.from(e)}const tp={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},ep=_d&&Ed<=11;class np{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class rp{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new np,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(t=>{for(let e=0;e<t.length;e++)this.queue.push(t[e]);_d&&Ed<=11&&t.some(t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length)?this.flushSoon():this.flush()}),ep&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,tp)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if($u(this.view)){if(this.suppressingSelectionUpdates)return Au(this.view);if(_d&&Ed<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&hd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e,n=new Set;for(let e=t.focusNode;e;e=cd(e))n.add(e);for(let r=t.anchorNode;r;r=cd(r))if(n.has(r)){e=r;break}let r=e&&this.view.docView.nearestDesc(e);return r&&r.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let n=t.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&$u(t)&&!this.ignoreSelectionChange(n),o=-1,i=-1,s=!1,a=[];if(t.editable)for(let t=0;t<e.length;t++){let n=this.registerMutation(e[t],a);n&&(o=o<0?n.from:Math.min(n.from,o),i=i<0?n.to:Math.max(n.to,i),n.typeOver&&(s=!0))}if(Td&&a.length){let e=a.filter(t=>"BR"==t.nodeName);if(2==e.length){let[t,n]=e;t.parentNode&&t.parentNode.parentNode==n.parentNode?n.remove():t.remove()}else{let{focusNode:n}=this.currentSelection;for(let r of e){let e=r.parentNode;!e||"LI"!=e.nodeName||n&&ap(t,n)==e||r.remove()}}}let l=null;o<0&&r&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&yd(n)&&(l=Tu(t))&&l.eq(Bc.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Au(t),this.currentSelection.set(n),t.scrollToSelection()):(o>-1||r)&&(o>-1&&(t.docView.markDirty(o,i),function(t){if(!op.has(t)&&(op.set(t,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace))){if(t.requiresGeckoHackNode=Td,ip)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),ip=!0}}(t)),this.handleDOMChange(o,i,s,a),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||Au(t),this.currentSelection.set(n))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(let n=0;n<t.addedNodes.length;n++){let r=t.addedNodes[n];e.push(r),3==r.nodeType&&(this.lastChangedTextNode=r)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};let r=t.previousSibling,o=t.nextSibling;if(_d&&Ed<=11&&t.addedNodes.length)for(let e=0;e<t.addedNodes.length;e++){let{previousSibling:n,nextSibling:i}=t.addedNodes[e];(!n||Array.prototype.indexOf.call(t.addedNodes,n)<0)&&(r=n),(!i||Array.prototype.indexOf.call(t.addedNodes,i)<0)&&(o=i)}let i=r&&r.parentNode==t.target?ld(r)+1:0,s=n.localPosFromDOM(t.target,i,-1),a=o&&o.parentNode==t.target?ld(o):t.target.childNodes.length;return{from:s,to:n.localPosFromDOM(t.target,a,1)}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=t.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let op=new WeakMap,ip=!1;function sp(t,e){let n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return hd(s.node,s.offset,o,i)&&([n,r,o,i]=[o,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:o,focusOffset:i}}function ap(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let e=t.docView.nearestDesc(n,!0);if(e&&e.node.isBlock)return n}return null}function lp(t){let e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(Dd&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}if(t.parentNode.lastChild==t||Dd&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const cp=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function dp(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Pu(t,e.resolve(n.anchor),e.resolve(n.head))}function up(t,e,n){let r=t.depth,o=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,o++,e=!1;if(n){let e=t.node(r).maybeChild(t.indexAfter(r));for(;e&&!e.isLeaf;)e=e.firstChild,o++}return o}function hp(t){if(2!=t.length)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class pp{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new hh,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(bp),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):"function"==typeof t?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=gp(this),mp(this),this.nodeViews=yp(this),this.docView=uu(this.state.doc,fp(this),Zh(this),this.dom,this),this.domObserver=new rp(this,(t,e,n,r)=>function(t,e,n,r,o){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let e=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,n=Tu(t,e);if(n&&!t.state.selection.eq(n)){if(Ad&&Id&&13===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",e=>e(t,bd(13,"Enter"))))return;let r=t.state.tr.setSelection(n);"pointer"==e?r.setMeta("pointer",!0):"key"==e&&r.scrollIntoView(),i&&r.setMeta("composition",i),t.dispatch(r)}return}let s=t.state.doc.resolve(e),a=s.sharedDepth(n);e=s.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l,c,d=t.state.selection,u=function(t,e,n){let r,{node:o,fromOffset:i,toOffset:s,from:a,to:l}=t.docView.parseRange(e,n),c=t.domSelectionRange(),d=c.anchorNode;if(d&&t.dom.contains(1==d.nodeType?d:d.parentNode)&&(r=[{node:d,offset:c.anchorOffset}],yd(c)||r.push({node:c.focusNode,offset:c.focusOffset})),Ad&&8===t.input.lastKeyCode)for(let t=s;t>i;t--){let e=o.childNodes[t-1],n=e.pmViewDesc;if("BR"==e.nodeName&&!n){s=t;break}if(!n||n.size)break}let u=t.state.doc,h=t.someProp("domParser")||Ll.fromSchema(t.state.schema),p=u.resolve(a),f=null,m=h.parse(o,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:s,preserveWhitespace:"pre"!=p.parent.type.whitespace||"full",findPositions:r,ruleFromNode:lp,context:p});if(r&&null!=r[0].pos){let t=r[0].pos,e=r[1]&&r[1].pos;null==e&&(e=t),f={anchor:t+a,head:e+a}}return{doc:m,sel:f,from:a,to:l}}(t,e,n),h=t.state.doc,p=h.slice(u.from,u.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(l=t.state.selection.to,c="end"):(l=t.state.selection.from,c="start"),t.input.lastKeyCode=null;let f=function(t,e,n,r,o){let i=t.findDiffStart(e,n);if(null==i)return null;let{a:s,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if("end"==o&&(r-=s+Math.max(0,i-Math.min(s,a))-i),s<i&&t.size<e.size){let t=r<=i&&r>=s?i-r:0;i-=t,i&&i<e.size&&hp(e.textBetween(i-1,i+1))&&(i+=t?1:-1),a=i+(a-s),s=i}else if(a<i){let e=r<=i&&r>=a?i-r:0;i-=e,i&&i<t.size&&hp(t.textBetween(i-1,i+1))&&(i+=e?1:-1),s=i+(s-a),a=i}return{start:i,endA:s,endB:a}}(p.content,u.doc.content,u.from,l,c);if(f&&t.input.domChangeCount++,(Rd&&t.input.lastIOSEnter>Date.now()-225||Id)&&o.some(t=>1==t.nodeType&&!cp.test(t.nodeName))&&(!f||f.endA>=f.endB)&&t.someProp("handleKeyDown",e=>e(t,bd(13,"Enter"))))return void(t.input.lastIOSEnter=0);if(!f){if(!(r&&d instanceof Vc&&!d.empty&&d.$head.sameParent(d.$anchor))||t.composing||u.sel&&u.sel.anchor!=u.sel.head){if(u.sel){let e=dp(t,t.state.doc,u.sel);if(e&&!e.eq(t.state.selection)){let n=t.state.tr.setSelection(e);i&&n.setMeta("composition",i),t.dispatch(n)}}return}f={start:d.from,endA:d.to,endB:d.to}}t.state.selection.from<t.state.selection.to&&f.start==f.endB&&t.state.selection instanceof Vc&&(f.start>t.state.selection.from&&f.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?f.start=t.state.selection.from:f.endA<t.state.selection.to&&f.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(f.endB+=t.state.selection.to-f.endA,f.endA=t.state.selection.to)),_d&&Ed<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>u.from&&" "==u.doc.textBetween(f.start-u.from-1,f.start-u.from+1)&&(f.start--,f.endA--,f.endB--);let m,g=u.doc.resolveNoCache(f.start-u.from),y=u.doc.resolveNoCache(f.endB-u.from),b=h.resolve(f.start),v=g.sameParent(y)&&g.parent.inlineContent&&b.end()>=f.endA;if((Rd&&t.input.lastIOSEnter>Date.now()-225&&(!v||o.some(t=>"DIV"==t.nodeName||"P"==t.nodeName))||!v&&g.pos<u.doc.content.size&&(!g.sameParent(y)||!g.parent.inlineContent)&&!/\S/.test(u.doc.textBetween(g.pos,y.pos,"",""))&&(m=Bc.findFrom(u.doc.resolve(g.pos+1),1,!0))&&m.head>g.pos)&&t.someProp("handleKeyDown",e=>e(t,bd(13,"Enter"))))return void(t.input.lastIOSEnter=0);if(t.state.selection.anchor>f.start&&function(t,e,n,r,o){if(n-e<=o.pos-r.pos||up(r,!0,!1)<o.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let t=i.nodeAfter;return null!=t&&n==e+t.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let s=t.resolve(up(i,!0,!0));return!(!s.parent.isTextblock||s.pos>n||up(s,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(s.parent.content)}(h,f.start,f.endA,g,y)&&t.someProp("handleKeyDown",e=>e(t,bd(8,"Backspace"))))return void(Id&&Ad&&t.domObserver.suppressSelectionUpdates());Ad&&f.endB==f.start&&(t.input.lastChromeDelete=Date.now()),Id&&!v&&g.start()!=y.start()&&0==y.parentOffset&&g.depth==y.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==f.endA&&(f.endB-=2,y=u.doc.resolveNoCache(f.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(e){return e(t,bd(13,"Enter"))})},20));let w,k=f.start,S=f.endA,x=e=>{let n=e||t.state.tr.replace(k,S,u.doc.slice(f.start-u.from,f.endB-u.from));if(u.sel){let e=dp(t,n.doc,u.sel);e&&!(Ad&&t.composing&&e.empty&&(f.start!=f.endB||t.input.lastChromeDelete<Date.now()-100)&&(e.head==k||e.head==n.mapping.map(S)-1)||_d&&e.empty&&e.head==k)&&n.setSelection(e)}return i&&n.setMeta("composition",i),n.scrollIntoView()};if(v){if(g.pos==y.pos){_d&&Ed<=11&&0==g.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Au(t),20));let e=x(t.state.tr.delete(k,S)),n=h.resolve(f.start).marksAcross(h.resolve(f.endA));n&&e.ensureMarks(n),t.dispatch(e)}else if(f.endA==f.endB&&(w=function(t,e){let n,r,o,i=t.firstChild.marks,s=e.firstChild.marks,a=i,l=s;for(let t=0;t<s.length;t++)a=s[t].removeFromSet(a);for(let t=0;t<i.length;t++)l=i[t].removeFromSet(l);if(1==a.length&&0==l.length)r=a[0],n="add",o=t=>t.mark(r.addToSet(t.marks));else{if(0!=a.length||1!=l.length)return null;r=l[0],n="remove",o=t=>t.mark(r.removeFromSet(t.marks))}let c=[];for(let t=0;t<e.childCount;t++)c.push(o(e.child(t)));if(Fa.from(c).eq(t))return{mark:r,type:n}}(g.parent.content.cut(g.parentOffset,y.parentOffset),b.parent.content.cut(b.parentOffset,f.endA-b.start())))){let e=x(t.state.tr);"add"==w.type?e.addMark(k,S,w.mark):e.removeMark(k,S,w.mark),t.dispatch(e)}else if(g.parent.child(g.index()).isText&&g.index()==y.index()-(y.textOffset?0:1)){let e=g.parent.textBetween(g.parentOffset,y.parentOffset),n=()=>x(t.state.tr.insertText(e,k,S));t.someProp("handleTextInput",r=>r(t,k,S,e,n))||t.dispatch(n())}}else t.dispatch(x())}(this,t,e,n,r)),this.domObserver.start(),function(t){for(let e in ch){let n=ch[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=e=>{!gh(t,e)||mh(t,e)||!t.editable&&e.type in dh||n(t,e)},uh[e]?{passive:!0}:void 0)}Dd&&t.dom.addEventListener("input",()=>null),fh(t)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&fh(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(bp),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let t in this._props)e[t]=this._props[t];e.state=this.state;for(let n in t)e[n]=t[n];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var n;let r=this.state,o=!1,i=!1;t.storedMarks&&this.composing&&(Mh(this),i=!0),this.state=t;let s=r.plugins!=t.plugins||this._props.plugins!=e.plugins;if(s||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let t=yp(this);(function(t,e){let n=0,r=0;for(let r in t){if(t[r]!=e[r])return!0;n++}for(let t in e)r++;return n!=r})(t,this.nodeViews)&&(this.nodeViews=t,o=!0)}(s||e.handleDOMEvents!=this._props.handleDOMEvents)&&fh(this),this.editable=gp(this),mp(this);let a=Zh(this),l=fp(this),c=r.plugins==t.plugins||r.doc.eq(t.doc)?t.scrollToSelection>r.scrollToSelection?"to selection":"preserve":"reset",d=o||!this.docView.matchesNode(t.doc,l,a);!d&&t.selection.eq(r.selection)||(i=!0);let u="preserve"==c&&i&&null==this.dom.style.overflowAnchor&&function(t){let e,n,r=t.dom.getBoundingClientRect(),o=Math.max(0,r.top);for(let i=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){let r=t.root.elementFromPoint(i,s);if(!r||r==t.dom||!t.dom.contains(r))continue;let a=r.getBoundingClientRect();if(a.top>=o-20){e=r,n=a.top;break}}return{refDOM:e,refTop:n,stack:Fd(t.dom)}}(this);if(i){this.domObserver.stop();let e=d&&(_d||Ad)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&function(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}(r.selection,t.selection);if(d){let n=Ad?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=function(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=function(t,e){for(;;){if(3==t.nodeType&&e)return t;if(1==t.nodeType&&e>0){if("false"==t.contentEditable)return null;e=md(t=t.childNodes[e-1])}else{if(!t.parentNode||gd(t))return null;e=ld(t),t=t.parentNode}}}(e.focusNode,e.focusOffset),r=function(t,e){for(;;){if(3==t.nodeType&&e<t.nodeValue.length)return t;if(1==t.nodeType&&e<t.childNodes.length){if("false"==t.contentEditable)return null;t=t.childNodes[e],e=0}else{if(!t.parentNode||gd(t))return null;e=ld(t)+1,t=t.parentNode}}}(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let e=r.pmViewDesc,o=t.domObserver.lastChangedTextNode;if(n==o||r==o)return o;if(!e||!e.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let t=n.pmViewDesc;if(t&&t.isText(n.nodeValue))return r}}return n||r}(this)),!o&&this.docView.update(t.doc,l,a,this)||(this.docView.updateOuterDeco(l),this.docView.destroy(),this.docView=uu(t.doc,l,a,this.dom,this)),n&&!this.trackWrites&&(e=!0)}e||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return hd(e.node,e.offset,n.anchorNode,n.anchorOffset)}(this))?Au(this,e):(Nu(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!r.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,r),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():u&&function({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;Vd(n,0==r?0:r-e)}(u)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(t&&this.dom.contains(1==t.nodeType?t:t.parentNode))if(this.someProp("handleScrollToSelection",t=>t(this)));else if(this.state.selection instanceof Wc){let e=this.docView.domAfterPos(this.state.selection.from);1==e.nodeType&&Ud(this,e.getBoundingClientRect(),t)}else Ud(this,this.coordsAtPos(this.state.selection.head,1),t)}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let e=this.directPlugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let e=this.state.plugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}}}updateDraggedNode(t,e){let n=t.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{let t=n.from+(this.state.doc.content.size-e.doc.content.size);(t>0&&this.state.doc.nodeAt(t))==n.node&&(r=t)}this.dragging=new Lh(t.slice,t.move,r<0?void 0:Wc.create(this.state.doc,r))}someProp(t,e){let n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;for(let r=0;r<this.directPlugins.length;r++){let o=this.directPlugins[r].props[t];if(null!=o&&(n=e?e(o):o))return n}let o=this.state.plugins;if(o)for(let r=0;r<o.length;r++){let i=o[r].props[t];if(null!=i&&(n=e?e(i):i))return n}}hasFocus(){if(_d){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if("false"==t.contentEditable)return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(t){if(t.setActive)return t.setActive();if(zd)return t.focus(zd);let e=Fd(t);t.focus(null==zd?{get preventScroll(){return zd={preventScroll:!0},!0}}:void 0),zd||(zd=!1,Vd(e,0))}(this.dom),Au(this),this.domObserver.start()}get root(){let t=this._root;if(null==t)for(let t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t;return t||document}updateRoot(){this._root=null}posAtCoords(t){return Jd(this,t)}coordsAtPos(t,e=1){return Qd(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,n=-1){let r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(t,e){return function(t,e,n){return ru==e&&ou==n?iu:(ru=e,ou=n,iu="up"==n||"down"==n?function(t,e,n){let r=e.selection,o="up"==n?r.$from:r.$to;return eu(t,e,()=>{let{node:e}=t.docView.domFromPos(o.pos,"up"==n?-1:1);for(;;){let n=t.docView.nearestDesc(e,!0);if(!n)break;if(n.node.isBlock){e=n.contentDOM||n.dom;break}e=n.dom.parentNode}let r=Qd(t,o.pos,1);for(let t=e.firstChild;t;t=t.nextSibling){let e;if(1==t.nodeType)e=t.getClientRects();else{if(3!=t.nodeType)continue;e=ud(t,0,t.nodeValue.length).getClientRects()}for(let t=0;t<e.length;t++){let o=e[t];if(o.bottom>o.top+1&&("up"==n?r.top-o.top>2*(o.bottom-r.top):o.bottom-r.bottom>2*(r.bottom-o.top)))return!1}}return!0})}(t,e,n):function(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let o=r.parentOffset,i=!o,s=o==r.parent.content.size,a=t.domSelection();return a?nu.test(r.parent.textContent)&&a.modify?eu(t,e,()=>{let{focusNode:e,focusOffset:o,anchorNode:i,anchorOffset:s}=t.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:d,focusOffset:u}=t.domSelectionRange(),h=d&&!c.contains(1==d.nodeType?d:d.parentNode)||e==d&&o==u;try{a.collapse(i,s),e&&(e!=i||o!=s)&&a.extend&&a.extend(e,o)}catch(t){}return null!=l&&(a.caretBidiLevel=l),h}):"left"==n||"backward"==n?i:s:r.pos==r.start()||r.pos==r.end()}(t,e,n))}(this,e||this.state,t)}pasteHTML(t,e){return Dh(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return Dh(this,t,null,!0,e||new ClipboardEvent("paste"))}serializeForClipboard(t){return Xu(this,t)}destroy(){this.docView&&(function(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Zh(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,dd=null)}get isDestroyed(){return null==this.docView}dispatchEvent(t){return function(t,e){mh(t,e)||!ch[e.type]||!t.editable&&e.type in dh||ch[e.type](t,e)}(this,t)}domSelectionRange(){let t=this.domSelection();return t?Dd&&11===this.root.nodeType&&function(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}(this.dom.ownerDocument)==this.dom&&function(t,e){if(e.getComposedRanges){let n=e.getComposedRanges(t.root)[0];if(n)return sp(t,n)}let n;function r(t){t.preventDefault(),t.stopImmediatePropagation(),n=t.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?sp(t,n):null}(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function fp(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if("function"==typeof n&&(n=n(t.state)),n)for(let t in n)"class"==t?e.class+=" "+n[t]:"style"==t?e.style=(e.style?e.style+";":"")+n[t]:e[t]||"contenteditable"==t||"nodeName"==t||(e[t]=String(n[t]))}),e.translate||(e.translate="no"),[jh.node(0,t.state.doc.content.size,e)]}function mp(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:jh.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function gp(t){return!t.someProp("editable",e=>!1===e(t.state))}function yp(t){let e=Object.create(null);function n(t){for(let n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function bp(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}pp.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};for(var vp={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},wp={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},kp="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Sp="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),xp=0;xp<10;xp++)vp[48+xp]=vp[96+xp]=String(xp);for(xp=1;xp<=24;xp++)vp[xp+111]="F"+xp;for(xp=65;xp<=90;xp++)vp[xp]=String.fromCharCode(xp+32),wp[xp]=String.fromCharCode(xp);for(var Cp in vp)wp.hasOwnProperty(Cp)||(wp[Cp]=vp[Cp]);const _p="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Ep="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function Tp(t){let e,n,r,o,i=t.split(/-(?!$)/),s=i[i.length-1];"Space"==s&&(s=" ");for(let t=0;t<i.length-1;t++){let s=i[t];if(/^(cmd|meta|m)$/i.test(s))o=!0;else if(/^a(lt)?$/i.test(s))e=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else if(/^s(hift)?$/i.test(s))r=!0;else{if(!/^mod$/i.test(s))throw new Error("Unrecognized modifier name: "+s);_p?o=!0:n=!0}}return e&&(s="Alt-"+s),n&&(s="Ctrl-"+s),o&&(s="Meta-"+s),r&&(s="Shift-"+s),s}function Mp(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Ap(t){let e=function(t){let e=Object.create(null);for(let n in t)e[Tp(n)]=t[n];return e}(t);return function(t,n){let r,o=function(t){var e=!(kp&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Sp&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key)&&t.key||(t.shiftKey?wp:vp)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(n),i=e[Mp(o,n)];if(i&&i(t.state,t.dispatch,t))return!0;if(1==o.length&&" "!=o){if(n.shiftKey){let r=e[Mp(o,n,!1)];if(r&&r(t.state,t.dispatch,t))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Ep&&n.ctrlKey&&n.altKey)&&(r=vp[n.keyCode])&&r!=o){let o=e[Mp(r,n)];if(o&&o(t.state,t.dispatch,t))return!0}}return!1}}const Op=(t,e)=>!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function Dp(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const Rp=(t,e,n)=>{let r=Dp(t,n);if(!r)return!1;let o=Pp(r);if(!o){let n=r.blockRange(),o=n&&pc(n);return null!=o&&(e&&e(t.tr.lift(n,o).scrollIntoView()),!0)}let i=o.nodeBefore;if(Kp(t,o,e,-1))return!0;if(0==r.parent.content.size&&(Np(i,"end")||Wc.isSelectable(i)))for(let n=r.depth;;n--){let s=xc(t.doc,r.before(n),r.after(n),Ja.empty);if(s&&s.slice.size<s.to-s.from){if(e){let n=t.tr.step(s);n.setSelection(Np(i,"end")?Bc.findFrom(n.doc.resolve(n.mapping.map(o.pos,-1)),-1):Wc.create(n.doc,o.pos-i.nodeSize)),e(n.scrollIntoView())}return!0}if(1==n||r.node(n-1).childCount>1)break}return!(!i.isAtom||o.depth!=r.depth-1||(e&&e(t.tr.delete(o.pos-i.nodeSize,o.pos).scrollIntoView()),0))};function Lp(t,e,n){let r=e.nodeBefore,o=e.pos-1;for(;!r.isTextblock;o--){if(r.type.spec.isolating)return!1;let t=r.lastChild;if(!t)return!1;r=t}let i=e.nodeAfter,s=e.pos+1;for(;!i.isTextblock;s++){if(i.type.spec.isolating)return!1;let t=i.firstChild;if(!t)return!1;i=t}let a=xc(t.doc,o,s,Ja.empty);if(!a||a.from!=o||a instanceof lc&&a.slice.size>=s-o)return!1;if(n){let e=t.tr.step(a);e.setSelection(Vc.create(e.doc,o)),n(e.scrollIntoView())}return!0}function Np(t,e,n=!1){for(let r=t;r;r="start"==e?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)return!1}return!1}const Ip=(t,e,n)=>{let{$head:r,empty:o}=t.selection,i=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=Pp(r)}let s=i&&i.nodeBefore;return!(!s||!Wc.isSelectable(s)||(e&&e(t.tr.setSelection(Wc.create(t.doc,i.pos-s.nodeSize)).scrollIntoView()),0))};function Pp(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function $p(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const Hp=(t,e,n)=>{let r=$p(t,n);if(!r)return!1;let o=jp(r);if(!o)return!1;let i=o.nodeAfter;if(Kp(t,o,e,1))return!0;if(0==r.parent.content.size&&(Np(i,"start")||Wc.isSelectable(i))){let n=xc(t.doc,r.before(),r.after(),Ja.empty);if(n&&n.slice.size<n.to-n.from){if(e){let r=t.tr.step(n);r.setSelection(Np(i,"start")?Bc.findFrom(r.doc.resolve(r.mapping.map(o.pos)),1):Wc.create(r.doc,r.mapping.map(o.pos))),e(r.scrollIntoView())}return!0}}return!(!i.isAtom||o.depth!=r.depth-1||(e&&e(t.tr.delete(o.pos,o.pos+i.nodeSize).scrollIntoView()),0))},Bp=(t,e,n)=>{let{$head:r,empty:o}=t.selection,i=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=jp(r)}let s=i&&i.nodeAfter;return!(!s||!Wc.isSelectable(s)||(e&&e(t.tr.setSelection(Wc.create(t.doc,i.pos)).scrollIntoView()),0))};function jp(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const Up=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!(!n.parent.type.spec.code||!n.sameParent(r)||(e&&e(t.tr.insertText("\n").scrollIntoView()),0))};function Fp(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const Vp=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let o=n.node(-1),i=n.indexAfter(-1),s=Fp(o.contentMatchAt(i));if(!s||!o.canReplaceWith(i,i,s))return!1;if(e){let r=n.after(),o=t.tr.replaceWith(r,r,s.createAndFill());o.setSelection(Bc.near(o.doc.resolve(r),1)),e(o.scrollIntoView())}return!0},zp=(t,e)=>{let n=t.selection,{$from:r,$to:o}=n;if(n instanceof Kc||r.parent.inlineContent||o.parent.inlineContent)return!1;let i=Fp(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let n=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,s=t.tr.insert(n,i.createAndFill());s.setSelection(Vc.create(s.doc,n+1)),e(s.scrollIntoView())}return!0},Wp=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if(bc(t.doc,r))return e&&e(t.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),o=r&&pc(r);return null!=o&&(e&&e(t.tr.lift(r,o).scrollIntoView()),!0)};var qp;function Kp(t,e,n,r){let o,i,s=e.nodeBefore,a=e.nodeAfter,l=s.type.spec.isolating||a.type.spec.isolating;if(!l&&function(t,e,n){let r=e.nodeBefore,o=e.nodeAfter,i=e.index();return!(!(r&&o&&r.type.compatibleContent(o.type))||(!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),0):!e.parent.canReplace(i,i+1)||!o.isTextblock&&!vc(t.doc,e.pos)||(n&&n(t.tr.join(e.pos).scrollIntoView()),0)))}(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(i=s.contentMatchAt(s.childCount)).findWrapping(a.type))&&i.matchType(o[0]||a.type).validEnd){if(n){let r=e.pos+a.nodeSize,i=Fa.empty;for(let t=o.length-1;t>=0;t--)i=Fa.from(o[t].create(null,i));i=Fa.from(s.copy(i));let l=t.tr.step(new cc(e.pos-1,r,e.pos,r,new Ja(i,1,0),o.length,!0)),c=l.doc.resolve(r+2*o.length);c.nodeAfter&&c.nodeAfter.type==s.type&&vc(l.doc,c.pos)&&l.join(c.pos),n(l.scrollIntoView())}return!0}let d=a.type.spec.isolating||r>0&&l?null:Bc.findFrom(e,1),u=d&&d.$from.blockRange(d.$to),h=u&&pc(u);if(null!=h&&h>=e.depth)return n&&n(t.tr.lift(u,h).scrollIntoView()),!0;if(c&&Np(a,"start",!0)&&Np(s,"end")){let r=s,o=[];for(;o.push(r),!r.isTextblock;)r=r.lastChild;let i=a,l=1;for(;!i.isTextblock;i=i.firstChild)l++;if(r.canReplace(r.childCount,r.childCount,i.content)){if(n){let r=Fa.empty;for(let t=o.length-1;t>=0;t--)r=Fa.from(o[t].copy(r));n(t.tr.step(new cc(e.pos-o.length,e.pos+a.nodeSize,e.pos+l,e.pos+a.nodeSize-l,new Ja(r,o.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Jp(t){return function(e,n){let r=e.selection,o=t<0?r.$from:r.$to,i=o.depth;for(;o.node(i).isInline;){if(!i)return!1;i--}return!!o.node(i).isTextblock&&(n&&n(e.tr.setSelection(Vc.create(e.doc,t<0?o.start(i):o.end(i)))),!0)}}const Gp=Jp(-1),Yp=Jp(1);function Xp(t,e=null){return function(n,r){let o=!1;for(let r=0;r<n.selection.ranges.length&&!o;r++){let{$from:{pos:i},$to:{pos:s}}=n.selection.ranges[r];n.doc.nodesBetween(i,s,(r,i)=>{if(o)return!1;if(r.isTextblock&&!r.hasMarkup(t,e))if(r.type==t)o=!0;else{let e=n.doc.resolve(i),r=e.index();o=e.parent.canReplaceWith(r,r+1,t)}})}if(!o)return!1;if(r){let o=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:i},$to:{pos:s}}=n.selection.ranges[r];o.setBlockType(i,s,t,e)}r(o.scrollIntoView())}return!0}}function Qp(...t){return function(e,n,r){for(let o=0;o<t.length;o++)if(t[o](e,n,r))return!0;return!1}}let Zp=Qp(Op,Rp,Ip),tf=Qp(Op,Hp,Bp);const ef={Enter:Qp(Up,zp,Wp,(t,e)=>{let{$from:n,$to:r}=t.selection;if(t.selection instanceof Wc&&t.selection.node.isBlock)return!(!n.parentOffset||!bc(t.doc,n.pos)||(e&&e(t.tr.split(n.pos).scrollIntoView()),0));if(!n.depth)return!1;let o,i,s=[],a=!1,l=!1;for(let t=n.depth;;t--){if(n.node(t).isBlock){a=n.end(t)==n.pos+(n.depth-t),l=n.start(t)==n.pos-(n.depth-t),i=Fp(n.node(t-1).contentMatchAt(n.indexAfter(t-1)));let e=qp;s.unshift(e||(a&&i?{type:i}:null)),o=t;break}if(1==t)return!1;s.unshift(null)}let c=t.tr;(t.selection instanceof Vc||t.selection instanceof Kc)&&c.deleteSelection();let d=c.mapping.map(n.pos),u=bc(c.doc,d,s.length,s);if(u||(s[0]=i?{type:i}:null,u=bc(c.doc,d,s.length,s)),!u)return!1;if(c.split(d,s.length,s),!a&&l&&n.node(o).type!=i){let t=c.mapping.map(n.before(o)),e=c.doc.resolve(t);i&&n.node(o-1).canReplaceWith(e.index(),e.index()+1,i)&&c.setNodeMarkup(c.mapping.map(n.before(o)),i)}return e&&e(c.scrollIntoView()),!0}),"Mod-Enter":Vp,Backspace:Zp,"Mod-Backspace":Zp,"Shift-Backspace":Zp,Delete:tf,"Mod-Delete":tf,"Mod-a":(t,e)=>(e&&e(t.tr.setSelection(new Kc(t.doc))),!0)},nf={"Ctrl-h":ef.Backspace,"Alt-Backspace":ef["Mod-Backspace"],"Ctrl-d":ef.Delete,"Ctrl-Alt-Backspace":ef["Mod-Delete"],"Alt-Delete":ef["Mod-Delete"],"Alt-d":ef["Mod-Delete"],"Ctrl-a":Gp,"Ctrl-e":Yp};for(let t in ef)nf[t]=ef[t];function rf(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:o}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return o},get tr(){return r=n.selection,o=n.doc,i=n.storedMarks,n}}}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();var of=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:o}=n,i=this.buildProps(o);return Object.fromEntries(Object.entries(t).map(([t,e])=>[t,(...t)=>{const n=e(...t)(i);return o.getMeta("preventDispatch")||this.hasCustomState||r.dispatch(o),n}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:o}=this,{view:i}=r,s=[],a=!!t,l=t||o.tr,c={...Object.fromEntries(Object.entries(n).map(([t,n])=>[t,(...t)=>{const r=this.buildProps(l,e),o=n(...t)(r);return s.push(o),c}])),run:()=>(a||!e||l.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(l),s.every(t=>!0===t))};return c}createCan(t){const{rawCommands:e,state:n}=this,r=!1,o=t||n.tr,i=this.buildProps(o,r),s=Object.fromEntries(Object.entries(e).map(([t,e])=>[t,(...t)=>e(...t)({...i,dispatch:void 0})]));return{...s,chain:()=>this.createChain(o,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:o}=this,{view:i}=r,s={tr:t,editor:r,view:i,state:rf({state:o,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([t,e])=>[t,(...t)=>e(...t)(s)]))}};return s}},sf=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(t=>t.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(t=>t!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}};function af(t,e){const n=new $c(t);return e.forEach(t=>{t.steps.forEach(t=>{n.step(t)})}),n}var lf=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];3===r.nodeType&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):1===r.nodeType&&lf(r)}return t};function cf(t){if("undefined"==typeof window)throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=(new window.DOMParser).parseFromString(e,"text/html").body;return lf(n)}function df(t,e,n){if(t instanceof hl||t instanceof Fa)return t;n={slice:!0,parseOptions:{},...n};const r="string"==typeof t;if("object"==typeof t&&null!==t)try{if(Array.isArray(t)&&t.length>0)return Fa.fromArray(t.map(t=>e.nodeFromJSON(t)));const r=e.nodeFromJSON(t);return n.errorOnInvalidContent&&r.check(),r}catch(r){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",r),df("",e,n)}if(r){if(n.errorOnInvalidContent){let r=!1,o="";const i=new Dl({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:t=>(r=!0,o="string"==typeof t?t:t.outerHTML,null)}]}})});if(n.slice?Ll.fromSchema(i).parseSlice(cf(t),n.parseOptions):Ll.fromSchema(i).parse(cf(t),n.parseOptions),n.errorOnInvalidContent&&r)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${o}`)})}const r=Ll.fromSchema(e);return n.slice?r.parseSlice(cf(t),n.parseOptions).content:r.parse(cf(t),n.parseOptions)}return df("",e,n)}function uf(t,e,n={},r={}){return df(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}function hf(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function pf(t){return e=>hf(e.$from,t)}function ff(t,e,n){return void 0===t.config[e]&&t.parent?ff(t.parent,e,n):"function"==typeof t.config[e]?t.config[e].bind({...n,parent:t.parent?ff(t.parent,e,n):null}):t.config[e]}function mf(t){return t.map(t=>{const e=ff(t,"addExtensions",{name:t.name,options:t.options,storage:t.storage});return e?[t,...mf(e())]:t}).flat(10)}function gf(t,e){const n=Vl.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}function yf(t){return"function"==typeof t}function bf(t,e=void 0,...n){return yf(t)?e?t.bind(e)(...n):t(...n):t}function vf(t){return{baseExtensions:t.filter(t=>"extension"===t.type),nodeExtensions:t.filter(t=>"node"===t.type),markExtensions:t.filter(t=>"mark"===t.type)}}function wf(t){const e=[],{nodeExtensions:n,markExtensions:r}=vf(t),o=[...n,...r],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(t=>{const n=ff(t,"addGlobalAttributes",{name:t.name,options:t.options,storage:t.storage,extensions:o});n&&n().forEach(t=>{t.types.forEach(n=>{Object.entries(t.attributes).forEach(([t,r])=>{e.push({type:n,name:t,attribute:{...i,...r}})})})})}),o.forEach(t=>{const n={name:t.name,options:t.options,storage:t.storage},r=ff(t,"addAttributes",n);if(!r)return;const o=r();Object.entries(o).forEach(([n,r])=>{const o={...i,...r};"function"==typeof(null==o?void 0:o.default)&&(o.default=o.default()),(null==o?void 0:o.isRequired)&&void 0===(null==o?void 0:o.default)&&delete o.default,e.push({type:t.name,name:n,attribute:o})})}),e}function kf(...t){return t.filter(t=>!!t).reduce((t,e)=>{const n={...t};return Object.entries(e).forEach(([t,e])=>{if(n[t])if("class"===t){const r=e?String(e).split(" "):[],o=n[t]?n[t].split(" "):[],i=r.filter(t=>!o.includes(t));n[t]=[...o,...i].join(" ")}else if("style"===t){const r=e?e.split(";").map(t=>t.trim()).filter(Boolean):[],o=n[t]?n[t].split(";").map(t=>t.trim()).filter(Boolean):[],i=new Map;o.forEach(t=>{const[e,n]=t.split(":").map(t=>t.trim());i.set(e,n)}),r.forEach(t=>{const[e,n]=t.split(":").map(t=>t.trim());i.set(e,n)}),n[t]=Array.from(i.entries()).map(([t,e])=>`${t}: ${e}`).join("; ")}else n[t]=e;else n[t]=e}),n},{})}function Sf(t,e){return e.filter(e=>e.type===t.type.name).filter(t=>t.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(t.attrs)||{}:{[e.name]:t.attrs[e.name]}).reduce((t,e)=>kf(t,e),{})}function xf(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(!1===r)return!1;const o=e.reduce((t,e)=>{const r=e.attribute.parseHTML?e.attribute.parseHTML(n):function(t){return"string"!=typeof t?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):"true"===t||"false"!==t&&t}(n.getAttribute(e.name));return null==r?t:{...t,[e.name]:r}},{});return{...r,...o}}}}function Cf(t){return Object.fromEntries(Object.entries(t).filter(([t,e])=>("attrs"!==t||!function(t={}){return 0===Object.keys(t).length&&t.constructor===Object}(e))&&null!=e))}function _f(t,e){var n;const r=wf(t),{nodeExtensions:o,markExtensions:i}=vf(t),s=null==(n=o.find(t=>ff(t,"topNode")))?void 0:n.name,a=Object.fromEntries(o.map(n=>{const o=r.filter(t=>t.type===n.name),i={name:n.name,options:n.options,storage:n.storage,editor:e},s=Cf({...t.reduce((t,e)=>{const r=ff(e,"extendNodeSchema",i);return{...t,...r?r(n):{}}},{}),content:bf(ff(n,"content",i)),marks:bf(ff(n,"marks",i)),group:bf(ff(n,"group",i)),inline:bf(ff(n,"inline",i)),atom:bf(ff(n,"atom",i)),selectable:bf(ff(n,"selectable",i)),draggable:bf(ff(n,"draggable",i)),code:bf(ff(n,"code",i)),whitespace:bf(ff(n,"whitespace",i)),linebreakReplacement:bf(ff(n,"linebreakReplacement",i)),defining:bf(ff(n,"defining",i)),isolating:bf(ff(n,"isolating",i)),attrs:Object.fromEntries(o.map(t=>{var e,n;return[t.name,{default:null==(e=null==t?void 0:t.attribute)?void 0:e.default,validate:null==(n=null==t?void 0:t.attribute)?void 0:n.validate}]}))}),a=bf(ff(n,"parseHTML",i));a&&(s.parseDOM=a.map(t=>xf(t,o)));const l=ff(n,"renderHTML",i);l&&(s.toDOM=t=>l({node:t,HTMLAttributes:Sf(t,o)}));const c=ff(n,"renderText",i);return c&&(s.toText=c),[n.name,s]})),l=Object.fromEntries(i.map(n=>{const o=r.filter(t=>t.type===n.name),i={name:n.name,options:n.options,storage:n.storage,editor:e},s=Cf({...t.reduce((t,e)=>{const r=ff(e,"extendMarkSchema",i);return{...t,...r?r(n):{}}},{}),inclusive:bf(ff(n,"inclusive",i)),excludes:bf(ff(n,"excludes",i)),group:bf(ff(n,"group",i)),spanning:bf(ff(n,"spanning",i)),code:bf(ff(n,"code",i)),attrs:Object.fromEntries(o.map(t=>{var e,n;return[t.name,{default:null==(e=null==t?void 0:t.attribute)?void 0:e.default,validate:null==(n=null==t?void 0:t.attribute)?void 0:n.validate}]}))}),a=bf(ff(n,"parseHTML",i));a&&(s.parseDOM=a.map(t=>xf(t,o)));const l=ff(n,"renderHTML",i);return l&&(s.toDOM=t=>l({mark:t,HTMLAttributes:Sf(t,o)})),[n.name,s]}));return new Dl({topNode:s,nodes:a,marks:l})}function Ef(t){return t.sort((t,e)=>{const n=ff(t,"priority")||100,r=ff(e,"priority")||100;return n>r?-1:n<r?1:0})}function Tf(t){const e=Ef(mf(t)),n=function(t){const e=t.filter((e,n)=>t.indexOf(e)!==n);return Array.from(new Set(e))}(e.map(t=>t.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(t=>`'${t}'`).join(", ")}]. This can lead to issues.`),e}function Mf(t,e,n){const{from:r,to:o}=e,{blockSeparator:i="\n\n",textSerializers:s={}}=n||{};let a="";return t.nodesBetween(r,o,(t,n,l,c)=>{var d;t.isBlock&&n>r&&(a+=i);const u=null==s?void 0:s[t.type.name];if(u)return l&&(a+=u({node:t,pos:n,parent:l,index:c,range:e})),!1;t.isText&&(a+=null==(d=null==t?void 0:t.text)?void 0:d.slice(Math.max(r,n)-n,o-n))}),a}function Af(t,e){return Mf(t,{from:0,to:t.content.size},e)}function Of(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}function Df(t,e){if("string"==typeof t){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}function Rf(t,e){const n=Df(e,t.schema),{from:r,to:o,empty:i}=t.selection,s=[];i?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,o,t=>{s.push(...t.marks)});const a=s.find(t=>t.type.name===n.name);return a?{...a.attrs}:{}}function Lf(t,e){if("string"==typeof t){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function Nf(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function If(t,e){const n=Nf("string"==typeof e?e:e.name,t.schema);return"node"===n?function(t,e){const n=Lf(e,t.schema),{from:r,to:o}=t.selection,i=[];t.doc.nodesBetween(r,o,t=>{i.push(t)});const s=i.reverse().find(t=>t.type.name===n.name);return s?{...s.attrs}:{}}(t,e):"mark"===n?Rf(t,e):{}}function Pf(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((t,o)=>{const i=[];if(t.ranges.length)t.forEach((t,e)=>{i.push({from:t,to:e})});else{const{from:t,to:e}=n[o];if(void 0===t||void 0===e)return;i.push({from:t,to:e})}i.forEach(({from:t,to:n})=>{const i=e.slice(o).map(t,-1),s=e.slice(o).map(n),a=e.invert().map(i,-1),l=e.invert().map(s);r.push({oldRange:{from:a,to:l},newRange:{from:i,to:s}})})}),function(t){const e=function(t,e=JSON.stringify){const n={};return t.filter(t=>{const r=e(t);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)})}(t);return 1===e.length?e:e.filter((t,n)=>{const r=e.filter((t,e)=>e!==n);return!r.some(e=>t.oldRange.from>=e.oldRange.from&&t.oldRange.to<=e.oldRange.to&&t.newRange.from>=e.newRange.from&&t.newRange.to<=e.newRange.to)})}(r)}function $f(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function Hf(t,e,n={strict:!0}){const r=Object.keys(e);return!r.length||r.every(r=>n.strict?e[r]===t[r]:$f(e[r])?e[r].test(t[r]):e[r]===t[r])}function Bf(t,e,n={}){return t.find(t=>t.type===e&&Hf(Object.fromEntries(Object.keys(n).map(e=>[e,t.attrs[e]])),n))}function jf(t,e,n={}){return!!Bf(t,e,n)}function Uf(t,e,n){var r;if(!t||!e)return;let o=t.parent.childAfter(t.parentOffset);if(o.node&&o.node.marks.some(t=>t.type===e)||(o=t.parent.childBefore(t.parentOffset)),!o.node||!o.node.marks.some(t=>t.type===e))return;if(n=n||(null==(r=o.node.marks[0])?void 0:r.attrs),!Bf([...o.node.marks],e,n))return;let i=o.index,s=t.start()+o.offset,a=i+1,l=s+o.node.nodeSize;for(;i>0&&jf([...t.parent.child(i-1).marks],e,n);)i-=1,s-=t.parent.child(i).nodeSize;for(;a<t.parent.childCount&&jf([...t.parent.child(a).marks],e,n);)l+=t.parent.child(a).nodeSize,a+=1;return{from:s,to:l}}function Ff(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(e=>{const o=Uf(n.resolve(t),e.type);o&&r.push({mark:e,...o})}):n.nodesBetween(t,e,(t,e)=>{t&&void 0!==(null==t?void 0:t.nodeSize)&&r.push(...t.marks.map(n=>({from:e,to:e+t.nodeSize,mark:n})))}),r}function Vf(t,e){return e.nodes[t]||e.marks[t]||null}function zf(t,e,n){return Object.fromEntries(Object.entries(n).filter(([n])=>{const r=t.find(t=>t.type===e&&t.name===n);return!!r&&r.attribute.keepOnSplit}))}function Wf(t,e,n={}){const{empty:r,ranges:o}=t.selection,i=e?Df(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(t=>!i||i.name===t.type.name).find(t=>Hf(t.attrs,n,{strict:!1}));let s=0;const a=[];if(o.forEach(({$from:e,$to:n})=>{const r=e.pos,o=n.pos;t.doc.nodesBetween(r,o,(t,e)=>{if(!t.isText&&!t.marks.length)return;const n=Math.max(r,e),i=Math.min(o,e+t.nodeSize);s+=i-n,a.push(...t.marks.map(t=>({mark:t,from:n,to:i})))})}),0===s)return!1;const l=a.filter(t=>!i||i.name===t.mark.type.name).filter(t=>Hf(t.mark.attrs,n,{strict:!1})).reduce((t,e)=>t+e.to-e.from,0),c=a.filter(t=>!i||t.mark.type!==i&&t.mark.type.excludes(i)).reduce((t,e)=>t+e.to-e.from,0);return(l>0?l+c:l)>=s}function qf(t,e,n={}){const{from:r,to:o,empty:i}=t.selection,s=e?Lf(e,t.schema):null,a=[];t.doc.nodesBetween(r,o,(t,e)=>{if(t.isText)return;const n=Math.max(r,e),i=Math.min(o,e+t.nodeSize);a.push({node:t,from:n,to:i})});const l=o-r,c=a.filter(t=>!s||s.name===t.node.type.name).filter(t=>Hf(t.node.attrs,n,{strict:!1}));return i?!!c.length:c.reduce((t,e)=>t+e.to-e.from,0)>=l}function Kf(t,e){return Array.isArray(e)?e.some(e=>("string"==typeof e?e:e.name)===t.name):e}function Jf(t,e){const{nodeExtensions:n}=vf(e),r=n.find(e=>e.name===t);if(!r)return!1;const o=bf(ff(r,"group",{name:r.name,options:r.options,storage:r.storage}));return"string"==typeof o&&o.split(" ").includes("list")}function Gf(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if("hardBreak"===t.type.name)return!0;if(t.isText)return/^\s*$/m.test(null!=(r=t.text)?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(0===t.content.childCount)return!0;if(e){let r=!0;return t.content.forEach(t=>{!1!==r&&(Gf(t,{ignoreWhitespace:n,checkChildren:e})||(r=!1))}),r}return!1}function Yf(t){return t instanceof Wc}function Xf(t){return t instanceof Vc}function Qf(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Zf(t,e,n){const r=t.state.doc.content.size,o=Qf(e,0,r),i=Qf(n,0,r),s=t.coordsAtPos(o),a=t.coordsAtPos(i,-1),l=Math.min(s.top,a.top),c=Math.max(s.bottom,a.bottom),d=Math.min(s.left,a.left),u=Math.max(s.right,a.right),h={top:l,bottom:c,left:d,right:u,width:u-d,height:c-l,x:d,y:l};return{...h,toJSON:()=>h}}function tm(t,e=null){if(!e)return null;const n=Bc.atStart(t),r=Bc.atEnd(t);if("start"===e||!0===e)return n;if("end"===e)return r;const o=n.from,i=r.to;return"all"===e?Vc.create(t,Qf(0,o,i),Qf(t.content.size,o,i)):Vc.create(t,Qf(e,o,i),Qf(e,o,i))}var em=class{constructor(t){this.find=t.find,this.handler=t.handler}};function nm(t){var e;const{editor:n,from:r,to:o,text:i,rules:s,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(null==(e=c.nodeBefore||c.nodeAfter)?void 0:e.marks.find(t=>t.type.spec.code)))return!1;let d=!1;const u=((t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(t,e,o,i)=>{var s,a;const l=(null==(a=(s=t.type.spec).toText)?void 0:a.call(s,{node:t,pos:e,parent:o,index:i}))||t.textContent||"%leaf%";n+=t.isAtom&&!t.isText?l:l.slice(0,Math.max(0,r-e))}),n})(c)+i;return s.forEach(t=>{if(d)return;const e=((t,e)=>{if($f(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r})(u,t.find);if(!e)return;const s=l.state.tr,c=rf({state:l.state,transaction:s}),h={from:r-(e[0].length-i.length),to:o},{commands:p,chain:f,can:m}=new of({editor:n,state:c});null!==t.handler({state:c,range:h,match:e,commands:p,chain:f,can:m})&&s.steps.length&&(s.setMeta(a,{transform:s,from:r,to:o,text:i}),l.dispatch(s),d=!0)}),d}function rm(t){const{editor:e,rules:n}=t,r=new od({state:{init:()=>null,apply(t,o,i){const s=t.getMeta(r);if(s)return s;const a=t.getMeta("applyInputRules");return!!a&&setTimeout(()=>{let{text:t}=a;"string"==typeof t||(t=gf(Fa.from(t),i.schema));const{from:o}=a,s=o+t.length;nm({editor:e,from:o,to:s,text:t,rules:n,plugin:r})}),t.selectionSet||t.docChanged?null:o}},props:{handleTextInput:(t,o,i,s)=>nm({editor:e,from:o,to:i,text:s,rules:n,plugin:r}),handleDOMEvents:{compositionend:t=>(setTimeout(()=>{const{$cursor:o}=t.state.selection;o&&nm({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(t,o){if("Enter"!==o.key)return!1;const{$cursor:i}=t.state.selection;return!!i&&nm({editor:e,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:r})}},isInputRules:!0});return r}function om(t){return"Object"===function(t){return Object.prototype.toString.call(t).slice(8,-1)}(t)&&t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function im(t,e){const n={...t};return om(t)&&om(e)&&Object.keys(e).forEach(r=>{om(e[r])&&om(t[r])?n[r]=im(t[r],e[r]):n[r]=e[r]}),n}var sm=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...bf(ff(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...bf(ff(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>im(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},am=class t extends sm{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n="function"==typeof e?e():e;return new t(n)}static handleExit({editor:t,mark:e}){const{tr:n}=t.state,r=t.state.selection.$from;if(r.pos===r.end()){const o=r.marks();if(!o.find(t=>(null==t?void 0:t.type.name)===e.name))return!1;const i=o.find(t=>(null==t?void 0:t.type.name)===e.name);return i&&n.removeStoredMark(i),n.insertText(" ",r.pos),t.view.dispatch(n),!0}return!1}configure(t){return super.configure(t)}extend(t){const e="function"==typeof t?t():t;return super.extend(e)}},lm=class{constructor(t){this.find=t.find,this.handler=t.handler}};var cm=null;function dm(t){const{editor:e,rules:n}=t;let r,o=null,i=!1,s=!1,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{r="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{r=null}const l=({state:t,from:n,to:o,rule:i,pasteEvt:s})=>{const l=t.tr,c=rf({state:t,transaction:l});if(function(t){const{editor:e,state:n,from:r,to:o,rule:i,pasteEvent:s,dropEvent:a}=t,{commands:l,chain:c,can:d}=new of({editor:e,state:n}),u=[];return n.doc.nodesBetween(r,o,(t,e)=>{if(!t.isTextblock||t.type.spec.code)return;const h=Math.max(r,e),p=Math.min(o,e+t.content.size);((t,e,n)=>{if($f(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(e=>{const n=[e.text];return n.index=e.index,n.input=t,n.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(e.replaceWith)),n}):[]})(t.textBetween(h-e,p-e,void 0,""),i.find,s).forEach(t=>{if(void 0===t.index)return;const e=h+t.index+1,r=e+t[0].length,o={from:n.tr.mapping.map(e),to:n.tr.mapping.map(r)},p=i.handler({state:n,range:o,match:t,commands:l,chain:c,can:d,pasteEvent:s,dropEvent:a});u.push(p)})}),u.every(t=>null!==t)}({editor:e,state:c,from:Math.max(n-1,0),to:o.b-1,rule:i,pasteEvent:s,dropEvent:r})&&l.steps.length){try{r="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{r=null}return a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,l}};return n.map(t=>new od({view(t){const n=n=>{var r;o=(null==(r=t.dom.parentElement)?void 0:r.contains(n.target))?t.dom.parentElement:null,o&&(cm=e)},r=()=>{cm&&(cm=null)};return window.addEventListener("dragstart",n),window.addEventListener("dragend",r),{destroy(){window.removeEventListener("dragstart",n),window.removeEventListener("dragend",r)}}},props:{handleDOMEvents:{drop:(t,e)=>{if(s=o===t.dom.parentElement,r=e,!s){const t=cm;(null==t?void 0:t.isEditable)&&setTimeout(()=>{const e=t.state.selection;e&&t.commands.deleteRange({from:e.from,to:e.to})},10)}return!1},paste:(t,e)=>{var n;const r=null==(n=e.clipboardData)?void 0:n.getData("text/html");return a=e,i=!!(null==r?void 0:r.includes("data-pm-slice")),!1}}},appendTransaction:(e,n,r)=>{const o=e[0],c="paste"===o.getMeta("uiEvent")&&!i,d="drop"===o.getMeta("uiEvent")&&!s,u=o.getMeta("applyPasteRules"),h=!!u;if(!c&&!d&&!h)return;if(h){let{text:e}=u;"string"==typeof e||(e=gf(Fa.from(e),r.schema));const{from:n}=u,o=n+e.length,i=(t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null==(e=n.clipboardData)||e.setData("text/html",t),n})(e);return l({rule:t,state:r,from:n,to:{b:o},pasteEvt:i})}const p=n.doc.content.findDiffStart(r.doc.content),f=n.doc.content.findDiffEnd(r.doc.content);return"number"==typeof p&&f&&p!==f.b?l({rule:t,state:r,from:p,to:f,pasteEvt:a}):void 0}}))}var um=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=Tf(t),this.schema=_f(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n=ff(e,"addCommands",{name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Vf(e.name,this.schema)});return n?{...t,...n()}:t},{})}get plugins(){const{editor:t}=this,e=Ef([...this.extensions].reverse()),n=[],r=[],o=e.map(e=>{const o={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:t,type:Vf(e.name,this.schema)},i=[],s=ff(e,"addKeyboardShortcuts",o);let a={};if("mark"===e.type&&ff(e,"exitable",o)&&(a.ArrowRight=()=>am.handleExit({editor:t,mark:e})),s){const e=Object.fromEntries(Object.entries(s()).map(([e,n])=>[e,()=>n({editor:t})]));a={...a,...e}}const l=new od({props:{handleKeyDown:Ap(a)}});i.push(l);const c=ff(e,"addInputRules",o);Kf(e,t.options.enableInputRules)&&c&&n.push(...c());const d=ff(e,"addPasteRules",o);Kf(e,t.options.enablePasteRules)&&d&&r.push(...d());const u=ff(e,"addProseMirrorPlugins",o);if(u){const t=u();i.push(...t)}return i}).flat();return[rm({editor:t,rules:n}),...dm({editor:t,rules:r}),...o]}get attributes(){return wf(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=vf(this.extensions);return Object.fromEntries(e.filter(t=>!!ff(t,"addNodeView")).map(e=>{const n=this.attributes.filter(t=>t.type===e.name),r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:t,type:Lf(e.name,this.schema)},o=ff(e,"addNodeView",r);return o?[e.name,(r,i,s,a,l)=>{const c=Sf(r,n);return o()({node:r,view:i,getPos:s,decorations:a,innerDecorations:l,editor:t,extension:e,HTMLAttributes:c})}]:[]}))}get markViews(){const{editor:t}=this,{markExtensions:e}=vf(this.extensions);return Object.fromEntries(e.filter(t=>!!ff(t,"addMarkView")).map(e=>{const n=this.attributes.filter(t=>t.type===e.name),r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:t,type:Df(e.name,this.schema)},o=ff(e,"addMarkView",r);return o?[e.name,(r,i,s)=>{const a=Sf(r,n);return o()({mark:r,view:i,inline:s,editor:t,extension:e,HTMLAttributes:a})}]:[]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(t=>[t.name,t.storage])),t.forEach(t=>{var e;const n={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:Vf(t.name,this.schema)};"mark"===t.type&&(null==(e=bf(ff(t,"keepOnSplit",n)))||e)&&this.splittableMarks.push(t.name);const r=ff(t,"onBeforeCreate",n),o=ff(t,"onCreate",n),i=ff(t,"onUpdate",n),s=ff(t,"onSelectionUpdate",n),a=ff(t,"onTransaction",n),l=ff(t,"onFocus",n),c=ff(t,"onBlur",n),d=ff(t,"onDestroy",n);r&&this.editor.on("beforeCreate",r),o&&this.editor.on("create",o),i&&this.editor.on("update",i),s&&this.editor.on("selectionUpdate",s),a&&this.editor.on("transaction",a),l&&this.editor.on("focus",l),c&&this.editor.on("blur",c),d&&this.editor.on("destroy",d)})}};um.resolve=Tf,um.sort=Ef,um.flatten=mf,(0,$a.VA)({},{ClipboardTextSerializer:()=>pm,Commands:()=>_g,Delete:()=>Eg,Drop:()=>Tg,Editable:()=>Mg,FocusEvents:()=>Og,Keymap:()=>Dg,Paste:()=>Rg,Tabindex:()=>Lg,focusEventsPluginKey:()=>Ag});var hm=class t extends sm{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n="function"==typeof e?e():e;return new t(n)}configure(t){return super.configure(t)}extend(t){const e="function"==typeof t?t():t;return super.extend(e)}},pm=hm.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new od({key:new ad("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:o}=e,{ranges:i}=o,s=Math.min(...i.map(t=>t.$from.pos)),a=Math.max(...i.map(t=>t.$to.pos)),l=Of(n);return Mf(r,{from:s,to:a},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),fm={};(0,$a.VA)(fm,{blur:()=>mm,clearContent:()=>gm,clearNodes:()=>ym,command:()=>bm,createParagraphNear:()=>vm,cut:()=>wm,deleteCurrentNode:()=>km,deleteNode:()=>Sm,deleteRange:()=>xm,deleteSelection:()=>Cm,enter:()=>_m,exitCode:()=>Em,extendMarkRange:()=>Tm,first:()=>Mm,focus:()=>Om,forEach:()=>Dm,insertContent:()=>Rm,insertContentAt:()=>Lm,joinBackward:()=>Pm,joinDown:()=>Im,joinForward:()=>$m,joinItemBackward:()=>Hm,joinItemForward:()=>Bm,joinTextblockBackward:()=>jm,joinTextblockForward:()=>Um,joinUp:()=>Nm,keyboardShortcut:()=>Vm,lift:()=>zm,liftEmptyBlock:()=>Wm,liftListItem:()=>qm,newlineInCode:()=>Km,resetAttributes:()=>Gm,scrollIntoView:()=>Ym,selectAll:()=>Xm,selectNodeBackward:()=>Qm,selectNodeForward:()=>Zm,selectParentNode:()=>tg,selectTextblockEnd:()=>eg,selectTextblockStart:()=>ng,setContent:()=>rg,setMark:()=>og,setMeta:()=>ig,setNode:()=>sg,setNodeSelection:()=>ag,setTextSelection:()=>lg,sinkListItem:()=>cg,splitBlock:()=>ug,splitListItem:()=>hg,toggleList:()=>mg,toggleMark:()=>gg,toggleNode:()=>yg,toggleWrap:()=>bg,undoInputRule:()=>vg,unsetAllMarks:()=>wg,unsetMark:()=>kg,updateAttributes:()=>Sg,wrapIn:()=>xg,wrapInList:()=>Cg});var mm=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),null==(n=null==window?void 0:window.getSelection())||n.removeAllRanges())}),!0),gm=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),ym=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:o}=r;return!n||(o.forEach(({$from:n,$to:r})=>{t.doc.nodesBetween(n.pos,r.pos,(t,n)=>{if(t.type.isText)return;const{doc:r,mapping:o}=e,i=r.resolve(o.map(n)),s=r.resolve(o.map(n+t.nodeSize)),a=i.blockRange(s);if(!a)return;const l=pc(a);if(t.type.isTextblock){const{defaultType:t}=i.parent.contentMatchAt(i.index());e.setNodeMarkup(a.start,t)}(l||0===l)&&e.lift(a,l)})}),!0)},bm=t=>e=>t(e),vm=()=>({state:t,dispatch:e})=>zp(t,e),wm=(t,e)=>({editor:n,tr:r})=>{const{state:o}=n,i=o.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const s=r.mapping.map(e);return r.insert(s,i.content),r.setSelection(new Vc(r.doc.resolve(Math.max(s-1,0)))),!0},km=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const o=t.selection.$anchor;for(let n=o.depth;n>0;n-=1)if(o.node(n).type===r.type){if(e){const e=o.before(n),r=o.after(n);t.delete(e,r).scrollIntoView()}return!0}return!1},Sm=t=>({tr:e,state:n,dispatch:r})=>{const o=Lf(t,n.schema),i=e.selection.$anchor;for(let t=i.depth;t>0;t-=1)if(i.node(t).type===o){if(r){const n=i.before(t),r=i.after(t);e.delete(n,r).scrollIntoView()}return!0}return!1},xm=t=>({tr:e,dispatch:n})=>{const{from:r,to:o}=t;return n&&e.delete(r,o),!0},Cm=()=>({state:t,dispatch:e})=>Op(t,e),_m=()=>({commands:t})=>t.keyboardShortcut("Enter"),Em=()=>({state:t,dispatch:e})=>Vp(t,e),Tm=(t,e={})=>({tr:n,state:r,dispatch:o})=>{const i=Df(t,r.schema),{doc:s,selection:a}=n,{$from:l,from:c,to:d}=a;if(o){const t=Uf(l,i,e);if(t&&t.from<=c&&t.to>=d){const e=Vc.create(s,t.from,t.to);n.setSelection(e)}}return!0},Mm=t=>e=>{const n="function"==typeof t?t(e):t;for(let t=0;t<n.length;t+=1)if(n[t](e))return!0;return!1};function Am(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Om=(t=null,e={})=>({editor:n,view:r,tr:o,dispatch:i})=>{e={scrollIntoView:!0,...e};const s=()=>{(Am()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),(null==e?void 0:e.scrollIntoView)&&n.commands.scrollIntoView())})};if(r.hasFocus()&&null===t||!1===t)return!0;if(i&&null===t&&!Xf(n.state.selection))return s(),!0;const a=tm(o.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||o.setSelection(a),l&&o.storedMarks&&o.setStoredMarks(o.storedMarks),s()),!0},Dm=(t,e)=>n=>t.every((t,r)=>e(t,{...n,index:r})),Rm=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),Lm=(t,e,n)=>({tr:r,dispatch:o,editor:i})=>{var s;if(o){let o;n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};const{selection:a}=i.state,l=t=>{i.emit("contentError",{editor:i,error:t,disableCollaboration:()=>{"collaboration"in i.storage&&"object"==typeof i.storage.collaboration&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{df(e,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(t){l(t)}try{o=df(e,i.schema,{parseOptions:c,errorOnInvalidContent:null!=(s=n.errorOnInvalidContent)?s:i.options.enableContentCheck})}catch(t){return l(t),!1}let d,{from:u,to:h}="number"==typeof t?{from:t,to:t}:{from:t.from,to:t.to},p=!0,f=!0;if(("type"in o?[o]:o).forEach(t=>{t.check(),p=!!p&&t.isText&&0===t.marks.length,f=!!f&&t.isBlock}),u===h&&f){const{parent:t}=r.doc.resolve(u);t.isTextblock&&!t.type.spec.code&&!t.childCount&&(u-=1,h+=1)}if(p){if(Array.isArray(e))d=e.map(t=>t.text||"").join("");else if(e instanceof Fa){let t="";e.forEach(e=>{e.text&&(t+=e.text)}),d=t}else d="object"==typeof e&&e&&e.text?e.text:e;r.insertText(d,u,h)}else{d=o;const t=0===a.$from.parentOffset,e=a.$from.node().isText||a.$from.node().isTextblock,n=a.$from.node().content.size>0;t&&e&&n&&(u=Math.max(0,u-1)),r.replaceWith(u,h,d)}n.updateSelection&&function(t,e){const n=t.steps.length-1;if(n<e)return;const r=t.steps[n];if(!(r instanceof lc||r instanceof cc))return;const o=t.mapping.maps[n];let i=0;o.forEach((t,e,n,r)=>{0===i&&(i=r)}),t.setSelection(Bc.near(t.doc.resolve(i),-1))}(r,r.steps.length-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:d}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:d})}return!0},Nm=()=>({state:t,dispatch:e})=>((t,e)=>{let n,r=t.selection,o=r instanceof Wc;if(o){if(r.node.isTextblock||!vc(t.doc,r.from))return!1;n=r.from}else if(n=kc(t.doc,r.from,-1),null==n)return!1;if(e){let r=t.tr.join(n);o&&r.setSelection(Wc.create(r.doc,n-t.doc.resolve(n).nodeBefore.nodeSize)),e(r.scrollIntoView())}return!0})(t,e),Im=()=>({state:t,dispatch:e})=>((t,e)=>{let n,r=t.selection;if(r instanceof Wc){if(r.node.isTextblock||!vc(t.doc,r.to))return!1;n=r.to}else if(n=kc(t.doc,r.to,1),null==n)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0})(t,e),Pm=()=>({state:t,dispatch:e})=>Rp(t,e),$m=()=>({state:t,dispatch:e})=>Hp(t,e),Hm=()=>({state:t,dispatch:e,tr:n})=>{try{const r=kc(t.doc,t.selection.$from.pos,-1);return null!=r&&(n.join(r,2),e&&e(n),!0)}catch{return!1}},Bm=()=>({state:t,dispatch:e,tr:n})=>{try{const r=kc(t.doc,t.selection.$from.pos,1);return null!=r&&(n.join(r,2),e&&e(n),!0)}catch{return!1}},jm=()=>({state:t,dispatch:e})=>((t,e)=>{let n=Dp(t,void 0);if(!n)return!1;let r=Pp(n);return!!r&&Lp(t,r,e)})(t,e),Um=()=>({state:t,dispatch:e})=>((t,e)=>{let n=$p(t,void 0);if(!n)return!1;let r=jp(n);return!!r&&Lp(t,r,e)})(t,e);function Fm(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var Vm=t=>({editor:e,view:n,tr:r,dispatch:o})=>{const i=function(t){const e=t.split(/-(?!$)/);let n,r,o,i,s=e[e.length-1];"Space"===s&&(s=" ");for(let t=0;t<e.length-1;t+=1){const s=e[t];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))n=!0;else if(/^(c|ctrl|control)$/i.test(s))r=!0;else if(/^s(hift)?$/i.test(s))o=!0;else{if(!/^mod$/i.test(s))throw new Error(`Unrecognized modifier name: ${s}`);Am()||Fm()?i=!0:r=!0}}return n&&(s=`Alt-${s}`),r&&(s=`Ctrl-${s}`),i&&(s=`Meta-${s}`),o&&(s=`Shift-${s}`),s}(t).split(/-(?!$)/),s=i.find(t=>!["Alt","Ctrl","Meta","Shift"].includes(t)),a=new KeyboardEvent("keydown",{key:"Space"===s?" ":s,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",t=>t(n,a))});return null==l||l.steps.forEach(t=>{const e=t.map(r.mapping);e&&o&&r.maybeStep(e)}),!0},zm=(t,e={})=>({state:n,dispatch:r})=>!!qf(n,Lf(t,n.schema),e)&&((t,e)=>{let{$from:n,$to:r}=t.selection,o=n.blockRange(r),i=o&&pc(o);return null!=i&&(e&&e(t.tr.lift(o,i).scrollIntoView()),!0)})(n,r),Wm=()=>({state:t,dispatch:e})=>Wp(t,e),qm=t=>({state:e,dispatch:n})=>{return(r=Lf(t,e.schema),function(t,e){let{$from:n,$to:o}=t.selection,i=n.blockRange(o,t=>t.childCount>0&&t.firstChild.type==r);return!!i&&(!e||(n.node(i.depth-1).type==r?function(t,e,n,r){let o=t.tr,i=r.end,s=r.$to.end(r.depth);i<s&&(o.step(new cc(i-1,s,i,s,new Ja(Fa.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new dl(o.doc.resolve(r.$from.pos),o.doc.resolve(s),r.depth));const a=pc(r);if(null==a)return!1;o.lift(r,a);let l=o.doc.resolve(o.mapping.map(i,-1)-1);return vc(o.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&o.join(l.pos),e(o.scrollIntoView()),!0}(t,e,r,i):function(t,e,n){let r=t.tr,o=n.parent;for(let t=n.end,e=n.endIndex-1,i=n.startIndex;e>i;e--)t-=o.child(e).nodeSize,r.delete(t-1,t+1);let i=r.doc.resolve(n.start),s=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==o.childCount,c=i.node(-1),d=i.index(-1);if(!c.canReplace(d+(a?0:1),d+1,s.content.append(l?Fa.empty:Fa.from(o))))return!1;let u=i.pos,h=u+s.nodeSize;return r.step(new cc(u-(a?1:0),h+(l?1:0),u+1,h-1,new Ja((a?Fa.empty:Fa.from(o.copy(Fa.empty))).append(l?Fa.empty:Fa.from(o.copy(Fa.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}(t,e,i)))})(e,n);var r},Km=()=>({state:t,dispatch:e})=>Up(t,e);function Jm(t,e){const n="string"==typeof e?[e]:e;return Object.keys(t).reduce((e,r)=>(n.includes(r)||(e[r]=t[r]),e),{})}var Gm=(t,e)=>({tr:n,state:r,dispatch:o})=>{let i=null,s=null;const a=Nf("string"==typeof t?t:t.name,r.schema);return!!a&&("node"===a&&(i=Lf(t,r.schema)),"mark"===a&&(s=Df(t,r.schema)),o&&n.selection.ranges.forEach(t=>{r.doc.nodesBetween(t.$from.pos,t.$to.pos,(t,r)=>{i&&i===t.type&&n.setNodeMarkup(r,void 0,Jm(t.attrs,e)),s&&t.marks.length&&t.marks.forEach(o=>{s===o.type&&n.addMark(r,r+t.nodeSize,s.create(Jm(o.attrs,e)))})})}),!0)},Ym=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Xm=()=>({tr:t,dispatch:e})=>{if(e){const e=new Kc(t.doc);t.setSelection(e)}return!0},Qm=()=>({state:t,dispatch:e})=>Ip(t,e),Zm=()=>({state:t,dispatch:e})=>Bp(t,e),tg=()=>({state:t,dispatch:e})=>((t,e)=>{let n,{$from:r,to:o}=t.selection,i=r.sharedDepth(o);return 0!=i&&(n=r.before(i),e&&e(t.tr.setSelection(Wc.create(t.doc,n))),!0)})(t,e),eg=()=>({state:t,dispatch:e})=>Yp(t,e),ng=()=>({state:t,dispatch:e})=>Gp(t,e),rg=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:o,tr:i,dispatch:s,commands:a})=>{const{doc:l}=i;if("full"!==r.preserveWhitespace){const a=uf(t,o.schema,r,{errorOnInvalidContent:null!=e?e:o.options.enableContentCheck});return s&&i.replaceWith(0,l.content.size,a).setMeta("preventUpdate",!n),!0}return s&&i.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:r,errorOnInvalidContent:null!=e?e:o.options.enableContentCheck})},og=(t,e={})=>({tr:n,state:r,dispatch:o})=>{const{selection:i}=n,{empty:s,ranges:a}=i,l=Df(t,r.schema);if(o)if(s){const t=Rf(r,l);n.addStoredMark(l.create({...t,...e}))}else a.forEach(t=>{const o=t.$from.pos,i=t.$to.pos;r.doc.nodesBetween(o,i,(t,r)=>{const s=Math.max(r,o),a=Math.min(r+t.nodeSize,i);t.marks.find(t=>t.type===l)?t.marks.forEach(t=>{l===t.type&&n.addMark(s,a,l.create({...t.attrs,...e}))}):n.addMark(s,a,l.create(e))})});return function(t,e,n){var r;const{selection:o}=e;let i=null;if(Xf(o)&&(i=o.$cursor),i){const e=null!=(r=t.storedMarks)?r:i.marks();return!!n.isInSet(e)||!e.some(t=>t.type.excludes(n))}const{ranges:s}=o;return s.some(({$from:e,$to:r})=>{let o=0===e.depth&&t.doc.inlineContent&&t.doc.type.allowsMarkType(n);return t.doc.nodesBetween(e.pos,r.pos,(t,e,r)=>{if(o)return!1;if(t.isInline){const e=!r||r.type.allowsMarkType(n),i=!!n.isInSet(t.marks)||!t.marks.some(t=>t.type.excludes(n));o=e&&i}return!o}),o})}(r,n,l)},ig=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),sg=(t,e={})=>({state:n,dispatch:r,chain:o})=>{const i=Lf(t,n.schema);let s;return n.selection.$anchor.sameParent(n.selection.$head)&&(s=n.selection.$anchor.parent.attrs),i.isTextblock?o().command(({commands:t})=>!!Xp(i,{...s,...e})(n)||t.clearNodes()).command(({state:t})=>Xp(i,{...s,...e})(t,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},ag=t=>({tr:e,dispatch:n})=>{if(n){const{doc:n}=e,r=Qf(t,0,n.content.size),o=Wc.create(n,r);e.setSelection(o)}return!0},lg=t=>({tr:e,dispatch:n})=>{if(n){const{doc:n}=e,{from:r,to:o}="number"==typeof t?{from:t,to:t}:t,i=Vc.atStart(n).from,s=Vc.atEnd(n).to,a=Qf(r,i,s),l=Qf(o,i,s),c=Vc.create(n,a,l);e.setSelection(c)}return!0},cg=t=>({state:e,dispatch:n})=>{const r=Lf(t,e.schema);return(o=r,function(t,e){let{$from:n,$to:r}=t.selection,i=n.blockRange(r,t=>t.childCount>0&&t.firstChild.type==o);if(!i)return!1;let s=i.startIndex;if(0==s)return!1;let a=i.parent,l=a.child(s-1);if(l.type!=o)return!1;if(e){let n=l.lastChild&&l.lastChild.type==a.type,r=Fa.from(n?o.create():null),s=new Ja(Fa.from(o.create(null,Fa.from(a.type.create(null,r)))),n?3:1,0),c=i.start,d=i.end;e(t.tr.step(new cc(c-(n?3:1),d,c,d,s,1,!0)).scrollIntoView())}return!0})(e,n);var o};function dg(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(t=>null==e?void 0:e.includes(t.type.name));t.tr.ensureMarks(r)}}var ug=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:o})=>{const{selection:i,doc:s}=e,{$from:a,$to:l}=i,c=zf(o.extensionManager.attributes,a.node().type.name,a.node().attrs);if(i instanceof Wc&&i.node.isBlock)return!(!a.parentOffset||!bc(s,a.pos)||(r&&(t&&dg(n,o.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),0));if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,u=0===a.depth?void 0:function(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=d&&u?[{type:u,attrs:c}]:void 0,p=bc(e.doc,e.mapping.map(a.pos),1,h);if(h||p||!bc(e.doc,e.mapping.map(a.pos),1,u?[{type:u}]:void 0)||(p=!0,h=u?[{type:u,attrs:c}]:void 0),r){if(p&&(i instanceof Vc&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),u&&!d&&!a.parentOffset&&a.parent.type!==u)){const t=e.mapping.map(a.before()),n=e.doc.resolve(t);a.node(-1).canReplaceWith(n.index(),n.index()+1,u)&&e.setNodeMarkup(e.mapping.map(a.before()),u)}t&&dg(n,o.extensionManager.splittableMarks),e.scrollIntoView()}return p},hg=(t,e={})=>({tr:n,state:r,dispatch:o,editor:i})=>{var s;const a=Lf(t,r.schema),{$from:l,$to:c}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(c))return!1;const u=l.node(-1);if(u.type!==a)return!1;const h=i.extensionManager.attributes;if(0===l.parent.content.size&&l.node(-1).childCount===l.indexAfter(-1)){if(2===l.depth||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(o){let t=Fa.empty;const r=l.index(-1)?1:l.index(-2)?2:3;for(let e=l.depth-r;e>=l.depth-3;e-=1)t=Fa.from(l.node(e).copy(t));const o=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,i={...zf(h,l.node().type.name,l.node().attrs),...e},c=(null==(s=a.contentMatch.defaultType)?void 0:s.createAndFill(i))||void 0;t=t.append(Fa.from(a.createAndFill(null,c)||void 0));const d=l.before(l.depth-(r-1));n.replace(d,l.after(-o),new Ja(t,4-r,0));let u=-1;n.doc.nodesBetween(d,n.doc.content.size,(t,e)=>{if(u>-1)return!1;t.isTextblock&&0===t.content.size&&(u=e+1)}),u>-1&&n.setSelection(Vc.near(n.doc.resolve(u))),n.scrollIntoView()}return!0}const p=c.pos===l.end()?u.contentMatchAt(0).defaultType:null,f={...zf(h,u.type.name,u.attrs),...e},m={...zf(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const g=p?[{type:a,attrs:f},{type:p,attrs:m}]:[{type:a,attrs:f}];if(!bc(n.doc,l.pos,2))return!1;if(o){const{selection:t,storedMarks:e}=r,{splittableMarks:s}=i.extensionManager,a=e||t.$to.parentOffset&&t.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!a||!o)return!0;const c=a.filter(t=>s.includes(t.type.name));n.ensureMarks(c)}return!0},pg=(t,e)=>{const n=pf(t=>t.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;const o=t.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!vc(t.doc,n.pos)||(t.join(n.pos),!0)},fg=(t,e)=>{const n=pf(t=>t.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;const o=t.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!vc(t.doc,r)||(t.join(r),!0)},mg=(t,e,n,r={})=>({editor:o,tr:i,state:s,dispatch:a,chain:l,commands:c,can:d})=>{const{extensions:u,splittableMarks:h}=o.extensionManager,p=Lf(t,s.schema),f=Lf(e,s.schema),{selection:m,storedMarks:g}=s,{$from:y,$to:b}=m,v=y.blockRange(b),w=g||m.$to.parentOffset&&m.$from.marks();if(!v)return!1;const k=pf(t=>Jf(t.type.name,u))(m);if(v.depth>=1&&k&&v.depth-k.depth<=1){if(k.node.type===p)return c.liftListItem(f);if(Jf(k.node.type.name,u)&&p.validContent(k.node.content)&&a)return l().command(()=>(i.setNodeMarkup(k.pos,p),!0)).command(()=>pg(i,p)).command(()=>fg(i,p)).run()}return n&&w&&a?l().command(()=>{const t=d().wrapInList(p,r),e=w.filter(t=>h.includes(t.type.name));return i.ensureMarks(e),!!t||c.clearNodes()}).wrapInList(p,r).command(()=>pg(i,p)).command(()=>fg(i,p)).run():l().command(()=>!!d().wrapInList(p,r)||c.clearNodes()).wrapInList(p,r).command(()=>pg(i,p)).command(()=>fg(i,p)).run()},gg=(t,e={},n={})=>({state:r,commands:o})=>{const{extendEmptyMarkRange:i=!1}=n,s=Df(t,r.schema);return Wf(r,s,e)?o.unsetMark(s,{extendEmptyMarkRange:i}):o.setMark(s,e)},yg=(t,e,n={})=>({state:r,commands:o})=>{const i=Lf(t,r.schema),s=Lf(e,r.schema),a=qf(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?o.setNode(s,l):o.setNode(i,{...l,...n})},bg=(t,e={})=>({state:n,commands:r})=>{const o=Lf(t,n.schema);return qf(n,o,e)?r.lift(o):r.wrapIn(o,e)},vg=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const o=n[r];let i;if(o.spec.isInputRules&&(i=o.getState(t))){if(e){const e=t.tr,n=i.transform;for(let t=n.steps.length-1;t>=0;t-=1)e.step(n.steps[t].invert(n.docs[t]));if(i.text){const n=e.doc.resolve(i.from).marks();e.replaceWith(i.from,i.to,t.schema.text(i.text,n))}else e.delete(i.from,i.to)}return!0}}return!1},wg=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:o}=n;return r||e&&o.forEach(e=>{t.removeMark(e.$from.pos,e.$to.pos)}),!0},kg=(t,e={})=>({tr:n,state:r,dispatch:o})=>{var i;const{extendEmptyMarkRange:s=!1}=e,{selection:a}=n,l=Df(t,r.schema),{$from:c,empty:d,ranges:u}=a;if(!o)return!0;if(d&&s){let{from:t,to:e}=a;const r=null==(i=c.marks().find(t=>t.type===l))?void 0:i.attrs,o=Uf(c,l,r);o&&(t=o.from,e=o.to),n.removeMark(t,e,l)}else u.forEach(t=>{n.removeMark(t.$from.pos,t.$to.pos,l)});return n.removeStoredMark(l),!0},Sg=(t,e={})=>({tr:n,state:r,dispatch:o})=>{let i=null,s=null;const a=Nf("string"==typeof t?t:t.name,r.schema);return!!a&&("node"===a&&(i=Lf(t,r.schema)),"mark"===a&&(s=Df(t,r.schema)),o&&n.selection.ranges.forEach(t=>{const o=t.$from.pos,a=t.$to.pos;let l,c,d,u;n.selection.empty?r.doc.nodesBetween(o,a,(t,e)=>{i&&i===t.type&&(d=Math.max(e,o),u=Math.min(e+t.nodeSize,a),l=e,c=t)}):r.doc.nodesBetween(o,a,(t,r)=>{r<o&&i&&i===t.type&&(d=Math.max(r,o),u=Math.min(r+t.nodeSize,a),l=r,c=t),r>=o&&r<=a&&(i&&i===t.type&&n.setNodeMarkup(r,void 0,{...t.attrs,...e}),s&&t.marks.length&&t.marks.forEach(i=>{if(s===i.type){const l=Math.max(r,o),c=Math.min(r+t.nodeSize,a);n.addMark(l,c,s.create({...i.attrs,...e}))}}))}),c&&(void 0!==l&&n.setNodeMarkup(l,void 0,{...c.attrs,...e}),s&&c.marks.length&&c.marks.forEach(t=>{s===t.type&&n.addMark(d,u,s.create({...t.attrs,...e}))}))}),!0)},xg=(t,e={})=>({state:n,dispatch:r})=>function(t,e=null){return function(n,r){let{$from:o,$to:i}=n.selection,s=o.blockRange(i),a=s&&fc(s,t,e);return!!a&&(r&&r(n.tr.wrap(s,a).scrollIntoView()),!0)}}(Lf(t,n.schema),e)(n,r),Cg=(t,e={})=>({state:n,dispatch:r})=>function(t,e=null){return function(n,r){let{$from:o,$to:i}=n.selection,s=o.blockRange(i);if(!s)return!1;let a=r?n.tr:null;return!!function(t,e,n,r=null){let o=!1,i=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&0==e.startIndex){if(0==e.$from.index(e.depth-1))return!1;let t=s.resolve(e.start-2);i=new dl(t,t,e.depth),e.endIndex<e.parent.childCount&&(e=new dl(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),o=!0}let a=fc(i,n,r,e);return!!a&&(t&&function(t,e,n,r,o){let i=Fa.empty;for(let t=n.length-1;t>=0;t--)i=Fa.from(n[t].type.create(n[t].attrs,i));t.step(new cc(e.start-(r?2:0),e.end,e.start,e.end,new Ja(i,0,0),n.length,!0));let s=0;for(let t=0;t<n.length;t++)n[t].type==o&&(s=t+1);let a=n.length-s,l=e.start+n.length-(r?2:0),c=e.parent;for(let n=e.startIndex,r=e.endIndex,o=!0;n<r;n++,o=!1)!o&&bc(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(n).nodeSize}(t,e,a,o,n),!0)}(a,s,t,e)&&(r&&r(a.scrollIntoView()),!0)}}(Lf(t,n.schema),e)(n,r),_g=hm.create({name:"commands",addCommands:()=>({...fm})}),Eg=hm.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,o;const i=()=>{var n,r,o,i;if(null!=(i=null==(o=null==(r=null==(n=this.editor.options.coreExtensionOptions)?void 0:n.delete)?void 0:r.filterTransaction)?void 0:o.call(r,t))?i:t.getMeta("y-sync$"))return;const s=af(t.before,[t,...e]);Pf(s).forEach(e=>{s.mapping.mapResult(e.oldRange.from).deletedAfter&&s.mapping.mapResult(e.oldRange.to).deletedBefore&&s.before.nodesBetween(e.oldRange.from,e.oldRange.to,(n,r)=>{const o=r+n.nodeSize-2,i=e.oldRange.from<=r&&o<=e.oldRange.to;this.editor.emit("delete",{type:"node",node:n,from:r,to:o,newFrom:s.mapping.map(r),newTo:s.mapping.map(o),deletedRange:e.oldRange,newRange:e.newRange,partial:!i,editor:this.editor,transaction:t,combinedTransform:s})})});const a=s.mapping;s.steps.forEach((e,n)=>{var r,o;if(e instanceof ic){const i=a.slice(n).map(e.from,-1),l=a.slice(n).map(e.to),c=a.invert().map(i,-1),d=a.invert().map(l),u=null==(r=s.doc.nodeAt(i-1))?void 0:r.marks.some(t=>t.eq(e.mark)),h=null==(o=s.doc.nodeAt(l))?void 0:o.marks.some(t=>t.eq(e.mark));this.editor.emit("delete",{type:"mark",mark:e.mark,from:e.from,to:e.to,deletedRange:{from:c,to:d},newRange:{from:i,to:l},partial:Boolean(h||u),editor:this.editor,transaction:t,combinedTransform:s})}})};null==(o=null==(r=null==(n=this.editor.options.coreExtensionOptions)?void 0:n.delete)?void 0:r.async)||o?setTimeout(i,0):i()}}),Tg=hm.create({name:"drop",addProseMirrorPlugins(){return[new od({key:new ad("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),Mg=hm.create({name:"editable",addProseMirrorPlugins(){return[new od({key:new ad("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Ag=new ad("focusEvents"),Og=hm.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new od({key:Ag,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),Dg=hm.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:t})=>[()=>t.undoInputRule(),()=>t.command(({tr:e})=>{const{selection:n,doc:r}=e,{empty:o,$anchor:i}=n,{pos:s,parent:a}=i,l=i.parent.isTextblock&&s>0?e.doc.resolve(s-1):i,c=l.parent.type.spec.isolating,d=i.pos-i.parentOffset,u=c&&1===l.parent.childCount?d===i.pos:Bc.atStart(r).from===s;return!(!o||!a.type.isTextblock||a.textContent.length||!u||u&&"paragraph"===i.parent.type.name)&&t.clearNodes()}),()=>t.deleteSelection(),()=>t.joinBackward(),()=>t.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:t})=>[()=>t.deleteSelection(),()=>t.deleteCurrentNode(),()=>t.joinForward(),()=>t.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:t})=>[()=>t.newlineInCode(),()=>t.createParagraphNear(),()=>t.liftEmptyBlock(),()=>t.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},r={...n},o={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Am()||Fm()?o:r},addProseMirrorPlugins(){return[new od({key:new ad("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(t=>t.getMeta("composition")))return;const r=t.some(t=>t.docChanged)&&!e.doc.eq(n.doc),o=t.some(t=>t.getMeta("preventClearDocument"));if(!r||o)return;const{empty:i,from:s,to:a}=e.selection,l=Bc.atStart(e.doc).from,c=Bc.atEnd(e.doc).to;if(i||s!==l||a!==c)return;if(!Gf(n.doc))return;const d=n.tr,u=rf({state:n,transaction:d}),{commands:h}=new of({editor:this.editor,state:u});return h.clearNodes(),d.steps.length?d:void 0}})]}}),Rg=hm.create({name:"paste",addProseMirrorPlugins(){return[new od({key:new ad("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),Lg=hm.create({name:"tabindex",addProseMirrorPlugins(){return[new od({key:new ad("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),Ng=class t{constructor(t,e,n=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=t,this.editor=e,this.currentNode=r}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return null!=(t=this.actualDepth)?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let e=this.from,n=this.to;if(this.isBlock){if(0===this.content.size)return void console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);e=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:e,to:n},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(0===this.depth)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new t(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new t(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new t(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const o=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,s=this.pos+r+(i?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(s);if(!o&&a.depth<=this.depth)return;const l=new t(a,this.editor,o,o?n:null);o&&(l.actualDepth=this.depth+1),e.push(new t(a,this.editor,o,o?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,e={}){let n=null,r=this.parent;for(;r&&!n;){if(r.node.type.name===t)if(Object.keys(e).length>0){const t=r.node.attrs,n=Object.keys(e);for(let r=0;r<n.length;r+=1){const o=n[r];if(t[o]!==e[o])break}}else n=r;r=r.parent}return n}querySelector(t,e={}){return this.querySelectorAll(t,e,!0)[0]||null}querySelectorAll(t,e={},n=!1){let r=[];if(!this.children||0===this.children.length)return r;const o=Object.keys(e);return this.children.forEach(i=>{n&&r.length>0||(i.node.type.name===t&&o.every(t=>e[t]===i.node.attrs[t])&&r.push(i),n&&r.length>0||(r=r.concat(i.querySelectorAll(t,e,n))))}),r}setAttribute(t){const{tr:e}=this.editor.state;e.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(e)}},Ig=class extends sf{constructor(t={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:"undefined"!=typeof document?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,enableDevTools:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:t,slice:e,moved:n})=>this.options.onDrop(t,e,n)),this.on("paste",({event:t,slice:e})=>this.options.onPaste(t,e)),this.on("delete",this.options.onDelete);const e=this.createDoc(),n=tm(e,this.options.autofocus);this.editorState=nd.create({doc:e,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if("undefined"==typeof document)throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){var t;if(this.editorView){const t=this.editorView.dom;(null==t?void 0:t.editor)&&delete t.editor,this.editorView.destroy()}this.editorView=null,this.isInitialized=!1,null==(t=this.css)||t.remove(),this.css=null}applyDevTools(){"undefined"!=typeof window&&this.options.enableDevTools&&o.e(564).then(o.bind(o,4422)).then(({default:t})=>{this.editorView&&t(this.editorView)}).catch(()=>{console.warn("[Tiptap warning]: Devtools are enabled but `prosemirror-dev-tools` is not installed."),console.warn("Install 'prosemirror-dev-tools' as a dev dependency to use the dev tools.")})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&"undefined"!=typeof document&&(this.css=function(t,e){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML='.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}',document.getElementsByTagName("head")[0].appendChild(r),r}(0,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},this.editorView&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.editorState=this.state.apply(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if("state"===e)return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const n=yf(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let n=e;if([].concat(t).forEach(t=>{const e="string"==typeof t?`${t}$`:t.key;n=n.filter(t=>!t.key.startsWith(e))}),e.length===n.length)return;const r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[Mg,pm.configure({blockSeparator:null==(e=null==(t=this.options.coreExtensionOptions)?void 0:t.clipboardTextSerializer)?void 0:e.blockSeparator}),_g,Og,Dg,Lg,Tg,Rg,Eg].filter(t=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[t.name]):[],...this.options.extensions].filter(t=>["extension","node","mark"].includes(null==t?void 0:t.type));this.extensionManager=new um(n,this)}createCommandManager(){this.commandManager=new of({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=uf(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message)))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&"object"==typeof this.storage.collaboration&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(t=>"collaboration"!==t.name),this.createExtensionManager()}}),t=uf(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){var e;this.editorView=new pp(t,{...this.options.editorProps,attributes:{role:"textbox",...null==(e=this.options.editorProps)?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState}),this.options.enableDevTools&&this.applyDevTools();const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews(),this.prependClass(),this.injectCSS(),this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void t.steps.forEach(t=>{var e;return null==(e=this.capturedTransaction)?void 0:e.step(t)}):void(this.capturedTransaction=t);const{state:e,transactions:n}=this.state.applyTransaction(t),r=!this.state.selection.eq(e.selection),o=n.includes(t),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!o)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:n.slice(1)}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=n.findLast(t=>t.getMeta("focus")||t.getMeta("blur")),a=null==s?void 0:s.getMeta("focus"),l=null==s?void 0:s.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:s}),l&&this.emit("blur",{editor:this,event:l.event,transaction:s}),t.getMeta("preventUpdate")||!n.some(t=>t.docChanged)||i.doc.eq(e.doc)||this.emit("update",{editor:this,transaction:t,appendedTransactions:n.slice(1)})}getAttributes(t){return If(this.state,t)}isActive(t,e){const n="string"==typeof t?t:null,r="string"==typeof t?e:t;return function(t,e,n={}){if(!e)return qf(t,null,n)||Wf(t,null,n);const r=Nf(e,t.schema);return"node"===r?qf(t,e,n):"mark"===r&&Wf(t,e,n)}(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return gf(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e="\n\n",textSerializers:n={}}=t||{};return Af(this.state.doc,{blockSeparator:e,textSerializers:{...Of(this.schema),...n}})}get isEmpty(){return Gf(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return null==(e=null==(t=this.editorView)?void 0:t.isDestroyed)||e}$node(t,e){var n;return(null==(n=this.$doc)?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return(null==(n=this.$doc)?void 0:n.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new Ng(e,this)}get $doc(){return this.$pos(0)}};function Pg(t){return new em({find:t.find,handler:({state:e,range:n,match:r})=>{const o=bf(t.getAttributes,void 0,r);if(!1===o||null===o)return null;const{tr:i}=e,s=r[r.length-1],a=r[0];if(s){const r=a.search(/\S/),l=n.from+a.indexOf(s),c=l+s.length;if(Ff(n.from,n.to,e.doc).filter(e=>e.mark.type.excluded.find(n=>n===t.type&&n!==e.mark.type)).filter(t=>t.to>l).length)return null;c<n.to&&i.delete(c,n.to),l>n.from&&i.delete(n.from+r,l);const d=n.from+r+s.length;i.addMark(n.from+r,d,t.type.create(o||{})),i.removeStoredMark(t.type)}}})}function $g(t){return new em({find:t.find,handler:({state:e,range:n,match:r})=>{const o=bf(t.getAttributes,void 0,r)||{},{tr:i}=e,s=n.from;let a=n.to;const l=t.type.create(o);if(r[1]){let t=s+r[0].lastIndexOf(r[1]);t>a?t=a:a=t+r[1].length;const e=r[0][r[0].length-1];i.insertText(e,s+r[0].length-1),i.replaceWith(t,a,l)}else if(r[0]){const e=t.type.isInline?s:s-1;i.insert(e,t.type.create(o)).delete(i.mapping.map(s),i.mapping.map(a))}i.scrollIntoView()}})}function Hg(t){return new em({find:t.find,handler:({state:e,range:n,match:r})=>{const o=e.doc.resolve(n.from),i=bf(t.getAttributes,void 0,r)||{};if(!o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)}})}function Bg(t){return new em({find:t.find,handler:({state:e,range:n,match:r})=>{let o=t.replace,i=n.from;const s=n.to;if(r[1]){const t=r[0].lastIndexOf(r[1]);o+=r[0].slice(t+r[1].length),i+=t;const e=i-s;e>0&&(o=r[0].slice(t-e,t)+o,i=s)}e.tr.insertText(o,i,s)}})}function jg(t){return new em({find:t.find,handler:({state:e,range:n,match:r,chain:o})=>{const i=bf(t.getAttributes,void 0,r)||{},s=e.tr.delete(n.from,n.to),a=s.doc.resolve(n.from).blockRange(),l=a&&fc(a,t.type,i);if(!l)return null;if(s.wrap(a,l),t.keepMarks&&t.editor){const{selection:n,storedMarks:r}=e,{splittableMarks:o}=t.editor.extensionManager,i=r||n.$to.parentOffset&&n.$from.marks();if(i){const t=i.filter(t=>o.includes(t.type.name));s.ensureMarks(t)}}if(t.keepAttributes){const e="bulletList"===t.type.name||"orderedList"===t.type.name?"listItem":"taskList";o().updateAttributes(e,i).run()}const c=s.doc.resolve(n.from-1).nodeBefore;c&&c.type===t.type&&vc(s.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,c))&&s.join(n.from-1)}})}var Ug=class t extends sm{constructor(){super(...arguments),this.type="node"}static create(e={}){const n="function"==typeof e?e():e;return new t(n)}configure(t){return super.configure(t)}extend(t){const e="function"==typeof t?t():t;return super.extend(e)}};function Fg(t){return new lm({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:o})=>{const i=bf(t.getAttributes,void 0,r,o);if(!1===i||null===i)return null;const{tr:s}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const r=l.search(/\S/),o=n.from+l.indexOf(a),d=o+a.length;if(Ff(n.from,n.to,e.doc).filter(e=>e.mark.type.excluded.find(n=>n===t.type&&n!==e.mark.type)).filter(t=>t.to>o).length)return null;d<n.to&&s.delete(d,n.to),o>n.from&&s.delete(n.from+r,o),c=n.from+r+a.length,s.addMark(n.from+r,c,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function Vg(t){const e=Object.create(null);for(const n of t.split(","))e[n]=1;return t=>t in e}const zg={},Wg=[],qg=()=>{},Kg=()=>!1,Jg=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Gg=t=>t.startsWith("onUpdate:"),Yg=Object.assign,Xg=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},Qg=Object.prototype.hasOwnProperty,Zg=(t,e)=>Qg.call(t,e),ty=Array.isArray,ey=t=>"[object Map]"===ly(t),ny=t=>"function"==typeof t,ry=t=>"string"==typeof t,oy=t=>"symbol"==typeof t,iy=t=>null!==t&&"object"==typeof t,sy=t=>(iy(t)||ny(t))&&ny(t.then)&&ny(t.catch),ay=Object.prototype.toString,ly=t=>ay.call(t),cy=t=>ry(t)&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,dy=Vg(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),uy=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},hy=/-(\w)/g,py=uy(t=>t.replace(hy,(t,e)=>e?e.toUpperCase():"")),fy=/\B([A-Z])/g,my=uy(t=>t.replace(fy,"-$1").toLowerCase()),gy=uy(t=>t.charAt(0).toUpperCase()+t.slice(1)),yy=uy(t=>t?`on${gy(t)}`:""),by=(t,e)=>!Object.is(t,e),vy=(t,...e)=>{for(let n=0;n<t.length;n++)t[n](...e)},wy=(t,e,n,r=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:r,value:n})},ky=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let Sy;const xy=()=>Sy||(Sy="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==o.g?o.g:{});function Cy(t){if(ty(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],o=ry(r)?My(r):Cy(r);if(o)for(const t in o)e[t]=o[t]}return e}if(ry(t)||iy(t))return t}const _y=/;(?![^(]*\))/g,Ey=/:([^]+)/,Ty=/\/\*[^]*?\*\//g;function My(t){const e={};return t.replace(Ty,"").split(_y).forEach(t=>{if(t){const n=t.split(Ey);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Ay(t){let e="";if(ry(t))e=t;else if(ty(t))for(let n=0;n<t.length;n++){const r=Ay(t[n]);r&&(e+=r+" ")}else if(iy(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const Oy=Vg("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function Dy(t){return!!t||""===t}let Ry,Ly;class Ny{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ry,!t&&Ry&&(this.index=(Ry.scopes||(Ry.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let t,e;if(this._isPaused=!0,this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){let t,e;if(this._isPaused=!1,this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=Ry;try{return Ry=this,t()}finally{Ry=e}}}on(){1===++this._on&&(this.prevScope=Ry,Ry=this)}off(){this._on>0&&0===--this._on&&(Ry=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){let e,n;for(this._active=!1,e=0,n=this.effects.length;e<n;e++)this.effects[e].stop();for(this.effects.length=0,e=0,n=this.cleanups.length;e<n;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0}}}const Iy=new WeakSet;class Py{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ry&&Ry.active&&Ry.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,Iy.has(this)&&(Iy.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||jy(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,Zy(this),Vy(this);const t=Ly,e=Gy;Ly=this,Gy=!0;try{return this.fn()}finally{zy(this),Ly=t,Gy=e,this.flags&=-3}}stop(){if(1&this.flags){for(let t=this.deps;t;t=t.nextDep)Ky(t);this.deps=this.depsTail=void 0,Zy(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?Iy.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Wy(this)&&this.run()}get dirty(){return Wy(this)}}let $y,Hy,By=0;function jy(t,e=!1){if(t.flags|=8,e)return t.next=Hy,void(Hy=t);t.next=$y,$y=t}function Uy(){By++}function Fy(){if(--By>0)return;if(Hy){let t=Hy;for(Hy=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let t;for(;$y;){let e=$y;for($y=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,1&e.flags)try{e.trigger()}catch(e){t||(t=e)}e=n}}if(t)throw t}function Vy(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function zy(t){let e,n=t.depsTail,r=n;for(;r;){const t=r.prevDep;-1===r.version?(r===n&&(n=t),Ky(r),Jy(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=t}t.deps=e,t.depsTail=n}function Wy(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(qy(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function qy(t){if(4&t.flags&&!(16&t.flags))return;if(t.flags&=-17,t.globalVersion===tb)return;if(t.globalVersion=tb,!t.isSSR&&128&t.flags&&(!t.deps&&!t._dirty||!Wy(t)))return;t.flags|=2;const e=t.dep,n=Ly,r=Gy;Ly=t,Gy=!0;try{Vy(t);const n=t.fn(t._value);(0===e.version||by(n,t._value))&&(t.flags|=128,t._value=n,e.version++)}catch(t){throw e.version++,t}finally{Ly=n,Gy=r,zy(t),t.flags&=-3}}function Ky(t,e=!1){const{dep:n,prevSub:r,nextSub:o}=t;if(r&&(r.nextSub=o,t.prevSub=void 0),o&&(o.prevSub=r,t.nextSub=void 0),n.subs===t&&(n.subs=r,!r&&n.computed)){n.computed.flags&=-5;for(let t=n.computed.deps;t;t=t.nextDep)Ky(t,!0)}e||--n.sc||!n.map||n.map.delete(n.key)}function Jy(t){const{prevDep:e,nextDep:n}=t;e&&(e.nextDep=n,t.prevDep=void 0),n&&(n.prevDep=e,t.nextDep=void 0)}let Gy=!0;const Yy=[];function Xy(){Yy.push(Gy),Gy=!1}function Qy(){const t=Yy.pop();Gy=void 0===t||t}function Zy(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const t=Ly;Ly=void 0;try{e()}finally{Ly=t}}}let tb=0;class eb{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class nb{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!Ly||!Gy||Ly===this.computed)return;let e=this.activeLink;if(void 0===e||e.sub!==Ly)e=this.activeLink=new eb(Ly,this),Ly.deps?(e.prevDep=Ly.depsTail,Ly.depsTail.nextDep=e,Ly.depsTail=e):Ly.deps=Ly.depsTail=e,rb(e);else if(-1===e.version&&(e.version=this.version,e.nextDep)){const t=e.nextDep;t.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=t),e.prevDep=Ly.depsTail,e.nextDep=void 0,Ly.depsTail.nextDep=e,Ly.depsTail=e,Ly.deps===e&&(Ly.deps=t)}return e}trigger(t){this.version++,tb++,this.notify(t)}notify(t){Uy();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Fy()}}}function rb(t){if(t.dep.sc++,4&t.sub.flags){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let t=e.deps;t;t=t.nextDep)rb(t)}const n=t.dep.subs;n!==t&&(t.prevSub=n,n&&(n.nextSub=t)),t.dep.subs=t}}const ob=new WeakMap,ib=Symbol(""),sb=Symbol(""),ab=Symbol("");function lb(t,e,n){if(Gy&&Ly){let e=ob.get(t);e||ob.set(t,e=new Map);let r=e.get(n);r||(e.set(n,r=new nb),r.map=e,r.key=n),r.track()}}function cb(t,e,n,r,o,i){const s=ob.get(t);if(!s)return void tb++;const a=t=>{t&&t.trigger()};if(Uy(),"clear"===e)s.forEach(a);else{const o=ty(t),i=o&&cy(n);if(o&&"length"===n){const t=Number(r);s.forEach((e,n)=>{("length"===n||n===ab||!oy(n)&&n>=t)&&a(e)})}else switch((void 0!==n||s.has(void 0))&&a(s.get(n)),i&&a(s.get(ab)),e){case"add":o?i&&a(s.get("length")):(a(s.get(ib)),ey(t)&&a(s.get(sb)));break;case"delete":o||(a(s.get(ib)),ey(t)&&a(s.get(sb)));break;case"set":ey(t)&&a(s.get(ib))}}Fy()}function db(t){const e=qb(t);return e===t?e:(lb(e,0,ab),zb(t)?e:e.map(Jb))}function ub(t){return lb(t=qb(t),0,ab),t}const hb={__proto__:null,[Symbol.iterator](){return pb(this,Symbol.iterator,Jb)},concat(...t){return db(this).concat(...t.map(t=>ty(t)?db(t):t))},entries(){return pb(this,"entries",t=>(t[1]=Jb(t[1]),t))},every(t,e){return mb(this,"every",t,e,void 0,arguments)},filter(t,e){return mb(this,"filter",t,e,t=>t.map(Jb),arguments)},find(t,e){return mb(this,"find",t,e,Jb,arguments)},findIndex(t,e){return mb(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return mb(this,"findLast",t,e,Jb,arguments)},findLastIndex(t,e){return mb(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return mb(this,"forEach",t,e,void 0,arguments)},includes(...t){return yb(this,"includes",t)},indexOf(...t){return yb(this,"indexOf",t)},join(t){return db(this).join(t)},lastIndexOf(...t){return yb(this,"lastIndexOf",t)},map(t,e){return mb(this,"map",t,e,void 0,arguments)},pop(){return bb(this,"pop")},push(...t){return bb(this,"push",t)},reduce(t,...e){return gb(this,"reduce",t,e)},reduceRight(t,...e){return gb(this,"reduceRight",t,e)},shift(){return bb(this,"shift")},some(t,e){return mb(this,"some",t,e,void 0,arguments)},splice(...t){return bb(this,"splice",t)},toReversed(){return db(this).toReversed()},toSorted(t){return db(this).toSorted(t)},toSpliced(...t){return db(this).toSpliced(...t)},unshift(...t){return bb(this,"unshift",t)},values(){return pb(this,"values",Jb)}};function pb(t,e,n){const r=ub(t),o=r[e]();return r===t||zb(t)||(o._next=o.next,o.next=()=>{const t=o._next();return t.value&&(t.value=n(t.value)),t}),o}const fb=Array.prototype;function mb(t,e,n,r,o,i){const s=ub(t),a=s!==t&&!zb(t),l=s[e];if(l!==fb[e]){const e=l.apply(t,i);return a?Jb(e):e}let c=n;s!==t&&(a?c=function(e,r){return n.call(this,Jb(e),r,t)}:n.length>2&&(c=function(e,r){return n.call(this,e,r,t)}));const d=l.call(s,c,r);return a&&o?o(d):d}function gb(t,e,n,r){const o=ub(t);let i=n;return o!==t&&(zb(t)?n.length>3&&(i=function(e,r,o){return n.call(this,e,r,o,t)}):i=function(e,r,o){return n.call(this,e,Jb(r),o,t)}),o[e](i,...r)}function yb(t,e,n){const r=qb(t);lb(r,0,ab);const o=r[e](...n);return-1!==o&&!1!==o||!Wb(n[0])?o:(n[0]=qb(n[0]),r[e](...n))}function bb(t,e,n=[]){Xy(),Uy();const r=qb(t)[e].apply(t,n);return Fy(),Qy(),r}const vb=Vg("__proto__,__v_isRef,__isVue"),wb=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>"arguments"!==t&&"caller"!==t).map(t=>Symbol[t]).filter(oy));function kb(t){oy(t)||(t=String(t));const e=qb(this);return lb(e,0,t),e.hasOwnProperty(t)}class Sb{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,n){if("__v_skip"===e)return t.__v_skip;const r=this._isReadonly,o=this._isShallow;if("__v_isReactive"===e)return!r;if("__v_isReadonly"===e)return r;if("__v_isShallow"===e)return o;if("__v_raw"===e)return n===(r?o?Hb:$b:o?Pb:Ib).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const i=ty(t);if(!r){let t;if(i&&(t=hb[e]))return t;if("hasOwnProperty"===e)return kb}const s=Reflect.get(t,e,Yb(t)?t:n);return(oy(e)?wb.has(e):vb(e))?s:(r||lb(t,0,e),o?s:Yb(s)?i&&cy(e)?s:s.value:iy(s)?r?jb(s):Bb(s):s)}}class xb extends Sb{constructor(t=!1){super(!1,t)}set(t,e,n,r){let o=t[e];if(!this._isShallow){const e=Vb(o);if(zb(n)||Vb(n)||(o=qb(o),n=qb(n)),!ty(t)&&Yb(o)&&!Yb(n))return!e&&(o.value=n,!0)}const i=ty(t)&&cy(e)?Number(e)<t.length:Zg(t,e),s=Reflect.set(t,e,n,Yb(t)?t:r);return t===qb(r)&&(i?by(n,o)&&cb(t,"set",e,n):cb(t,"add",e,n)),s}deleteProperty(t,e){const n=Zg(t,e),r=(t[e],Reflect.deleteProperty(t,e));return r&&n&&cb(t,"delete",e,void 0),r}has(t,e){const n=Reflect.has(t,e);return oy(e)&&wb.has(e)||lb(t,0,e),n}ownKeys(t){return lb(t,0,ty(t)?"length":ib),Reflect.ownKeys(t)}}class Cb extends Sb{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const _b=new xb,Eb=new Cb,Tb=new xb(!0),Mb=t=>t,Ab=t=>Reflect.getPrototypeOf(t);function Ob(t){return function(...e){return"delete"!==t&&("clear"===t?void 0:this)}}function Db(t,e){const n=function(t,e){const n={get(n){const r=this.__v_raw,o=qb(r),i=qb(n);t||(by(n,i)&&lb(o,0,n),lb(o,0,i));const{has:s}=Ab(o),a=e?Mb:t?Gb:Jb;return s.call(o,n)?a(r.get(n)):s.call(o,i)?a(r.get(i)):void(r!==o&&r.get(n))},get size(){const e=this.__v_raw;return!t&&lb(qb(e),0,ib),Reflect.get(e,"size",e)},has(e){const n=this.__v_raw,r=qb(n),o=qb(e);return t||(by(e,o)&&lb(r,0,e),lb(r,0,o)),e===o?n.has(e):n.has(e)||n.has(o)},forEach(n,r){const o=this,i=o.__v_raw,s=qb(i),a=e?Mb:t?Gb:Jb;return!t&&lb(s,0,ib),i.forEach((t,e)=>n.call(r,a(t),a(e),o))}};return Yg(n,t?{add:Ob("add"),set:Ob("set"),delete:Ob("delete"),clear:Ob("clear")}:{add(t){e||zb(t)||Vb(t)||(t=qb(t));const n=qb(this);return Ab(n).has.call(n,t)||(n.add(t),cb(n,"add",t,t)),this},set(t,n){e||zb(n)||Vb(n)||(n=qb(n));const r=qb(this),{has:o,get:i}=Ab(r);let s=o.call(r,t);s||(t=qb(t),s=o.call(r,t));const a=i.call(r,t);return r.set(t,n),s?by(n,a)&&cb(r,"set",t,n):cb(r,"add",t,n),this},delete(t){const e=qb(this),{has:n,get:r}=Ab(e);let o=n.call(e,t);o||(t=qb(t),o=n.call(e,t)),r&&r.call(e,t);const i=e.delete(t);return o&&cb(e,"delete",t,void 0),i},clear(){const t=qb(this),e=0!==t.size,n=t.clear();return e&&cb(t,"clear",void 0,void 0),n}}),["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=function(t,e,n){return function(...r){const o=this.__v_raw,i=qb(o),s=ey(i),a="entries"===t||t===Symbol.iterator&&s,l="keys"===t&&s,c=o[t](...r),d=n?Mb:e?Gb:Jb;return!e&&lb(i,0,l?sb:ib),{next(){const{value:t,done:e}=c.next();return e?{value:t,done:e}:{value:a?[d(t[0]),d(t[1])]:d(t),done:e}},[Symbol.iterator](){return this}}}}(r,t,e)}),n}(t,e);return(e,r,o)=>"__v_isReactive"===r?!t:"__v_isReadonly"===r?t:"__v_raw"===r?e:Reflect.get(Zg(n,r)&&r in e?n:e,r,o)}const Rb={get:Db(!1,!1)},Lb={get:Db(!1,!0)},Nb={get:Db(!0,!1)},Ib=new WeakMap,Pb=new WeakMap,$b=new WeakMap,Hb=new WeakMap;function Bb(t){return Vb(t)?t:Ub(t,!1,_b,Rb,Ib)}function jb(t){return Ub(t,!0,Eb,Nb,$b)}function Ub(t,e,n,r,o){if(!iy(t))return t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const i=function(t){return t.__v_skip||!Object.isExtensible(t)?0:function(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((t=>ly(t).slice(8,-1))(t))}(t);if(0===i)return t;const s=o.get(t);if(s)return s;const a=new Proxy(t,2===i?r:n);return o.set(t,a),a}function Fb(t){return Vb(t)?Fb(t.__v_raw):!(!t||!t.__v_isReactive)}function Vb(t){return!(!t||!t.__v_isReadonly)}function zb(t){return!(!t||!t.__v_isShallow)}function Wb(t){return!!t&&!!t.__v_raw}function qb(t){const e=t&&t.__v_raw;return e?qb(e):t}function Kb(t){return!Zg(t,"__v_skip")&&Object.isExtensible(t)&&wy(t,"__v_skip",!0),t}const Jb=t=>iy(t)?Bb(t):t,Gb=t=>iy(t)?jb(t):t;function Yb(t){return!!t&&!0===t.__v_isRef}function Xb(t){return Qb(t,!1)}function Qb(t,e){return Yb(t)?t:new Zb(t,e)}class Zb{constructor(t,e){this.dep=new nb,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:qb(t),this._value=e?t:Jb(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,n=this.__v_isShallow||zb(t)||Vb(t);t=n?t:qb(t),by(t,e)&&(this._rawValue=t,this._value=n?t:Jb(t),this.dep.trigger())}}function tv(t){return Yb(t)?t.value:t}const ev={get:(t,e,n)=>"__v_raw"===e?t:tv(Reflect.get(t,e,n)),set:(t,e,n,r)=>{const o=t[e];return Yb(o)&&!Yb(n)?(o.value=n,!0):Reflect.set(t,e,n,r)}};function nv(t){return Fb(t)?t:new Proxy(t,ev)}class rv{constructor(t){this.__v_isRef=!0,this._value=void 0;const e=this.dep=new nb,{get:n,set:r}=t(e.track.bind(e),e.trigger.bind(e));this._get=n,this._set=r}get value(){return this._value=this._get()}set value(t){this._set(t)}}class ov{constructor(t,e,n){this.fn=t,this.setter=e,this._value=void 0,this.dep=new nb(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=tb-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=n}notify(){if(this.flags|=16,!(8&this.flags||Ly===this))return jy(this,!0),!0}get value(){const t=this.dep.track();return qy(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}const iv={},sv=new WeakMap;let av;function lv(t,e=1/0,n){if(e<=0||!iy(t)||t.__v_skip)return t;if((n=n||new Set).has(t))return t;if(n.add(t),e--,Yb(t))lv(t.value,e,n);else if(ty(t))for(let r=0;r<t.length;r++)lv(t[r],e,n);else if("[object Set]"===ly(t)||ey(t))t.forEach(t=>{lv(t,e,n)});else if((t=>"[object Object]"===ly(t))(t)){for(const r in t)lv(t[r],e,n);for(const r of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,r)&&lv(t[r],e,n)}return t}function cv(t,e,n,r){try{return r?t(...r):t()}catch(t){uv(t,e,n)}}function dv(t,e,n,r){if(ny(t)){const o=cv(t,e,n,r);return o&&sy(o)&&o.catch(t=>{uv(t,e,n)}),o}if(ty(t)){const o=[];for(let i=0;i<t.length;i++)o.push(dv(t[i],e,n,r));return o}}function uv(t,e,n,r=!0){e&&e.vnode;const{errorHandler:o,throwUnhandledErrorInProduction:i}=e&&e.appContext.config||zg;if(e){let r=e.parent;const i=e.proxy,s=`https://vuejs.org/error-reference/#runtime-${n}`;for(;r;){const e=r.ec;if(e)for(let n=0;n<e.length;n++)if(!1===e[n](t,i,s))return;r=r.parent}if(o)return Xy(),cv(o,null,10,[t,i,s]),void Qy()}!function(t,e,n,r=!0,o=!1){if(o)throw t;console.error(t)}(t,0,0,r,i)}const hv=[];let pv=-1;const fv=[];let mv=null,gv=0;const yv=Promise.resolve();let bv=null;function vv(t){const e=bv||yv;return t?e.then(this?t.bind(this):t):e}function wv(t){if(!(1&t.flags)){const e=Cv(t),n=hv[hv.length-1];!n||!(2&t.flags)&&e>=Cv(n)?hv.push(t):hv.splice(function(t){let e=pv+1,n=hv.length;for(;e<n;){const r=e+n>>>1,o=hv[r],i=Cv(o);i<t||i===t&&2&o.flags?e=r+1:n=r}return e}(e),0,t),t.flags|=1,kv()}}function kv(){bv||(bv=yv.then(_v))}function Sv(t,e,n=pv+1){for(;n<hv.length;n++){const e=hv[n];if(e&&2&e.flags){if(t&&e.id!==t.uid)continue;hv.splice(n,1),n--,4&e.flags&&(e.flags&=-2),e(),4&e.flags||(e.flags&=-2)}}}function xv(t){if(fv.length){const t=[...new Set(fv)].sort((t,e)=>Cv(t)-Cv(e));if(fv.length=0,mv)return void mv.push(...t);for(mv=t,gv=0;gv<mv.length;gv++){const t=mv[gv];4&t.flags&&(t.flags&=-2),8&t.flags||t(),t.flags&=-2}mv=null,gv=0}}const Cv=t=>null==t.id?2&t.flags?-1:1/0:t.id;function _v(t){try{for(pv=0;pv<hv.length;pv++){const t=hv[pv];!t||8&t.flags||(4&t.flags&&(t.flags&=-2),cv(t,t.i,t.i?15:14),4&t.flags||(t.flags&=-2))}}finally{for(;pv<hv.length;pv++){const t=hv[pv];t&&(t.flags&=-2)}pv=-1,hv.length=0,xv(),bv=null,(hv.length||fv.length)&&_v(t)}}let Ev,Tv=[],Mv=!1;function Av(t,...e){Ev?Ev.emit(t,...e):Mv||Tv.push({event:t,args:e})}function Ov(t,e){var n,r;Ev=t,Ev?(Ev.enabled=!0,Tv.forEach(({event:t,args:e})=>Ev.emit(t,...e)),Tv=[]):"undefined"!=typeof window&&window.HTMLElement&&!(null==(r=null==(n=window.navigator)?void 0:n.userAgent)?void 0:r.includes("jsdom"))?((e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(t=>{Ov(t,e)}),setTimeout(()=>{Ev||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,Mv=!0,Tv=[])},3e3)):(Mv=!0,Tv=[])}const Dv=Nv("component:added"),Rv=Nv("component:updated"),Lv=Nv("component:removed");function Nv(t){return e=>{Av(t,e.appContext.app,e.uid,e.parent?e.parent.uid:void 0,e)}}let Iv=null,Pv=null;function $v(t){const e=Iv;return Iv=t,Pv=t&&t.type.__scopeId||null,e}function Hv(t,e,n,r){const o=t.dirs,i=e&&e.dirs;for(let s=0;s<o.length;s++){const a=o[s];i&&(a.oldValue=i[s].value);let l=a.dir[r];l&&(Xy(),dv(l,n,8,[t.el,a,t,e]),Qy())}}const Bv=Symbol("_vte");Symbol("_leaveCb"),Symbol("_enterCb");function jv(t,e){6&t.shapeFlag&&t.component?(t.transition=e,jv(t.component.subTree,e)):128&t.shapeFlag?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function Uv(t,e){return ny(t)?(()=>Yg({name:t.name},e,{setup:t}))():t}function Fv(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}function Vv(t,e,n,r,o=!1){if(ty(t))return void t.forEach((t,i)=>Vv(t,e&&(ty(e)?e[i]:e),n,r,o));if(zv(r)&&!o)return void(512&r.shapeFlag&&r.type.__asyncResolved&&r.component.subTree.component&&Vv(t,e,n,r.component.subTree));const i=4&r.shapeFlag?Wk(r.component):r.el,s=o?null:i,{i:a,r:l}=t,c=e&&e.r,d=a.refs===zg?a.refs={}:a.refs,u=a.setupState,h=qb(u),p=u===zg?()=>!1:t=>Zg(h,t);if(null!=c&&c!==l&&(ry(c)?(d[c]=null,p(c)&&(u[c]=null)):Yb(c)&&(c.value=null)),ny(l))cv(l,a,12,[s,d]);else{const e=ry(l),r=Yb(l);if(e||r){const a=()=>{if(t.f){const n=e?p(l)?u[l]:d[l]:l.value;o?ty(n)&&Xg(n,i):ty(n)?n.includes(i)||n.push(i):e?(d[l]=[i],p(l)&&(u[l]=d[l])):(l.value=[i],t.k&&(d[t.k]=l.value))}else e?(d[l]=s,p(l)&&(u[l]=s)):r&&(l.value=s,t.k&&(d[t.k]=s))};s?(a.id=-1,zw(a,n)):a()}}}Boolean,Boolean,xy().requestIdleCallback,xy().cancelIdleCallback;const zv=t=>!!t.type.__asyncLoader,Wv=t=>t.type.__isKeepAlive;function qv(t,e){Jv(t,"a",e)}function Kv(t,e){Jv(t,"da",e)}function Jv(t,e,n=Lk){const r=t.__wdc||(t.__wdc=()=>{let e=n;for(;e;){if(e.isDeactivated)return;e=e.parent}return t()});if(Yv(e,r,n),n){let t=n.parent;for(;t&&t.parent;)Wv(t.parent.vnode)&&Gv(r,e,n,t),t=t.parent}}function Gv(t,e,n,r){const o=Yv(e,t,r,!0);rw(()=>{Xg(r[e],o)},n)}function Yv(t,e,n=Lk,r=!1){if(n){const o=n[t]||(n[t]=[]),i=e.__weh||(e.__weh=(...r)=>{Xy();const o=Pk(n),i=dv(e,n,t,r);return o(),Qy(),i});return r?o.unshift(i):o.push(i),i}}RegExp,RegExp;const Xv=t=>(e,n=Lk)=>{Uk&&"sp"!==t||Yv(t,(...t)=>e(...t),n)},Qv=Xv("bm"),Zv=Xv("m"),tw=Xv("bu"),ew=Xv("u"),nw=Xv("bum"),rw=Xv("um"),ow=Xv("sp"),iw=Xv("rtg"),sw=Xv("rtc");function aw(t,e=Lk){Yv("ec",t,e)}const lw=Symbol.for("v-ndc"),cw=t=>t?Hk(t)?Wk(t):cw(t.parent):null,dw=Yg(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>cw(t.parent),$root:t=>cw(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>__VUE_OPTIONS_API__?yw(t):t.type,$forceUpdate:t=>t.f||(t.f=()=>{wv(t.update)}),$nextTick:t=>t.n||(t.n=vv.bind(t.proxy)),$watch:t=>__VUE_OPTIONS_API__?ek.bind(t):qg}),uw=(t,e)=>t!==zg&&!t.__isScriptSetup&&Zg(t,e),hw={get({_:t},e){if("__v_skip"===e)return!0;const{ctx:n,setupState:r,data:o,props:i,accessCache:s,type:a,appContext:l}=t;let c;if("$"!==e[0]){const a=s[e];if(void 0!==a)switch(a){case 1:return r[e];case 2:return o[e];case 4:return n[e];case 3:return i[e]}else{if(uw(r,e))return s[e]=1,r[e];if(o!==zg&&Zg(o,e))return s[e]=2,o[e];if((c=t.propsOptions[0])&&Zg(c,e))return s[e]=3,i[e];if(n!==zg&&Zg(n,e))return s[e]=4,n[e];__VUE_OPTIONS_API__&&!fw||(s[e]=0)}}const d=dw[e];let u,h;return d?("$attrs"===e&&lb(t.attrs,0,""),d(t)):(u=a.__cssModules)&&(u=u[e])?u:n!==zg&&Zg(n,e)?(s[e]=4,n[e]):(h=l.config.globalProperties,Zg(h,e)?h[e]:void 0)},set({_:t},e,n){const{data:r,setupState:o,ctx:i}=t;return uw(o,e)?(o[e]=n,!0):r!==zg&&Zg(r,e)?(r[e]=n,!0):!(Zg(t.props,e)||"$"===e[0]&&e.slice(1)in t||(i[e]=n,0))},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:o,propsOptions:i}},s){let a;return!!n[s]||t!==zg&&Zg(t,s)||uw(e,s)||(a=i[0])&&Zg(a,s)||Zg(r,s)||Zg(dw,s)||Zg(o.config.globalProperties,s)},defineProperty(t,e,n){return null!=n.get?t._.accessCache[e]=0:Zg(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function pw(t){return ty(t)?t.reduce((t,e)=>(t[e]=null,t),{}):t}let fw=!0;function mw(t,e,n){dv(ty(t)?t.map(t=>t.bind(e.proxy)):t.bind(e.proxy),e,n)}function gw(t,e,n,r){let o=r.includes(".")?nk(n,r):()=>n[r];if(ry(t)){const n=e[t];ny(n)&&Zw(o,n)}else if(ny(t))Zw(o,t.bind(n));else if(iy(t))if(ty(t))t.forEach(t=>gw(t,e,n,r));else{const r=ny(t.handler)?t.handler.bind(n):e[t.handler];ny(r)&&Zw(o,r,t)}}function yw(t){const e=t.type,{mixins:n,extends:r}=e,{mixins:o,optionsCache:i,config:{optionMergeStrategies:s}}=t.appContext,a=i.get(e);let l;return a?l=a:o.length||n||r?(l={},o.length&&o.forEach(t=>bw(l,t,s,!0)),bw(l,e,s)):l=e,iy(e)&&i.set(e,l),l}function bw(t,e,n,r=!1){const{mixins:o,extends:i}=e;i&&bw(t,i,n,!0),o&&o.forEach(e=>bw(t,e,n,!0));for(const o in e)if(r&&"expose"===o);else{const r=vw[o]||n&&n[o];t[o]=r?r(t[o],e[o]):e[o]}return t}const vw={data:ww,props:Cw,emits:Cw,methods:xw,computed:xw,beforeCreate:Sw,created:Sw,beforeMount:Sw,mounted:Sw,beforeUpdate:Sw,updated:Sw,beforeDestroy:Sw,beforeUnmount:Sw,destroyed:Sw,unmounted:Sw,activated:Sw,deactivated:Sw,errorCaptured:Sw,serverPrefetch:Sw,components:xw,directives:xw,watch:function(t,e){if(!t)return e;if(!e)return t;const n=Yg(Object.create(null),t);for(const r in e)n[r]=Sw(t[r],e[r]);return n},provide:ww,inject:function(t,e){return xw(kw(t),kw(e))}};function ww(t,e){return e?t?function(){return Yg(ny(t)?t.call(this,this):t,ny(e)?e.call(this,this):e)}:e:t}function kw(t){if(ty(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function Sw(t,e){return t?[...new Set([].concat(t,e))]:e}function xw(t,e){return t?Yg(Object.create(null),t,e):e}function Cw(t,e){return t?ty(t)&&ty(e)?[...new Set([...t,...e])]:Yg(Object.create(null),pw(t),pw(null!=e?e:{})):e}function _w(){return{app:null,config:{isNativeTag:Kg,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Ew=0;function Tw(t,e){return function(n,r=null){ny(n)||(n=Yg({},n)),null==r||iy(r)||(r=null);const o=_w(),i=new WeakSet,s=[];let a=!1;const l=o.app={_uid:Ew++,_component:n,_props:r,_container:null,_context:o,_instance:null,version:Jk,get config(){return o.config},set config(t){},use:(t,...e)=>(i.has(t)||(t&&ny(t.install)?(i.add(t),t.install(l,...e)):ny(t)&&(i.add(t),t(l,...e))),l),mixin:t=>(__VUE_OPTIONS_API__&&(o.mixins.includes(t)||o.mixins.push(t)),l),component:(t,e)=>e?(o.components[t]=e,l):o.components[t],directive:(t,e)=>e?(o.directives[t]=e,l):o.directives[t],mount(i,s,c){if(!a){const d=l._ceVNode||Ck(n,r);return d.appContext=o,!0===c?c="svg":!1===c&&(c=void 0),s&&e?e(d,i):t(d,i,c),a=!0,l._container=i,i.__vue_app__=l,__VUE_PROD_DEVTOOLS__&&(l._instance=d.component,function(t,e){Av("app:init",t,e,{Fragment:hk,Text:pk,Comment:fk,Static:mk})}(l,Jk)),Wk(d.component)}},onUnmount(t){s.push(t)},unmount(){a&&(dv(s,l._instance,16),t(null,l._container),__VUE_PROD_DEVTOOLS__&&(l._instance=null,function(t){Av("app:unmount",t)}(l)),delete l._container.__vue_app__)},provide:(t,e)=>(o.provides[t]=e,l),runWithContext(t){const e=Mw;Mw=l;try{return t()}finally{Mw=e}}};return l}}let Mw=null;function Aw(t,e,n=!1){const r=Lk||Iv;if(r||Mw){let o=Mw?Mw._context.provides:r?null==r.parent||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(o&&t in o)return o[t];if(arguments.length>1)return n&&ny(e)?e.call(r&&r.proxy):e}}const Ow={},Dw=()=>Object.create(Ow),Rw=t=>Object.getPrototypeOf(t)===Ow;function Lw(t,e,n,r){const[o,i]=t.propsOptions;let s,a=!1;if(e)for(let l in e){if(dy(l))continue;const c=e[l];let d;o&&Zg(o,d=py(l))?i&&i.includes(d)?(s||(s={}))[d]=c:n[d]=c:sk(t.emitsOptions,l)||l in r&&c===r[l]||(r[l]=c,a=!0)}if(i){const e=qb(n),r=s||zg;for(let s=0;s<i.length;s++){const a=i[s];n[a]=Nw(o,e,a,r[a],t,!Zg(r,a))}}return a}function Nw(t,e,n,r,o,i){const s=t[n];if(null!=s){const t=Zg(s,"default");if(t&&void 0===r){const t=s.default;if(s.type!==Function&&!s.skipFactory&&ny(t)){const{propsDefaults:i}=o;if(n in i)r=i[n];else{const s=Pk(o);r=i[n]=t.call(null,e),s()}}else r=t;o.ce&&o.ce._setProp(n,r)}s[0]&&(i&&!t?r=!1:!s[1]||""!==r&&r!==my(n)||(r=!0))}return r}const Iw=new WeakMap;function Pw(t,e,n=!1){const r=__VUE_OPTIONS_API__&&n?Iw:e.propsCache,o=r.get(t);if(o)return o;const i=t.props,s={},a=[];let l=!1;if(__VUE_OPTIONS_API__&&!ny(t)){const r=t=>{l=!0;const[n,r]=Pw(t,e,!0);Yg(s,n),r&&a.push(...r)};!n&&e.mixins.length&&e.mixins.forEach(r),t.extends&&r(t.extends),t.mixins&&t.mixins.forEach(r)}if(!i&&!l)return iy(t)&&r.set(t,Wg),Wg;if(ty(i))for(let t=0;t<i.length;t++){const e=py(i[t]);$w(e)&&(s[e]=zg)}else if(i)for(const t in i){const e=py(t);if($w(e)){const n=i[t],r=s[e]=ty(n)||ny(n)?{type:n}:Yg({},n),o=r.type;let l=!1,c=!0;if(ty(o))for(let t=0;t<o.length;++t){const e=o[t],n=ny(e)&&e.name;if("Boolean"===n){l=!0;break}"String"===n&&(c=!1)}else l=ny(o)&&"Boolean"===o.name;r[0]=l,r[1]=c,(l||Zg(r,"default"))&&a.push(e)}}const c=[s,a];return iy(t)&&r.set(t,c),c}function $w(t){return"$"!==t[0]&&!dy(t)}const Hw=t=>"_"===t[0]||"$stable"===t,Bw=t=>ty(t)?t.map(Tk):[Tk(t)],jw=(t,e,n)=>{if(e._n)return e;const r=function(t,e=Iv){if(!e)return t;if(t._n)return t;const n=(...r)=>{n._d&&vk(-1);const o=$v(e);let i;try{i=t(...r)}finally{$v(o),n._d&&vk(1)}return __VUE_PROD_DEVTOOLS__&&Rv(e),i};return n._n=!0,n._c=!0,n._d=!0,n}((...t)=>Bw(e(...t)),n);return r._c=!1,r},Uw=(t,e,n)=>{const r=t._ctx;for(const n in t){if(Hw(n))continue;const o=t[n];if(ny(o))e[n]=jw(0,o,r);else if(null!=o){const t=Bw(o);e[n]=()=>t}}},Fw=(t,e)=>{const n=Bw(e);t.slots.default=()=>n},Vw=(t,e,n)=>{for(const r in e)!n&&Hw(r)||(t[r]=e[r])},zw=function(t,e){e&&e.pendingBranch?ty(t)?e.effects.push(...t):e.effects.push(t):(n=t,ty(n)?fv.push(...n):mv&&-1===n.id?mv.splice(gv+1,0,n):1&n.flags||(fv.push(n),n.flags|=1),kv());var n};function Ww(t,e){"boolean"!=typeof __VUE_OPTIONS_API__&&(xy().__VUE_OPTIONS_API__=!0),"boolean"!=typeof __VUE_PROD_DEVTOOLS__&&(xy().__VUE_PROD_DEVTOOLS__=!1),"boolean"!=typeof __VUE_PROD_HYDRATION_MISMATCH_DETAILS__&&(xy().__VUE_PROD_HYDRATION_MISMATCH_DETAILS__=!1);const n=xy();n.__VUE__=!0,__VUE_PROD_DEVTOOLS__&&Ov(n.__VUE_DEVTOOLS_GLOBAL_HOOK__,n);const{insert:r,remove:o,patchProp:i,createElement:s,createText:a,createComment:l,setText:c,setElementText:d,parentNode:u,nextSibling:h,setScopeId:p=qg,insertStaticContent:f}=t,m=(t,e,n,r=null,o=null,i=null,s=void 0,a=null,l=!!e.dynamicChildren)=>{if(t===e)return;t&&!kk(t,e)&&(r=U(t),P(t,o,i,!0),t=null),-2===e.patchFlag&&(l=!1,e.dynamicChildren=null);const{type:c,ref:d,shapeFlag:u}=e;switch(c){case pk:g(t,e,n,r);break;case fk:y(t,e,n,r);break;case mk:null==t&&b(e,n,r,s);break;case hk:E(t,e,n,r,o,i,s,a,l);break;default:1&u?v(t,e,n,r,o,i,s,a,l):6&u?T(t,e,n,r,o,i,s,a,l):(64&u||128&u)&&c.process(t,e,n,r,o,i,s,a,l,z)}null!=d&&o?Vv(d,t&&t.ref,i,e||t,!e):null==d&&t&&null!=t.ref&&Vv(t.ref,null,i,t,!0)},g=(t,e,n,o)=>{if(null==t)r(e.el=a(e.children),n,o);else{const n=e.el=t.el;e.children!==t.children&&c(n,e.children)}},y=(t,e,n,o)=>{null==t?r(e.el=l(e.children||""),n,o):e.el=t.el},b=(t,e,n,r)=>{[t.el,t.anchor]=f(t.children,e,n,r,t.el,t.anchor)},v=(t,e,n,r,o,i,s,a,l)=>{"svg"===e.type?s="svg":"math"===e.type&&(s="mathml"),null==t?w(e,n,r,o,i,s,a,l):x(t,e,o,i,s,a,l)},w=(t,e,n,o,a,l,c,u)=>{let h,p;const{props:f,shapeFlag:m,transition:g,dirs:y}=t;if(h=t.el=s(t.type,l,f&&f.is,f),8&m?d(h,t.children):16&m&&S(t.children,h,null,o,a,qw(t,l),c,u),y&&Hv(t,null,o,"created"),k(h,t,t.scopeId,c,o),f){for(const t in f)"value"===t||dy(t)||i(h,t,null,f[t],l,o);"value"in f&&i(h,"value",null,f.value,l),(p=f.onVnodeBeforeMount)&&Ok(p,o,t)}__VUE_PROD_DEVTOOLS__&&(wy(h,"__vnode",t,!0),wy(h,"__vueParentComponent",o,!0)),y&&Hv(t,null,o,"beforeMount");const b=function(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}(a,g);b&&g.beforeEnter(h),r(h,e,n),((p=f&&f.onVnodeMounted)||b||y)&&zw(()=>{p&&Ok(p,o,t),b&&g.enter(h),y&&Hv(t,null,o,"mounted")},a)},k=(t,e,n,r,o)=>{if(n&&p(t,n),r)for(let e=0;e<r.length;e++)p(t,r[e]);if(o){let n=o.subTree;if(e===n||uk(n.type)&&(n.ssContent===e||n.ssFallback===e)){const e=o.vnode;k(t,e,e.scopeId,e.slotScopeIds,o.parent)}}},S=(t,e,n,r,o,i,s,a,l=0)=>{for(let c=l;c<t.length;c++){const l=t[c]=a?Mk(t[c]):Tk(t[c]);m(null,l,e,n,r,o,i,s,a)}},x=(t,e,n,r,o,s,a)=>{const l=e.el=t.el;__VUE_PROD_DEVTOOLS__&&(l.__vnode=e);let{patchFlag:c,dynamicChildren:u,dirs:h}=e;c|=16&t.patchFlag;const p=t.props||zg,f=e.props||zg;let m;if(n&&Kw(n,!1),(m=f.onVnodeBeforeUpdate)&&Ok(m,n,e,t),h&&Hv(e,t,n,"beforeUpdate"),n&&Kw(n,!0),(p.innerHTML&&null==f.innerHTML||p.textContent&&null==f.textContent)&&d(l,""),u?C(t.dynamicChildren,u,l,n,r,qw(e,o),s):a||R(t,e,l,null,n,r,qw(e,o),s,!1),c>0){if(16&c)_(l,p,f,n,o);else if(2&c&&p.class!==f.class&&i(l,"class",null,f.class,o),4&c&&i(l,"style",p.style,f.style,o),8&c){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const r=t[e],s=p[r],a=f[r];a===s&&"value"!==r||i(l,r,s,a,o,n)}}1&c&&t.children!==e.children&&d(l,e.children)}else a||null!=u||_(l,p,f,n,o);((m=f.onVnodeUpdated)||h)&&zw(()=>{m&&Ok(m,n,e,t),h&&Hv(e,t,n,"updated")},r)},C=(t,e,n,r,o,i,s)=>{for(let a=0;a<e.length;a++){const l=t[a],c=e[a],d=l.el&&(l.type===hk||!kk(l,c)||198&l.shapeFlag)?u(l.el):n;m(l,c,d,null,r,o,i,s,!0)}},_=(t,e,n,r,o)=>{if(e!==n){if(e!==zg)for(const s in e)dy(s)||s in n||i(t,s,e[s],null,o,r);for(const s in n){if(dy(s))continue;const a=n[s],l=e[s];a!==l&&"value"!==s&&i(t,s,l,a,o,r)}"value"in n&&i(t,"value",e.value,n.value,o)}},E=(t,e,n,o,i,s,l,c,d)=>{const u=e.el=t?t.el:a(""),h=e.anchor=t?t.anchor:a("");let{patchFlag:p,dynamicChildren:f,slotScopeIds:m}=e;m&&(c=c?c.concat(m):m),null==t?(r(u,n,o),r(h,n,o),S(e.children||[],n,h,i,s,l,c,d)):p>0&&64&p&&f&&t.dynamicChildren?(C(t.dynamicChildren,f,n,i,s,l,c),(null!=e.key||i&&e===i.subTree)&&Jw(t,e,!0)):R(t,e,n,h,i,s,l,c,d)},T=(t,e,n,r,o,i,s,a,l)=>{e.slotScopeIds=a,null==t?512&e.shapeFlag?o.ctx.activate(e,n,r,s,l):M(e,n,r,o,i,s,l):A(t,e,l)},M=(t,e,n,r,o,i,s)=>{const a=t.component=function(t,e,n){const r=t.type,o=(e?e.appContext:t.appContext)||Dk,i={uid:Rk++,vnode:t,type:r,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ny(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Pw(r,o),emitsOptions:ik(r,o),emit:null,emitted:null,propsDefaults:zg,inheritAttrs:r.inheritAttrs,ctx:zg,data:zg,props:zg,attrs:zg,slots:zg,refs:zg,setupState:zg,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=ok.bind(null,i),t.ce&&t.ce(i),i}(t,r,o);if(Wv(t)&&(a.ctx.renderer=z),function(t,e=!1,n=!1){e&&Ik(e);const{props:r,children:o}=t.vnode,i=Hk(t);(function(t,e,n,r=!1){const o={},i=Dw();t.propsDefaults=Object.create(null),Lw(t,e,o,i);for(const e in t.propsOptions[0])e in o||(o[e]=void 0);n?t.props=r?o:Ub(o,!1,Tb,Lb,Pb):t.type.props?t.props=o:t.props=i,t.attrs=i})(t,r,i,e),((t,e,n)=>{const r=t.slots=Dw();if(32&t.vnode.shapeFlag){const t=e.__;t&&wy(r,"__",t,!0);const o=e._;o?(Vw(r,e,n),n&&wy(r,"_",o,!0)):Uw(e,r)}else e&&Fw(t,e)})(t,o,n||e);const s=i?function(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,hw);const{setup:r}=n;if(r){Xy();const n=t.setupContext=r.length>1?function(t){const e=e=>{t.exposed=e||{}};return{attrs:new Proxy(t.attrs,zk),slots:t.slots,emit:t.emit,expose:e}}(t):null,o=Pk(t),i=cv(r,t,0,[t.props,n]),s=sy(i);if(Qy(),o(),!s&&!t.sp||zv(t)||Fv(t),s){if(i.then($k,$k),e)return i.then(n=>{Fk(t,n,e)}).catch(e=>{uv(e,t,0)});t.asyncDep=i}else Fk(t,i,e)}else Vk(t,e)}(t,e):void 0;e&&Ik(!1)}(a,!1,s),a.asyncDep){if(o&&o.registerDep(a,O,s),!t.el){const t=a.subTree=Ck(fk);y(null,t,e,n)}}else O(a,t,e,n,o,i,s)},A=(t,e,n)=>{const r=e.component=t.component;if(function(t,e,n){const{props:r,children:o,component:i}=t,{props:s,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(!(n&&l>=0))return!(!o&&!a||a&&a.$stable)||r!==s&&(r?!s||dk(r,s,c):!!s);if(1024&l)return!0;if(16&l)return r?dk(r,s,c):!!s;if(8&l){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const n=t[e];if(s[n]!==r[n]&&!sk(c,n))return!0}}return!1}(t,e,n)){if(r.asyncDep&&!r.asyncResolved)return void D(r,e,n);r.next=e,r.update()}else e.el=t.el,r.vnode=e},O=(t,e,n,r,o,i,s)=>{const a=()=>{if(t.isMounted){let{next:e,bu:n,u:r,parent:l,vnode:c}=t;{const n=Gw(t);if(n)return e&&(e.el=c.el,D(t,e,s)),void n.asyncDep.then(()=>{t.isUnmounted||a()})}let d,h=e;Kw(t,!1),e?(e.el=c.el,D(t,e,s)):e=c,n&&vy(n),(d=e.props&&e.props.onVnodeBeforeUpdate)&&Ok(d,l,e,c),Kw(t,!0);const p=ak(t),f=t.subTree;t.subTree=p,m(f,p,u(f.el),U(f),t,o,i),e.el=p.el,null===h&&function({vnode:t,parent:e},n){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===t&&(r.el=t.el),r!==t)break;(t=e.vnode).el=n,e=e.parent}}(t,p.el),r&&zw(r,o),(d=e.props&&e.props.onVnodeUpdated)&&zw(()=>Ok(d,l,e,c),o),__VUE_PROD_DEVTOOLS__&&Rv(t)}else{let s;const{el:a,props:l}=e,{bm:c,m:d,parent:u,root:h,type:p}=t,f=zv(e);if(Kw(t,!1),c&&vy(c),!f&&(s=l&&l.onVnodeBeforeMount)&&Ok(s,u,e),Kw(t,!0),a&&q){const e=()=>{t.subTree=ak(t),q(a,t.subTree,t,o,null)};f&&p.__asyncHydrate?p.__asyncHydrate(a,t,e):e()}else{h.ce&&!1!==h.ce._def.shadowRoot&&h.ce._injectChildStyle(p);const s=t.subTree=ak(t);m(null,s,n,r,t,o,i),e.el=s.el}if(d&&zw(d,o),!f&&(s=l&&l.onVnodeMounted)){const t=e;zw(()=>Ok(s,u,t),o)}(256&e.shapeFlag||u&&zv(u.vnode)&&256&u.vnode.shapeFlag)&&t.a&&zw(t.a,o),t.isMounted=!0,__VUE_PROD_DEVTOOLS__&&Dv(t),e=n=r=null}};t.scope.on();const l=t.effect=new Py(a);t.scope.off();const c=t.update=l.run.bind(l),d=t.job=l.runIfDirty.bind(l);d.i=t,d.id=t.uid,l.scheduler=()=>wv(d),Kw(t,!0),c()},D=(t,e,n)=>{e.component=t;const r=t.vnode.props;t.vnode=e,t.next=null,function(t,e,n,r){const{props:o,attrs:i,vnode:{patchFlag:s}}=t,a=qb(o),[l]=t.propsOptions;let c=!1;if(!(r||s>0)||16&s){let r;Lw(t,e,o,i)&&(c=!0);for(const i in a)e&&(Zg(e,i)||(r=my(i))!==i&&Zg(e,r))||(l?!n||void 0===n[i]&&void 0===n[r]||(o[i]=Nw(l,a,i,void 0,t,!0)):delete o[i]);if(i!==a)for(const t in i)e&&Zg(e,t)||(delete i[t],c=!0)}else if(8&s){const n=t.vnode.dynamicProps;for(let r=0;r<n.length;r++){let s=n[r];if(sk(t.emitsOptions,s))continue;const d=e[s];if(l)if(Zg(i,s))d!==i[s]&&(i[s]=d,c=!0);else{const e=py(s);o[e]=Nw(l,a,e,d,t,!1)}else d!==i[s]&&(i[s]=d,c=!0)}}c&&cb(t.attrs,"set","")}(t,e.props,r,n),((t,e,n)=>{const{vnode:r,slots:o}=t;let i=!0,s=zg;if(32&r.shapeFlag){const t=e._;t?n&&1===t?i=!1:Vw(o,e,n):(i=!e.$stable,Uw(e,o)),s=e}else e&&(Fw(t,e),s={default:1});if(i)for(const t in o)Hw(t)||null!=s[t]||delete o[t]})(t,e.children,n),Xy(),Sv(t),Qy()},R=(t,e,n,r,o,i,s,a,l=!1)=>{const c=t&&t.children,u=t?t.shapeFlag:0,h=e.children,{patchFlag:p,shapeFlag:f}=e;if(p>0){if(128&p)return void N(c,h,n,r,o,i,s,a,l);if(256&p)return void L(c,h,n,r,o,i,s,a,l)}8&f?(16&u&&j(c,o,i),h!==c&&d(n,h)):16&u?16&f?N(c,h,n,r,o,i,s,a,l):j(c,o,i,!0):(8&u&&d(n,""),16&f&&S(h,n,r,o,i,s,a,l))},L=(t,e,n,r,o,i,s,a,l)=>{e=e||Wg;const c=(t=t||Wg).length,d=e.length,u=Math.min(c,d);let h;for(h=0;h<u;h++){const r=e[h]=l?Mk(e[h]):Tk(e[h]);m(t[h],r,n,null,o,i,s,a,l)}c>d?j(t,o,i,!0,!1,u):S(e,n,r,o,i,s,a,l,u)},N=(t,e,n,r,o,i,s,a,l)=>{let c=0;const d=e.length;let u=t.length-1,h=d-1;for(;c<=u&&c<=h;){const r=t[c],d=e[c]=l?Mk(e[c]):Tk(e[c]);if(!kk(r,d))break;m(r,d,n,null,o,i,s,a,l),c++}for(;c<=u&&c<=h;){const r=t[u],c=e[h]=l?Mk(e[h]):Tk(e[h]);if(!kk(r,c))break;m(r,c,n,null,o,i,s,a,l),u--,h--}if(c>u){if(c<=h){const t=h+1,u=t<d?e[t].el:r;for(;c<=h;)m(null,e[c]=l?Mk(e[c]):Tk(e[c]),n,u,o,i,s,a,l),c++}}else if(c>h)for(;c<=u;)P(t[c],o,i,!0),c++;else{const p=c,f=c,g=new Map;for(c=f;c<=h;c++){const t=e[c]=l?Mk(e[c]):Tk(e[c]);null!=t.key&&g.set(t.key,c)}let y,b=0;const v=h-f+1;let w=!1,k=0;const S=new Array(v);for(c=0;c<v;c++)S[c]=0;for(c=p;c<=u;c++){const r=t[c];if(b>=v){P(r,o,i,!0);continue}let d;if(null!=r.key)d=g.get(r.key);else for(y=f;y<=h;y++)if(0===S[y-f]&&kk(r,e[y])){d=y;break}void 0===d?P(r,o,i,!0):(S[d-f]=c+1,d>=k?k=d:w=!0,m(r,e[d],n,null,o,i,s,a,l),b++)}const x=w?function(t){const e=t.slice(),n=[0];let r,o,i,s,a;const l=t.length;for(r=0;r<l;r++){const l=t[r];if(0!==l){if(o=n[n.length-1],t[o]<l){e[r]=o,n.push(r);continue}for(i=0,s=n.length-1;i<s;)a=i+s>>1,t[n[a]]<l?i=a+1:s=a;l<t[n[i]]&&(i>0&&(e[r]=n[i-1]),n[i]=r)}}for(i=n.length,s=n[i-1];i-- >0;)n[i]=s,s=e[s];return n}(S):Wg;for(y=x.length-1,c=v-1;c>=0;c--){const t=f+c,u=e[t],h=t+1<d?e[t+1].el:r;0===S[c]?m(null,u,n,h,o,i,s,a,l):w&&(y<0||c!==x[y]?I(u,n,h,2):y--)}}},I=(t,e,n,i,s=null)=>{const{el:a,type:l,transition:c,children:d,shapeFlag:u}=t;if(6&u)I(t.component.subTree,e,n,i);else if(128&u)t.suspense.move(e,n,i);else if(64&u)l.move(t,e,n,z);else if(l!==hk)if(l!==mk)if(2!==i&&1&u&&c)if(0===i)c.beforeEnter(a),r(a,e,n),zw(()=>c.enter(a),s);else{const{leave:i,delayLeave:s,afterLeave:l}=c,d=()=>{t.ctx.isUnmounted?o(a):r(a,e,n)},u=()=>{i(a,()=>{d(),l&&l()})};s?s(a,d,u):u()}else r(a,e,n);else(({el:t,anchor:e},n,o)=>{let i;for(;t&&t!==e;)i=h(t),r(t,n,o),t=i;r(e,n,o)})(t,e,n);else{r(a,e,n);for(let t=0;t<d.length;t++)I(d[t],e,n,i);r(t.anchor,e,n)}},P=(t,e,n,r=!1,o=!1)=>{const{type:i,props:s,ref:a,children:l,dynamicChildren:c,shapeFlag:d,patchFlag:u,dirs:h,cacheIndex:p}=t;if(-2===u&&(o=!1),null!=a&&(Xy(),Vv(a,null,n,t,!0),Qy()),null!=p&&(e.renderCache[p]=void 0),256&d)return void e.ctx.deactivate(t);const f=1&d&&h,m=!zv(t);let g;if(m&&(g=s&&s.onVnodeBeforeUnmount)&&Ok(g,e,t),6&d)B(t.component,n,r);else{if(128&d)return void t.suspense.unmount(n,r);f&&Hv(t,null,e,"beforeUnmount"),64&d?t.type.remove(t,e,n,z,r):c&&!c.hasOnce&&(i!==hk||u>0&&64&u)?j(c,e,n,!1,!0):(i===hk&&384&u||!o&&16&d)&&j(l,e,n),r&&$(t)}(m&&(g=s&&s.onVnodeUnmounted)||f)&&zw(()=>{g&&Ok(g,e,t),f&&Hv(t,null,e,"unmounted")},n)},$=t=>{const{type:e,el:n,anchor:r,transition:i}=t;if(e===hk)return void H(n,r);if(e===mk)return void(({el:t,anchor:e})=>{let n;for(;t&&t!==e;)n=h(t),o(t),t=n;o(e)})(t);const s=()=>{o(n),i&&!i.persisted&&i.afterLeave&&i.afterLeave()};if(1&t.shapeFlag&&i&&!i.persisted){const{leave:e,delayLeave:r}=i,o=()=>e(n,s);r?r(t.el,s,o):o()}else s()},H=(t,e)=>{let n;for(;t!==e;)n=h(t),o(t),t=n;o(e)},B=(t,e,n)=>{const{bum:r,scope:o,job:i,subTree:s,um:a,m:l,a:c,parent:d,slots:{__:u}}=t;var h;Yw(l),Yw(c),r&&vy(r),d&&ty(u)&&u.forEach(t=>{d.renderCache[t]=void 0}),o.stop(),i&&(i.flags|=8,P(s,t,e,n)),a&&zw(a,e),zw(()=>{t.isUnmounted=!0},e),e&&e.pendingBranch&&!e.isUnmounted&&t.asyncDep&&!t.asyncResolved&&t.suspenseId===e.pendingId&&(e.deps--,0===e.deps&&e.resolve()),__VUE_PROD_DEVTOOLS__&&(h=t,Ev&&"function"==typeof Ev.cleanupBuffer&&!Ev.cleanupBuffer(h)&&Lv(h))},j=(t,e,n,r=!1,o=!1,i=0)=>{for(let s=i;s<t.length;s++)P(t[s],e,n,r,o)},U=t=>{if(6&t.shapeFlag)return U(t.component.subTree);if(128&t.shapeFlag)return t.suspense.next();const e=h(t.anchor||t.el),n=e&&e[Bv];return n?h(n):e};let F=!1;const V=(t,e,n)=>{null==t?e._vnode&&P(e._vnode,null,null,!0):m(e._vnode||null,t,e,null,null,null,n),e._vnode=t,F||(F=!0,Sv(),xv(),F=!1)},z={p:m,um:P,m:I,r:$,mt:M,mc:S,pc:R,pbc:C,n:U,o:t};let W,q;return e&&([W,q]=e(z)),{render:V,hydrate:W,createApp:Tw(V,W)}}function qw({type:t,props:e},n){return"svg"===n&&"foreignObject"===t||"mathml"===n&&"annotation-xml"===t&&e&&e.encoding&&e.encoding.includes("html")?void 0:n}function Kw({effect:t,job:e},n){n?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function Jw(t,e,n=!1){const r=t.children,o=e.children;if(ty(r)&&ty(o))for(let t=0;t<r.length;t++){const e=r[t];let i=o[t];1&i.shapeFlag&&!i.dynamicChildren&&((i.patchFlag<=0||32===i.patchFlag)&&(i=o[t]=Mk(o[t]),i.el=e.el),n||-2===i.patchFlag||Jw(e,i)),i.type===pk&&(i.el=e.el),i.type!==fk||i.el||(i.el=e.el)}}function Gw(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Gw(e)}function Yw(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const Xw=Symbol.for("v-scx"),Qw=()=>Aw(Xw);function Zw(t,e,n){return tk(t,e,n)}function tk(t,e,n=zg){const{immediate:r,deep:o,flush:i,once:s}=n,a=Yg({},n),l=e&&r||!e&&"post"!==i;let c;if(Uk)if("sync"===i){const t=Qw();c=t.__watcherHandles||(t.__watcherHandles=[])}else if(!l){const t=()=>{};return t.stop=qg,t.resume=qg,t.pause=qg,t}const d=Lk;a.call=(t,e,n)=>dv(t,d,e,n);let u=!1;"post"===i?a.scheduler=t=>{zw(t,d&&d.suspense)}:"sync"!==i&&(u=!0,a.scheduler=(t,e)=>{e?t():wv(t)}),a.augmentJob=t=>{e&&(t.flags|=4),u&&(t.flags|=2,d&&(t.id=d.uid,t.i=d))};const h=function(t,e,n=zg){const{immediate:r,deep:o,once:i,scheduler:s,augmentJob:a,call:l}=n,c=t=>o?t:zb(t)||!1===o||0===o?lv(t,1):lv(t);let d,u,h,p,f=!1,m=!1;if(Yb(t)?(u=()=>t.value,f=zb(t)):Fb(t)?(u=()=>c(t),f=!0):ty(t)?(m=!0,f=t.some(t=>Fb(t)||zb(t)),u=()=>t.map(t=>Yb(t)?t.value:Fb(t)?c(t):ny(t)?l?l(t,2):t():void 0)):u=ny(t)?e?l?()=>l(t,2):t:()=>{if(h){Xy();try{h()}finally{Qy()}}const e=av;av=d;try{return l?l(t,3,[p]):t(p)}finally{av=e}}:qg,e&&o){const t=u,e=!0===o?1/0:o;u=()=>lv(t(),e)}const g=Ry,y=()=>{d.stop(),g&&g.active&&Xg(g.effects,d)};if(i&&e){const t=e;e=(...e)=>{t(...e),y()}}let b=m?new Array(t.length).fill(iv):iv;const v=t=>{if(1&d.flags&&(d.dirty||t))if(e){const t=d.run();if(o||f||(m?t.some((t,e)=>by(t,b[e])):by(t,b))){h&&h();const n=av;av=d;try{const n=[t,b===iv?void 0:m&&b[0]===iv?[]:b,p];b=t,l?l(e,3,n):e(...n)}finally{av=n}}}else d.run()};return a&&a(v),d=new Py(u),d.scheduler=s?()=>s(v,!1):v,p=t=>function(t,e=!1,n=av){if(n){let e=sv.get(n);e||sv.set(n,e=[]),e.push(t)}}(t,!1,d),h=d.onStop=()=>{const t=sv.get(d);if(t){if(l)l(t,4);else for(const e of t)e();sv.delete(d)}},e?r?v(!0):b=d.run():s?s(v.bind(null,!0),!0):d.run(),y.pause=d.pause.bind(d),y.resume=d.resume.bind(d),y.stop=y,y}(t,e,a);return Uk&&(c?c.push(h):l&&h()),h}function ek(t,e,n){const r=this.proxy,o=ry(t)?t.includes(".")?nk(r,t):()=>r[t]:t.bind(r,r);let i;ny(e)?i=e:(i=e.handler,n=e);const s=Pk(this),a=tk(o,i.bind(r),n);return s(),a}function nk(t,e){const n=e.split(".");return()=>{let e=t;for(let t=0;t<n.length&&e;t++)e=e[n[t]];return e}}const rk=(t,e)=>"modelValue"===e||"model-value"===e?t.modelModifiers:t[`${e}Modifiers`]||t[`${py(e)}Modifiers`]||t[`${my(e)}Modifiers`];function ok(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||zg;let o=n;const i=e.startsWith("update:"),s=i&&rk(r,e.slice(7));let a;s&&(s.trim&&(o=n.map(t=>ry(t)?t.trim():t)),s.number&&(o=n.map(ky))),__VUE_PROD_DEVTOOLS__&&function(t,e,n){Av("component:emit",t.appContext.app,t,e,n)}(t,e,o);let l=r[a=yy(e)]||r[a=yy(py(e))];!l&&i&&(l=r[a=yy(my(e))]),l&&dv(l,t,6,o);const c=r[a+"Once"];if(c){if(t.emitted){if(t.emitted[a])return}else t.emitted={};t.emitted[a]=!0,dv(c,t,6,o)}}function ik(t,e,n=!1){const r=e.emitsCache,o=r.get(t);if(void 0!==o)return o;const i=t.emits;let s={},a=!1;if(__VUE_OPTIONS_API__&&!ny(t)){const r=t=>{const n=ik(t,e,!0);n&&(a=!0,Yg(s,n))};!n&&e.mixins.length&&e.mixins.forEach(r),t.extends&&r(t.extends),t.mixins&&t.mixins.forEach(r)}return i||a?(ty(i)?i.forEach(t=>s[t]=null):Yg(s,i),iy(t)&&r.set(t,s),s):(iy(t)&&r.set(t,null),null)}function sk(t,e){return!(!t||!Jg(e))&&(e=e.slice(2).replace(/Once$/,""),Zg(t,e[0].toLowerCase()+e.slice(1))||Zg(t,my(e))||Zg(t,e))}function ak(t){const{type:e,vnode:n,proxy:r,withProxy:o,propsOptions:[i],slots:s,attrs:a,emit:l,render:c,renderCache:d,props:u,data:h,setupState:p,ctx:f,inheritAttrs:m}=t,g=$v(t);let y,b;try{if(4&n.shapeFlag){const t=o||r,e=t;y=Tk(c.call(e,t,d,u,p,h,f)),b=a}else{const t=e;y=Tk(t.length>1?t(u,{attrs:a,slots:s,emit:l}):t(u,null)),b=e.props?a:lk(a)}}catch(e){gk.length=0,uv(e,t,1),y=Ck(fk)}let v=y;if(b&&!1!==m){const t=Object.keys(b),{shapeFlag:e}=v;t.length&&7&e&&(i&&t.some(Gg)&&(b=ck(b,i)),v=_k(v,b,!1,!0))}return n.dirs&&(v=_k(v,null,!1,!0),v.dirs=v.dirs?v.dirs.concat(n.dirs):n.dirs),n.transition&&jv(v,n.transition),y=v,$v(g),y}const lk=t=>{let e;for(const n in t)("class"===n||"style"===n||Jg(n))&&((e||(e={}))[n]=t[n]);return e},ck=(t,e)=>{const n={};for(const r in t)Gg(r)&&r.slice(9)in e||(n[r]=t[r]);return n};function dk(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let o=0;o<r.length;o++){const i=r[o];if(e[i]!==t[i]&&!sk(n,i))return!0}return!1}const uk=t=>t.__isSuspense;const hk=Symbol.for("v-fgt"),pk=Symbol.for("v-txt"),fk=Symbol.for("v-cmt"),mk=Symbol.for("v-stc"),gk=[];let yk=null,bk=1;function vk(t,e=!1){bk+=t,t<0&&yk&&e&&(yk.hasOnce=!0)}function wk(t){return!!t&&!0===t.__v_isVNode}function kk(t,e){return t.type===e.type&&t.key===e.key}const Sk=({key:t})=>null!=t?t:null,xk=({ref:t,ref_key:e,ref_for:n})=>("number"==typeof t&&(t=""+t),null!=t?ry(t)||Yb(t)||ny(t)?{i:Iv,r:t,k:e,f:!!n}:t:null);const Ck=function(t,e=null,n=null,r=0,o=null,i=!1){if(t&&t!==lw||(t=fk),wk(t)){const r=_k(t,e,!0);return n&&Ak(r,n),bk>0&&!i&&yk&&(6&r.shapeFlag?yk[yk.indexOf(t)]=r:yk.push(r)),r.patchFlag=-2,r}if(function(t){return ny(t)&&"__vccOpts"in t}(t)&&(t=t.__vccOpts),e){e=function(t){return t?Wb(t)||Rw(t)?Yg({},t):t:null}(e);let{class:t,style:n}=e;t&&!ry(t)&&(e.class=Ay(t)),iy(n)&&(Wb(n)&&!ty(n)&&(n=Yg({},n)),e.style=Cy(n))}return function(t,e=null,n=null,r=0,o=null,i=(t===hk?0:1),s=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Sk(e),ref:e&&xk(e),scopeId:Pv,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Iv};return a?(Ak(l,n),128&i&&t.normalize(l)):n&&(l.shapeFlag|=ry(n)?8:16),bk>0&&!s&&yk&&(l.patchFlag>0||6&i)&&32!==l.patchFlag&&yk.push(l),l}(t,e,n,r,o,ry(t)?1:uk(t)?128:(t=>t.__isTeleport)(t)?64:iy(t)?4:ny(t)?2:0,i,!0)};function _k(t,e,n=!1,r=!1){const{props:o,ref:i,patchFlag:s,children:a,transition:l}=t,c=e?function(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const t in r)if("class"===t)e.class!==r.class&&(e.class=Ay([e.class,r.class]));else if("style"===t)e.style=Cy([e.style,r.style]);else if(Jg(t)){const n=e[t],o=r[t];!o||n===o||ty(n)&&n.includes(o)||(e[t]=n?[].concat(n,o):o)}else""!==t&&(e[t]=r[t])}return e}(o||{},e):o,d={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&Sk(c),ref:e&&e.ref?n&&i?ty(i)?i.concat(xk(e)):[i,xk(e)]:xk(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==hk?-1===s?16:16|s:s,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:l,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&_k(t.ssContent),ssFallback:t.ssFallback&&_k(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l&&r&&jv(d,l.clone(d)),d}function Ek(t=" ",e=0){return Ck(pk,null,t,e)}function Tk(t){return null==t||"boolean"==typeof t?Ck(fk):ty(t)?Ck(hk,null,t.slice()):wk(t)?Mk(t):Ck(pk,null,String(t))}function Mk(t){return null===t.el&&-1!==t.patchFlag||t.memo?t:_k(t)}function Ak(t,e){let n=0;const{shapeFlag:r}=t;if(null==e)e=null;else if(ty(e))n=16;else if("object"==typeof e){if(65&r){const n=e.default;return void(n&&(n._c&&(n._d=!1),Ak(t,n()),n._c&&(n._d=!0)))}{n=32;const r=e._;r||Rw(e)?3===r&&Iv&&(1===Iv.slots._?e._=1:(e._=2,t.patchFlag|=1024)):e._ctx=Iv}}else ny(e)?(e={default:e,_ctx:Iv},n=32):(e=String(e),64&r?(n=16,e=[Ek(e)]):n=8);t.children=e,t.shapeFlag|=n}function Ok(t,e,n,r=null){dv(t,e,7,[n,r])}const Dk=_w();let Rk=0;let Lk=null;let Nk,Ik;{const t=xy(),e=(e,n)=>{let r;return(r=t[e])||(r=t[e]=[]),r.push(n),t=>{r.length>1?r.forEach(e=>e(t)):r[0](t)}};Nk=e("__VUE_INSTANCE_SETTERS__",t=>Lk=t),Ik=e("__VUE_SSR_SETTERS__",t=>Uk=t)}const Pk=t=>{const e=Lk;return Nk(t),t.scope.on(),()=>{t.scope.off(),Nk(e)}},$k=()=>{Lk&&Lk.scope.off(),Nk(null)};function Hk(t){return 4&t.vnode.shapeFlag}let Bk,jk,Uk=!1;function Fk(t,e,n){ny(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:iy(e)&&(__VUE_PROD_DEVTOOLS__&&(t.devtoolsRawSetupState=e),t.setupState=nv(e)),Vk(t,n)}function Vk(t,e,n){const r=t.type;if(!t.render){if(!e&&Bk&&!r.render){const e=r.template||__VUE_OPTIONS_API__&&yw(t).template;if(e){const{isCustomElement:n,compilerOptions:o}=t.appContext.config,{delimiters:i,compilerOptions:s}=r,a=Yg(Yg({isCustomElement:n,delimiters:i},o),s);r.render=Bk(e,a)}}t.render=r.render||qg,jk&&jk(t)}if(__VUE_OPTIONS_API__){const e=Pk(t);Xy();try{!function(t){const e=yw(t),n=t.proxy,r=t.ctx;fw=!1,e.beforeCreate&&mw(e.beforeCreate,t,"bc");const{data:o,computed:i,methods:s,watch:a,provide:l,inject:c,created:d,beforeMount:u,mounted:h,beforeUpdate:p,updated:f,activated:m,deactivated:g,beforeDestroy:y,beforeUnmount:b,destroyed:v,unmounted:w,render:k,renderTracked:S,renderTriggered:x,errorCaptured:C,serverPrefetch:_,expose:E,inheritAttrs:T,components:M,directives:A,filters:O}=e;if(c&&function(t,e){ty(t)&&(t=kw(t));for(const n in t){const r=t[n];let o;o=iy(r)?"default"in r?Aw(r.from||n,r.default,!0):Aw(r.from||n):Aw(r),Yb(o)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>o.value,set:t=>o.value=t}):e[n]=o}}(c,r),s)for(const t in s){const e=s[t];ny(e)&&(r[t]=e.bind(n))}if(o){const e=o.call(n,n);iy(e)&&(t.data=Bb(e))}if(fw=!0,i)for(const t in i){const e=i[t],o=ny(e)?e.bind(n,n):ny(e.get)?e.get.bind(n,n):qg,s=!ny(e)&&ny(e.set)?e.set.bind(n):qg,a=qk({get:o,set:s});Object.defineProperty(r,t,{enumerable:!0,configurable:!0,get:()=>a.value,set:t=>a.value=t})}if(a)for(const t in a)gw(a[t],r,n,t);if(l){const t=ny(l)?l.call(n):l;Reflect.ownKeys(t).forEach(e=>{!function(t,e){if(Lk){let n=Lk.provides;const r=Lk.parent&&Lk.parent.provides;r===n&&(n=Lk.provides=Object.create(r)),n[t]=e}}(e,t[e])})}function D(t,e){ty(e)?e.forEach(e=>t(e.bind(n))):e&&t(e.bind(n))}if(d&&mw(d,t,"c"),D(Qv,u),D(Zv,h),D(tw,p),D(ew,f),D(qv,m),D(Kv,g),D(aw,C),D(sw,S),D(iw,x),D(nw,b),D(rw,w),D(ow,_),ty(E))if(E.length){const e=t.exposed||(t.exposed={});E.forEach(t=>{Object.defineProperty(e,t,{get:()=>n[t],set:e=>n[t]=e})})}else t.exposed||(t.exposed={});k&&t.render===qg&&(t.render=k),null!=T&&(t.inheritAttrs=T),M&&(t.components=M),A&&(t.directives=A),_&&Fv(t)}(t)}finally{Qy(),e()}}}const zk={get:(t,e)=>(lb(t,0,""),t[e])};function Wk(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(nv(Kb(t.exposed)),{get:(e,n)=>n in e?e[n]:n in dw?dw[n](t):void 0,has:(t,e)=>e in t||e in dw})):t.proxy}const qk=(t,e)=>{const n=function(t,e,n=!1){let r,o;return ny(t)?r=t:(r=t.get,o=t.set),new ov(r,o,n)}(t,0,Uk);return n};function Kk(t,e,n){const r=arguments.length;return 2===r?iy(e)&&!ty(e)?wk(e)?Ck(t,null,[e]):Ck(t,e):Ck(t,null,e):(r>3?n=Array.prototype.slice.call(arguments,2):3===r&&wk(n)&&(n=[n]),Ck(t,e,n))}const Jk="3.5.17";let Gk;const Yk="undefined"!=typeof window&&window.trustedTypes;if(Yk)try{Gk=Yk.createPolicy("vue",{createHTML:t=>t})}catch(t){}const Xk=Gk?t=>Gk.createHTML(t):t=>t,Qk="undefined"!=typeof document?document:null,Zk=Qk&&Qk.createElement("template"),tS={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const o="svg"===e?Qk.createElementNS("http://www.w3.org/2000/svg",t):"mathml"===e?Qk.createElementNS("http://www.w3.org/1998/Math/MathML",t):n?Qk.createElement(t,{is:n}):Qk.createElement(t);return"select"===t&&r&&null!=r.multiple&&o.setAttribute("multiple",r.multiple),o},createText:t=>Qk.createTextNode(t),createComment:t=>Qk.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Qk.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,r,o,i){const s=n?n.previousSibling:e.lastChild;if(o&&(o===i||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),n),o!==i&&(o=o.nextSibling););else{Zk.innerHTML=Xk("svg"===r?`<svg>${t}</svg>`:"mathml"===r?`<math>${t}</math>`:t);const o=Zk.content;if("svg"===r||"mathml"===r){const t=o.firstChild;for(;t.firstChild;)o.appendChild(t.firstChild);o.removeChild(t)}e.insertBefore(o,n)}return[s?s.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},eS=Symbol("_vtc");Boolean;const nS=Symbol("_vod"),rS=Symbol("_vsh"),oS=Symbol(""),iS=/(^|;)\s*display\s*:/,sS=/\s*!important$/;function aS(t,e,n){if(ty(n))n.forEach(n=>aS(t,e,n));else if(null==n&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const r=function(t,e){const n=cS[e];if(n)return n;let r=py(e);if("filter"!==r&&r in t)return cS[e]=r;r=gy(r);for(let n=0;n<lS.length;n++){const o=lS[n]+r;if(o in t)return cS[e]=o}return e}(t,e);sS.test(n)?t.setProperty(my(r),n.replace(sS,""),"important"):t[r]=n}}const lS=["Webkit","Moz","ms"],cS={},dS="http://www.w3.org/1999/xlink";function uS(t,e,n,r,o,i=Oy(e)){r&&e.startsWith("xlink:")?null==n?t.removeAttributeNS(dS,e.slice(6,e.length)):t.setAttributeNS(dS,e,n):null==n||i&&!Dy(n)?t.removeAttribute(e):t.setAttribute(e,i?"":oy(n)?String(n):n)}function hS(t,e,n,r,o){if("innerHTML"===e||"textContent"===e)return void(null!=n&&(t[e]="innerHTML"===e?Xk(n):n));const i=t.tagName;if("value"===e&&"PROGRESS"!==i&&!i.includes("-")){const r="OPTION"===i?t.getAttribute("value")||"":t.value,o=null==n?"checkbox"===t.type?"on":"":String(n);return r===o&&"_value"in t||(t.value=o),null==n&&t.removeAttribute(e),void(t._value=n)}let s=!1;if(""===n||null==n){const r=typeof t[e];"boolean"===r?n=Dy(n):null==n&&"string"===r?(n="",s=!0):"number"===r&&(n=0,s=!0)}try{t[e]=n}catch(t){}s&&t.removeAttribute(o||e)}const pS=Symbol("_vei");const fS=/(?:Once|Passive|Capture)$/;let mS=0;const gS=Promise.resolve(),yS=()=>mS||(gS.then(()=>mS=0),mS=Date.now()),bS=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123;"undefined"!=typeof HTMLElement&&HTMLElement,Symbol("_moveCb"),Symbol("_enterCb"),Symbol("_assign");const vS=Yg({patchProp:(t,e,n,r,o,i)=>{const s="svg"===o;"class"===e?function(t,e,n){const r=t[eS];r&&(e=(e?[e,...r]:[...r]).join(" ")),null==e?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}(t,r,s):"style"===e?function(t,e,n){const r=t.style,o=ry(n);let i=!1;if(n&&!o){if(e)if(ry(e))for(const t of e.split(";")){const e=t.slice(0,t.indexOf(":")).trim();null==n[e]&&aS(r,e,"")}else for(const t in e)null==n[t]&&aS(r,t,"");for(const t in n)"display"===t&&(i=!0),aS(r,t,n[t])}else if(o){if(e!==n){const t=r[oS];t&&(n+=";"+t),r.cssText=n,i=iS.test(n)}}else e&&t.removeAttribute("style");nS in t&&(t[nS]=i?r.display:"",t[rS]&&(r.display="none"))}(t,n,r):Jg(e)?Gg(e)||function(t,e,n,r,o=null){const i=t[pS]||(t[pS]={}),s=i[e];if(r&&s)s.value=r;else{const[n,a]=function(t){let e;if(fS.test(t)){let n;for(e={};n=t.match(fS);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[":"===t[2]?t.slice(3):my(t.slice(2)),e]}(e);if(r){const s=i[e]=function(t,e){const n=t=>{if(t._vts){if(t._vts<=n.attached)return}else t._vts=Date.now();dv(function(t,e){if(ty(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(t=>e=>!e._stopped&&t&&t(e))}return e}(t,n.value),e,5,[t])};return n.value=t,n.attached=yS(),n}(r,o);!function(t,e,n,r){t.addEventListener(e,n,r)}(t,n,s,a)}else s&&(function(t,e,n,r){t.removeEventListener(e,n,r)}(t,n,s,a),i[e]=void 0)}}(t,e,0,r,i):("."===e[0]?(e=e.slice(1),1):"^"===e[0]?(e=e.slice(1),0):function(t,e,n,r){if(r)return"innerHTML"===e||"textContent"===e||!!(e in t&&bS(e)&&ny(n));if("spellcheck"===e||"draggable"===e||"translate"===e||"autocorrect"===e)return!1;if("form"===e)return!1;if("list"===e&&"INPUT"===t.tagName)return!1;if("type"===e&&"TEXTAREA"===t.tagName)return!1;if("width"===e||"height"===e){const e=t.tagName;if("IMG"===e||"VIDEO"===e||"CANVAS"===e||"SOURCE"===e)return!1}return(!bS(e)||!ry(n))&&e in t}(t,e,r,s))?(hS(t,e,r),t.tagName.includes("-")||"value"!==e&&"checked"!==e&&"selected"!==e||uS(t,e,r,s,0,"value"!==e)):!t._isVueCE||!/[A-Z]/.test(e)&&ry(r)?("true-value"===e?t._trueValue=r:"false-value"===e&&(t._falseValue=r),uS(t,e,r,s)):hS(t,py(e),r,0,e)}},tS);let wS;const kS=(...t)=>{(wS||(wS=Ww(vS))).render(...t)};function SS(t){return e=(e,n)=>({get:()=>(e(),t),set(e){t=e,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}),new rv(e);var e}var xS=class extends Ig{constructor(t={}){return super(t),this.contentComponent=null,this.appContext=null,this.reactiveState=SS(this.view.state),this.reactiveExtensionStorage=SS(this.extensionStorage),this.on("beforeTransaction",({nextState:t})=>{this.reactiveState.value=t,this.reactiveExtensionStorage.value=this.extensionStorage}),Kb(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(t,e){const n=super.registerPlugin(t,e);return this.reactiveState&&(this.reactiveState.value=n),n}unregisterPlugin(t){const e=super.unregisterPlugin(t);return this.reactiveState&&e&&(this.reactiveState.value=e),e}},CS=Uv({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=Xb(),n=Lk||Iv;return tk(()=>{const r=t.editor;r&&r.options.element&&e.value&&vv(()=>{var t;if(!e.value||!(null==(t=r.options.element)?void 0:t.firstChild))return;const o=tv(e.value);e.value.append(...r.options.element.childNodes),r.contentComponent=n.ctx._,n&&(r.appContext={...n.appContext,provides:n.provides}),r.setOptions({element:o}),r.createNodeViews()})},null,void 0),nw(()=>{const e=t.editor;e&&(e.contentComponent=null,e.appContext=null)}),{rootEl:e}},render(){return Kk("div",{ref:t=>{this.rootEl=t}})}}),_S=(Uv({name:"NodeViewContent",props:{as:{type:String,default:"div"}},render(){return Kk(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}}),Uv({name:"NodeViewWrapper",props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return Kk(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},null==(e=(t=this.$slots).default)?void 0:e.call(t))}}),class{constructor(t,{props:e={},editor:n}){this.editor=n,this.component=Kb(t),this.el=document.createElement("div"),this.props=Bb(e),this.renderedComponent=this.renderComponent()}get element(){return this.renderedComponent.el}get ref(){var t,e,n,r;return(null==(e=null==(t=this.renderedComponent.vNode)?void 0:t.component)?void 0:e.exposed)?this.renderedComponent.vNode.component.exposed:null==(r=null==(n=this.renderedComponent.vNode)?void 0:n.component)?void 0:r.proxy}renderComponent(){let t=Kk(this.component,this.props);return this.editor.appContext&&(t.appContext=this.editor.appContext),"undefined"!=typeof document&&this.el&&kS(t,this.el),{vNode:t,destroy:()=>{this.el&&kS(null,this.el),this.el=null,t=null},el:this.el?this.el.firstElementChild:null}}updateProps(t={}){Object.entries(t).forEach(([t,e])=>{this.props[t]=e}),this.renderComponent()}destroy(){this.renderedComponent.destroy()}});Boolean,Uv({name:"MarkViewContent",props:{as:{type:String,default:"span"}},render(){return Kk(this.as,{style:{whiteSpace:"inherit"},"data-mark-view-content":""})}}),Boolean;var ES=(t,e)=>{if("slot"===t)return 0;if(t instanceof Function)return t(e);const{children:n,...r}=null!=e?e:{};if("svg"===t)throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},TS=/^\s*>\s$/,MS=Ug.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:t}){return ES("blockquote",{...kf(this.options.HTMLAttributes,t),children:ES("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[jg({find:TS,type:this.type})]}}),AS=MS,OS=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,DS=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,RS=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,LS=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,NS=am.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!==t.style.fontWeight&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return ES("strong",{...kf(this.options.HTMLAttributes,t),children:ES("slot",{})})},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Pg({find:OS,type:this.type}),Pg({find:RS,type:this.type})]},addPasteRules(){return[Fg({find:DS,type:this.type}),Fg({find:LS,type:this.type})]}}),IS=NS,PS=/(^|[^`])`([^`]+)`(?!`)/,$S=/(^|[^`])`([^`]+)`(?!`)/g,HS=am.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:t}){return["code",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Pg({find:PS,type:this.type})]},addPasteRules(){return[Fg({find:$S,type:this.type})]}}),BS=HS,jS=/^```([a-z]+)?[\s\n]$/,US=/^~~~([a-z]+)?[\s\n]$/,FS=Ug.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;return[...(null==(e=t.firstElementChild)?void 0:e.classList)||[]].filter(t=>t.startsWith(n)).map(t=>t.replace(n,""))[0]||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:t,HTMLAttributes:e}){return["pre",kf(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=1===e.pos;return!(!t||e.parent.type.name!==this.name)&&!(!n&&e.parent.textContent.length)&&this.editor.commands.clearNodes()},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:o}=n;if(!o||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,s=r.parent.textContent.endsWith("\n\n");return!(!i||!s)&&t.chain().command(({tr:t})=>(t.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:o,empty:i}=n;if(!i||o.parent.type!==this.type)return!1;if(o.parentOffset!==o.parent.nodeSize-2)return!1;const s=o.after();return void 0!==s&&(r.nodeAt(s)?t.commands.command(({tr:t})=>(t.setSelection(Bc.near(r.resolve(s))),!0)):t.commands.exitCode())}}},addInputRules(){return[Hg({find:jS,type:this.type,getAttributes:t=>({language:t[1]})}),Hg({find:US,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new od({key:new ad("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),o=r?JSON.parse(r):void 0,i=null==o?void 0:o.mode;if(!n||!i)return!1;const{tr:s,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,"\n"));return s.replaceSelectionWith(this.type.create({language:i},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(Vc.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),t.dispatch(s),!0}}})]}}),VS=FS,zS=Ug.create({name:"doc",topNode:!0,content:"block+"}),WS=zS,qS=Ug.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:t}){return["br",kf(this.options.HTMLAttributes,t)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:t,storedMarks:o}=n;if(t.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:s}=r.extensionManager,a=o||t.$to.parentOffset&&t.$from.marks();return e().insertContent({type:this.name}).command(({tr:t,dispatch:e})=>{if(e&&a&&i){const e=a.filter(t=>s.includes(t.type.name));t.ensureMarks(e)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),KS=qS,JS=Ug.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,kf(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>!!this.options.levels.includes(t.level)&&e.setNode(this.name,t),toggleHeading:t=>({commands:e})=>!!this.options.levels.includes(t.level)&&e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Hg({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),GS=JS,YS=Ug.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:t}){return["hr",kf(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!function(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof Wc){const t=r.index();return r.parent.canReplaceWith(t,t+1,e)}let o=r.depth;for(;o>=0;){const t=r.index(o);if(r.node(o).contentMatchAt(t).matchType(e))return!0;o-=1}return!1}(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,o=t();return Yf(n)?o.insertContentAt(r.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({tr:t,dispatch:e})=>{var n;if(e){const{$to:e}=t.selection,r=e.end();if(e.nodeAfter)e.nodeAfter.isTextblock?t.setSelection(Vc.create(t.doc,e.pos+1)):e.nodeAfter.isBlock?t.setSelection(Wc.create(t.doc,e.pos)):t.setSelection(Vc.create(t.doc,e.pos));else{const o=null==(n=e.parent.type.contentMatch.defaultType)?void 0:n.create();o&&(t.insert(r,o),t.setSelection(Vc.create(t.doc,r+1)))}t.scrollIntoView()}return!0}).run()}}},addInputRules(){return[$g({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),XS=YS,QS=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,ZS=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,tx=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,ex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,nx=am.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>"normal"!==t.style.fontStyle&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Pg({find:QS,type:this.type}),Pg({find:tx,type:this.type})]},addPasteRules(){return[Fg({find:ZS,type:this.type}),Fg({find:ex,type:this.type})]}}),rx=nx;const ox=(t,e)=>{for(const n in e)t[n]=e[n];return t},ix="numeric",sx="ascii",ax="alpha",lx="asciinumeric",cx="alphanumeric",dx="domain",ux="emoji",hx="scheme",px="slashscheme",fx="whitespace";function mx(t,e){return t in e||(e[t]=[]),e[t]}function gx(t,e,n){e[ix]&&(e[lx]=!0,e[cx]=!0),e[sx]&&(e[lx]=!0,e[ax]=!0),e[lx]&&(e[cx]=!0),e[ax]&&(e[cx]=!0),e[cx]&&(e[dx]=!0),e[ux]&&(e[dx]=!0);for(const r in e){const e=mx(r,n);e.indexOf(t)<0&&e.push(t)}}function yx(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}yx.groups={},yx.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let n=0;n<e.jr.length;n++){const r=e.jr[n][0],o=e.jr[n][1];if(o&&r.test(t))return o}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let o=0;o<t.length;o++)this.tt(t[o],e,n,r)},tr(t,e,n,r){let o;return r=r||yx.groups,e&&e.j?o=e:(o=new yx(e),n&&r&&gx(e,n,r)),this.jr.push([t,o]),o},ts(t,e,n,r){let o=this;const i=t.length;if(!i)return o;for(let e=0;e<i-1;e++)o=o.tt(t[e]);return o.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||yx.groups;const o=this;if(e&&e.j)return o.j[t]=e,e;const i=e;let s,a=o.go(t);if(a?(s=new yx,ox(s.j,a.j),s.jr.push.apply(s.jr,a.jr),s.jd=a.jd,s.t=a.t):s=new yx,i){if(r)if(s.t&&"string"==typeof s.t){const t=ox(function(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}(s.t,r),n);gx(i,t,r)}else n&&gx(i,n,r);s.t=i}return o.j[t]=s,s}};const bx=(t,e,n,r,o)=>t.ta(e,n,r,o),vx=(t,e,n,r,o)=>t.tr(e,n,r,o),wx=(t,e,n,r,o)=>t.ts(e,n,r,o),kx=(t,e,n,r,o)=>t.tt(e,n,r,o),Sx="WORD",xx="UWORD",Cx="ASCIINUMERICAL",_x="ALPHANUMERICAL",Ex="LOCALHOST",Tx="TLD",Mx="UTLD",Ax="SCHEME",Ox="SLASH_SCHEME",Dx="NUM",Rx="WS",Lx="NL",Nx="OPENBRACE",Ix="CLOSEBRACE",Px="OPENBRACKET",$x="CLOSEBRACKET",Hx="OPENPAREN",Bx="CLOSEPAREN",jx="OPENANGLEBRACKET",Ux="CLOSEANGLEBRACKET",Fx="FULLWIDTHLEFTPAREN",Vx="FULLWIDTHRIGHTPAREN",zx="LEFTCORNERBRACKET",Wx="RIGHTCORNERBRACKET",qx="LEFTWHITECORNERBRACKET",Kx="RIGHTWHITECORNERBRACKET",Jx="FULLWIDTHLESSTHAN",Gx="FULLWIDTHGREATERTHAN",Yx="AMPERSAND",Xx="APOSTROPHE",Qx="ASTERISK",Zx="AT",tC="BACKSLASH",eC="BACKTICK",nC="CARET",rC="COLON",oC="COMMA",iC="DOLLAR",sC="DOT",aC="EQUALS",lC="EXCLAMATION",cC="HYPHEN",dC="PERCENT",uC="PIPE",hC="PLUS",pC="POUND",fC="QUERY",mC="QUOTE",gC="FULLWIDTHMIDDLEDOT",yC="SEMI",bC="SLASH",vC="TILDE",wC="UNDERSCORE",kC="EMOJI",SC="SYM";var xC=Object.freeze({__proto__:null,ALPHANUMERICAL:_x,AMPERSAND:Yx,APOSTROPHE:Xx,ASCIINUMERICAL:Cx,ASTERISK:Qx,AT:Zx,BACKSLASH:tC,BACKTICK:eC,CARET:nC,CLOSEANGLEBRACKET:Ux,CLOSEBRACE:Ix,CLOSEBRACKET:$x,CLOSEPAREN:Bx,COLON:rC,COMMA:oC,DOLLAR:iC,DOT:sC,EMOJI:kC,EQUALS:aC,EXCLAMATION:lC,FULLWIDTHGREATERTHAN:Gx,FULLWIDTHLEFTPAREN:Fx,FULLWIDTHLESSTHAN:Jx,FULLWIDTHMIDDLEDOT:gC,FULLWIDTHRIGHTPAREN:Vx,HYPHEN:cC,LEFTCORNERBRACKET:zx,LEFTWHITECORNERBRACKET:qx,LOCALHOST:Ex,NL:Lx,NUM:Dx,OPENANGLEBRACKET:jx,OPENBRACE:Nx,OPENBRACKET:Px,OPENPAREN:Hx,PERCENT:dC,PIPE:uC,PLUS:hC,POUND:pC,QUERY:fC,QUOTE:mC,RIGHTCORNERBRACKET:Wx,RIGHTWHITECORNERBRACKET:Kx,SCHEME:Ax,SEMI:yC,SLASH:bC,SLASH_SCHEME:Ox,SYM:SC,TILDE:vC,TLD:Tx,UNDERSCORE:wC,UTLD:Mx,UWORD:xx,WORD:Sx,WS:Rx});const CC=/[a-z]/,_C=/\p{L}/u,EC=/\p{Emoji}/u,TC=/\d/,MC=/\s/;let AC=null,OC=null;function DC(t,e){const n=function(t){const e=[],n=t.length;let r=0;for(;r<n;){let o,i=t.charCodeAt(r),s=i<55296||i>56319||r+1===n||(o=t.charCodeAt(r+1))<56320||o>57343?t[r]:t.slice(r,r+2);e.push(s),r+=s.length}return e}(e.replace(/[A-Z]/g,t=>t.toLowerCase())),r=n.length,o=[];let i=0,s=0;for(;s<r;){let a=t,l=null,c=0,d=null,u=-1,h=-1;for(;s<r&&(l=a.go(n[s]));)a=l,a.accepts()?(u=0,h=0,d=a):u>=0&&(u+=n[s].length,h++),c+=n[s].length,i+=n[s].length,s++;i-=u,s-=h,c-=u,o.push({t:d.t,v:e.slice(i-c,i),s:i-c,e:i})}return o}function RC(t,e,n,r,o){let i;const s=e.length;for(let n=0;n<s-1;n++){const s=e[n];t.j[s]?i=t.j[s]:(i=new yx(r),i.jr=o.slice(),t.j[s]=i),t=i}return i=new yx(n),i.jr=o.slice(),t.j[e[s-1]]=i,i}function LC(t){const e=[],n=[];let r=0;for(;r<t.length;){let o=0;for(;"0123456789".indexOf(t[r+o])>=0;)o++;if(o>0){e.push(n.join(""));for(let e=parseInt(t.substring(r,r+o),10);e>0;e--)n.pop();r+=o}else n.push(t[r]),r++}return e}const NC={defaultProtocol:"http",events:null,format:PC,formatHref:PC,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function IC(t,e=null){let n=ox({},NC);t&&(n=ox(n,t instanceof IC?t.o:t));const r=n.ignoreTags,o=[];for(let t=0;t<r.length;t++)o.push(r[t].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=o}function PC(t){return t}function $C(t,e){this.t="token",this.v=t,this.tk=e}function HC(t,e){class n extends $C{constructor(e,n){super(e,n),this.t=t}}for(const t in e)n.prototype[t]=e[t];return n.t=t,n}IC.prototype={o:NC,ignoreTags:[],defaultRender:t=>t,check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=null!=e;let o=this.o[t];return o?("object"==typeof o?(o=n.t in o?o[n.t]:NC[t],"function"==typeof o&&r&&(o=o(e,n))):"function"==typeof o&&r&&(o=o(e,n.t,n)),o):o},getObj(t,e,n){let r=this.o[t];return"function"==typeof r&&null!=e&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}},$C.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=NC.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),o=t.get("tagName",n,e),i=this.toFormattedString(t),s={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),d=t.getObj("attributes",n,e),u=t.getObj("events",n,e);return s.href=r,a&&(s.class=a),l&&(s.target=l),c&&(s.rel=c),d&&ox(s,d),{tagName:o,attributes:s,content:i,eventListeners:u}}};const BC=HC("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),jC=HC("text"),UC=HC("nl"),FC=HC("url",{isLink:!0,toHref(t=NC.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Ex&&t[1].t===rC}}),VC=t=>new yx(t);function zC(t,e,n){const r=n[0].s,o=n[n.length-1].e;return new t(e.slice(r,o),n)}const WC="undefined"!=typeof console&&console&&console.warn||(()=>{}),qC={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function KC(t,e=!1){if(qC.initialized&&WC(`linkifyjs: already initialized - will not register custom scheme "${t}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');qC.customSchemes.push([t,e])}function JC(t){return qC.initialized||function(){qC.scanner=function(t=[]){const e={};yx.groups=e;const n=new yx;null==AC&&(AC=LC("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==OC&&(OC=LC("121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222")),kx(n,"'",Xx),kx(n,"{",Nx),kx(n,"}",Ix),kx(n,"[",Px),kx(n,"]",$x),kx(n,"(",Hx),kx(n,")",Bx),kx(n,"<",jx),kx(n,">",Ux),kx(n,"",Fx),kx(n,"",Vx),kx(n,"",zx),kx(n,"",Wx),kx(n,"",qx),kx(n,"",Kx),kx(n,"",Jx),kx(n,"",Gx),kx(n,"&",Yx),kx(n,"*",Qx),kx(n,"@",Zx),kx(n,"`",eC),kx(n,"^",nC),kx(n,":",rC),kx(n,",",oC),kx(n,"$",iC),kx(n,".",sC),kx(n,"=",aC),kx(n,"!",lC),kx(n,"-",cC),kx(n,"%",dC),kx(n,"|",uC),kx(n,"+",hC),kx(n,"#",pC),kx(n,"?",fC),kx(n,'"',mC),kx(n,"/",bC),kx(n,";",yC),kx(n,"~",vC),kx(n,"_",wC),kx(n,"\\",tC),kx(n,"",gC);const r=vx(n,TC,Dx,{[ix]:!0});vx(r,TC,r);const o=vx(r,CC,Cx,{[lx]:!0}),i=vx(r,_C,_x,{[cx]:!0}),s=vx(n,CC,Sx,{[sx]:!0});vx(s,TC,o),vx(s,CC,s),vx(o,TC,o),vx(o,CC,o);const a=vx(n,_C,xx,{[ax]:!0});vx(a,CC),vx(a,TC,i),vx(a,_C,a),vx(i,TC,i),vx(i,CC),vx(i,_C,i);const l=kx(n,"\n",Lx,{[fx]:!0}),c=kx(n,"\r",Rx,{[fx]:!0}),d=vx(n,MC,Rx,{[fx]:!0});kx(n,"",d),kx(c,"\n",l),kx(c,"",d),vx(c,MC,d),kx(d,"\r"),kx(d,"\n"),vx(d,MC,d),kx(d,"",d);const u=vx(n,EC,kC,{[ux]:!0});kx(u,"#"),vx(u,EC,u),kx(u,"",u);const h=kx(u,"");kx(h,"#"),vx(h,EC,u);const p=[[CC,s],[TC,o]],f=[[CC,null],[_C,a],[TC,i]];for(let t=0;t<AC.length;t++)RC(n,AC[t],Tx,Sx,p);for(let t=0;t<OC.length;t++)RC(n,OC[t],Mx,xx,f);gx(Tx,{tld:!0,ascii:!0},e),gx(Mx,{utld:!0,alpha:!0},e),RC(n,"file",Ax,Sx,p),RC(n,"mailto",Ax,Sx,p),RC(n,"http",Ox,Sx,p),RC(n,"https",Ox,Sx,p),RC(n,"ftp",Ox,Sx,p),RC(n,"ftps",Ox,Sx,p),gx(Ax,{scheme:!0,ascii:!0},e),gx(Ox,{slashscheme:!0,ascii:!0},e),t=t.sort((t,e)=>t[0]>e[0]?1:-1);for(let e=0;e<t.length;e++){const r=t[e][0],o=t[e][1]?{[hx]:!0}:{[px]:!0};r.indexOf("-")>=0?o[dx]=!0:CC.test(r)?TC.test(r)?o[lx]=!0:o[sx]=!0:o[ix]=!0,wx(n,r,r,o)}return wx(n,"localhost",Ex,{ascii:!0}),n.jd=new yx(SC),{start:n,tokens:ox({groups:e},xC)}}(qC.customSchemes);for(let t=0;t<qC.tokenQueue.length;t++)qC.tokenQueue[t][1]({scanner:qC.scanner});qC.parser=function({groups:t}){const e=t.domain.concat([Yx,Qx,Zx,tC,eC,nC,iC,aC,cC,Dx,dC,uC,hC,pC,bC,SC,vC,wC]),n=[Xx,rC,oC,sC,lC,dC,fC,mC,yC,jx,Ux,Nx,Ix,$x,Px,Hx,Bx,Fx,Vx,zx,Wx,qx,Kx,Jx,Gx],r=[Yx,Xx,Qx,tC,eC,nC,iC,aC,cC,Nx,Ix,dC,uC,hC,pC,fC,bC,SC,vC,wC],o=VC(),i=kx(o,vC);bx(i,r,i),bx(i,t.domain,i);const s=VC(),a=VC(),l=VC();bx(o,t.domain,s),bx(o,t.scheme,a),bx(o,t.slashscheme,l),bx(s,r,i),bx(s,t.domain,s);const c=kx(s,Zx);kx(i,Zx,c),kx(a,Zx,c),kx(l,Zx,c);const d=kx(i,sC);bx(d,r,i),bx(d,t.domain,i);const u=VC();bx(c,t.domain,u),bx(u,t.domain,u);const h=kx(u,sC);bx(h,t.domain,u);const p=VC(BC);bx(h,t.tld,p),bx(h,t.utld,p),kx(c,Ex,p);const f=kx(u,cC);kx(f,cC,f),bx(f,t.domain,u),bx(p,t.domain,u),kx(p,sC,h),kx(p,cC,f);const m=kx(p,rC);bx(m,t.numeric,BC);const g=kx(s,cC),y=kx(s,sC);kx(g,cC,g),bx(g,t.domain,s),bx(y,r,i),bx(y,t.domain,s);const b=VC(FC);bx(y,t.tld,b),bx(y,t.utld,b),bx(b,t.domain,s),bx(b,r,i),kx(b,sC,y),kx(b,cC,g),kx(b,Zx,c);const v=kx(b,rC),w=VC(FC);bx(v,t.numeric,w);const k=VC(FC),S=VC();bx(k,e,k),bx(k,n,S),bx(S,e,k),bx(S,n,S),kx(b,bC,k),kx(w,bC,k);const x=kx(a,rC),C=kx(l,rC),_=kx(C,bC),E=kx(_,bC);bx(a,t.domain,s),kx(a,sC,y),kx(a,cC,g),bx(l,t.domain,s),kx(l,sC,y),kx(l,cC,g),bx(x,t.domain,k),kx(x,bC,k),kx(x,fC,k),bx(E,t.domain,k),bx(E,e,k),kx(E,bC,k);const T=[[Nx,Ix],[Px,$x],[Hx,Bx],[jx,Ux],[Fx,Vx],[zx,Wx],[qx,Kx],[Jx,Gx]];for(let t=0;t<T.length;t++){const[r,o]=T[t],i=kx(k,r);kx(S,r,i),kx(i,o,k);const s=VC(FC);bx(i,e,s);const a=VC();bx(i,n),bx(s,e,s),bx(s,n,a),bx(a,e,s),bx(a,n,a),kx(s,o,k),kx(a,o,k)}return kx(o,Ex,b),kx(o,Lx,UC),{start:o,tokens:xC}}(qC.scanner.tokens);for(let t=0;t<qC.pluginQueue.length;t++)qC.pluginQueue[t][1]({scanner:qC.scanner,parser:qC.parser});qC.initialized=!0}(),function(t,e,n){let r=n.length,o=0,i=[],s=[];for(;o<r;){let a=t,l=null,c=null,d=0,u=null,h=-1;for(;o<r&&!(l=a.go(n[o].t));)s.push(n[o++]);for(;o<r&&(c=l||a.go(n[o].t));)l=null,a=c,a.accepts()?(h=0,u=a):h>=0&&h++,o++,d++;if(h<0)o-=d,o<r&&(s.push(n[o]),o++);else{s.length>0&&(i.push(zC(jC,e,s)),s=[]),o-=h,d-=h;const t=u.t,r=n.slice(o-d,o);i.push(zC(t,e,r))}}return s.length>0&&i.push(zC(jC,e,s)),i}(qC.parser.start,t,DC(qC.scanner.start,t))}function GC(t,e=null,n=null){if(e&&"object"==typeof e){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new IC(n),o=JC(t),i=[];for(let t=0;t<o.length;t++){const n=o[t];!n.isLink||e&&n.t!==e||!r.check(n)||i.push(n.toFormattedObject(r))}return i}JC.scan=DC;var YC="[\0- -\u2029]",XC=new RegExp(YC),QC=new RegExp(`${YC}$`),ZC=new RegExp(YC,"g");function t_(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(t=>{const e="string"==typeof t?t:t.scheme;e&&n.push(e)}),!t||t.replace(ZC,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var e_=am.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{"string"!=typeof t?KC(t.scheme,t.optionalSlashes):KC(t)})},onDestroy(){yx.groups={},qC.scanner=null,qC.parser=null,qC.tokenQueue=[],qC.pluginQueue=[],qC.customSchemes=[],qC.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!t_(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}),addAttributes(){return{href:{default:null,parseHTML:t=>t.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!(!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!t_(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:t=>!!t_(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",kf(this.options.HTMLAttributes,t),0]:["a",kf(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return!!this.options.isAllowedUri(n,{defaultValidate:t=>!!t_(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&e().setMark(this.name,t).setMeta("preventAutolink",!0).run()},toggleLink:t=>({chain:e})=>{const{href:n}=t;return!!this.options.isAllowedUri(n,{defaultValidate:t=>!!t_(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Fg({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,o=GC(t).filter(t=>t.isLink&&this.options.isAllowedUri(t.value,{defaultValidate:t=>!!t_(t,n),protocols:n,defaultProtocol:r}));o.length&&o.forEach(t=>e.push({text:t.value,data:{href:t.href},index:t.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:null==(e=t.data)?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push((r={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:t=>this.options.isAllowedUri(t,{defaultValidate:t=>!!t_(t,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink},new od({key:new ad("autolink"),appendTransaction:(t,e,n)=>{const o=t.some(t=>t.docChanged)&&!e.doc.eq(n.doc),i=t.some(t=>t.getMeta("preventAutolink"));if(!o||i)return;const{tr:s}=n;return Pf(af(e.doc,[...t])).forEach(({newRange:t})=>{const e=function(t,e){const n=[];return t.nodesBetween(e.from,e.to,(t,e)=>{(t=>t.isTextblock)(t)&&n.push({node:t,pos:e})}),n}(n.doc,t);let o,i;if(e.length>1)o=e[0],i=n.doc.textBetween(o.pos,o.pos+o.node.nodeSize,void 0," ");else if(e.length){const r=n.doc.textBetween(t.from,t.to," "," ");if(!QC.test(r))return;o=e[0],i=n.doc.textBetween(o.pos,t.to,void 0," ")}if(o&&i){const t=i.split(XC).filter(Boolean);if(t.length<=0)return!1;const e=t[t.length-1],l=o.pos+i.lastIndexOf(e);if(!e)return!1;const c=JC(e).map(t=>t.toObject(r.defaultProtocol));if(!(1===(a=c).length?a[0].isLink:3===a.length&&a[1].isLink&&["()","[]"].includes(a[0].value+a[2].value)))return!1;c.filter(t=>t.isLink).map(t=>({...t,from:l+t.start+1,to:l+t.end+1})).filter(t=>!n.schema.marks.code||!n.doc.rangeHasMark(t.from,t.to,n.schema.marks.code)).filter(t=>r.validate(t.value)).filter(t=>r.shouldAutoLink(t.value)).forEach(t=>{Ff(t.from,t.to,n.doc).some(t=>t.mark.type===r.type)||s.addMark(t.from,t.to,r.type.create({href:t.href}))})}var a}),s.steps.length?s:void 0}}))),!0===this.options.openOnClick&&t.push(function(t){return new od({key:new ad("handleClickLink"),props:{handleClick:(e,n,r)=>{var o,i;if(0!==r.button)return!1;if(!e.editable)return!1;let s=null;if(r.target instanceof HTMLAnchorElement)s=r.target;else{let t=r.target;const e=[];for(;"DIV"!==t.nodeName;)e.push(t),t=t.parentNode;s=e.find(t=>"A"===t.nodeName)}if(!s)return!1;const a=If(e.state,t.type.name),l=null!=(o=null==s?void 0:s.href)?o:a.href,c=null!=(i=null==s?void 0:s.target)?i:a.target;return!(!s||!l||(window.open(l,c),0))}}})}({type:this.type})),this.options.linkOnPaste&&t.push(function(t){return new od({key:new ad("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:o}=e,{selection:i}=o,{empty:s}=i;if(s)return!1;let a="";r.content.forEach(t=>{a+=t.textContent});const l=GC(a,{defaultProtocol:t.defaultProtocol}).find(t=>t.isLink&&t.value===a);return!(!a||!l)&&t.editor.commands.setMark(t.type,{href:l.href})}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t;var r}}),n_=e_,r_=Object.defineProperty,o_="textStyle",i_=/^\s*([-+*])\s$/,s_=Ug.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:t}){return["ul",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(o_)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=jg({find:i_,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=jg({find:i_,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(o_),editor:this.editor})),[t]}}),a_=Ug.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:t}){return["li",kf(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}});((t,e)=>{for(var n in e)r_(t,n,{get:e[n],enumerable:!0})})({},{findListItemPos:()=>l_,getNextListDepth:()=>c_,handleBackspace:()=>p_,handleDelete:()=>g_,hasListBefore:()=>d_,hasListItemAfter:()=>y_,hasListItemBefore:()=>u_,listItemHasSubList:()=>h_,nextListIsDeeper:()=>f_,nextListIsHigher:()=>m_});var l_=(t,e)=>{const{$from:n}=e.selection,r=Lf(t,e.schema);let o=null,i=n.depth,s=n.pos,a=null;for(;i>0&&null===a;)o=n.node(i),o.type===r?a=i:(i-=1,s-=1);return null===a?null:{$pos:e.doc.resolve(s),depth:a}},c_=(t,e)=>{const n=l_(t,e);if(!n)return!1;const[,r]=((t,e,n,r=20)=>{const o=t.doc.resolve(n);let i=r,s=null;for(;i>0&&null===s;){const t=o.node(i);(null==t?void 0:t.type.name)===e?s=t:i-=1}return[s,i]})(e,t,n.$pos.pos+4);return r},d_=(t,e,n)=>{const{$anchor:r}=t.selection,o=Math.max(0,r.pos-2),i=t.doc.resolve(o).node();return!(!i||!n.includes(i.type.name))},u_=(t,e)=>{var n;const{$anchor:r}=e.selection,o=e.doc.resolve(r.pos-2);return 0!==o.index()&&(null==(n=o.nodeBefore)?void 0:n.type.name)===t},h_=(t,e,n)=>{if(!n)return!1;const r=Lf(t,e.schema);let o=!1;return n.descendants(t=>{t.type===r&&(o=!0)}),o},p_=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!qf(t.state,e)&&d_(t.state,e,n)){const{$anchor:n}=t.state.selection,r=t.state.doc.resolve(n.before()-1),o=[];r.node().descendants((t,n)=>{t.type.name===e&&o.push({node:t,pos:n})});const i=o.at(-1);if(!i)return!1;const s=t.state.doc.resolve(r.start()+i.pos+1);return t.chain().cut({from:n.start()-1,to:n.end()+1},s.end()).joinForward().run()}if(!qf(t.state,e))return!1;if(!(t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)})(t.state))return!1;const r=l_(e,t.state);if(!r)return!1;const o=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),i=h_(e,t.state,o);return u_(e,t.state)&&!i?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},f_=(t,e)=>{const n=c_(t,e),r=l_(t,e);return!(!r||!n)&&n>r.depth},m_=(t,e)=>{const n=c_(t,e),r=l_(t,e);return!(!r||!n)&&n<r.depth},g_=(t,e)=>{if(!qf(t.state,e))return!1;if(!((t,e)=>{const{$from:n,$to:r,$anchor:o}=t.selection;if(e){const n=pf(t=>t.type.name===e)(t.selection);if(!n)return!1;const r=t.doc.resolve(n.pos+1);return o.pos+1===r.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)})(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:o}=n;return!(!n.empty&&r.sameParent(o))&&(f_(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():m_(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward())},y_=(t,e)=>{var n;const{$anchor:r}=e.selection,o=e.doc.resolve(r.pos-r.parentOffset-2);return o.index()!==o.parent.childCount-1&&(null==(n=o.nodeAfter)?void 0:n.type.name)===t},b_=hm.create({name:"listKeymap",addOptions:()=>({listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}),addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{void 0!==t.state.schema.nodes[n]&&g_(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{void 0!==t.state.schema.nodes[n]&&g_(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{void 0!==t.state.schema.nodes[n]&&p_(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{void 0!==t.state.schema.nodes[n]&&p_(t,n,r)&&(e=!0)}),e}}}}),v_="textStyle",w_=/^(\d+)\.\s$/,k_=Ug.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return 1===e?["ol",kf(this.options.HTMLAttributes,n),0]:["ol",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(v_)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=jg({find:w_,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=jg({find:w_,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(v_)}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1],editor:this.editor})),[t]}}),S_=/^\s*(\[([( |x])?\])\s$/,x_=Ug.create({name:"taskItem",addOptions:()=>({nested:!1,HTMLAttributes:{},taskListTypeName:"taskList"}),content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return""===e||"true"===e},renderHTML:t=>({"data-checked":t.checked})}}),parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",kf(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const o=document.createElement("li"),i=document.createElement("label"),s=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",t=>t.preventDefault()),a.addEventListener("change",e=>{if(!r.isEditable&&!this.options.onReadOnlyChecked)return void(a.checked=!a.checked);const{checked:o}=e.target;r.isEditable&&"function"==typeof n&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:t})=>{const e=n();if("number"!=typeof e)return!1;const r=t.doc.nodeAt(e);return t.setNodeMarkup(e,void 0,{...null==r?void 0:r.attrs,checked:o}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,o)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([t,e])=>{o.setAttribute(t,e)}),o.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,i.append(a,s),o.append(i,l),Object.entries(e).forEach(([t,e])=>{o.setAttribute(t,e)}),{dom:o,contentDOM:l,update:t=>t.type===this.type&&(o.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,!0)}}},addInputRules(){return[jg({find:S_,type:this.type,getAttributes:t=>({checked:"x"===t[t.length-1]})})]}}),C_=Ug.create({name:"taskList",addOptions:()=>({itemTypeName:"taskItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",kf(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),__=(hm.create({name:"listKit",addExtensions(){const t=[];return!1!==this.options.bulletList&&t.push(s_.configure(this.options.bulletList)),!1!==this.options.listItem&&t.push(a_.configure(this.options.listItem)),!1!==this.options.listKeymap&&t.push(b_.configure(this.options.listKeymap)),!1!==this.options.orderedList&&t.push(k_.configure(this.options.orderedList)),!1!==this.options.taskItem&&t.push(x_.configure(this.options.taskItem)),!1!==this.options.taskList&&t.push(C_.configure(this.options.taskList)),t}}),Ug.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:t}){return["p",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}})),E_=__,T_=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,M_=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,A_=am.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>!!t.includes("line-through")&&{}}],renderHTML({HTMLAttributes:t}){return["s",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Pg({find:T_,type:this.type})]},addPasteRules(){return[Fg({find:M_,type:this.type})]}}),O_=A_,D_=Ug.create({name:"text",group:"inline"}),R_=D_,L_=am.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>!!t.includes("underline")&&{}}],renderHTML({HTMLAttributes:t}){return["u",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),N_=L_;function I_(t={}){return new od({view:e=>new P_(e,t)})}class P_{constructor(t,e){var n;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=e.width)&&void 0!==n?n:1,this.color=!1===e.color?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map(e=>{let n=t=>{this[e](t)};return t.dom.addEventListener(e,n),{name:e,handler:n}})}destroy(){this.handlers.forEach(({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e))}update(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t,e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r=this.editorView.dom,o=r.getBoundingClientRect(),i=o.width/r.offsetWidth,s=o.height/r.offsetHeight;if(n){let n=e.nodeBefore,r=e.nodeAfter;if(n||r){let e=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(e){let o=e.getBoundingClientRect(),i=n?o.bottom:o.top;n&&r&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let a=this.width/2*s;t={left:o.left,right:o.right,top:i-a,bottom:i+a}}}}if(!t){let e=this.editorView.coordsAtPos(this.cursorPos),n=this.width/2*i;t={left:e.left-n,right:e.left+n,top:e.top,bottom:e.bottom}}let a,l,c=this.editorView.dom.offsetParent;if(this.element||(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!c||c==document.body&&"static"==getComputedStyle(c).position)a=-pageXOffset,l=-pageYOffset;else{let t=c.getBoundingClientRect(),e=t.width/c.offsetWidth,n=t.height/c.offsetHeight;a=t.left-c.scrollLeft*e,l=t.top-c.scrollTop*n}this.element.style.left=(t.left-a)/i+"px",this.element.style.top=(t.top-l)/s+"px",this.element.style.width=(t.right-t.left)/i+"px",this.element.style.height=(t.bottom-t.top)/s+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),n=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),r=n&&n.type.spec.disableDropCursor,o="function"==typeof r?r(this.editorView,e,t):r;if(e&&!o){let t=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let e=Sc(this.editorView.state.doc,t,this.editorView.dragging.slice);null!=e&&(t=e)}this.setCursor(t),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}class $_ extends Bc{constructor(t){super(t,t)}map(t,e){let n=t.resolve(e.map(this.head));return $_.valid(n)?new $_(n):Bc.near(n)}content(){return Ja.empty}eq(t){return t instanceof $_&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new $_(t.resolve(e.pos))}getBookmark(){return new H_(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!function(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(0!=n)for(let t=r.child(n-1);;t=t.lastChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t)||!function(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n!=r.childCount)for(let t=r.child(n);;t=t.firstChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t))return!1;let n=e.type.spec.allowGapCursor;if(null!=n)return n;let r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(t,e,n=!1){t:for(;;){if(!n&&$_.valid(t))return t;let r=t.pos,o=null;for(let n=t.depth;;n--){let i=t.node(n);if(e>0?t.indexAfter(n)<i.childCount:t.index(n)>0){o=i.child(e>0?t.indexAfter(n):t.index(n)-1);break}if(0==n)return null;r+=e;let s=t.doc.resolve(r);if($_.valid(s))return s}for(;;){let i=e>0?o.firstChild:o.lastChild;if(!i){if(o.isAtom&&!o.isText&&!Wc.isSelectable(o)){t=t.doc.resolve(r+o.nodeSize*e),n=!1;continue t}break}o=i,r+=e;let s=t.doc.resolve(r);if($_.valid(s))return s}return null}}}$_.prototype.visible=!1,$_.findFrom=$_.findGapCursorFrom,Bc.jsonID("gapcursor",$_);class H_{constructor(t){this.pos=t}map(t){return new H_(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return $_.valid(e)?new $_(e):Bc.near(e)}}const B_=Ap({ArrowLeft:j_("horiz",-1),ArrowRight:j_("horiz",1),ArrowUp:j_("vert",-1),ArrowDown:j_("vert",1)});function j_(t,e){const n="vert"==t?e>0?"down":"up":e>0?"right":"left";return function(t,r,o){let i=t.selection,s=e>0?i.$to:i.$from,a=i.empty;if(i instanceof Vc){if(!o.endOfTextblock(n)||0==s.depth)return!1;a=!1,s=t.doc.resolve(e>0?s.after():s.before())}let l=$_.findGapCursorFrom(s,e,a);return!!l&&(r&&r(t.tr.setSelection(new $_(l))),!0)}}function U_(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!$_.valid(r))return!1;let o=t.posAtCoords({left:n.clientX,top:n.clientY});return!(o&&o.inside>-1&&Wc.isSelectable(t.state.doc.nodeAt(o.inside))||(t.dispatch(t.state.tr.setSelection(new $_(r))),0))}function F_(t,e){if("insertCompositionText"!=e.inputType||!(t.state.selection instanceof $_))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let o=Fa.empty;for(let t=r.length-1;t>=0;t--)o=Fa.from(r[t].createAndFill(null,o));let i=t.state.tr.replace(n.pos,n.pos,new Ja(o,0,0));return i.setSelection(Vc.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function V_(t){if(!(t.selection instanceof $_))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Vh.create(t.doc,[jh.widget(t.selection.head,e,{key:"gapcursor"})])}var z_=200,W_=function(){};W_.prototype.append=function(t){return t.length?(t=W_.from(t),!this.length&&t||t.length<z_&&this.leafAppend(t)||this.length<z_&&t.leafPrepend(this)||this.appendInner(t)):this},W_.prototype.prepend=function(t){return t.length?W_.from(t).append(this):this},W_.prototype.appendInner=function(t){return new K_(this,t)},W_.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?W_.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},W_.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},W_.prototype.forEach=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)},W_.prototype.map=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length);var r=[];return this.forEach(function(e,n){return r.push(t(e,n))},e,n),r},W_.from=function(t){return t instanceof W_?t:t&&t.length?new q_(t):W_.empty};var q_=function(t){function e(e){t.call(this),this.values=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(t,n){return 0==t&&n==this.length?this:new e(this.values.slice(t,n))},e.prototype.getInner=function(t){return this.values[t]},e.prototype.forEachInner=function(t,e,n,r){for(var o=e;o<n;o++)if(!1===t(this.values[o],r+o))return!1},e.prototype.forEachInvertedInner=function(t,e,n,r){for(var o=e-1;o>=n;o--)if(!1===t(this.values[o],r+o))return!1},e.prototype.leafAppend=function(t){if(this.length+t.length<=z_)return new e(this.values.concat(t.flatten()))},e.prototype.leafPrepend=function(t){if(this.length+t.length<=z_)return new e(t.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(W_);W_.empty=new q_([]);var K_=function(t){function e(e,n){t.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,e,n,r){var o=this.left.length;return!(e<o&&!1===this.left.forEachInner(t,e,Math.min(n,o),r))&&!(n>o&&!1===this.right.forEachInner(t,Math.max(e-o,0),Math.min(this.length,n)-o,r+o))&&void 0},e.prototype.forEachInvertedInner=function(t,e,n,r){var o=this.left.length;return!(e>o&&!1===this.right.forEachInvertedInner(t,e-o,Math.max(n,o)-o,r+o))&&!(n<o&&!1===this.left.forEachInvertedInner(t,Math.min(e,o),n,r))&&void 0},e.prototype.sliceInner=function(t,e){if(0==t&&e==this.length)return this;var n=this.left.length;return e<=n?this.left.slice(t,e):t>=n?this.right.slice(t-n,e-n):this.left.slice(t,n).append(this.right.slice(0,e-n))},e.prototype.leafAppend=function(t){var n=this.right.leafAppend(t);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(t){var n=this.left.leafPrepend(t);if(n)return new e(n,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e}(W_);const J_=W_;class G_{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(0==this.eventCount)return null;let n,r,o=this.items.length;for(;;o--)if(this.items.get(o-1).selection){--o;break}e&&(n=this.remapping(o,this.items.length),r=n.maps.length);let i,s,a=t.tr,l=[],c=[];return this.items.forEach((t,e)=>{if(!t.step)return n||(n=this.remapping(o,e+1),r=n.maps.length),r--,void c.push(t);if(n){c.push(new Y_(t.map));let e,o=t.step.map(n.slice(r));o&&a.maybeStep(o).doc&&(e=a.mapping.maps[a.mapping.maps.length-1],l.push(new Y_(e,void 0,void 0,l.length+c.length))),r--,e&&n.appendMap(e,r)}else a.maybeStep(t.step);return t.selection?(i=n?t.selection.map(n.slice(r)):t.selection,s=new G_(this.items.slice(0,o).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0},this.items.length,0),{remaining:s,transform:a,selection:i}}addTransform(t,e,n,r){let o=[],i=this.eventCount,s=this.items,a=!r&&s.length?s.get(s.length-1):null;for(let n=0;n<t.steps.length;n++){let l,c=t.steps[n].invert(t.docs[n]),d=new Y_(t.mapping.maps[n],c,e);(l=a&&a.merge(d))&&(d=l,n?o.pop():s=s.slice(0,s.length-1)),o.push(d),e&&(i++,e=void 0),r||(a=d)}let l=i-n.depth;return l>Q_&&(s=function(t,e){let n;return t.forEach((t,r)=>{if(t.selection&&0==e--)return n=r,!1}),t.slice(n)}(s,l),i-=l),new G_(s.append(o),i)}remapping(t,e){let n=new Zl;return this.items.forEach((e,r)=>{let o=null!=e.mirrorOffset&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:void 0;n.appendMap(e.map,o)},t,e),n}addMaps(t){return 0==this.eventCount?this:new G_(this.items.append(t.map(t=>new Y_(t))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-e),o=t.mapping,i=t.steps.length,s=this.eventCount;this.items.forEach(t=>{t.selection&&s--},r);let a=e;this.items.forEach(e=>{let r=o.getMirror(--a);if(null==r)return;i=Math.min(i,r);let l=o.maps[r];if(e.step){let i=t.steps[r].invert(t.docs[r]),c=e.selection&&e.selection.map(o.slice(a+1,r));c&&s++,n.push(new Y_(l,i,c))}else n.push(new Y_(l))},r);let l=[];for(let t=e;t<i;t++)l.push(new Y_(o.maps[t]));let c=this.items.slice(0,r).append(l).append(n),d=new G_(c,s);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let t=0;return this.items.forEach(e=>{e.step||t++}),t}compress(t=this.items.length){let e=this.remapping(0,t),n=e.maps.length,r=[],o=0;return this.items.forEach((i,s)=>{if(s>=t)r.push(i),i.selection&&o++;else if(i.step){let t=i.step.map(e.slice(n)),s=t&&t.getMap();if(n--,s&&e.appendMap(s,n),t){let a=i.selection&&i.selection.map(e.slice(n));a&&o++;let l,c=new Y_(s.invert(),t,a),d=r.length-1;(l=r.length&&r[d].merge(c))?r[d]=l:r.push(c)}}else i.map&&n--},this.items.length,0),new G_(J_.from(r.reverse()),o)}}G_.empty=new G_(J_.empty,0);class Y_{constructor(t,e,n,r){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=r}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new Y_(e.getMap().invert(),e,this.selection)}}}class X_{constructor(t,e,n,r,o){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=r,this.prevComposition=o}}const Q_=20;function Z_(t){let e=[];for(let n=t.length-1;n>=0&&0==e.length;n--)t[n].forEach((t,n,r,o)=>e.push(r,o));return e}function tE(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let o=e.map(t[r],1),i=e.map(t[r+1],-1);o<=i&&n.push(o,i)}return n}let eE=!1,nE=null;function rE(t){let e=t.plugins;if(nE!=e){eE=!1,nE=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){eE=!0;break}}return eE}const oE=new ad("history"),iE=new ad("closeHistory");function sE(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new od({key:oE,state:{init:()=>new X_(G_.empty,G_.empty,null,0,-1),apply:(e,n,r)=>function(t,e,n,r){let o,i=n.getMeta(oE);if(i)return i.historyState;n.getMeta(iE)&&(t=new X_(t.done,t.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(0==n.steps.length)return t;if(s&&s.getMeta(oE))return s.getMeta(oE).redo?new X_(t.done.addTransform(n,void 0,r,rE(e)),t.undone,Z_(n.mapping.maps),t.prevTime,t.prevComposition):new X_(t.done,t.undone.addTransform(n,void 0,r,rE(e)),null,t.prevTime,t.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new X_(t.done.rebased(n,o),t.undone.rebased(n,o),tE(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new X_(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),tE(t.prevRanges,n.mapping),t.prevTime,t.prevComposition);{let o=n.getMeta("composition"),i=0==t.prevTime||!s&&t.prevComposition!=o&&(t.prevTime<(n.time||0)-r.newGroupDelay||!function(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((t,r)=>{for(let o=0;o<e.length;o+=2)t<=e[o+1]&&r>=e[o]&&(n=!0)}),n}(n,t.prevRanges)),a=s?tE(t.prevRanges,n.mapping):Z_(n.mapping.maps);return new X_(t.done.addTransform(n,i?e.selection.getBookmark():void 0,r,rE(e)),G_.empty,a,n.time,null==o?t.prevComposition:o)}}(n,r,e,t)},config:t,props:{handleDOMEvents:{beforeinput(t,e){let n=e.inputType,r="historyUndo"==n?lE:"historyRedo"==n?cE:null;return!!r&&(e.preventDefault(),r(t.state,t.dispatch))}}}})}function aE(t,e){return(n,r)=>{let o=oE.getState(n);if(!o||0==(t?o.undone:o.done).eventCount)return!1;if(r){let i=function(t,e,n){let r=rE(e),o=oE.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let s=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),o,r),l=new X_(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(s).setMeta(oE,{redo:n,historyState:l})}(o,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const lE=aE(!1,!0),cE=aE(!0,!0);aE(!1,!1),aE(!0,!1);var dE=hm.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(t=>""!==t).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=t=>{const e=(null==t?void 0:t.node)||this.editor.state.doc;if("textSize"===((null==t?void 0:t.mode)||this.options.mode)){const t=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(t)}return e.nodeSize},this.storage.words=t=>{const e=(null==t?void 0:t.node)||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new od({key:new ad("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const o=this.options.limit;if(null==o||0===o)return void(t=!0);const i=this.storage.characters({node:r.doc});if(i>o){const e=0,n=i-o;console.warn(`[CharacterCount] Initial content exceeded limit of ${o} characters. Content was automatically trimmed.`);const s=r.tr.deleteRange(e,n);return t=!0,s}t=!0},filterTransaction:(t,e)=>{const n=this.options.limit;if(!t.docChanged||0===n||null==n)return!0;const r=this.storage.characters({node:e.doc}),o=this.storage.characters({node:t.doc});if(o<=n)return!0;if(r>n&&o>n&&o<=r)return!0;if(r>n&&o>n&&o>r)return!1;if(!t.getMeta("paste"))return!1;const i=t.selection.$head.pos,s=i-(o-n),a=i;return t.deleteRange(s,a),!(this.storage.characters({node:t.doc})>n)}})]}}),uE=hm.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[I_(this.options)]}}),hE=(hm.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new od({key:new ad("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:o}=e,i=[];if(!n||!r)return Vh.create(t,[]);let s=0;"deepest"===this.options.mode&&t.descendants((t,e)=>{if(!t.isText)return o>=e&&o<=e+t.nodeSize-1&&void(s+=1)});let a=0;return t.descendants((t,e)=>!t.isText&&(o>=e&&o<=e+t.nodeSize-1&&(a+=1,"deepest"===this.options.mode&&s-a>0||"shallowest"===this.options.mode&&a>1?"deepest"===this.options.mode:void i.push(jh.node(e,e+t.nodeSize,{class:this.options.className}))))),Vh.create(t,i)}}})]}}),hm.create({name:"gapCursor",addProseMirrorPlugins:()=>[new od({props:{decorations:V_,createSelectionBetween:(t,e,n)=>e.pos==n.pos&&$_.valid(n)?new $_(n):null,handleClick:U_,handleKeyDown:B_,handleDOMEvents:{beforeinput:F_}}})],extendNodeSchema(t){var e;return{allowGapCursor:null!=(e=bf(ff(t,"allowGapCursor",{name:t.name,options:t.options,storage:t.storage})))?e:null}}})),pE=hm.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new od({key:new ad("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,o=[];if(!n)return null;const i=this.editor.isEmpty;return t.descendants((t,e)=>{const n=r>=e&&r<=e+t.nodeSize,s=!t.isLeaf&&Gf(t);if((n||!this.options.showOnlyCurrent)&&s){const r=[this.options.emptyNodeClass];i&&r.push(this.options.emptyEditorClass);const s=jh.node(e,e+t.nodeSize,{class:r.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:t,pos:e,hasAnchor:n}):this.options.placeholder});o.push(s)}return this.options.includeChildren}),Vh.create(t,o)}}})]}});function fE({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||(null==e?void 0:e.type)===t}hm.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new od({key:new ad("selection"),props:{decorations:n=>n.selection.empty||t.isFocused||!t.isEditable||Yf(n.selection)?null:Vh.create(n.doc,[jh.inline(n.selection.from,n.selection.to,{class:e.className})])}})]}});var mE=hm.create({name:"trailingNode",addOptions:()=>({node:"paragraph",notAfter:[]}),addProseMirrorPlugins(){const t=new ad(this.name),e=Object.entries(this.editor.schema.nodes).map(([,t])=>t).filter(t=>(this.options.notAfter||[]).concat(this.options.node).includes(t.name));return[new od({key:t,appendTransaction:(e,n,r)=>{const{doc:o,tr:i,schema:s}=r,a=t.getState(r),l=o.content.size,c=s.nodes[this.options.node];if(a)return i.insert(l,c.create())},state:{init:(t,n)=>!fE({node:n.tr.doc.lastChild,types:e}),apply:(t,n)=>t.docChanged?!fE({node:t.doc.lastChild,types:e}):n}})]}}),gE=hm.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:t,dispatch:e})=>lE(t,e),redo:()=>({state:t,dispatch:e})=>cE(t,e)}),addProseMirrorPlugins(){return[sE(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),yE=hm.create({name:"starterKit",addExtensions(){var t,e,n,r;const o=[];return!1!==this.options.bold&&o.push(NS.configure(this.options.bold)),!1!==this.options.blockquote&&o.push(MS.configure(this.options.blockquote)),!1!==this.options.bulletList&&o.push(s_.configure(this.options.bulletList)),!1!==this.options.code&&o.push(HS.configure(this.options.code)),!1!==this.options.codeBlock&&o.push(FS.configure(this.options.codeBlock)),!1!==this.options.document&&o.push(zS.configure(this.options.document)),!1!==this.options.dropcursor&&o.push(uE.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&o.push(hE.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&o.push(qS.configure(this.options.hardBreak)),!1!==this.options.heading&&o.push(JS.configure(this.options.heading)),!1!==this.options.undoRedo&&o.push(gE.configure(this.options.undoRedo)),!1!==this.options.horizontalRule&&o.push(YS.configure(this.options.horizontalRule)),!1!==this.options.italic&&o.push(nx.configure(this.options.italic)),!1!==this.options.listItem&&o.push(a_.configure(this.options.listItem)),!1!==this.options.listKeymap&&o.push(b_.configure(null==(t=this.options)?void 0:t.listKeymap)),!1!==this.options.link&&o.push(e_.configure(null==(e=this.options)?void 0:e.link)),!1!==this.options.orderedList&&o.push(k_.configure(this.options.orderedList)),!1!==this.options.paragraph&&o.push(__.configure(this.options.paragraph)),!1!==this.options.strike&&o.push(A_.configure(this.options.strike)),!1!==this.options.text&&o.push(D_.configure(this.options.text)),!1!==this.options.underline&&o.push(L_.configure(null==(n=this.options)?void 0:n.underline)),!1!==this.options.trailingNode&&o.push(mE.configure(null==(r=this.options)?void 0:r.trailingNode)),o}});const bE=/[\uD800-\uDBFF]/,vE=/[\uDC00-\uDFFF]/,wE=t=>class{constructor(t){this._=t}destroy(){t(this._)}},kE=wE(clearTimeout),SE=(t,e)=>new kE(setTimeout(e,t)),xE=(wE(clearInterval),wE(t=>"undefined"!=typeof requestAnimationFrame&&cancelAnimationFrame(t)),wE(t=>"undefined"!=typeof cancelIdleCallback&&cancelIdleCallback(t)),(t,e)=>t>>>e|t<<32-e),CE=t=>xE(t,2)^xE(t,13)^xE(t,22),_E=t=>xE(t,6)^xE(t,11)^xE(t,25),EE=t=>xE(t,7)^xE(t,18)^t>>>3,TE=t=>xE(t,17)^xE(t,19)^t>>>10,ME=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),AE=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);class OE{constructor(){const t=new ArrayBuffer(320);this._H=new Uint32Array(t,0,8),this._H.set(AE),this._W=new Uint32Array(t,64,64)}_updateHash(){const t=this._H,e=this._W;for(let t=16;t<64;t++)e[t]=TE(e[t-2])+e[t-7]+EE(e[t-15])+e[t-16];let n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=t[5],l=t[6],c=t[7];for(let t,d,u=0;u<64;u++)t=c+_E(s)+(s&a^~s&l)+ME[u]+e[u]>>>0,d=CE(n)+(n&r^n&o^r&o)>>>0,c=l,l=a,a=s,s=i+t>>>0,i=o,o=r,r=n,n=t+d>>>0;t[0]+=n,t[1]+=r,t[2]+=o,t[3]+=i,t[4]+=s,t[5]+=a,t[6]+=l,t[7]+=c}digest(t){let e=0;for(;e+56<=t.length;){let n=0;for(;n<16&&e+3<t.length;n++)this._W[n]=t[e++]<<24|t[e++]<<16|t[e++]<<8|t[e++];if(e%64!=0){for(this._W.fill(0,n,16);e<t.length;)this._W[n]|=t[e]<<8*(3-e%4),e++;this._W[n]|=W<<8*(3-e%4)}this._updateHash()}const n=e%64!=0;this._W.fill(0,0,16);let r=0;for(;e<t.length;r++)for(let n=3;n>=0&&e<t.length;n--)this._W[r]|=t[e++]<<8*n;n||(this._W[r-(e%4==0?0:1)]|=W<<8*(3-e%4)),this._W[14]=t.byteLength/536870912,this._W[15]=8*t.byteLength,this._updateHash();const o=new Uint8Array(32);for(let t=0;t<this._H.length;t++)for(let e=0;e<4;e++)o[4*t+e]=this._H[t]>>>8*(3-e);return o}}const DE=new ad("y-sync"),RE=new ad("y-undo"),LE=new ad("yjs-cursor"),NE=(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&e.sv.get(t.id.client)>t.id.clock&&!en(e.ds,t.id),IE=[{light:"#ecd44433",dark:"#ecd444"}],PE=(t,e,n)=>{if(!t.has(n)){if(t.size<e.length){const n=D();t.forEach(t=>n.add(t)),e=e.filter(t=>!n.has(t))}t.set(n,(r=e)[H(zt()*r.length)])}var r;return t.get(n)},$E=(t,e)=>({type:e.selection.jsonID,anchor:iT(e.selection.anchor,t.type,t.mapping),head:iT(e.selection.head,t.type,t.mapping)});class HE{constructor(t,e=new Map){this.type=t,this.prosemirrorView=null,this.mux=ea(),this.mapping=e,this.isOMark=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=t.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{null===this.beforeTransactionSelection&&null!=this.prosemirrorView&&(this.beforeTransactionSelection=$E(this,this.prosemirrorView.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return!!this.prosemirrorView.hasFocus()&&(pe&&null===this._domSelectionInView&&(SE(0,()=>{this._domSelectionInView=null}),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView)}_isDomSelectionInView(){const t=this.prosemirrorView._root.getSelection();if(null==t||null==t.anchorNode)return!1;const e=this.prosemirrorView._root.createRange();e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset),0===e.getClientRects().length&&e.startContainer&&e.collapsed&&e.selectNodeContents(e.startContainer);const n=e.getBoundingClientRect(),r=Te.documentElement;return n.bottom>=0&&n.right>=0&&n.left<=(window.innerWidth||r.clientWidth||0)&&n.top<=(window.innerHeight||r.clientHeight||0)}renderSnapshot(t,e){e||(e=cr(sn(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(DE,{snapshot:t,prevSnapshot:e}))}unrenderSnapshot(){this.mapping.clear(),this.mux(()=>{const t=this.type.toArray().map(t=>jE(t,this.prosemirrorView.state.schema,this)).filter(t=>null!==t),e=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ja(Fa.from(t),0,0));e.setMeta(DE,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(e)})}_forceRerender(){this.mapping.clear(),this.mux(()=>{const t=null!==this.beforeTransactionSelection?null:this.prosemirrorView.state.selection,e=this.type.toArray().map(t=>jE(t,this.prosemirrorView.state.schema,this)).filter(t=>null!==t),n=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ja(Fa.from(e),0,0));if(t){const e=U(F(t.anchor,0),n.doc.content.size),r=U(F(t.head,0),n.doc.content.size);n.setSelection(Vc.create(n.doc,e,r))}this.prosemirrorView.dispatch(n.setMeta(DE,{isChangeOrigin:!0,binding:this}))})}_renderSnapshot(t,e,n){let r=this.doc,o=this.type;if(t||(t=ur(this.doc)),t instanceof Uint8Array||e instanceof Uint8Array)if(t instanceof Uint8Array&&e instanceof Uint8Array||_t(),r=new pn({gc:!1}),_n(r,e),e=ur(r),_n(r,t),t=ur(r),null===o._item){const t=Array.from(this.doc.share.keys()).find(t=>this.doc.share.get(t)===this.type);o=r.getXmlFragment(t)}else{const t=r.store.clients.get(o._item.id.client)??[],e=t[wr(t,o._item.id.clock)].content;o=e.type}this.mapping.clear(),this.mux(()=>{r.transact(r=>{const i=n.permanentUserData;i&&i.dss.forEach(t=>{tn(r,t,t=>{})});const s=(t,e)=>{const r="added"===t?i.getUserByClientId(e.client):i.getUserByDeletedId(e);return{user:r,type:t,color:PE(n.colorMapping,n.colors,r)}},a=Co(o,new rr(e.ds,t.sv)).map(n=>!n._item.deleted||NE(n._item,t)||NE(n._item,e)?jE(n,this.prosemirrorView.state.schema,{mapping:new Map,isOMark:new Map},t,e,s):null).filter(t=>null!==t),l=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ja(Fa.from(a),0,0));this.prosemirrorView.dispatch(l.setMeta(DE,{isChangeOrigin:!0}))},DE)})}_typeChanged(t,e){if(null==this.prosemirrorView)return;const n=DE.getState(this.prosemirrorView.state);0!==t.length&&null==n.snapshot&&null==n.prevSnapshot?this.mux(()=>{const t=(t,e)=>this.mapping.delete(e);tn(e,e.deleteSet,t=>{if(t.constructor===Bi){const e=t.content.type;e&&this.mapping.delete(e)}}),e.changed.forEach(t),e.changedParentTypes.forEach(t);const n=this.type.toArray().map(t=>BE(t,this.prosemirrorView.state.schema,this)).filter(t=>null!==t);let r=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ja(Fa.from(n),0,0));((t,e,n)=>{if(null!==e&&null!==e.anchor&&null!==e.head)if("all"===e.type)t.setSelection(new Kc(t.doc));else if("node"===e.type){const r=aT(n.doc,n.type,e.anchor,n.mapping);t.setSelection(Wc.create(t.doc,r))}else{const r=aT(n.doc,n.type,e.anchor,n.mapping),o=aT(n.doc,n.type,e.head,n.mapping);null!==r&&null!==o&&t.setSelection(Vc.between(t.doc.resolve(r),t.doc.resolve(o)))}})(r,this.beforeTransactionSelection,this),r=r.setMeta(DE,{isChangeOrigin:!0,isUndoRedoOperation:e.origin instanceof Hr}),null!==this.beforeTransactionSelection&&this._isLocalCursorInView()&&r.scrollIntoView(),this.prosemirrorView.dispatch(r)}):this.renderSnapshot(n.snapshot,n.prevSnapshot)}_prosemirrorChanged(t){this.doc.transact(()=>{eT(this.doc,this.type,t,this),this.beforeTransactionSelection=$E(this,this.prosemirrorView.state)},DE)}initView(t){null!=this.prosemirrorView&&this.destroy(),this.prosemirrorView=t,this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),this.type.observeDeep(this._observeFunction)}destroy(){null!=this.prosemirrorView&&(this.prosemirrorView=null,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions))}}const BE=(t,e,n,r,o,i)=>{const s=n.mapping.get(t);if(void 0===s){if(t instanceof ci)return jE(t,e,n,r,o,i);throw Ct()}return s},jE=(t,e,n,r,o,i)=>{const s=[],a=t=>{if(t instanceof ci){const a=BE(t,e,n,r,o,i);null!==a&&s.push(a)}else{const a=(t._item.right?.content)?.type;a instanceof si&&!a._item.deleted&&a._item.id.client===a.doc.clientID&&(t.applyDelta([{retain:t.length},...a.toDelta()]),a.doc.transact(t=>{a._item.delete(t)}));const l=UE(t,e,n,r,o,i);null!==l&&l.forEach(t=>{null!==t&&s.push(t)})}};void 0===r||void 0===o?t.toArray().forEach(a):Co(t,new rr(o.ds,r.sv)).forEach(a);try{const a=t.getAttributes(r);void 0!==r&&(NE(t._item,r)?NE(t._item,o)||(a.ychange=i?i("added",t._item.id):{type:"added"}):a.ychange=i?i("removed",t._item.id):{type:"removed"});const l=e.node(t.nodeName,a,s);return n.mapping.set(t,l),l}catch(e){return t.doc.transact(e=>{t._item.delete(e)},DE),n.mapping.delete(t),null}},UE=(t,e,n,r,o,i)=>{const s=[],a=t.toDelta(r,o,i);try{for(let t=0;t<a.length;t++){const n=a[t];s.push(e.text(n.insert,ZE(n.attributes,e)))}}catch(e){return t.doc.transact(e=>{t._item.delete(e)},DE),null}return s},FE=(t,e)=>t instanceof Array?((t,e)=>{const n=new hi,r=t.map(t=>({insert:t.text,attributes:tT(t.marks,e)}));return n.applyDelta(r),e.mapping.set(n,t),n})(t,e):((t,e)=>{const n=new ci(t.type.name);for(const e in t.attrs){const r=t.attrs[e];null!==r&&"ychange"!==e&&n.setAttribute(e,r)}return n.insert(0,WE(t).map(t=>FE(t,e))),e.mapping.set(n,t),n})(t,e),VE=t=>"object"==typeof t&&null!==t,zE=(t,e)=>{const n=Object.keys(t).filter(e=>null!==t[e]);let r=n.length===Object.keys(e).filter(t=>null!==e[t]).length;for(let o=0;o<n.length&&r;o++){const i=n[o],s=t[i],a=e[i];r="ychange"===i||s===a||VE(s)&&VE(a)&&zE(s,a)}return r},WE=t=>{const e=t.content.content,n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r.isText){const r=[];for(let n=e[t];t<e.length&&n.isText;n=e[++t])r.push(n);t--,n.push(r)}else n.push(r)}return n},qE=(t,e)=>{const n=t.toDelta();return n.length===e.length&&n.every((t,n)=>t.insert===e[n].text&&te(t.attributes||{}).length===e[n].marks.length&&re(t.attributes,(t,r)=>{const o=QE(r),i=e[n].marks;return zE(t,i.find(t=>t.type.name===o)?.attrs)}))},KE=(t,e)=>{if(t instanceof ci&&!(e instanceof Array)&&nT(t,e)){const n=WE(e);return t._length===n.length&&zE(t.getAttributes(),e.attrs)&&t.toArray().every((t,e)=>KE(t,n[e]))}return t instanceof hi&&e instanceof Array&&qE(t,e)},JE=(t,e)=>t===e||t instanceof Array&&e instanceof Array&&t.length===e.length&&t.every((t,n)=>e[n]===t),GE=(t,e,n)=>{const r=t.toArray(),o=WE(e),i=o.length,s=r.length,a=U(s,i);let l=0,c=0,d=!1;for(;l<a;l++){const t=r[l],e=o[l];if(JE(n.mapping.get(t),e))d=!0;else if(!KE(t,e))break}for(;l+c<a;c++){const t=r[s-c-1],e=o[i-c-1];if(JE(n.mapping.get(t),e))d=!0;else if(!KE(t,e))break}return{equalityFactor:l+c,foundMappedChild:d}},YE=(t,e,n)=>{n.mapping.set(t,e);const{nAttrs:r,str:o}=(t=>{let e="",n=t._start;const r={};for(;null!==n;)n.deleted||(n.countable&&n.content instanceof Ci?e+=n.content.str:n.content instanceof wi&&(r[n.content.key]=null)),n=n.right;return{str:e,nAttrs:r}})(t),i=e.map(t=>({insert:t.text,attributes:Object.assign({},r,tT(t.marks,n))})),{insert:s,remove:a,index:l}=((t,e)=>{let n=0,r=0;for(;n<t.length&&n<e.length&&t[n]===e[n];)n++;for(n>0&&bE.test(t[n-1])&&n--;r+n<t.length&&r+n<e.length&&t[t.length-r-1]===e[e.length-r-1];)r++;return r>0&&vE.test(t[t.length-r])&&r--,{index:n,remove:t.length-n-r,insert:e.slice(n,e.length-r)}})(o,i.map(t=>t.insert).join(""));t.delete(l,a),t.insert(l,s),t.applyDelta(i.map(t=>({retain:t.insert.length,attributes:t.attributes})))},XE=/(.*)(--[a-zA-Z0-9+/=]{8})$/,QE=t=>XE.exec(t)?.[1]??t,ZE=(t,e)=>{const n=[];for(const r in t)n.push(e.mark(QE(r),t[r]));return n},tT=(t,e)=>{const n={};return t.forEach(t=>{if("ychange"!==t.type.name){const i=O(e.isOMark,t.type,()=>!t.type.excludes(t.type));n[i?`${t.type.name}--${r=t.toJSON(),ke((t=>{for(let e=6;e<t.length;e++)t[e%6]=t[e%6]^t[e];return t.slice(0,6)})((o=xe(r),(new OE).digest(o))))}`:t.type.name]=t.attrs}var r,o}),n},eT=(t,e,n,r)=>{if(e instanceof ci&&e.nodeName!==n.type.name)throw new Error("node name mismatch!");if(r.mapping.set(e,n),e instanceof ci){const t=e.getAttributes(),r=n.attrs;for(const n in r)null!==r[n]?t[n]!==r[n]&&"ychange"!==n&&e.setAttribute(n,r[n]):e.removeAttribute(n);for(const n in t)void 0===r[n]&&e.removeAttribute(n)}const o=WE(n),i=o.length,s=e.toArray(),a=s.length,l=U(i,a);let c=0,d=0;for(;c<l;c++){const t=s[c],e=o[c];if(!JE(r.mapping.get(t),e)){if(!KE(t,e))break;r.mapping.set(t,e)}}for(;d+c+1<l;d++){const t=s[a-d-1],e=o[i-d-1];if(!JE(r.mapping.get(t),e)){if(!KE(t,e))break;r.mapping.set(t,e)}}t.transact(()=>{for(;a-c-d>0&&i-c-d>0;){const n=s[c],l=o[c],u=s[a-d-1],h=o[i-d-1];if(n instanceof hi&&l instanceof Array)qE(n,l)||YE(n,l,r),c+=1;else{let o=n instanceof ci&&nT(n,l),i=u instanceof ci&&nT(u,h);if(o&&i){const t=GE(n,l,r),e=GE(u,h,r);t.foundMappedChild&&!e.foundMappedChild?i=!1:!t.foundMappedChild&&e.foundMappedChild||t.equalityFactor<e.equalityFactor?o=!1:i=!1}o?(eT(t,n,l,r),c+=1):i?(eT(t,u,h,r),d+=1):(r.mapping.delete(e.get(c)),e.delete(c,1),e.insert(c,[FE(l,r)]),c+=1)}}const n=a-c-d;if(1===a&&0===i&&s[0]instanceof hi?(r.mapping.delete(s[0]),s[0].delete(0,s[0].length)):n>0&&(e.slice(c,c+n).forEach(t=>r.mapping.delete(t)),e.delete(c,n)),c+d<i){const t=[];for(let e=c;e<i-d;e++)t.push(FE(o[e],r));e.insert(c,t)}},DE)},nT=(t,e)=>!(e instanceof Array)&&t.nodeName===e.type.name;let rT=null;const oT=()=>{const t=rT;rT=null,t.forEach((t,e)=>{const n=e.state.tr,r=DE.getState(e.state);r&&r.binding&&!r.binding.isDestroyed&&(t.forEach((t,e)=>{n.setMeta(e,t)}),e.dispatch(n))})},iT=(t,e,n)=>{if(0===t)return Qn(e,0,-1);let r=null===e._first?null:e._first.content.type;for(;null!==r&&e!==r;){if(r instanceof hi){if(r._length>=t)return Qn(r,t,-1);if(t-=r._length,null!==r._item&&null!==r._item.next)r=r._item.next.content.type;else{do{r=null===r._item?null:r._item.parent,t--}while(r!==e&&null!==r&&null!==r._item&&null===r._item.next);null!==r&&r!==e&&(r=null===r._item?null:r._item.next.content.type)}}else{const o=(n.get(r)||{nodeSize:0}).nodeSize;if(null!==r._first&&t<o)r=r._first.content.type,t--;else{if(1===t&&0===r._length&&o>1)return new Kn(null===r._item?null:r._item.id,null===r._item?Vn(r):null,null);if(t-=o,null!==r._item&&null!==r._item.next)r=r._item.next.content.type;else{if(0===t)return r=null===r._item?r:r._item.parent,new Kn(null===r._item?null:r._item.id,null===r._item?Vn(r):null,null);do{r=r._item.parent,t--}while(r!==e&&null===r._item.next);r!==e&&(r=r._item.next.content.type)}}}if(null===r)throw _t();if(0===t&&r.constructor!==hi&&r!==e)return sT(r._item.parent,r._item)}return Qn(e,e._length,-1)},sT=(t,e)=>{let n=null,r=null;return null===t._item?r=Vn(t):n=jn(t._item.id.client,t._item.id.clock),new Kn(n,r,e.id)},aT=(t,e,n,r)=>{const o=er(n,t);if(null===o||o.type!==e&&!zn(e,o.type._item))return null;let i=o.type,s=0;if(i.constructor===hi)s=o.index;else if(null===i._item||!i._item.deleted){let t=i._first,e=0;for(;e<i._length&&e<o.index&&null!==t;){if(!t.deleted){const n=t.content.type;e++,s+=n instanceof hi?n._length:r.get(n).nodeSize}t=t.right}s+=1}for(;i!==e&&null!==i._item;){const t=i._item.parent;if(null===t._item||!t._item.deleted){s+=1;let e=t._first;for(;null!==e;){const t=e.content.type;if(t===i)break;e.deleted||(s+=t instanceof hi?t._length:r.get(t).nodeSize),e=e.right}}i=t}return s-1};const lT=(t,e,n)=>t!==e,cT=t=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null);const r=document.createTextNode(""),o=document.createTextNode("");return e.insertBefore(r,null),e.insertBefore(n,null),e.insertBefore(o,null),e},dT=t=>({style:`background-color: ${t.color}70`,class:"ProseMirror-yjs-selection"}),uT=/^#[0-9a-fA-F]{6}$/,hT=(t,e,n,r,o)=>{const i=DE.getState(t),s=i.doc,a=[];return null!=i.snapshot||null!=i.prevSnapshot||0===i.binding.mapping.size?Vh.create(t.doc,[]):(e.getStates().forEach((e,l)=>{if(n(s.clientID,l,e)&&null!=e.cursor){const n=e.user||{};null==n.color?n.color="#ffa500":uT.test(n.color)||console.warn("A user uses an unsupported color format",n),null==n.name&&(n.name=`User: ${l}`);let c=aT(s,i.type,Gn(e.cursor.anchor),i.binding.mapping),d=aT(s,i.type,Gn(e.cursor.head),i.binding.mapping);if(null!==c&&null!==d){const e=F(t.doc.content.size-1,0);c=U(c,e),d=U(d,e),a.push(jh.widget(d,()=>r(n,l),{key:l+"",side:10}));const i=U(c,d),s=F(c,d);a.push(jh.inline(i,s,o(n,l),{inclusiveEnd:!0,inclusiveStart:!1}))}}}),Vh.create(t.doc,a))},pT=(t,{awarenessStateFilter:e=lT,cursorBuilder:n=cT,selectionBuilder:r=dT,getSelection:o=t=>t.selection}={},i="cursor")=>new od({key:LE,state:{init:(o,i)=>hT(i,t,e,n,r),apply(o,i,s,a){const l=DE.getState(a),c=o.getMeta(LE);return l&&l.isChangeOrigin||c&&c.awarenessUpdated?hT(a,t,e,n,r):i.map(o.mapping,o.doc)}},props:{decorations:t=>LE.getState(t)},view:e=>{const n=()=>{e.docView&&((t,e)=>{rT||(rT=new Map,SE(0,oT)),O(rT,t,M).set(e,{awarenessUpdated:!0})})(e,LE)},r=()=>{const n=DE.getState(e.state),r=t.getLocalState()||{};if(e.hasFocus()){const s=o(e.state),a=iT(s.anchor,n.type,n.binding.mapping),l=iT(s.head,n.type,n.binding.mapping);null!=r.cursor&&nr(Gn(r.cursor.anchor),a)&&nr(Gn(r.cursor.head),l)||t.setLocalStateField(i,{anchor:a,head:l})}else null!=r.cursor&&null!==aT(n.doc,n.type,Gn(r.cursor.anchor),n.binding.mapping)&&t.setLocalStateField(i,null)};return t.on("change",n),e.dom.addEventListener("focusin",r),e.dom.addEventListener("focusout",r),{update:r,destroy:()=>{e.dom.removeEventListener("focusin",r),e.dom.removeEventListener("focusout",r),t.off("change",n),t.setLocalStateField(i,null)}}}}),fT=new Set(["paragraph"]);var mT=hm.create({name:"collaboration",priority:1e3,addOptions:()=>({document:null,field:"default",fragment:null}),addStorage:()=>({isDisabled:!1}),onCreate(){this.editor.extensionManager.extensions.find(t=>"undoRedo"===t.name)&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands:()=>({undo:()=>({tr:t,state:e,dispatch:n})=>(t.setMeta("preventDispatch",!0),0!==RE.getState(e).undoManager.undoStack.length&&(!n||(t=>{const e=RE.getState(t).undoManager;if(null!=e)return e.undo(),!0})(e))),redo:()=>({tr:t,state:e,dispatch:n})=>(t.setMeta("preventDispatch",!0),0!==RE.getState(e).undoManager.redoStack.length&&(!n||(t=>{const e=RE.getState(t).undoManager;if(null!=e)return e.redo(),!0})(e)))}),addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){var t;const e=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),n=(({protectedNodes:t=fT,trackedOrigins:e=[],undoManager:n=null}={})=>new od({key:RE,state:{init:(r,o)=>{const i=DE.getState(o),s=n||new Hr(i.type,{trackedOrigins:new Set([DE].concat(e)),deleteFilter:e=>((t,e)=>!(t instanceof Bi&&t.content instanceof Li&&(t.content.type instanceof si||t.content.type instanceof ci&&e.has(t.content.type.nodeName))&&0!==t.content.type._length))(e,t),captureTransaction:t=>!1!==t.meta.get("addToHistory")});return{undoManager:s,prevSel:null,hasUndoOps:s.undoStack.length>0,hasRedoOps:s.redoStack.length>0}},apply:(t,e,n,r)=>{const o=DE.getState(r).binding,i=e.undoManager,s=i.undoStack.length>0,a=i.redoStack.length>0;return o?{undoManager:i,prevSel:$E(o,n),hasUndoOps:s,hasRedoOps:a}:s!==e.hasUndoOps||a!==e.hasRedoOps?Object.assign({},e,{hasUndoOps:i.undoStack.length>0,hasRedoOps:i.redoStack.length>0}):e}},view:t=>{const e=DE.getState(t.state),n=RE.getState(t.state).undoManager;return n.on("stack-item-added",({stackItem:n})=>{const r=e.binding;r&&n.meta.set(r,RE.getState(t.state).prevSel)}),n.on("stack-item-popped",({stackItem:t})=>{const n=e.binding;n&&(n.beforeTransactionSelection=t.meta.get(n)||n.beforeTransactionSelection)}),{destroy:()=>{n.destroy()}}}}))(this.options.yUndoOptions),r=n.spec.view;n.spec.view=t=>{const{undoManager:e}=RE.getState(t.state);e.restore&&(e.restore(),e.restore=()=>{});const n=r?r(t):void 0;return{destroy:()=>{const t=e.trackedOrigins.has(e),r=e._observers;e.restore=()=>{t&&e.trackedOrigins.add(e),e.doc.on("afterTransaction",e.afterTransactionHandler),e._observers=r},(null==n?void 0:n.destroy)&&n.destroy()}}};const o={...this.options.ySyncOptions,onFirstRender:this.options.onFirstRender},i=((t,{colors:e=IE,colorMapping:n=new Map,permanentUserData:r=null,onFirstRender:o=()=>{},mapping:i}={})=>{let s=!1;const a=new HE(t,i),l=new od({props:{editable:t=>{const e=DE.getState(t);return null==e.snapshot&&null==e.prevSnapshot}},key:DE,state:{init:(o,i)=>({type:t,doc:t.doc,binding:a,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,isUndoRedoOperation:!1,addToHistory:!0,colors:e,colorMapping:n,permanentUserData:r}),apply:(t,e)=>{const n=t.getMeta(DE);if(void 0!==n){e=Object.assign({},e);for(const t in n)e[t]=n[t]}return e.addToHistory=!1!==t.getMeta("addToHistory"),e.isChangeOrigin=void 0!==n&&!!n.isChangeOrigin,e.isUndoRedoOperation=void 0!==n&&!!n.isChangeOrigin&&!!n.isUndoRedoOperation,null!==a.prosemirrorView&&(void 0===n||null==n.snapshot&&null==n.prevSnapshot||SE(0,()=>{null!=a.prosemirrorView&&(null==n.restore?a._renderSnapshot(n.snapshot,n.prevSnapshot,e):(a._renderSnapshot(n.snapshot,n.snapshot,e),delete e.restore,delete e.snapshot,delete e.prevSnapshot,a.mux(()=>{a._prosemirrorChanged(a.prosemirrorView.state.doc)})))})),e}},view:t=>(a.initView(t),null==i&&a._forceRerender(),o(),{update:()=>{const e=l.getState(t.state);if(null==e.snapshot&&null==e.prevSnapshot&&(s||null!==t.state.doc.content.findDiffStart(t.state.doc.type.createAndFill().content))){if(s=!0,!1===e.addToHistory&&!e.isChangeOrigin){const e=RE.getState(t.state),n=e&&e.undoManager;n&&n.stopCapturing()}a.mux(()=>{e.doc.transact(n=>{n.meta.set("addToHistory",e.addToHistory),a._prosemirrorChanged(t.state.doc)},DE)})}},destroy:()=>{a.destroy()}})});return l})(e,o);return this.editor.options.enableContentCheck&&(null==(t=e.doc)||t.on("beforeTransaction",()=>{try{const t=function(t){const e=t.toArray(),n=t=>{let e;if(t instanceof hi)e=t.toDelta().map(t=>{const e={type:"text",text:t.insert};return t.attributes&&(e.marks=Object.keys(t.attributes).map(e=>{const n=t.attributes[e],r={type:QE(e)};return Object.keys(n)&&(r.attrs=n),r})),e});else if(t instanceof ci){e={type:t.nodeName};const r=t.getAttributes();Object.keys(r).length&&(e.attrs=r);const o=t.toArray();o.length&&(e.content=o.map(n).flat())}else _t();return e};return{type:"doc",content:e.map(n)}}(e);if(0===t.content.length)return;this.editor.schema.nodeFromJSON(t).check()}catch(t){return this.editor.emit("contentError",{error:t,editor:this.editor,disableCollaboration:()=>{var t;null==(t=e.doc)||t.destroy(),this.storage.isDisabled=!0}}),!1}})),[i,n,this.editor.options.enableContentCheck&&new od({key:new ad("filterInvalidContent"),filterTransaction:()=>{var t;return!1===this.storage.isDisabled||(null==(t=e.doc)||t.destroy(),!0)}})].filter(Boolean)}}),gT=mT,yT=t=>Array.from(t.entries()).map(([t,e])=>({clientId:t,...e.user})),bT=()=>null,vT=hm.create({name:"collaborationCaret",priority:999,addOptions:()=>({provider:null,user:{name:null,color:null},render:t=>{const e=document.createElement("span");e.classList.add("collaboration-carets__caret"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");return n.classList.add("collaboration-carets__label"),n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null),e.insertBefore(n,null),e},selectionRender:dT,onUpdate:bT}),onCreate(){if(this.options.onUpdate!==bT&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCaret.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-caret'),!this.options.provider)throw new Error('The "provider" option is required for the CollaborationCaret extension')},addStorage:()=>({users:[]}),addCommands(){return{updateUser:t=>()=>(this.options.user=t,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:t=>({editor:e})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-caret'),e.commands.updateUser(t))}},addProseMirrorPlugins(){return[pT((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=yT(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=yT(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render,selectionBuilder:this.options.selectionRender})]}}),wT=hm.create({name:"typography",addOptions:()=>({closeDoubleQuote:"",closeSingleQuote:"",copyright:"",ellipsis:"",emDash:"",laquo:"",leftArrow:"",multiplication:"",notEqual:"",oneHalf:"",oneQuarter:"",openDoubleQuote:"",openSingleQuote:"",plusMinus:"",raquo:"",registeredTrademark:"",rightArrow:"",servicemark:"",superscriptThree:"",superscriptTwo:"",threeQuarters:"",trademark:""}),addInputRules(){const t=[];var e;return!1!==this.options.emDash&&t.push(Bg({find:/--$/,replace:null!=(e=this.options.emDash)?e:""})),!1!==this.options.ellipsis&&t.push((t=>Bg({find:/\.\.\.$/,replace:null!=t?t:""}))(this.options.ellipsis)),!1!==this.options.openDoubleQuote&&t.push((t=>Bg({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:null!=t?t:""}))(this.options.openDoubleQuote)),!1!==this.options.closeDoubleQuote&&t.push((t=>Bg({find:/"$/,replace:null!=t?t:""}))(this.options.closeDoubleQuote)),!1!==this.options.openSingleQuote&&t.push((t=>Bg({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:null!=t?t:""}))(this.options.openSingleQuote)),!1!==this.options.closeSingleQuote&&t.push((t=>Bg({find:/'$/,replace:null!=t?t:""}))(this.options.closeSingleQuote)),!1!==this.options.leftArrow&&t.push((t=>Bg({find:/<-$/,replace:null!=t?t:""}))(this.options.leftArrow)),!1!==this.options.rightArrow&&t.push((t=>Bg({find:/->$/,replace:null!=t?t:""}))(this.options.rightArrow)),!1!==this.options.copyright&&t.push((t=>Bg({find:/\(c\)$/,replace:null!=t?t:""}))(this.options.copyright)),!1!==this.options.trademark&&t.push((t=>Bg({find:/\(tm\)$/,replace:null!=t?t:""}))(this.options.trademark)),!1!==this.options.servicemark&&t.push((t=>Bg({find:/\(sm\)$/,replace:null!=t?t:""}))(this.options.servicemark)),!1!==this.options.registeredTrademark&&t.push((t=>Bg({find:/\(r\)$/,replace:null!=t?t:""}))(this.options.registeredTrademark)),!1!==this.options.oneHalf&&t.push((t=>Bg({find:/(?:^|\s)(1\/2)\s$/,replace:null!=t?t:""}))(this.options.oneHalf)),!1!==this.options.plusMinus&&t.push((t=>Bg({find:/\+\/-$/,replace:null!=t?t:""}))(this.options.plusMinus)),!1!==this.options.notEqual&&t.push((t=>Bg({find:/!=$/,replace:null!=t?t:""}))(this.options.notEqual)),!1!==this.options.laquo&&t.push((t=>Bg({find:/<<$/,replace:null!=t?t:""}))(this.options.laquo)),!1!==this.options.raquo&&t.push((t=>Bg({find:/>>$/,replace:null!=t?t:""}))(this.options.raquo)),!1!==this.options.multiplication&&t.push((t=>Bg({find:/\d+\s?([*x])\s?\d+$/,replace:null!=t?t:""}))(this.options.multiplication)),!1!==this.options.superscriptTwo&&t.push((t=>Bg({find:/\^2$/,replace:null!=t?t:""}))(this.options.superscriptTwo)),!1!==this.options.superscriptThree&&t.push((t=>Bg({find:/\^3$/,replace:null!=t?t:""}))(this.options.superscriptThree)),!1!==this.options.oneQuarter&&t.push((t=>Bg({find:/(?:^|\s)(1\/4)\s$/,replace:null!=t?t:""}))(this.options.oneQuarter)),!1!==this.options.threeQuarters&&t.push((t=>Bg({find:/(?:^|\s)(3\/4)\s$/,replace:null!=t?t:""}))(this.options.threeQuarters)),t}});function kT(t){var e;const{char:n,allowSpaces:r,allowToIncludeChar:o,allowedPrefixes:i,startOfLine:s,$position:a}=t,l=r&&!o,c=n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),d=new RegExp(`\\s${c}$`),u=s?"^":"",h=o?"":c,p=l?new RegExp(`${u}${c}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${u}(?:^)?${c}[^\\s${h}]*`,"gm"),f=(null==(e=a.nodeBefore)?void 0:e.isText)&&a.nodeBefore.text;if(!f)return null;const m=a.pos-f.length,g=Array.from(f.matchAll(p)).pop();if(!g||void 0===g.input||void 0===g.index)return null;const y=g.input.slice(Math.max(0,g.index-1),g.index),b=new RegExp(`^[${null==i?void 0:i.join("")}\0]?$`).test(y);if(null!==i&&!b)return null;const v=m+g.index;let w=v+g[0].length;return l&&d.test(f.slice(w-1,w+1))&&(g[0]+=" ",w+=1),v<a.pos&&w>=a.pos?{range:{from:v,to:w},query:g[0].slice(n.length),text:g[0]}:null}var ST=new ad("suggestion"),xT=function({pluginKey:t=ST,editor:e,char:n="@",allowSpaces:r=!1,allowToIncludeChar:o=!1,allowedPrefixes:i=[" "],startOfLine:s=!1,decorationTag:a="span",decorationClass:l="suggestion",command:c=()=>null,items:d=()=>[],render:u=()=>({}),allow:h=()=>!0,findSuggestionMatch:p=kT}){let f;const m=null==u?void 0:u(),g=new od({key:t,view(){return{update:async(t,n)=>{var r,o,i,s,a,l,u;const h=null==(r=this.key)?void 0:r.getState(n),p=null==(o=this.key)?void 0:o.getState(t.state),g=h.active&&p.active&&h.range.from!==p.range.from,y=!h.active&&p.active,b=h.active&&!p.active,v=!y&&!b&&h.query!==p.query,w=y||g&&v,k=v||g,S=b||g&&v;if(!w&&!k&&!S)return;const x=S&&!w?h:p,C=t.dom.querySelector(`[data-decoration-id="${x.decorationId}"]`);f={editor:e,range:x.range,query:x.query,text:x.text,items:[],command:t=>c({editor:e,range:x.range,props:t}),decorationNode:C,clientRect:C?()=>{var n;const{decorationId:r}=null==(n=this.key)?void 0:n.getState(e.state),o=t.dom.querySelector(`[data-decoration-id="${r}"]`);return(null==o?void 0:o.getBoundingClientRect())||null}:null},w&&(null==(i=null==m?void 0:m.onBeforeStart)||i.call(m,f)),k&&(null==(s=null==m?void 0:m.onBeforeUpdate)||s.call(m,f)),(k||w)&&(f.items=await d({editor:e,query:x.query})),S&&(null==(a=null==m?void 0:m.onExit)||a.call(m,f)),k&&(null==(l=null==m?void 0:m.onUpdate)||l.call(m,f)),w&&(null==(u=null==m?void 0:m.onStart)||u.call(m,f))},destroy:()=>{var t;f&&(null==(t=null==m?void 0:m.onExit)||t.call(m,f))}}},state:{init:()=>({active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}),apply(t,a,l,c){const{isEditable:d}=e,{composing:u}=e.view,{selection:f}=t,{empty:m,from:g}=f,y={...a};if(y.composing=u,d&&(m||e.view.composing)){!(g<a.range.from||g>a.range.to)||u||a.composing||(y.active=!1);const t=p({char:n,allowSpaces:r,allowToIncludeChar:o,allowedPrefixes:i,startOfLine:s,$position:f.$from}),l=`id_${Math.floor(4294967295*Math.random())}`;t&&h({editor:e,state:c,range:t.range,isActive:a.active})?(y.active=!0,y.decorationId=a.decorationId?a.decorationId:l,y.range=t.range,y.query=t.query,y.text=t.text):y.active=!1}else y.active=!1;return y.active||(y.decorationId=null,y.range={from:0,to:0},y.query=null,y.text=null),y}},props:{handleKeyDown(t,e){var n;const{active:r,range:o}=g.getState(t.state);return r&&(null==(n=null==m?void 0:m.onKeyDown)?void 0:n.call(m,{view:t,event:e,range:o}))||!1},decorations(t){const{active:e,range:n,decorationId:r}=g.getState(t);return e?Vh.create(t.doc,[jh.inline(n.from,n.to,{nodeName:a,class:l,"data-decoration-id":r})]):null}}});return g};function CT(t){return(t.options.suggestions.length?t.options.suggestions:[t.options.suggestion]).map(e=>function({editor:t,overrideSuggestionOptions:e,extensionName:n,char:r="@"}){const o=new ad;return{editor:t,char:r,pluginKey:o,command:({editor:t,range:e,props:o})=>{var i,s,a;const l=t.view.state.selection.$to.nodeAfter;(null==(i=null==l?void 0:l.text)?void 0:i.startsWith(" "))&&(e.to+=1),t.chain().focus().insertContentAt(e,[{type:n,attrs:{...o,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),null==(a=null==(s=t.view.dom.ownerDocument.defaultView)?void 0:s.getSelection())||a.collapseToEnd()},allow:({state:t,range:e})=>{const r=t.doc.resolve(e.from),o=t.schema.nodes[n];return!!r.parent.type.contentMatch.matchType(o)},...e}}({editor:t.editor,overrideSuggestionOptions:e,extensionName:t.name,char:e.char}))}function _T(t,e){const n=CT(t);return n.find(t=>t.char===e)||(n.length?n[0]:null)}var ET,TT,MT=Ug.create({name:"mention",priority:101,addOptions:()=>({HTMLAttributes:{},renderText({node:t,suggestion:e}){var n,r;return`${null!=(n=null==e?void 0:e.char)?n:"@"}${null!=(r=t.attrs.label)?r:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:t,node:e,suggestion:n}){var r,o;return["span",kf(this.HTMLAttributes,t.HTMLAttributes),`${null!=(r=null==n?void 0:n.char)?r:"@"}${null!=(o=e.attrs.label)?o:e.attrs.id}`]},suggestions:[],suggestion:{}}),group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:t=>t.getAttribute("data-mention-suggestion-char"),renderHTML:t=>({"data-mention-suggestion-char":t.mentionSuggestionChar})}}),parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){const n=_T(this,t.attrs.mentionSuggestionChar);if(void 0!==this.options.renderLabel)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",kf({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t,suggestion:n})];const r={...this.options};r.HTMLAttributes=kf({"data-type":this.name},this.options.HTMLAttributes,e);const o=this.options.renderHTML({options:r,node:t,suggestion:n});return"string"==typeof o?["span",kf({"data-type":this.name},this.options.HTMLAttributes,e),o]:o},renderText({node:t}){const e={options:this.options,node:t,suggestion:_T(this,t.attrs.mentionSuggestionChar)};return void 0!==this.options.renderLabel?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:r}=e,{empty:o,anchor:i}=r;if(!o)return!1;let s=new hl,a=0;return e.doc.nodesBetween(i-1,i,(t,e)=>{if(t.type.name===this.name)return n=!0,s=t,a=e,!1}),n&&t.insertText(this.options.deleteTriggerWithBackspace?"":s.attrs.mentionSuggestionChar,a,a+s.nodeSize),n})}},addProseMirrorPlugins(){return CT(this).map(xT)}}),AT=MT;if("undefined"!=typeof WeakMap){let t=new WeakMap;ET=e=>t.get(e),TT=(e,n)=>(t.set(e,n),n)}else{const t=[],e=10;let n=0;ET=e=>{for(let n=0;n<t.length;n+=2)if(t[n]==e)return t[n+1]},TT=(r,o)=>(n==e&&(n=0),t[n++]=r,t[n++]=o)}var OT=class{constructor(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const r=e%this.width,o=e/this.width|0;let i=r+1,s=o+1;for(let t=1;i<this.width&&this.map[e+t]==n;t++)i++;for(let t=1;s<this.height&&this.map[e+this.width*t]==n;t++)s++;return{left:r,top:o,right:i,bottom:s}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:r,right:o,top:i,bottom:s}=this.findCell(t);return"horiz"==e?(n<0?0==r:o==this.width)?null:this.map[i*this.width+(n<0?r-1:o)]:(n<0?0==i:s==this.height)?null:this.map[r+this.width*(n<0?i-1:s)]}rectBetween(t,e){const{left:n,right:r,top:o,bottom:i}=this.findCell(t),{left:s,right:a,top:l,bottom:c}=this.findCell(e);return{left:Math.min(n,s),top:Math.min(o,l),right:Math.max(r,a),bottom:Math.max(i,c)}}cellsInRect(t){const e=[],n={};for(let r=t.top;r<t.bottom;r++)for(let o=t.left;o<t.right;o++){const i=r*this.width+o,s=this.map[i];n[s]||(n[s]=!0,o==t.left&&o&&this.map[i-1]==s||r==t.top&&r&&this.map[i-this.width]==s||e.push(s))}return e}positionAt(t,e,n){for(let r=0,o=0;;r++){const i=o+n.child(r).nodeSize;if(r==t){let n=e+t*this.width;const r=(t+1)*this.width;for(;n<r&&this.map[n]<o;)n++;return n==r?i-1:this.map[n]}o=i}}static get(t){return ET(t)||TT(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);const e=function(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){const o=t.child(r);let i=0;if(n)for(let e=0;e<r;e++){const n=t.child(e);for(let t=0;t<n.childCount;t++){const o=n.child(t);e+o.attrs.rowspan>r&&(i+=o.attrs.colspan)}}for(let t=0;t<o.childCount;t++){const e=o.child(t);i+=e.attrs.colspan,e.attrs.rowspan>1&&(n=!0)}-1==e?e=i:e!=i&&(e=Math.max(e,i))}return e}(t),n=t.childCount,r=[];let o=0,i=null;const s=[];for(let t=0,o=e*n;t<o;t++)r[t]=0;for(let a=0,l=0;a<n;a++){const c=t.child(a);l++;for(let t=0;;t++){for(;o<r.length&&0!=r[o];)o++;if(t==c.childCount)break;const d=c.child(t),{colspan:u,rowspan:h,colwidth:p}=d.attrs;for(let t=0;t<h;t++){if(t+a>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:l,n:h-t});break}const c=o+t*e;for(let t=0;t<u;t++){0==r[c+t]?r[c+t]=l:(i||(i=[])).push({type:"collision",row:a,pos:l,n:u-t});const n=p&&p[t];if(n){const r=(c+t)%e*2,o=s[r];null==o||o!=n&&1==s[r+1]?(s[r]=n,s[r+1]=1):o==n&&s[r+1]++}}}o+=u,l+=d.nodeSize}const d=(a+1)*e;let u=0;for(;o<d;)0==r[o++]&&u++;u&&(i||(i=[])).push({type:"missing",row:a,n:u}),l++}0!==e&&0!==n||(i||(i=[])).push({type:"zero_sized"});const a=new OT(e,n,r,i);let l=!1;for(let t=0;!l&&t<s.length;t+=2)null!=s[t]&&s[t+1]<n&&(l=!0);return l&&function(t,e,n){t.problems||(t.problems=[]);const r={};for(let o=0;o<t.map.length;o++){const i=t.map[o];if(r[i])continue;r[i]=!0;const s=n.nodeAt(i);if(!s)throw new RangeError(`No cell with offset ${i} found`);let a=null;const l=s.attrs;for(let n=0;n<l.colspan;n++){const r=e[(o+n)%t.width*2];null==r||l.colwidth&&l.colwidth[n]==r||((a||(a=DT(l)))[n]=r)}a&&t.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:a})}}(a,s,t),a}(t))}};function DT(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function RT(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const r=t.nodes[n],o=r.spec.tableRole;o&&(e[o]=r)}}return e}var LT=new ad("selectingCells");function NT(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function IT(t){const e=t.selection.$head;for(let t=e.depth;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return!0;return!1}function PT(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&"cell"==e.node.type.spec.tableRole)return e.$anchor;const n=NT(e.$head)||function(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const r=e.type.spec.tableRole;if("cell"==r||"header_cell"==r)return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const r=e.type.spec.tableRole;if("cell"==r||"header_cell"==r)return t.doc.resolve(n-e.nodeSize)}}(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function $T(t){return"row"==t.parent.type.spec.tableRole&&!!t.nodeAfter}function HT(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function BT(t,e,n){const r=t.node(-1),o=OT.get(r),i=t.start(-1),s=o.nextCell(t.pos-i,e,n);return null==s?null:t.node(0).resolve(i+s)}function jT(t,e,n=1){const r={...t,colspan:t.colspan-n};return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(t=>t>0)||(r.colwidth=null)),r}function UT(t,e,n=1){const r={...t,colspan:t.colspan+n};if(r.colwidth){r.colwidth=r.colwidth.slice();for(let t=0;t<n;t++)r.colwidth.splice(e,0,0)}return r}var FT=class t extends Bc{constructor(t,e=t){const n=t.node(-1),r=OT.get(n),o=t.start(-1),i=r.rectBetween(t.pos-o,e.pos-o),s=t.node(0),a=r.cellsInRect(i).filter(t=>t!=e.pos-o);a.unshift(e.pos-o);const l=a.map(t=>{const e=n.nodeAt(t);if(!e)throw RangeError(`No cell with offset ${t} found`);const r=o+t+1;return new jc(s.resolve(r),s.resolve(r+e.content.size))});super(l[0].$from,l[0].$to,l),this.$anchorCell=t,this.$headCell=e}map(e,n){const r=e.resolve(n.map(this.$anchorCell.pos)),o=e.resolve(n.map(this.$headCell.pos));if($T(r)&&$T(o)&&HT(r,o)){const e=this.$anchorCell.node(-1)!=r.node(-1);return e&&this.isRowSelection()?t.rowSelection(r,o):e&&this.isColSelection()?t.colSelection(r,o):new t(r,o)}return Vc.between(r,o)}content(){const t=this.$anchorCell.node(-1),e=OT.get(t),n=this.$anchorCell.start(-1),r=e.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),o={},i=[];for(let n=r.top;n<r.bottom;n++){const s=[];for(let i=n*e.width+r.left,a=r.left;a<r.right;a++,i++){const n=e.map[i];if(o[n])continue;o[n]=!0;const a=e.findCell(n);let l=t.nodeAt(n);if(!l)throw RangeError(`No cell with offset ${n} found`);const c=r.left-a.left,d=a.right-r.right;if(c>0||d>0){let t=l.attrs;if(c>0&&(t=jT(t,0,c)),d>0&&(t=jT(t,t.colspan-d,d)),a.left<r.left){if(l=l.type.createAndFill(t),!l)throw RangeError(`Could not create cell with attrs ${JSON.stringify(t)}`)}else l=l.type.create(t,l.content)}if(a.top<r.top||a.bottom>r.bottom){const t={...l.attrs,rowspan:Math.min(a.bottom,r.bottom)-Math.max(a.top,r.top)};l=a.top<r.top?l.type.createAndFill(t):l.type.create(t,l.content)}s.push(l)}i.push(t.child(n).copy(Fa.from(s)))}const s=this.isColSelection()&&this.isRowSelection()?t:i;return new Ja(Fa.from(s),1,1)}replace(t,e=Ja.empty){const n=t.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){const{$from:i,$to:s}=r[o],a=t.mapping.slice(n);t.replace(a.map(i.pos),a.map(s.pos),o?Ja.empty:e)}const o=Bc.findFrom(t.doc.resolve(t.mapping.slice(n).map(this.to)),-1);o&&t.setSelection(o)}replaceWith(t,e){this.replace(t,new Ja(Fa.from(e),0,0))}forEachCell(t){const e=this.$anchorCell.node(-1),n=OT.get(e),r=this.$anchorCell.start(-1),o=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r));for(let n=0;n<o.length;n++)t(e.nodeAt(o[n]),r+o[n])}isColSelection(){const t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;const n=t+this.$anchorCell.nodeAfter.attrs.rowspan,r=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,r)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const r=e.node(-1),o=OT.get(r),i=e.start(-1),s=o.findCell(e.pos-i),a=o.findCell(n.pos-i),l=e.node(0);return s.top<=a.top?(s.top>0&&(e=l.resolve(i+o.map[s.left])),a.bottom<o.height&&(n=l.resolve(i+o.map[o.width*(o.height-1)+a.right-1]))):(a.top>0&&(n=l.resolve(i+o.map[a.left])),s.bottom<o.height&&(e=l.resolve(i+o.map[o.width*(o.height-1)+s.right-1]))),new t(e,n)}isRowSelection(){const t=this.$anchorCell.node(-1),e=OT.get(t),n=this.$anchorCell.start(-1),r=e.colCount(this.$anchorCell.pos-n),o=e.colCount(this.$headCell.pos-n);if(Math.min(r,o)>0)return!1;const i=r+this.$anchorCell.nodeAfter.attrs.colspan,s=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,s)==e.width}eq(e){return e instanceof t&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const r=e.node(-1),o=OT.get(r),i=e.start(-1),s=o.findCell(e.pos-i),a=o.findCell(n.pos-i),l=e.node(0);return s.left<=a.left?(s.left>0&&(e=l.resolve(i+o.map[s.top*o.width])),a.right<o.width&&(n=l.resolve(i+o.map[o.width*(a.top+1)-1]))):(a.left>0&&(n=l.resolve(i+o.map[a.top*o.width])),s.right<o.width&&(e=l.resolve(i+o.map[o.width*(s.top+1)-1]))),new t(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new t(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){return new t(e.resolve(n),e.resolve(r))}getBookmark(){return new VT(this.$anchorCell.pos,this.$headCell.pos)}};FT.prototype.visible=!1,Bc.jsonID("cell",FT);var VT=class t{constructor(t,e){this.anchor=t,this.head=e}map(e){return new t(e.map(this.anchor),e.map(this.head))}resolve(t){const e=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&n.index()<n.parent.childCount&&HT(e,n)?new FT(e,n):Bc.near(n,1)}};function zT(t){if(!(t.selection instanceof FT))return null;const e=[];return t.selection.forEachCell((t,n)=>{e.push(jh.node(n,n+t.nodeSize,{class:"selectedCell"}))}),Vh.create(t.doc,e)}var WT=new ad("fix-tables");function qT(t,e,n,r){const o=t.childCount,i=e.childCount;t:for(let s=0,a=0;s<i;s++){const i=e.child(s);for(let e=a,r=Math.min(o,s+3);e<r;e++)if(t.child(e)==i){a=e+1,n+=i.nodeSize;continue t}r(i,n),a<o&&t.child(a).sameMarkup(i)?qT(t.child(a),i,n+1,r):i.nodesBetween(0,i.content.size,r,n+1),n+=i.nodeSize}}function KT(t,e){let n;const r=(e,r)=>{"table"==e.type.spec.tableRole&&(n=function(t,e,n,r){const o=OT.get(e);if(!o.problems)return r;r||(r=t.tr);const i=[];for(let t=0;t<o.height;t++)i.push(0);for(let t=0;t<o.problems.length;t++){const s=o.problems[t];if("collision"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;const o=t.attrs;for(let t=0;t<o.rowspan;t++)i[s.row+t]+=s.n;r.setNodeMarkup(r.mapping.map(n+1+s.pos),null,jT(o,o.colspan-s.n,s.n))}else if("missing"==s.type)i[s.row]+=s.n;else if("overlong_rowspan"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;r.setNodeMarkup(r.mapping.map(n+1+s.pos),null,{...t.attrs,rowspan:t.attrs.rowspan-s.n})}else if("colwidth mismatch"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;r.setNodeMarkup(r.mapping.map(n+1+s.pos),null,{...t.attrs,colwidth:s.colwidth})}else if("zero_sized"==s.type){const t=r.mapping.map(n);r.delete(t,t+e.nodeSize)}}let s,a;for(let t=0;t<i.length;t++)i[t]&&(null==s&&(s=t),a=t);for(let l=0,c=n+1;l<o.height;l++){const n=e.child(l),o=c+n.nodeSize,d=i[l];if(d>0){let e="cell";n.firstChild&&(e=n.firstChild.type.spec.tableRole);const i=[];for(let n=0;n<d;n++){const n=RT(t.schema)[e].createAndFill();n&&i.push(n)}const u=0!=l&&s!=l-1||a!=l?o-1:c+1;r.insert(r.mapping.map(u),i)}c=o}return r.setMeta(WT,{fixTables:!0})}(t,e,r,n))};return e?e.doc!=t.doc&&qT(e.doc,t.doc,0,r):t.doc.descendants(r),n}function JT(t){const e=t.selection,n=PT(t),r=n.node(-1),o=n.start(-1),i=OT.get(r);return{...e instanceof FT?i.rectBetween(e.$anchorCell.pos-o,e.$headCell.pos-o):i.findCell(n.pos-o),tableStart:o,map:i,table:r}}function GT(t,{map:e,tableStart:n,table:r},o){let i=o>0?-1:0;(function(t,e,n){const r=RT(e.type.schema).header_cell;for(let o=0;o<t.height;o++)if(e.nodeAt(t.map[n+o*t.width]).type!=r)return!1;return!0})(e,r,o+i)&&(i=0==o||o==e.width?null:0);for(let s=0;s<e.height;s++){const a=s*e.width+o;if(o>0&&o<e.width&&e.map[a-1]==e.map[a]){const i=e.map[a],l=r.nodeAt(i);t.setNodeMarkup(t.mapping.map(n+i),null,UT(l.attrs,o-e.colCount(i))),s+=l.attrs.rowspan-1}else{const l=null==i?RT(r.type.schema).cell:r.nodeAt(e.map[a+i]).type,c=e.positionAt(s,o,r);t.insert(t.mapping.map(n+c),l.createAndFill())}}return t}function YT(t,e){if(!IT(t))return!1;if(e){const n=JT(t);e(GT(t.tr,n,n.left))}return!0}function XT(t,e){if(!IT(t))return!1;if(e){const n=JT(t);e(GT(t.tr,n,n.right))}return!0}function QT(t,{map:e,table:n,tableStart:r},o){const i=t.mapping.maps.length;for(let s=0;s<e.height;){const a=s*e.width+o,l=e.map[a],c=n.nodeAt(l),d=c.attrs;if(o>0&&e.map[a-1]==l||o<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(i).map(r+l),null,jT(d,o-e.colCount(l)));else{const e=t.mapping.slice(i).map(r+l);t.delete(e,e+c.nodeSize)}s+=d.rowspan}}function ZT(t,e){if(!IT(t))return!1;if(e){const n=JT(t),r=t.tr;if(0==n.left&&n.right==n.map.width)return!1;for(let t=n.right-1;QT(r,n,t),t!=n.left;t--){const t=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!t)throw RangeError("No table found");n.table=t,n.map=OT.get(t)}e(r)}return!0}function tM(t,{map:e,tableStart:n,table:r},o){var i;let s=n;for(let t=0;t<o;t++)s+=r.child(t).nodeSize;const a=[];let l=o>0?-1:0;(function(t,e,n){var r;const o=RT(e.type.schema).header_cell;for(let i=0;i<t.width;i++)if((null==(r=e.nodeAt(t.map[i+n*t.width]))?void 0:r.type)!=o)return!1;return!0})(e,r,o+l)&&(l=0==o||o==e.height?null:0);for(let s=0,c=e.width*o;s<e.width;s++,c++)if(o>0&&o<e.height&&e.map[c]==e.map[c-e.width]){const o=e.map[c],i=r.nodeAt(o).attrs;t.setNodeMarkup(n+o,null,{...i,rowspan:i.rowspan+1}),s+=i.colspan-1}else{const t=null==l?RT(r.type.schema).cell:null==(i=r.nodeAt(e.map[c+l*e.width]))?void 0:i.type,n=null==t?void 0:t.createAndFill();n&&a.push(n)}return t.insert(s,RT(r.type.schema).row.create(null,a)),t}function eM(t,e){if(!IT(t))return!1;if(e){const n=JT(t);e(tM(t.tr,n,n.top))}return!0}function nM(t,e){if(!IT(t))return!1;if(e){const n=JT(t);e(tM(t.tr,n,n.bottom))}return!0}function rM(t,{map:e,table:n,tableStart:r},o){let i=0;for(let t=0;t<o;t++)i+=n.child(t).nodeSize;const s=i+n.child(o).nodeSize,a=t.mapping.maps.length;t.delete(i+r,s+r);const l=new Set;for(let i=0,s=o*e.width;i<e.width;i++,s++){const c=e.map[s];if(!l.has(c))if(l.add(c),o>0&&c==e.map[s-e.width]){const e=n.nodeAt(c).attrs;t.setNodeMarkup(t.mapping.slice(a).map(c+r),null,{...e,rowspan:e.rowspan-1}),i+=e.colspan-1}else if(o<e.height&&c==e.map[s+e.width]){const s=n.nodeAt(c),l=s.attrs,d=s.type.create({...l,rowspan:s.attrs.rowspan-1},s.content),u=e.positionAt(o+1,i,n);t.insert(t.mapping.slice(a).map(r+u),d),i+=l.colspan-1}}}function oM(t,e){if(!IT(t))return!1;if(e){const n=JT(t),r=t.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(let t=n.bottom-1;rM(r,n,t),t!=n.top;t--){const t=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!t)throw RangeError("No table found");n.table=t,n.map=OT.get(n.table)}e(r)}return!0}function iM(t){const e=t.content;return 1==e.childCount&&e.child(0).isTextblock&&0==e.child(0).childCount}function sM(t,e){const n=t.selection;if(!(n instanceof FT)||n.$anchorCell.pos==n.$headCell.pos)return!1;const r=JT(t),{map:o}=r;if(function({width:t,height:e,map:n},r){let o=r.top*t+r.left,i=o,s=(r.bottom-1)*t+r.left,a=o+(r.right-r.left-1);for(let e=r.top;e<r.bottom;e++){if(r.left>0&&n[i]==n[i-1]||r.right<t&&n[a]==n[a+1])return!0;i+=t,a+=t}for(let i=r.left;i<r.right;i++){if(r.top>0&&n[o]==n[o-t]||r.bottom<e&&n[s]==n[s+t])return!0;o++,s++}return!1}(o,r))return!1;if(e){const n=t.tr,i={};let s,a,l=Fa.empty;for(let t=r.top;t<r.bottom;t++)for(let e=r.left;e<r.right;e++){const c=o.map[t*o.width+e],d=r.table.nodeAt(c);if(!i[c]&&d)if(i[c]=!0,null==s)s=c,a=d;else{iM(d)||(l=l.append(d.content));const t=n.mapping.map(c+r.tableStart);n.delete(t,t+d.nodeSize)}}if(null==s||null==a)return!0;if(n.setNodeMarkup(s+r.tableStart,null,{...UT(a.attrs,a.attrs.colspan,r.right-r.left-a.attrs.colspan),rowspan:r.bottom-r.top}),l.size){const t=s+1+a.content.size,e=iM(a)?s+1:t;n.replaceWith(e+r.tableStart,t+r.tableStart,l)}n.setSelection(new FT(n.doc.resolve(s+r.tableStart))),e(n)}return!0}function aM(t,e){const n=RT(t.schema);return(r=({node:t})=>n[t.type.spec.tableRole],(t,e)=>{var n;const o=t.selection;let i,s;if(o instanceof FT){if(o.$anchorCell.pos!=o.$headCell.pos)return!1;i=o.$anchorCell.nodeAfter,s=o.$anchorCell.pos}else{if(i=function(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if("cell"===n||"header_cell"===n)return t.node(e)}return null}(o.$from),!i)return!1;s=null==(n=NT(o.$from))?void 0:n.pos}if(null==i||null==s)return!1;if(1==i.attrs.colspan&&1==i.attrs.rowspan)return!1;if(e){let n=i.attrs;const a=[],l=n.colwidth;n.rowspan>1&&(n={...n,rowspan:1}),n.colspan>1&&(n={...n,colspan:1});const c=JT(t),d=t.tr;for(let t=0;t<c.right-c.left;t++)a.push(l?{...n,colwidth:l&&l[t]?[l[t]]:null}:n);let u;for(let t=c.top;t<c.bottom;t++){let e=c.map.positionAt(t,c.left,c.table);t==c.top&&(e+=i.nodeSize);for(let n=c.left,o=0;n<c.right;n++,o++)n==c.left&&t==c.top||d.insert(u=d.mapping.map(e+c.tableStart,1),r({node:i,row:t,col:n}).createAndFill(a[o]))}d.setNodeMarkup(s,r({node:i,row:c.top,col:c.left}),a[0]),o instanceof FT&&d.setSelection(new FT(d.doc.resolve(o.$anchorCell.pos),u?d.doc.resolve(u):void 0)),e(d)}return!0})(t,e);var r}function lM(t,e){return function(n,r){if(!IT(n))return!1;const o=PT(n);if(o.nodeAfter.attrs[t]===e)return!1;if(r){const i=n.tr;n.selection instanceof FT?n.selection.forEachCell((n,r)=>{n.attrs[t]!==e&&i.setNodeMarkup(r,null,{...n.attrs,[t]:e})}):i.setNodeMarkup(o.pos,null,{...o.nodeAfter.attrs,[t]:e}),r(i)}return!0}}function cM(t,e,n){const r=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1});for(let t=0;t<r.length;t++){const o=e.table.nodeAt(r[t]);if(o&&o.type!==n.header_cell)return!1}return!0}function dM(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,n){if(!IT(e))return!1;if(n){const r=RT(e.schema),o=JT(e),i=e.tr,s=o.map.cellsInRect("column"==t?{left:o.left,top:0,right:o.right,bottom:o.map.height}:"row"==t?{left:0,top:o.top,right:o.map.width,bottom:o.bottom}:o),a=s.map(t=>o.table.nodeAt(t));for(let t=0;t<s.length;t++)a[t].type==r.header_cell&&i.setNodeMarkup(o.tableStart+s[t],r.cell,a[t].attrs);if(0==i.steps.length)for(let t=0;t<s.length;t++)i.setNodeMarkup(o.tableStart+s[t],r.header_cell,a[t].attrs);n(i)}return!0}}(t):function(e,n){if(!IT(e))return!1;if(n){const r=RT(e.schema),o=JT(e),i=e.tr,s=cM("row",o,r),a=cM("column",o,r),l=("column"===t?s:"row"===t&&a)?1:0,c="column"==t?{left:0,top:l,right:1,bottom:o.map.height}:"row"==t?{left:l,top:0,right:o.map.width,bottom:1}:o,d="column"==t?a?r.cell:r.header_cell:"row"==t?s?r.cell:r.header_cell:r.cell;o.map.cellsInRect(c).forEach(t=>{const e=t+o.tableStart,n=i.doc.nodeAt(e);n&&i.setNodeMarkup(e,d,n.attrs)}),n(i)}return!0}}dM("row",{useDeprecatedLogic:!0}),dM("column",{useDeprecatedLogic:!0});var uM=dM("cell",{useDeprecatedLogic:!0});function hM(t){return function(e,n){if(!IT(e))return!1;const r=function(t,e){if(e<0){const e=t.nodeBefore;if(e)return t.pos-e.nodeSize;for(let e=t.index(-1)-1,n=t.before();e>=0;e--){const r=t.node(-1).child(e),o=r.lastChild;if(o)return n-1-o.nodeSize;n-=r.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const e=t.node(-1);for(let n=t.indexAfter(-1),r=t.after();n<e.childCount;n++){const t=e.child(n);if(t.childCount)return r+1;r+=t.nodeSize}}return null}(PT(e),t);if(null==r)return!1;if(n){const t=e.doc.resolve(r);n(e.tr.setSelection(Vc.between(t,(o=t,o.node(0).resolve(o.pos+o.nodeAfter.nodeSize)))).scrollIntoView())}var o;return!0}}function pM(t,e){const n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if("table"==n.node(r).type.spec.tableRole)return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function fM(t,e){const n=t.selection;if(!(n instanceof FT))return!1;if(e){const r=t.tr,o=RT(t.schema).cell.createAndFill().content;n.forEachCell((t,e)=>{t.content.eq(o)||r.replace(r.mapping.map(e+1),r.mapping.map(e+t.nodeSize-1),new Ja(o,0,0))}),r.docChanged&&e(r)}return!0}function mM(t,e){const n=t.createAndFill();return new $c(n).replace(0,n.content.size,e).doc}function gM(t,e,n,r,o,i,s,a){if(0==s||s==e.height)return!1;let l=!1;for(let c=o;c<i;c++){const o=s*e.width+c,i=e.map[o];if(e.map[o-e.width]==i){l=!0;const o=n.nodeAt(i),{top:d,left:u}=e.findCell(i);t.setNodeMarkup(t.mapping.slice(a).map(i+r),null,{...o.attrs,rowspan:s-d}),t.insert(t.mapping.slice(a).map(e.positionAt(s,u,n)),o.type.createAndFill({...o.attrs,rowspan:d+o.attrs.rowspan-s})),c+=o.attrs.colspan-1}}return l}function yM(t,e,n,r,o,i,s,a){if(0==s||s==e.width)return!1;let l=!1;for(let c=o;c<i;c++){const o=c*e.width+s,i=e.map[o];if(e.map[o-1]==i){l=!0;const o=n.nodeAt(i),d=e.colCount(i),u=t.mapping.slice(a).map(i+r);t.setNodeMarkup(u,null,jT(o.attrs,s-d,o.attrs.colspan-(s-d))),t.insert(u+o.nodeSize,o.type.createAndFill(jT(o.attrs,0,s-d))),c+=o.attrs.rowspan-1}}return l}function bM(t,e,n,r,o){let i=n?t.doc.nodeAt(n-1):t.doc;if(!i)throw new Error("No table found");let s=OT.get(i);const{top:a,left:l}=r,c=l+o.width,d=a+o.height,u=t.tr;let h=0;function p(){if(i=n?u.doc.nodeAt(n-1):u.doc,!i)throw new Error("No table found");s=OT.get(i),h=u.mapping.maps.length}(function(t,e,n,r,o,i,s){const a=RT(t.doc.type.schema);let l,c;if(o>e.width)for(let i=0,d=0;i<e.height;i++){const u=n.child(i);d+=u.nodeSize;const h=[];let p;p=null==u.lastChild||u.lastChild.type==a.cell?l||(l=a.cell.createAndFill()):c||(c=a.header_cell.createAndFill());for(let t=e.width;t<o;t++)h.push(p);t.insert(t.mapping.slice(s).map(d-1+r),h)}if(i>e.height){const d=[];for(let t=0,r=(e.height-1)*e.width;t<Math.max(e.width,o);t++){const o=!(t>=e.width)&&n.nodeAt(e.map[r+t]).type==a.header_cell;d.push(o?c||(c=a.header_cell.createAndFill()):l||(l=a.cell.createAndFill()))}const u=a.row.create(null,Fa.from(d)),h=[];for(let t=e.height;t<i;t++)h.push(u);t.insert(t.mapping.slice(s).map(r+n.nodeSize-2),h)}return!(!l&&!c)})(u,s,i,n,c,d,h)&&p(),gM(u,s,i,n,l,c,a,h)&&p(),gM(u,s,i,n,l,c,d,h)&&p(),yM(u,s,i,n,a,d,l,h)&&p(),yM(u,s,i,n,a,d,c,h)&&p();for(let t=a;t<d;t++){const e=s.positionAt(t,l,i),r=s.positionAt(t,c,i);u.replace(u.mapping.slice(h).map(e+n),u.mapping.slice(h).map(r+n),new Ja(o.rows[t-a],0,0))}p(),u.setSelection(new FT(u.doc.resolve(n+s.positionAt(a,l,i)),u.doc.resolve(n+s.positionAt(d-1,c-1,i)))),e(u)}var vM=Ap({ArrowLeft:kM("horiz",-1),ArrowRight:kM("horiz",1),ArrowUp:kM("vert",-1),ArrowDown:kM("vert",1),"Shift-ArrowLeft":SM("horiz",-1),"Shift-ArrowRight":SM("horiz",1),"Shift-ArrowUp":SM("vert",-1),"Shift-ArrowDown":SM("vert",1),Backspace:fM,"Mod-Backspace":fM,Delete:fM,"Mod-Delete":fM});function wM(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function kM(t,e){return(n,r,o)=>{if(!o)return!1;const i=n.selection;if(i instanceof FT)return wM(n,r,Bc.near(i.$headCell,e));if("horiz"!=t&&!i.empty)return!1;const s=EM(o,t,e);if(null==s)return!1;if("horiz"==t)return wM(n,r,Bc.near(n.doc.resolve(i.head+e),e));{const o=n.doc.resolve(s),i=BT(o,t,e);let a;return a=i?Bc.near(i,1):e<0?Bc.near(n.doc.resolve(o.before(-1)),-1):Bc.near(n.doc.resolve(o.after(-1)),1),wM(n,r,a)}}}function SM(t,e){return(n,r,o)=>{if(!o)return!1;const i=n.selection;let s;if(i instanceof FT)s=i;else{const r=EM(o,t,e);if(null==r)return!1;s=new FT(n.doc.resolve(r))}const a=BT(s.$headCell,t,e);return!!a&&wM(n,r,new FT(s.$anchorCell,a))}}function xM(t,e){const n=NT(t.state.doc.resolve(e));return!!n&&(t.dispatch(t.state.tr.setSelection(new FT(n))),!0)}function CM(t,e,n){if(!IT(t.state))return!1;let r=function(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:r}=t;for(;1==e.childCount&&(n>0&&r>0||"table"==e.child(0).type.spec.tableRole);)n--,r--,e=e.child(0).content;const o=e.child(0),i=o.type.spec.tableRole,s=o.type.schema,a=[];if("row"==i)for(let t=0;t<e.childCount;t++){let o=e.child(t).content;const i=t?0:Math.max(0,n-1),l=t<e.childCount-1?0:Math.max(0,r-1);(i||l)&&(o=mM(RT(s).row,new Ja(o,i,l)).content),a.push(o)}else{if("cell"!=i&&"header_cell"!=i)return null;a.push(n||r?mM(RT(s).row,new Ja(e,n,r)).content:e)}return function(t,e){const n=[];for(let t=0;t<e.length;t++){const r=e[t];for(let e=r.childCount-1;e>=0;e--){const{rowspan:o,colspan:i}=r.child(e).attrs;for(let e=t;e<t+o;e++)n[e]=(n[e]||0)+i}}let r=0;for(let t=0;t<n.length;t++)r=Math.max(r,n[t]);for(let o=0;o<n.length;o++)if(o>=e.length&&e.push(Fa.empty),n[o]<r){const i=RT(t).cell.createAndFill(),s=[];for(let t=n[o];t<r;t++)s.push(i);e[o]=e[o].append(Fa.from(s))}return{height:e.length,width:r,rows:e}}(s,a)}(n);const o=t.state.selection;if(o instanceof FT){r||(r={width:1,height:1,rows:[Fa.from(mM(RT(t.state.schema).cell,n))]});const e=o.$anchorCell.node(-1),i=o.$anchorCell.start(-1),s=OT.get(e).rectBetween(o.$anchorCell.pos-i,o.$headCell.pos-i);return r=function({width:t,height:e,rows:n},r,o){if(t!=r){const e=[],o=[];for(let t=0;t<n.length;t++){const i=n[t],s=[];for(let n=e[t]||0,o=0;n<r;o++){let a=i.child(o%i.childCount);n+a.attrs.colspan>r&&(a=a.type.createChecked(jT(a.attrs,a.attrs.colspan,n+a.attrs.colspan-r),a.content)),s.push(a),n+=a.attrs.colspan;for(let n=1;n<a.attrs.rowspan;n++)e[t+n]=(e[t+n]||0)+a.attrs.colspan}o.push(Fa.from(s))}n=o,t=r}if(e!=o){const t=[];for(let r=0,i=0;r<o;r++,i++){const s=[],a=n[i%e];for(let t=0;t<a.childCount;t++){let e=a.child(t);r+e.attrs.rowspan>o&&(e=e.type.create({...e.attrs,rowspan:Math.max(1,o-e.attrs.rowspan)},e.content)),s.push(e)}t.push(Fa.from(s))}n=t,e=o}return{width:t,height:e,rows:n}}(r,s.right-s.left,s.bottom-s.top),bM(t.state,t.dispatch,i,s,r),!0}if(r){const e=PT(t.state),n=e.start(-1);return bM(t.state,t.dispatch,n,OT.get(e.node(-1)).findCell(e.pos-n),r),!0}return!1}function _M(t,e){var n;if(e.ctrlKey||e.metaKey)return;const r=TM(t,e.target);let o;if(e.shiftKey&&t.state.selection instanceof FT)i(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&null!=(o=NT(t.state.selection.$anchor))&&(null==(n=MM(t,e))?void 0:n.pos)!=o.pos)i(o,e),e.preventDefault();else if(!r)return;function i(e,n){let r=MM(t,n);const o=null==LT.getState(t.state);if(!r||!HT(e,r)){if(!o)return;r=e}const i=new FT(e,r);if(o||!t.state.selection.eq(i)){const n=t.state.tr.setSelection(i);o&&n.setMeta(LT,e.pos),t.dispatch(n)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",a),null!=LT.getState(t.state)&&t.dispatch(t.state.tr.setMeta(LT,-1))}function a(n){const o=n,a=LT.getState(t.state);let l;if(null!=a)l=t.state.doc.resolve(a);else if(TM(t,o.target)!=r&&(l=MM(t,e),!l))return s();l&&i(l,o)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",a)}function EM(t,e,n){if(!(t.state.selection instanceof Vc))return null;const{$head:r}=t.state.selection;for(let o=r.depth-1;o>=0;o--){const i=r.node(o);if((n<0?r.index(o):r.indexAfter(o))!=(n<0?0:i.childCount))return null;if("cell"==i.type.spec.tableRole||"header_cell"==i.type.spec.tableRole){const i=r.before(o),s="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(s)?i:null}}return null}function TM(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function MM(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?NT(t.state.doc.resolve(n.pos)):null}var AM=class{constructor(t,e){this.node=t,this.defaultCellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${e}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),OM(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type==this.node.type&&(this.node=t,OM(t,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))}};function OM(t,e,n,r,o,i){var s;let a=0,l=!0,c=e.firstChild;const d=t.firstChild;if(d){for(let t=0,n=0;t<d.childCount;t++){const{colspan:s,colwidth:u}=d.child(t).attrs;for(let t=0;t<s;t++,n++){const s=o==n?i:u&&u[t],d=s?s+"px":"";if(a+=s||r,s||(l=!1),c)c.style.width!=d&&(c.style.width=d),c=c.nextSibling;else{const t=document.createElement("col");t.style.width=d,e.appendChild(t)}}}for(;c;){const t=c.nextSibling;null==(s=c.parentNode)||s.removeChild(c),c=t}l?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}}var DM=new ad("tableColumnResizing");function RM({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:r=AM,lastColumnResizable:o=!0}={}){const i=new od({key:DM,state:{init(t,e){var o,s;const a=null==(s=null==(o=i.spec)?void 0:o.props)?void 0:s.nodeViews,l=RT(e.schema).table.name;return r&&a&&(a[l]=(t,e)=>new r(t,n,e)),new LM(-1,!1)},apply:(t,e)=>e.apply(t)},props:{attributes:t=>{const e=DM.getState(t);return e&&e.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(e,n)=>{!function(t,e,n,r){if(!t.editable)return;const o=DM.getState(t.state);if(o&&!o.dragging){const i=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target);let s=-1;if(i){const{left:r,right:o}=i.getBoundingClientRect();e.clientX-r<=n?s=NM(t,e,"left",n):o-e.clientX<=n&&(s=NM(t,e,"right",n))}if(s!=o.activeHandle){if(!r&&-1!==s){const e=t.state.doc.resolve(s),n=e.node(-1),r=OT.get(n),o=e.start(-1);if(r.colCount(e.pos-o)+e.nodeAfter.attrs.colspan-1==r.width-1)return}PM(t,s)}}}(e,n,t,o)},mouseleave:t=>{!function(t){if(!t.editable)return;const e=DM.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&PM(t,-1)}(t)},mousedown:(t,r)=>{!function(t,e,n,r){var o;if(!t.editable)return!1;const i=null!=(o=t.dom.ownerDocument.defaultView)?o:window,s=DM.getState(t.state);if(!s||-1==s.activeHandle||s.dragging)return!1;const a=t.state.doc.nodeAt(s.activeHandle),l=function(t,e,{colspan:n,colwidth:r}){const o=r&&r[r.length-1];if(o)return o;const i=t.domAtPos(e);let s=i.node.childNodes[i.offset].offsetWidth,a=n;if(r)for(let t=0;t<n;t++)r[t]&&(s-=r[t],a--);return s/a}(t,s.activeHandle,a.attrs);function c(e){i.removeEventListener("mouseup",c),i.removeEventListener("mousemove",d);const r=DM.getState(t.state);(null==r?void 0:r.dragging)&&(function(t,e,n){const r=t.state.doc.resolve(e),o=r.node(-1),i=OT.get(o),s=r.start(-1),a=i.colCount(r.pos-s)+r.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let t=0;t<i.height;t++){const e=t*i.width+a;if(t&&i.map[e]==i.map[e-i.width])continue;const r=i.map[e],c=o.nodeAt(r).attrs,d=1==c.colspan?0:a-i.colCount(r);if(c.colwidth&&c.colwidth[d]==n)continue;const u=c.colwidth?c.colwidth.slice():HM(c.colspan);u[d]=n,l.setNodeMarkup(s+r,null,{...c,colwidth:u})}l.docChanged&&t.dispatch(l)}(t,r.activeHandle,IM(r.dragging,e,n)),t.dispatch(t.state.tr.setMeta(DM,{setDragging:null})))}function d(e){if(!e.which)return c(e);const o=DM.getState(t.state);if(o&&o.dragging){const i=IM(o.dragging,e,n);$M(t,o.activeHandle,i,r)}}t.dispatch(t.state.tr.setMeta(DM,{setDragging:{startX:e.clientX,startWidth:l}})),$M(t,s.activeHandle,l,r),i.addEventListener("mouseup",c),i.addEventListener("mousemove",d),e.preventDefault()}(t,r,e,n)}},decorations:t=>{const e=DM.getState(t);if(e&&e.activeHandle>-1)return function(t,e){var n;const r=[],o=t.doc.resolve(e),i=o.node(-1);if(!i)return Vh.empty;const s=OT.get(i),a=o.start(-1),l=s.colCount(o.pos-a)+o.nodeAfter.attrs.colspan-1;for(let e=0;e<s.height;e++){const o=l+e*s.width;if(!(l!=s.width-1&&s.map[o]==s.map[o+1]||0!=e&&s.map[o]==s.map[o-s.width])){const e=s.map[o],l=a+e+i.nodeAt(e).nodeSize-1,c=document.createElement("div");c.className="column-resize-handle",(null==(n=DM.getState(t))?void 0:n.dragging)&&r.push(jh.node(a+e,a+e+i.nodeAt(e).nodeSize,{class:"column-resize-dragging"})),r.push(jh.widget(l,c))}}return Vh.create(t.doc,r)}(t,e.activeHandle)},nodeViews:{}}});return i}var LM=class t{constructor(t,e){this.activeHandle=t,this.dragging=e}apply(e){const n=this,r=e.getMeta(DM);if(r&&null!=r.setHandle)return new t(r.setHandle,!1);if(r&&void 0!==r.setDragging)return new t(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let r=e.mapping.map(n.activeHandle,-1);return $T(e.doc.resolve(r))||(r=-1),new t(r,n.dragging)}return n}};function NM(t,e,n,r){const o="right"==n?-r:r,i=t.posAtCoords({left:e.clientX+o,top:e.clientY});if(!i)return-1;const{pos:s}=i,a=NT(t.state.doc.resolve(s));if(!a)return-1;if("right"==n)return a.pos;const l=OT.get(a.node(-1)),c=a.start(-1),d=l.map.indexOf(a.pos-c);return d%l.width==0?-1:c+l.map[d-1]}function IM(t,e,n){const r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function PM(t,e){t.dispatch(t.state.tr.setMeta(DM,{setHandle:e}))}function $M(t,e,n,r){const o=t.state.doc.resolve(e),i=o.node(-1),s=o.start(-1),a=OT.get(i).colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1;let l=t.domAtPos(o.start(-1)).node;for(;l&&"TABLE"!=l.nodeName;)l=l.parentNode;l&&OM(i,l.firstChild,l,r,a,n)}function HM(t){return Array(t).fill(0)}function BM({allowTableNodeSelection:t=!1}={}){return new od({key:LT,state:{init:()=>null,apply(t,e){const n=t.getMeta(LT);if(null!=n)return-1==n?null:n;if(null==e||!t.docChanged)return e;const{deleted:r,pos:o}=t.mapping.mapResult(e);return r?null:o}},props:{decorations:zT,handleDOMEvents:{mousedown:_M},createSelectionBetween:t=>null!=LT.getState(t.state)?t.state.selection:null,handleTripleClick:xM,handleKeyDown:vM,handlePaste:CM},appendTransaction:(e,n,r)=>function(t,e,n){const r=(e||t).selection,o=(e||t).doc;let i,s;if(r instanceof Wc&&(s=r.node.type.spec.tableRole)){if("cell"==s||"header_cell"==s)i=FT.create(o,r.from);else if("row"==s){const t=o.resolve(r.from+1);i=FT.rowSelection(t,t)}else if(!n){const t=OT.get(r.node),e=r.from+1,n=e+t.map[t.width*t.height-1];i=FT.create(o,e+1,n)}}else r instanceof Vc&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,r=e.pos,o=t.depth;for(;o>=0&&!(t.after(o+1)<t.end(o));o--,n++);for(let t=e.depth;t>=0&&!(e.before(t+1)>e.start(t));t--,r--);return n==r&&/row|table/.test(t.node(o).type.spec.tableRole)}(r)?i=Vc.create(o,r.from):r instanceof Vc&&function({$from:t,$to:e}){let n,r;for(let e=t.depth;e>0;e--){const r=t.node(e);if("cell"===r.type.spec.tableRole||"header_cell"===r.type.spec.tableRole){n=r;break}}for(let t=e.depth;t>0;t--){const n=e.node(t);if("cell"===n.type.spec.tableRole||"header_cell"===n.type.spec.tableRole){r=n;break}}return n!==r&&0===e.parentOffset}(r)&&(i=Vc.create(o,r.$from.start(),r.$from.end()));return i&&(e||(e=t.tr)).setSelection(i),e}(r,KT(r,n),t)})}var jM=Ug.create({name:"tableCell",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(t=>parseInt(t,10)):null}}}),tableRole:"cell",isolating:!0,parseHTML:()=>[{tag:"td"}],renderHTML({HTMLAttributes:t}){return["td",kf(this.options.HTMLAttributes,t),0]}}),UM=Ug.create({name:"tableHeader",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(t=>parseInt(t,10)):null}}}),tableRole:"header_cell",isolating:!0,parseHTML:()=>[{tag:"th"}],renderHTML({HTMLAttributes:t}){return["th",kf(this.options.HTMLAttributes,t),0]}}),FM=Ug.create({name:"tableRow",addOptions:()=>({HTMLAttributes:{}}),content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML:()=>[{tag:"tr"}],renderHTML({HTMLAttributes:t}){return["tr",kf(this.options.HTMLAttributes,t),0]}});function VM(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function zM(t,e,n,r,o,i){var s;let a=0,l=!0,c=e.firstChild;const d=t.firstChild;if(null!==d)for(let t=0,n=0;t<d.childCount;t+=1){const{colspan:s,colwidth:u}=d.child(t).attrs;for(let t=0;t<s;t+=1,n+=1){const s=o===n?i:u&&u[t],d=s?`${s}px`:"";if(a+=s||r,s||(l=!1),c){if(c.style.width!==d){const[t,e]=VM(r,s);c.style.setProperty(t,e)}c=c.nextSibling}else{const t=document.createElement("col"),[n,o]=VM(r,s);t.style.setProperty(n,o),e.appendChild(t)}}}for(;c;){const t=c.nextSibling;null==(s=c.parentNode)||s.removeChild(c),c=t}l?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}var WM=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),zM(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type===this.node.type&&(this.node=t,zM(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"===t.type&&(t.target===this.table||this.colgroup.contains(t.target))}};function qM(t,e){return e?t.createChecked(null,e):t.createAndFill()}var KM=({editor:t})=>{const{selection:e}=t.state;if(!(e instanceof FT))return!1;let n=0;const r=hf(e.ranges[0].$from,t=>"table"===t.type.name);return null==r||r.node.descendants(t=>{if("table"===t.type.name)return!1;["tableCell","tableHeader"].includes(t.type.name)&&(n+=1)}),n===e.ranges.length&&(t.commands.deleteTable(),!0)},JM=Ug.create({name:"table",addOptions:()=>({HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:WM,lastColumnResizable:!0,allowTableNodeSelection:!1}),content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:()=>[{tag:"table"}],renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:r,tableMinWidth:o}=function(t,e){let n=0,r=!0;const o=[],i=t.firstChild;if(!i)return{};for(let t=0,s=0;t<i.childCount;t+=1){const{colspan:a,colwidth:l}=i.child(t).attrs;for(let t=0;t<a;t+=1,s+=1){const i=undefined===s?undefined:l&&l[t];n+=i||e,i||(r=!1);const[a,c]=VM(e,i);o.push(["col",{style:`${a}: ${c}`}])}}const s=r?`${n}px`:"",a=r?"":`${n}px`;return{colgroup:["colgroup",{},...o],tableWidth:s,tableMinWidth:a}}(t,this.options.cellMinWidth);return["table",kf(this.options.HTMLAttributes,e,{style:r?`width: ${r}`:`min-width: ${o}`}),n,["tbody",0]]},addCommands:()=>({insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:o,editor:i})=>{const s=function(t,e,n,r,o){const i=function(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}(t),s=[],a=[];for(let t=0;t<n;t+=1){const t=qM(i.cell,o);if(t&&a.push(t),r){const t=qM(i.header_cell,o);t&&s.push(t)}}const l=[];for(let t=0;t<e;t+=1)l.push(i.row.createChecked(null,r&&0===t?s:a));return i.table.createChecked(null,l)}(i.schema,t,e,n);if(o){const t=r.selection.from+1;r.replaceSelectionWith(s).scrollIntoView().setSelection(Vc.near(r.doc.resolve(t)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>YT(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>XT(t,e),deleteColumn:()=>({state:t,dispatch:e})=>ZT(t,e),addRowBefore:()=>({state:t,dispatch:e})=>eM(t,e),addRowAfter:()=>({state:t,dispatch:e})=>nM(t,e),deleteRow:()=>({state:t,dispatch:e})=>oM(t,e),deleteTable:()=>({state:t,dispatch:e})=>pM(t,e),mergeCells:()=>({state:t,dispatch:e})=>sM(t,e),splitCell:()=>({state:t,dispatch:e})=>aM(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>dM("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>dM("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>uM(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>!!sM(t,e)||aM(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>lM(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>hM(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>hM(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&KT(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const n=FT.create(e.doc,t.anchorCell,t.headCell);e.setSelection(n)}return!0}}),addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:KM,"Mod-Backspace":KM,Delete:KM,"Mod-Delete":KM}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[RM({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],BM({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema:t=>({tableRole:bf(ff(t,"tableRole",{name:t.name,options:t.options,storage:t.storage}))})}),GM=hm.create({name:"tableKit",addExtensions(){const t=[];return!1!==this.options.table&&t.push(JM.configure(this.options.table)),!1!==this.options.tableCell&&t.push(jM.configure(this.options.tableCell)),!1!==this.options.tableHeader&&t.push(UM.configure(this.options.tableHeader)),!1!==this.options.tableRow&&t.push(FM.configure(this.options.tableRow)),t}}),YM=Ug.create({name:"tableCell",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(t=>parseInt(t,10)):null}}}),tableRole:"cell",isolating:!0,parseHTML:()=>[{tag:"td"}],renderHTML({HTMLAttributes:t}){return["td",kf(this.options.HTMLAttributes,t),0]}}),XM=Ug.create({name:"tableHeader",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(t=>parseInt(t,10)):null}}}),tableRole:"header_cell",isolating:!0,parseHTML:()=>[{tag:"th"}],renderHTML({HTMLAttributes:t}){return["th",kf(this.options.HTMLAttributes,t),0]}}),QM=Ug.create({name:"tableRow",addOptions:()=>({HTMLAttributes:{}}),content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML:()=>[{tag:"tr"}],renderHTML({HTMLAttributes:t}){return["tr",kf(this.options.HTMLAttributes,t),0]}});function ZM(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function tA(t,e,n,r,o,i){var s;let a=0,l=!0,c=e.firstChild;const d=t.firstChild;if(null!==d)for(let t=0,n=0;t<d.childCount;t+=1){const{colspan:s,colwidth:u}=d.child(t).attrs;for(let t=0;t<s;t+=1,n+=1){const s=o===n?i:u&&u[t],d=s?`${s}px`:"";if(a+=s||r,s||(l=!1),c){if(c.style.width!==d){const[t,e]=ZM(r,s);c.style.setProperty(t,e)}c=c.nextSibling}else{const t=document.createElement("col"),[n,o]=ZM(r,s);t.style.setProperty(n,o),e.appendChild(t)}}}for(;c;){const t=c.nextSibling;null==(s=c.parentNode)||s.removeChild(c),c=t}l?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}var eA=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),tA(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type===this.node.type&&(this.node=t,tA(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"===t.type&&(t.target===this.table||this.colgroup.contains(t.target))}};function nA(t,e){return e?t.createChecked(null,e):t.createAndFill()}var rA=({editor:t})=>{const{selection:e}=t.state;if(!(e instanceof FT))return!1;let n=0;const r=hf(e.ranges[0].$from,t=>"table"===t.type.name);return null==r||r.node.descendants(t=>{if("table"===t.type.name)return!1;["tableCell","tableHeader"].includes(t.type.name)&&(n+=1)}),n===e.ranges.length&&(t.commands.deleteTable(),!0)},oA=Ug.create({name:"table",addOptions:()=>({HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:eA,lastColumnResizable:!0,allowTableNodeSelection:!1}),content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:()=>[{tag:"table"}],renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:r,tableMinWidth:o}=function(t,e){let n=0,r=!0;const o=[],i=t.firstChild;if(!i)return{};for(let t=0,s=0;t<i.childCount;t+=1){const{colspan:a,colwidth:l}=i.child(t).attrs;for(let t=0;t<a;t+=1,s+=1){const i=undefined===s?undefined:l&&l[t];n+=i||e,i||(r=!1);const[a,c]=ZM(e,i);o.push(["col",{style:`${a}: ${c}`}])}}const s=r?`${n}px`:"",a=r?"":`${n}px`;return{colgroup:["colgroup",{},...o],tableWidth:s,tableMinWidth:a}}(t,this.options.cellMinWidth);return["table",kf(this.options.HTMLAttributes,e,{style:r?`width: ${r}`:`min-width: ${o}`}),n,["tbody",0]]},addCommands:()=>({insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:o,editor:i})=>{const s=function(t,e,n,r,o){const i=function(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}(t),s=[],a=[];for(let t=0;t<n;t+=1){const t=nA(i.cell,o);if(t&&a.push(t),r){const t=nA(i.header_cell,o);t&&s.push(t)}}const l=[];for(let t=0;t<e;t+=1)l.push(i.row.createChecked(null,r&&0===t?s:a));return i.table.createChecked(null,l)}(i.schema,t,e,n);if(o){const t=r.selection.from+1;r.replaceSelectionWith(s).scrollIntoView().setSelection(Vc.near(r.doc.resolve(t)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>YT(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>XT(t,e),deleteColumn:()=>({state:t,dispatch:e})=>ZT(t,e),addRowBefore:()=>({state:t,dispatch:e})=>eM(t,e),addRowAfter:()=>({state:t,dispatch:e})=>nM(t,e),deleteRow:()=>({state:t,dispatch:e})=>oM(t,e),deleteTable:()=>({state:t,dispatch:e})=>pM(t,e),mergeCells:()=>({state:t,dispatch:e})=>sM(t,e),splitCell:()=>({state:t,dispatch:e})=>aM(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>dM("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>dM("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>uM(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>!!sM(t,e)||aM(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>lM(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>hM(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>hM(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&KT(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const n=FT.create(e.doc,t.anchorCell,t.headCell);e.setSelection(n)}return!0}}),addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:rA,"Mod-Backspace":rA,Delete:rA,"Mod-Delete":rA}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[RM({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],BM({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema:t=>({tableRole:bf(ff(t,"tableRole",{name:t.name,options:t.options,storage:t.storage}))})}),iA=(hm.create({name:"tableKit",addExtensions(){const t=[];return!1!==this.options.table&&t.push(oA.configure(this.options.table)),!1!==this.options.tableCell&&t.push(YM.configure(this.options.tableCell)),!1!==this.options.tableHeader&&t.push(XM.configure(this.options.tableHeader)),!1!==this.options.tableRow&&t.push(QM.configure(this.options.tableRow)),t}}),YM);const sA=["top","right","bottom","left"],aA=["start","end"],lA=sA.reduce((t,e)=>t.concat(e,e+"-"+aA[0],e+"-"+aA[1]),[]),cA=Math.min,dA=Math.max,uA=Math.round,hA=(Math.floor,t=>({x:t,y:t})),pA={left:"right",right:"left",bottom:"top",top:"bottom"},fA={start:"end",end:"start"};function mA(t,e,n){return dA(t,cA(e,n))}function gA(t,e){return"function"==typeof t?t(e):t}function yA(t){return t.split("-")[0]}function bA(t){return t.split("-")[1]}function vA(t){return"x"===t?"y":"x"}function wA(t){return"y"===t?"height":"width"}const kA=new Set(["top","bottom"]);function SA(t){return kA.has(yA(t))?"y":"x"}function xA(t){return vA(SA(t))}function CA(t,e,n){void 0===n&&(n=!1);const r=bA(t),o=xA(t),i=wA(o);let s="x"===o?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return e.reference[i]>e.floating[i]&&(s=OA(s)),[s,OA(s)]}function _A(t){return t.replace(/start|end/g,t=>fA[t])}const EA=["left","right"],TA=["right","left"],MA=["top","bottom"],AA=["bottom","top"];function OA(t){return t.replace(/left|right|bottom|top/g,t=>pA[t])}function DA(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}function RA(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function LA(t,e,n){let{reference:r,floating:o}=t;const i=SA(e),s=xA(e),a=wA(s),l=yA(e),c="y"===i,d=r.x+r.width/2-o.width/2,u=r.y+r.height/2-o.height/2,h=r[a]/2-o[a]/2;let p;switch(l){case"top":p={x:d,y:r.y-o.height};break;case"bottom":p={x:d,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:u};break;case"left":p={x:r.x-o.width,y:u};break;default:p={x:r.x,y:r.y}}switch(bA(e)){case"start":p[s]-=h*(n&&c?-1:1);break;case"end":p[s]+=h*(n&&c?-1:1)}return p}async function NA(t,e){var n;void 0===e&&(e={});const{x:r,y:o,platform:i,rects:s,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=gA(e,t),f=DA(p),m=a[h?"floating"===u?"reference":"floating":u],g=RA(await i.getClippingRect({element:null==(n=await(null==i.isElement?void 0:i.isElement(m)))||n?m:m.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),y="floating"===u?{x:r,y:o,width:s.floating.width,height:s.floating.height}:s.reference,b=await(null==i.getOffsetParent?void 0:i.getOffsetParent(a.floating)),v=await(null==i.isElement?void 0:i.isElement(b))&&await(null==i.getScale?void 0:i.getScale(b))||{x:1,y:1},w=RA(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:y,offsetParent:b,strategy:l}):y);return{top:(g.top-w.top+f.top)/v.y,bottom:(w.bottom-g.bottom+f.bottom)/v.y,left:(g.left-w.left+f.left)/v.x,right:(w.right-g.right+f.right)/v.x}}function IA(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function PA(t){return sA.some(e=>t[e]>=0)}function $A(t){const e=cA(...t.map(t=>t.left)),n=cA(...t.map(t=>t.top));return{x:e,y:n,width:dA(...t.map(t=>t.right))-e,height:dA(...t.map(t=>t.bottom))-n}}const HA=new Set(["left","top"]);function BA(){return"undefined"!=typeof window}function jA(t){return VA(t)?(t.nodeName||"").toLowerCase():"#document"}function UA(t){var e;return(null==t||null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function FA(t){var e;return null==(e=(VA(t)?t.ownerDocument:t.document)||window.document)?void 0:e.documentElement}function VA(t){return!!BA()&&(t instanceof Node||t instanceof UA(t).Node)}function zA(t){return!!BA()&&(t instanceof Element||t instanceof UA(t).Element)}function WA(t){return!!BA()&&(t instanceof HTMLElement||t instanceof UA(t).HTMLElement)}function qA(t){return!(!BA()||"undefined"==typeof ShadowRoot)&&(t instanceof ShadowRoot||t instanceof UA(t).ShadowRoot)}const KA=new Set(["inline","contents"]);function JA(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=sO(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!KA.has(o)}const GA=new Set(["table","td","th"]);function YA(t){return GA.has(jA(t))}const XA=[":popover-open",":modal"];function QA(t){return XA.some(e=>{try{return t.matches(e)}catch(t){return!1}})}const ZA=["transform","translate","scale","rotate","perspective"],tO=["transform","translate","scale","rotate","perspective","filter"],eO=["paint","layout","strict","content"];function nO(t){const e=rO(),n=zA(t)?sO(t):t;return ZA.some(t=>!!n[t]&&"none"!==n[t])||!!n.containerType&&"normal"!==n.containerType||!e&&!!n.backdropFilter&&"none"!==n.backdropFilter||!e&&!!n.filter&&"none"!==n.filter||tO.some(t=>(n.willChange||"").includes(t))||eO.some(t=>(n.contain||"").includes(t))}function rO(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const oO=new Set(["html","body","#document"]);function iO(t){return oO.has(jA(t))}function sO(t){return UA(t).getComputedStyle(t)}function aO(t){return zA(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function lO(t){if("html"===jA(t))return t;const e=t.assignedSlot||t.parentNode||qA(t)&&t.host||FA(t);return qA(e)?e.host:e}function cO(t){const e=lO(t);return iO(e)?t.ownerDocument?t.ownerDocument.body:t.body:WA(e)&&JA(e)?e:cO(e)}function dO(t,e,n){var r;void 0===e&&(e=[]),void 0===n&&(n=!0);const o=cO(t),i=o===(null==(r=t.ownerDocument)?void 0:r.body),s=UA(o);if(i){const t=uO(s);return e.concat(s,s.visualViewport||[],JA(o)?o:[],t&&n?dO(t):[])}return e.concat(o,dO(o,[],n))}function uO(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function hO(t){const e=sO(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=WA(t),i=o?t.offsetWidth:n,s=o?t.offsetHeight:r,a=uA(n)!==i||uA(r)!==s;return a&&(n=i,r=s),{width:n,height:r,$:a}}function pO(t){return zA(t)?t:t.contextElement}function fO(t){const e=pO(t);if(!WA(e))return hA(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:i}=hO(e);let s=(i?uA(n.width):n.width)/r,a=(i?uA(n.height):n.height)/o;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}const mO=hA(0);function gO(t){const e=UA(t);return rO()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:mO}function yO(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=!1);const o=t.getBoundingClientRect(),i=pO(t);let s=hA(1);e&&(r?zA(r)&&(s=fO(r)):s=fO(t));const a=function(t,e,n){return void 0===e&&(e=!1),!(!n||e&&n!==UA(t))&&e}(i,n,r)?gO(i):hA(0);let l=(o.left+a.x)/s.x,c=(o.top+a.y)/s.y,d=o.width/s.x,u=o.height/s.y;if(i){const t=UA(i),e=r&&zA(r)?UA(r):r;let n=t,o=uO(n);for(;o&&r&&e!==n;){const t=fO(o),e=o.getBoundingClientRect(),r=sO(o),i=e.left+(o.clientLeft+parseFloat(r.paddingLeft))*t.x,s=e.top+(o.clientTop+parseFloat(r.paddingTop))*t.y;l*=t.x,c*=t.y,d*=t.x,u*=t.y,l+=i,c+=s,n=UA(o),o=uO(n)}}return RA({width:d,height:u,x:l,y:c})}function bO(t,e){const n=aO(t).scrollLeft;return e?e.left+n:yO(FA(t)).left+n}function vO(t,e,n){void 0===n&&(n=!1);const r=t.getBoundingClientRect();return{x:r.left+e.scrollLeft-(n?0:bO(t,r)),y:r.top+e.scrollTop}}const wO=new Set(["absolute","fixed"]);function kO(t,e,n){let r;if("viewport"===e)r=function(t,e){const n=UA(t),r=FA(t),o=n.visualViewport;let i=r.clientWidth,s=r.clientHeight,a=0,l=0;if(o){i=o.width,s=o.height;const t=rO();(!t||t&&"fixed"===e)&&(a=o.offsetLeft,l=o.offsetTop)}return{width:i,height:s,x:a,y:l}}(t,n);else if("document"===e)r=function(t){const e=FA(t),n=aO(t),r=t.ownerDocument.body,o=dA(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),i=dA(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+bO(t);const a=-n.scrollTop;return"rtl"===sO(r).direction&&(s+=dA(e.clientWidth,r.clientWidth)-o),{width:o,height:i,x:s,y:a}}(FA(t));else if(zA(e))r=function(t,e){const n=yO(t,!0,"fixed"===e),r=n.top+t.clientTop,o=n.left+t.clientLeft,i=WA(t)?fO(t):hA(1);return{width:t.clientWidth*i.x,height:t.clientHeight*i.y,x:o*i.x,y:r*i.y}}(e,n);else{const n=gO(t);r={x:e.x-n.x,y:e.y-n.y,width:e.width,height:e.height}}return RA(r)}function SO(t,e){const n=lO(t);return!(n===e||!zA(n)||iO(n))&&("fixed"===sO(n).position||SO(n,e))}function xO(t,e,n){const r=WA(e),o=FA(e),i="fixed"===n,s=yO(t,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=hA(0);function c(){l.x=bO(o)}if(r||!r&&!i)if(("body"!==jA(e)||JA(o))&&(a=aO(e)),r){const t=yO(e,!0,i,e);l.x=t.x+e.clientLeft,l.y=t.y+e.clientTop}else o&&c();i&&!r&&o&&c();const d=!o||r||i?hA(0):vO(o,a);return{x:s.left+a.scrollLeft-l.x-d.x,y:s.top+a.scrollTop-l.y-d.y,width:s.width,height:s.height}}function CO(t){return"static"===sO(t).position}function _O(t,e){if(!WA(t)||"fixed"===sO(t).position)return null;if(e)return e(t);let n=t.offsetParent;return FA(t)===n&&(n=n.ownerDocument.body),n}function EO(t,e){const n=UA(t);if(QA(t))return n;if(!WA(t)){let e=lO(t);for(;e&&!iO(e);){if(zA(e)&&!CO(e))return e;e=lO(e)}return n}let r=_O(t,e);for(;r&&YA(r)&&CO(r);)r=_O(r,e);return r&&iO(r)&&CO(r)&&!nO(r)?n:r||function(t){let e=lO(t);for(;WA(e)&&!iO(e);){if(nO(e))return e;if(QA(e))return null;e=lO(e)}return null}(t)||n}const TO={convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const i="fixed"===o,s=FA(r),a=!!e&&QA(e.floating);if(r===s||a&&i)return n;let l={scrollLeft:0,scrollTop:0},c=hA(1);const d=hA(0),u=WA(r);if((u||!u&&!i)&&(("body"!==jA(r)||JA(s))&&(l=aO(r)),WA(r))){const t=yO(r);c=fO(r),d.x=t.x+r.clientLeft,d.y=t.y+r.clientTop}const h=!s||u||i?hA(0):vO(s,l,!0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+d.x+h.x,y:n.y*c.y-l.scrollTop*c.y+d.y+h.y}},getDocumentElement:FA,getClippingRect:function(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const i="clippingAncestors"===n?QA(e)?[]:function(t,e){const n=e.get(t);if(n)return n;let r=dO(t,[],!1).filter(t=>zA(t)&&"body"!==jA(t)),o=null;const i="fixed"===sO(t).position;let s=i?lO(t):t;for(;zA(s)&&!iO(s);){const e=sO(s),n=nO(s);n||"fixed"!==e.position||(o=null),(i?!n&&!o:!n&&"static"===e.position&&o&&wO.has(o.position)||JA(s)&&!n&&SO(t,s))?r=r.filter(t=>t!==s):o=e,s=lO(s)}return e.set(t,r),r}(e,this._c):[].concat(n),s=[...i,r],a=s[0],l=s.reduce((t,n)=>{const r=kO(e,n,o);return t.top=dA(r.top,t.top),t.right=cA(r.right,t.right),t.bottom=cA(r.bottom,t.bottom),t.left=dA(r.left,t.left),t},kO(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}},getOffsetParent:EO,getElementRects:async function(t){const e=this.getOffsetParent||EO,n=this.getDimensions,r=await n(t.floating);return{reference:xO(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}},getClientRects:function(t){return Array.from(t.getClientRects())},getDimensions:function(t){const{width:e,height:n}=hO(t);return{width:e,height:n}},getScale:fO,isElement:zA,isRTL:function(t){return"rtl"===sO(t).direction}},MO=function(t){return void 0===t&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:i,placement:s,middlewareData:a}=e,l=await async function(t,e){const{placement:n,platform:r,elements:o}=t,i=await(null==r.isRTL?void 0:r.isRTL(o.floating)),s=yA(n),a=bA(n),l="y"===SA(n),c=HA.has(s)?-1:1,d=i&&l?-1:1,u=gA(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&"number"==typeof f&&(p="end"===a?-1*f:f),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}(e,t);return s===(null==(n=a.offset)?void 0:n.placement)&&null!=(r=a.arrow)&&r.alignmentOffset?{}:{x:o+l.x,y:i+l.y,data:{...l,placement:s}}}}},AO=function(t){return void 0===t&&(t={}),{name:"autoPlacement",options:t,async fn(e){var n,r,o;const{rects:i,middlewareData:s,placement:a,platform:l,elements:c}=e,{crossAxis:d=!1,alignment:u,allowedPlacements:h=lA,autoAlignment:p=!0,...f}=gA(t,e),m=void 0!==u||h===lA?function(t,e,n){return(t?[...n.filter(e=>bA(e)===t),...n.filter(e=>bA(e)!==t)]:n.filter(t=>yA(t)===t)).filter(n=>!t||bA(n)===t||!!e&&_A(n)!==n)}(u||null,p,h):h,g=await NA(e,f),y=(null==(n=s.autoPlacement)?void 0:n.index)||0,b=m[y];if(null==b)return{};const v=CA(b,i,await(null==l.isRTL?void 0:l.isRTL(c.floating)));if(a!==b)return{reset:{placement:m[0]}};const w=[g[yA(b)],g[v[0]],g[v[1]]],k=[...(null==(r=s.autoPlacement)?void 0:r.overflows)||[],{placement:b,overflows:w}],S=m[y+1];if(S)return{data:{index:y+1,overflows:k},reset:{placement:S}};const x=k.map(t=>{const e=bA(t.placement);return[t.placement,e&&d?t.overflows.slice(0,2).reduce((t,e)=>t+e,0):t.overflows[0],t.overflows]}).sort((t,e)=>t[1]-e[1]),C=(null==(o=x.filter(t=>t[2].slice(0,bA(t[0])?2:3).every(t=>t<=0))[0])?void 0:o[0])||x[0][0];return C!==a?{data:{index:y+1,overflows:k},reset:{placement:C}}:{}}}},OO=function(t){return void 0===t&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:i=!0,crossAxis:s=!1,limiter:a={fn:t=>{let{x:e,y:n}=t;return{x:e,y:n}}},...l}=gA(t,e),c={x:n,y:r},d=await NA(e,l),u=SA(yA(o)),h=vA(u);let p=c[h],f=c[u];if(i){const t="y"===h?"bottom":"right";p=mA(p+d["y"===h?"top":"left"],p,p-d[t])}if(s){const t="y"===u?"bottom":"right";f=mA(f+d["y"===u?"top":"left"],f,f-d[t])}const m=a.fn({...e,[h]:p,[u]:f});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[h]:i,[u]:s}}}}}},DO=function(t){return void 0===t&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:i,rects:s,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:m=!0,...g}=gA(t,e);if(null!=(n=i.arrow)&&n.alignmentOffset)return{};const y=yA(o),b=SA(a),v=yA(a)===a,w=await(null==l.isRTL?void 0:l.isRTL(c.floating)),k=h||(v||!m?[OA(a)]:function(t){const e=OA(t);return[_A(t),e,_A(e)]}(a)),S="none"!==f;!h&&S&&k.push(...function(t,e,n,r){const o=bA(t);let i=function(t,e,n){switch(t){case"top":case"bottom":return n?e?TA:EA:e?EA:TA;case"left":case"right":return e?MA:AA;default:return[]}}(yA(t),"start"===n,r);return o&&(i=i.map(t=>t+"-"+o),e&&(i=i.concat(i.map(_A)))),i}(a,m,f,w));const x=[a,...k],C=await NA(e,g),_=[];let E=(null==(r=i.flip)?void 0:r.overflows)||[];if(d&&_.push(C[y]),u){const t=CA(o,s,w);_.push(C[t[0]],C[t[1]])}if(E=[...E,{placement:o,overflows:_}],!_.every(t=>t<=0)){var T,M;const t=((null==(T=i.flip)?void 0:T.index)||0)+1,e=x[t];if(e&&("alignment"!==u||b===SA(e)||E.every(t=>t.overflows[0]>0&&SA(t.placement)===b)))return{data:{index:t,overflows:E},reset:{placement:e}};let n=null==(M=E.filter(t=>t.overflows[0]<=0).sort((t,e)=>t.overflows[1]-e.overflows[1])[0])?void 0:M.placement;if(!n)switch(p){case"bestFit":{var A;const t=null==(A=E.filter(t=>{if(S){const e=SA(t.placement);return e===b||"y"===e}return!0}).map(t=>[t.placement,t.overflows.filter(t=>t>0).reduce((t,e)=>t+e,0)]).sort((t,e)=>t[1]-e[1])[0])?void 0:A[0];t&&(n=t);break}case"initialPlacement":n=a}if(o!==n)return{reset:{placement:n}}}return{}}}},RO=function(t){return void 0===t&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:o,rects:i,platform:s,elements:a}=e,{apply:l=()=>{},...c}=gA(t,e),d=await NA(e,c),u=yA(o),h=bA(o),p="y"===SA(o),{width:f,height:m}=i.floating;let g,y;"top"===u||"bottom"===u?(g=u,y=h===(await(null==s.isRTL?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(y=u,g="end"===h?"top":"bottom");const b=m-d.top-d.bottom,v=f-d.left-d.right,w=cA(m-d[g],b),k=cA(f-d[y],v),S=!e.middlewareData.shift;let x=w,C=k;if(null!=(n=e.middlewareData.shift)&&n.enabled.x&&(C=v),null!=(r=e.middlewareData.shift)&&r.enabled.y&&(x=b),S&&!h){const t=dA(d.left,0),e=dA(d.right,0),n=dA(d.top,0),r=dA(d.bottom,0);p?C=f-2*(0!==t||0!==e?t+e:dA(d.left,d.right)):x=m-2*(0!==n||0!==r?n+r:dA(d.top,d.bottom))}await l({...e,availableWidth:C,availableHeight:x});const _=await s.getDimensions(a.floating);return f!==_.width||m!==_.height?{reset:{rects:!0}}:{}}}},LO=function(t){return void 0===t&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=gA(t,e);switch(r){case"referenceHidden":{const t=IA(await NA(e,{...o,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:t,referenceHidden:PA(t)}}}case"escaped":{const t=IA(await NA(e,{...o,altBoundary:!0}),n.floating);return{data:{escapedOffsets:t,escaped:PA(t)}}}default:return{}}}}},NO=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:i,platform:s,elements:a,middlewareData:l}=e,{element:c,padding:d=0}=gA(t,e)||{};if(null==c)return{};const u=DA(d),h={x:n,y:r},p=xA(o),f=wA(p),m=await s.getDimensions(c),g="y"===p,y=g?"top":"left",b=g?"bottom":"right",v=g?"clientHeight":"clientWidth",w=i.reference[f]+i.reference[p]-h[p]-i.floating[f],k=h[p]-i.reference[p],S=await(null==s.getOffsetParent?void 0:s.getOffsetParent(c));let x=S?S[v]:0;x&&await(null==s.isElement?void 0:s.isElement(S))||(x=a.floating[v]||i.floating[f]);const C=w/2-k/2,_=x/2-m[f]/2-1,E=cA(u[y],_),T=cA(u[b],_),M=E,A=x-m[f]-T,O=x/2-m[f]/2+C,D=mA(M,O,A),R=!l.arrow&&null!=bA(o)&&O!==D&&i.reference[f]/2-(O<M?E:T)-m[f]/2<0,L=R?O<M?O-M:O-A:0;return{[p]:h[p]+L,data:{[p]:D,centerOffset:O-D-L,...R&&{alignmentOffset:L}},reset:R}}}),IO=function(t){return void 0===t&&(t={}),{name:"inline",options:t,async fn(e){const{placement:n,elements:r,rects:o,platform:i,strategy:s}=e,{padding:a=2,x:l,y:c}=gA(t,e),d=Array.from(await(null==i.getClientRects?void 0:i.getClientRects(r.reference))||[]),u=function(t){const e=t.slice().sort((t,e)=>t.y-e.y),n=[];let r=null;for(let t=0;t<e.length;t++){const o=e[t];!r||o.y-r.y>r.height/2?n.push([o]):n[n.length-1].push(o),r=o}return n.map(t=>RA($A(t)))}(d),h=RA($A(d)),p=DA(a),f=await i.getElementRects({reference:{getBoundingClientRect:function(){if(2===u.length&&u[0].left>u[1].right&&null!=l&&null!=c)return u.find(t=>l>t.left-p.left&&l<t.right+p.right&&c>t.top-p.top&&c<t.bottom+p.bottom)||h;if(u.length>=2){if("y"===SA(n)){const t=u[0],e=u[u.length-1],r="top"===yA(n),o=t.top,i=e.bottom,s=r?t.left:e.left,a=r?t.right:e.right;return{top:o,bottom:i,left:s,right:a,width:a-s,height:i-o,x:s,y:o}}const t="left"===yA(n),e=dA(...u.map(t=>t.right)),r=cA(...u.map(t=>t.left)),o=u.filter(n=>t?n.left===r:n.right===e),i=o[0].top,s=o[o.length-1].bottom;return{top:i,bottom:s,left:r,right:e,width:e-r,height:s-i,x:r,y:i}}return h}},floating:r.floating,strategy:s});return o.reference.x!==f.reference.x||o.reference.y!==f.reference.y||o.reference.width!==f.reference.width||o.reference.height!==f.reference.height?{reset:{rects:f}}:{}}}},PO=(t,e,n)=>{const r=new Map,o={platform:TO,...n},i={...o.platform,_c:r};return(async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:s}=n,a=i.filter(Boolean),l=await(null==s.isRTL?void 0:s.isRTL(e));let c=await s.getElementRects({reference:t,floating:e,strategy:o}),{x:d,y:u}=LA(c,r,l),h=r,p={},f=0;for(let n=0;n<a.length;n++){const{name:i,fn:m}=a[n],{x:g,y,data:b,reset:v}=await m({x:d,y:u,initialPlacement:r,placement:h,strategy:o,middlewareData:p,rects:c,platform:s,elements:{reference:t,floating:e}});d=null!=g?g:d,u=null!=y?y:u,p={...p,[i]:{...p[i],...b}},v&&f<=50&&(f++,"object"==typeof v&&(v.placement&&(h=v.placement),v.rects&&(c=!0===v.rects?await s.getElementRects({reference:t,floating:e,strategy:o}):v.rects),({x:d,y:u}=LA(c,h,l))),n=-1)}return{x:d,y:u,placement:h,strategy:o,middlewareData:p}})(t,e,{...o,platform:i})};var $O=class{constructor({editor:t,element:e,view:n,updateDelay:r=250,resizeDelay:o=60,shouldShow:i,options:s}){this.preventHide=!1,this.isVisible=!1,this.floatingUIOptions={strategy:"absolute",placement:"top",offset:8,flip:{},shift:{},arrow:!1,size:!1,autoPlacement:!1,hide:!1,inline:!1,onShow:void 0,onHide:void 0,onUpdate:void 0,onDestroy:void 0},this.shouldShow=({view:t,state:e,from:n,to:r})=>{const{doc:o,selection:i}=e,{empty:s}=i,a=!o.textBetween(n,r).length&&Xf(e.selection),l=this.element.contains(document.activeElement);return!(!t.hasFocus()&&!l||s||a||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.resizeHandler=()=>{this.resizeDebounceTimer&&clearTimeout(this.resizeDebounceTimer),this.resizeDebounceTimer=window.setTimeout(()=>{this.updatePosition()},this.resizeDelay)},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:t})=>{var e;this.preventHide?this.preventHide=!1:(null==t?void 0:t.relatedTarget)&&(null==(e=this.element.parentNode)?void 0:e.contains(t.relatedTarget))||(null==t?void 0:t.relatedTarget)!==this.editor.view.dom&&this.hide()},this.handleDebouncedUpdate=(t,e)=>{const n=!(null==e?void 0:e.selection.eq(t.state.selection)),r=!(null==e?void 0:e.doc.eq(t.state.doc));(n||r)&&(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout(()=>{this.updateHandler(t,n,r,e)},this.updateDelay))},this.updateHandler=(t,e,n,r)=>{const{composing:o}=t;o||!e&&!n||(this.getShouldShow(r)?(this.updatePosition(),this.show()):this.hide())},this.editor=t,this.element=e,this.view=n,this.updateDelay=r,this.resizeDelay=o,this.floatingUIOptions={...this.floatingUIOptions,...s},i&&(this.shouldShow=i),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),window.addEventListener("resize",this.resizeHandler),this.update(n,n.state),this.getShouldShow()&&this.show()}get middlewares(){const t=[];return this.floatingUIOptions.flip&&t.push(DO("boolean"!=typeof this.floatingUIOptions.flip?this.floatingUIOptions.flip:void 0)),this.floatingUIOptions.shift&&t.push(OO("boolean"!=typeof this.floatingUIOptions.shift?this.floatingUIOptions.shift:void 0)),this.floatingUIOptions.offset&&t.push(MO("boolean"!=typeof this.floatingUIOptions.offset?this.floatingUIOptions.offset:void 0)),this.floatingUIOptions.arrow&&t.push(NO(this.floatingUIOptions.arrow)),this.floatingUIOptions.size&&t.push(RO("boolean"!=typeof this.floatingUIOptions.size?this.floatingUIOptions.size:void 0)),this.floatingUIOptions.autoPlacement&&t.push(AO("boolean"!=typeof this.floatingUIOptions.autoPlacement?this.floatingUIOptions.autoPlacement:void 0)),this.floatingUIOptions.hide&&t.push(LO("boolean"!=typeof this.floatingUIOptions.hide?this.floatingUIOptions.hide:void 0)),this.floatingUIOptions.inline&&t.push(IO("boolean"!=typeof this.floatingUIOptions.inline?this.floatingUIOptions.inline:void 0)),t}updatePosition(){const{selection:t}=this.editor.state;let e={getBoundingClientRect:()=>Zf(this.view,t.from,t.to)};if(t instanceof FT){const{$anchorCell:n,$headCell:r}=t,o=n?n.pos:r.pos,i=r?r.pos:n.pos,s=this.view.nodeDOM(o),a=this.view.nodeDOM(i);if(!s||!a)return;const l=s===a?s.getBoundingClientRect():function(t,e){const n=Math.min(t.top,e.top),r=Math.max(t.bottom,e.bottom),o=Math.min(t.left,e.left),i=Math.max(t.right,e.right);return new DOMRect(o,n,i-o,r-n)}(s.getBoundingClientRect(),a.getBoundingClientRect());e={getBoundingClientRect:()=>l}}PO(e,this.element,{placement:this.floatingUIOptions.placement,strategy:this.floatingUIOptions.strategy,middleware:this.middlewares}).then(({x:t,y:e,strategy:n})=>{this.element.style.width="max-content",this.element.style.position=n,this.element.style.left=`${t}px`,this.element.style.top=`${e}px`,this.isVisible&&this.floatingUIOptions.onUpdate&&this.floatingUIOptions.onUpdate()})}update(t,e){const{state:n}=t,r=n.selection.from!==n.selection.to;if(this.updateDelay>0&&r)return void this.handleDebouncedUpdate(t,e);const o=!(null==e?void 0:e.selection.eq(t.state.selection)),i=!(null==e?void 0:e.doc.eq(t.state.doc));this.updateHandler(t,o,i,e)}getShouldShow(t){var e;const{state:n}=this.view,{selection:r}=n,{ranges:o}=r,i=Math.min(...o.map(t=>t.$from.pos)),s=Math.max(...o.map(t=>t.$to.pos));return null==(e=this.shouldShow)?void 0:e.call(this,{editor:this.editor,element:this.element,view:this.view,state:n,oldState:t,from:i,to:s})}show(){var t;this.isVisible||(this.element.style.visibility="visible",this.element.style.opacity="1",null==(t=this.view.dom.parentElement)||t.appendChild(this.element),this.floatingUIOptions.onShow&&this.floatingUIOptions.onShow(),this.isVisible=!0)}hide(){this.isVisible&&(this.element.style.visibility="hidden",this.element.style.opacity="0",this.element.remove(),this.floatingUIOptions.onHide&&this.floatingUIOptions.onHide(),this.isVisible=!1)}destroy(){this.hide(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),window.removeEventListener("resize",this.resizeHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler),this.floatingUIOptions.onDestroy&&this.floatingUIOptions.onDestroy()}},HO=hm.create({name:"bubbleMenu",addOptions:()=>({element:null,pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}),addProseMirrorPlugins(){return this.options.element?[(t={pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow},new od({key:"string"==typeof t.pluginKey?new ad(t.pluginKey):t.pluginKey,view:e=>new $O({view:e,...t})}))]:[];var t}}),BO=class{constructor({editor:t,element:e,view:n,options:r,shouldShow:o}){this.preventHide=!1,this.isVisible=!1,this.shouldShow=({view:t,state:e})=>{const{selection:n}=e,{$anchor:r,empty:o}=n,i=1===r.depth,s=r.parent.isTextblock&&!r.parent.type.spec.code&&!r.parent.textContent&&0===r.parent.childCount&&!this.getTextContent(r.parent);return!!(t.hasFocus()&&o&&i&&s&&this.editor.isEditable)},this.floatingUIOptions={strategy:"absolute",placement:"right",offset:8,flip:{},shift:{},arrow:!1,size:!1,autoPlacement:!1,hide:!1,inline:!1},this.updateHandler=(t,e,n,r)=>{const{composing:o}=t;o||!e&&!n||(this.getShouldShow(r)?(this.updatePosition(),this.show()):this.hide())},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:t})=>{var e;this.preventHide?this.preventHide=!1:(null==t?void 0:t.relatedTarget)&&(null==(e=this.element.parentNode)?void 0:e.contains(t.relatedTarget))||(null==t?void 0:t.relatedTarget)!==this.editor.view.dom&&this.hide()},this.editor=t,this.element=e,this.view=n,this.floatingUIOptions={...this.floatingUIOptions,...r},o&&(this.shouldShow=o),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.update(n,n.state),this.getShouldShow()&&this.show()}getTextContent(t){return Af(t,{textSerializers:Of(this.editor.schema)})}get middlewares(){const t=[];return this.floatingUIOptions.flip&&t.push(DO("boolean"!=typeof this.floatingUIOptions.flip?this.floatingUIOptions.flip:void 0)),this.floatingUIOptions.shift&&t.push(OO("boolean"!=typeof this.floatingUIOptions.shift?this.floatingUIOptions.shift:void 0)),this.floatingUIOptions.offset&&t.push(MO("boolean"!=typeof this.floatingUIOptions.offset?this.floatingUIOptions.offset:void 0)),this.floatingUIOptions.arrow&&t.push(NO(this.floatingUIOptions.arrow)),this.floatingUIOptions.size&&t.push(RO("boolean"!=typeof this.floatingUIOptions.size?this.floatingUIOptions.size:void 0)),this.floatingUIOptions.autoPlacement&&t.push(AO("boolean"!=typeof this.floatingUIOptions.autoPlacement?this.floatingUIOptions.autoPlacement:void 0)),this.floatingUIOptions.hide&&t.push(LO("boolean"!=typeof this.floatingUIOptions.hide?this.floatingUIOptions.hide:void 0)),this.floatingUIOptions.inline&&t.push(IO("boolean"!=typeof this.floatingUIOptions.inline?this.floatingUIOptions.inline:void 0)),t}getShouldShow(t){var e;const{state:n}=this.view,{selection:r}=n,{ranges:o}=r,i=Math.min(...o.map(t=>t.$from.pos)),s=Math.max(...o.map(t=>t.$to.pos));return null==(e=this.shouldShow)?void 0:e.call(this,{editor:this.editor,view:this.view,state:n,oldState:t,from:i,to:s})}updatePosition(){const{selection:t}=this.editor.state;PO({getBoundingClientRect:()=>Zf(this.view,t.from,t.to)},this.element,{placement:this.floatingUIOptions.placement,strategy:this.floatingUIOptions.strategy,middleware:this.middlewares}).then(({x:t,y:e,strategy:n})=>{this.element.style.width="max-content",this.element.style.position=n,this.element.style.left=`${t}px`,this.element.style.top=`${e}px`,this.isVisible&&this.floatingUIOptions.onUpdate&&this.floatingUIOptions.onUpdate()})}update(t,e){const n=!(null==e?void 0:e.selection.eq(t.state.selection)),r=!(null==e?void 0:e.doc.eq(t.state.doc));this.updateHandler(t,n,r,e)}show(){var t;this.isVisible||(this.element.style.visibility="visible",this.element.style.opacity="1",null==(t=this.view.dom.parentElement)||t.appendChild(this.element),this.floatingUIOptions.onShow&&this.floatingUIOptions.onShow(),this.isVisible=!0)}hide(){this.isVisible&&(this.element.style.visibility="hidden",this.element.style.opacity="0",this.element.remove(),this.floatingUIOptions.onHide&&this.floatingUIOptions.onHide(),this.isVisible=!1)}destroy(){this.hide(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler),this.floatingUIOptions.onDestroy&&this.floatingUIOptions.onDestroy()}},jO=hm.create({name:"floatingMenu",addOptions:()=>({element:null,options:{},pluginKey:"floatingMenu",shouldShow:null}),addProseMirrorPlugins(){return this.options.element?[(t={pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,options:this.options.options,shouldShow:this.options.shouldShow},new od({key:"string"==typeof t.pluginKey?new ad(t.pluginKey):t.pluginKey,view:e=>new BO({view:e,...t})}))]:[];var t}});function UO(t){if(!t.length)return Vh.empty;const e=[],n=t[0].$from.node(0);return t.forEach(t=>{const n=t.$from.pos,r=t.$from.nodeAfter;r&&e.push(jh.node(n,n+r.nodeSize,{class:"ProseMirror-selectednoderange"}))}),Vh.create(n,e)}function FO(t,e,n){const r=[],o=t.node(0);"number"==typeof n&&n>=0||(n=t.sameParent(e)?Math.max(0,t.sharedDepth(e.pos)-1):t.sharedDepth(e.pos));const i=new dl(t,e,n),s=0===i.depth?0:o.resolve(i.start).posAtIndex(0);return i.parent.forEach((t,e)=>{const n=s+e,a=n+t.nodeSize;if(n<i.start||n>=i.end)return;const l=new jc(o.resolve(n),o.resolve(a));r.push(l)}),r}var VO=class t{constructor(t,e){this.anchor=t,this.head=e}map(e){return new t(e.map(this.anchor),e.map(this.head))}resolve(t){const e=t.resolve(this.anchor),n=t.resolve(this.head);return new zO(e,n)}},zO=class t extends Bc{constructor(t,e,n,r=1){const{doc:o}=t,i=t===e,s=t.pos===o.content.size&&e.pos===o.content.size,a=i&&!s?o.resolve(e.pos+(r>0?1:-1)):e,l=i&&s?o.resolve(t.pos-(r>0?1:-1)):t,c=FO(l.min(a),l.max(a),n);super(a.pos>=t.pos?c[0].$from:c[c.length-1].$to,a.pos>=t.pos?c[c.length-1].$to:c[0].$from,c),this.depth=n}get $to(){return this.ranges[this.ranges.length-1].$to}eq(e){return e instanceof t&&e.$from.pos===this.$from.pos&&e.$to.pos===this.$to.pos}map(e,n){const r=e.resolve(n.map(this.anchor)),o=e.resolve(n.map(this.head));return new t(r,o)}toJSON(){return{type:"nodeRange",anchor:this.anchor,head:this.head}}get isForwards(){return this.head>=this.anchor}get isBackwards(){return!this.isForwards}extendBackwards(){const{doc:e}=this.$from;if(this.isForwards&&this.ranges.length>1){const e=this.ranges.slice(0,-1),n=e[0].$from,r=e[e.length-1].$to;return new t(n,r,this.depth)}const n=this.ranges[0],r=e.resolve(Math.max(0,n.$from.pos-1));return new t(this.$anchor,r,this.depth)}extendForwards(){const{doc:e}=this.$from;if(this.isBackwards&&this.ranges.length>1){const e=this.ranges.slice(1),n=e[0].$from,r=e[e.length-1].$to;return new t(r,n,this.depth)}const n=this.ranges[this.ranges.length-1],r=e.resolve(Math.min(e.content.size,n.$to.pos+1));return new t(this.$anchor,r,this.depth)}static fromJSON(e,n){return new t(e.resolve(n.anchor),e.resolve(n.head))}static create(t,e,n,r,o=1){return new this(t.resolve(e),t.resolve(n),r,o)}getBookmark(){return new VO(this.anchor,this.head)}};function WO(t){return t instanceof zO}zO.prototype.visible=!1,hm.create({name:"nodeRange",addOptions:()=>({depth:void 0,key:"Mod"}),addKeyboardShortcuts(){return{"Shift-ArrowUp":({editor:t})=>{const{depth:e}=this.options,{view:n,state:r}=t,{doc:o,selection:i,tr:s}=r,{anchor:a,head:l}=i;if(!WO(i)){const t=zO.create(o,a,l,e,-1);return s.setSelection(t),n.dispatch(s),!0}const c=i.extendBackwards();return s.setSelection(c),n.dispatch(s),!0},"Shift-ArrowDown":({editor:t})=>{const{depth:e}=this.options,{view:n,state:r}=t,{doc:o,selection:i,tr:s}=r,{anchor:a,head:l}=i;if(!WO(i)){const t=zO.create(o,a,l,e);return s.setSelection(t),n.dispatch(s),!0}const c=i.extendForwards();return s.setSelection(c),n.dispatch(s),!0},"Mod-a":({editor:t})=>{const{depth:e}=this.options,{view:n,state:r}=t,{doc:o,tr:i}=r,s=zO.create(o,0,o.content.size,e);return i.setSelection(s),n.dispatch(i),!0}}},onSelectionUpdate(){const{selection:t}=this.editor.state;WO(t)&&this.editor.view.dom.classList.add("ProseMirror-noderangeselection")},addProseMirrorPlugins(){let t=!1,e=!1;return[new od({key:new ad("nodeRange"),props:{attributes:()=>t?{class:"ProseMirror-noderangeselection"}:{class:""},handleDOMEvents:{mousedown:(t,n)=>{const{key:r}=this.options,o=/Mac/.test(navigator.platform),i=!!n.shiftKey,s=!!n.ctrlKey,a=!!n.altKey,l=!!n.metaKey;return(null==r||"Shift"===r&&i||"Control"===r&&s||"Alt"===r&&a||"Meta"===r&&l||"Mod"===r&&(o?l:s))&&(e=!0),!!e&&(document.addEventListener("mouseup",()=>{e=!1;const{state:n}=t,{doc:r,selection:o,tr:i}=n,{$anchor:s,$head:a}=o;if(s.sameParent(a))return;const l=zO.create(r,s.pos,a.pos,this.options.depth);i.setSelection(l),t.dispatch(i)},{once:!0}),!1)}},decorations:n=>{const{selection:r}=n,o=WO(r);if(t=!1,!e)return o?(t=!0,UO(r.ranges)):null;const{$from:i,$to:s}=r;if(!o&&i.sameParent(s))return null;const a=FO(i,s,this.options.depth);return a.length?(t=!0,UO(a)):null}}})]}});var qO=t=>{const{x:e,y:n,direction:r,editor:o}=t;let i=null,s=null,a=null,l=e;for(;null===s&&l<window.innerWidth&&l>0;){const t=document.elementsFromPoint(l,n),e=t.findIndex(t=>t.classList.contains("ProseMirror")),c=t.slice(0,e);if(c.length>0){const t=c[0];if(i=t,a=o.view.posAtDOM(t,0),a>=0){s=o.state.doc.nodeAt(Math.max(a-1,0)),(null==s?void 0:s.isText)&&(s=o.state.doc.nodeAt(Math.max(a-1,0))),s||(s=o.state.doc.nodeAt(Math.max(a,0)));break}}"left"===r?l-=1:l+=1}return{resultElement:i,resultNode:s,pos:null!=a?a:null}};function KO(t,e){return window.getComputedStyle(t)[e]}function JO(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function GO(t){var e;null==(e=t.parentNode)||e.removeChild(t)}var YO=(t,e)=>{const n=t.resolve(e),{depth:r}=n;return 0===r?e:n.pos-n.parentOffset-1},XO=(t,e)=>{const n=t.nodeAt(e),r=t.resolve(e);let{depth:o}=r,i=n;for(;o>0;){const t=r.node(o);o-=1,0===o&&(i=t)}return i},QO=(t,e)=>{const n=DE.getState(t);return n?iT(e,n.type,n.binding.mapping):null},ZO=(t,e)=>{let n=e;for(;(null==n?void 0:n.parentNode)&&n.parentNode!==t.dom;)n=n.parentNode;return n},tD=new ad("dragHandle"),eD=({pluginKey:t=tD,element:e,editor:n,computePositionConfig:r,onNodeChange:o})=>{const i=document.createElement("div");let s,a=!1,l=null,c=-1;function d(){e&&(e.style.visibility="hidden",e.style.pointerEvents="none")}function u(t){PO({getBoundingClientRect:()=>t.getBoundingClientRect()},e,r).then(t=>{Object.assign(e.style,{position:t.strategy,left:`${t.x}px`,top:`${t.y}px`})})}function h(t){!function(t,e){const{view:n}=e;if(!t.dataTransfer)return;const{empty:r,$from:o,$to:i}=n.state.selection,s=function(t,e){const{doc:n}=e.view.state,r=qO({editor:e,x:t.clientX,y:t.clientY,direction:"right"});if(!r.resultNode||null===r.pos)return[];const o=t.clientX,i=function(t,e,n){const r=parseInt(KO(t.dom,"paddingLeft"),10),o=parseInt(KO(t.dom,"paddingRight"),10),i=parseInt(KO(t.dom,"borderLeftWidth"),10),s=parseInt(KO(t.dom,"borderLeftWidth"),10),a=t.dom.getBoundingClientRect();return{left:JO(e,a.left+r+i,a.right-o-s),top:n}}(e.view,o,t.clientY),s=e.view.posAtCoords(i);if(!s)return[];const{pos:a}=s;return n.resolve(a).parent?FO(n.resolve(r.pos),n.resolve(r.pos+1),0):[]}(t,e),a=FO(o,i,0),l=a.some(t=>s.find(e=>e.$from===t.$from&&e.$to===t.$to)),c=r||!l?s:a;if(!c.length)return;const{tr:d}=n.state,u=document.createElement("div"),h=c[0].$from.pos,p=c[c.length-1].$to.pos,f=zO.create(n.state.doc,h,p),m=f.content();c.forEach(t=>{const e=function(t){const e=t.cloneNode(!0),n=[t,...Array.from(t.getElementsByTagName("*"))],r=[e,...Array.from(e.getElementsByTagName("*"))];return n.forEach((t,e)=>{r[e].style.cssText=function(t){let e="";const n=getComputedStyle(t);for(let t=0;t<n.length;t+=1)e+=`${n[t]}:${n.getPropertyValue(n[t])};`;return e}(t)}),e}(n.nodeDOM(t.$from.pos));u.append(e)}),u.style.position="absolute",u.style.top="-10000px",document.body.append(u),t.dataTransfer.clearData(),t.dataTransfer.setDragImage(u,0,0),n.dragging={slice:m,move:!0},d.setSelection(f),n.dispatch(d),document.addEventListener("drop",()=>GO(u),{once:!0})}(t,n),setTimeout(()=>{e&&(e.style.pointerEvents="none")},0)}function p(){d(),e&&(e.style.pointerEvents="auto")}return e.addEventListener("dragstart",h),e.addEventListener("dragend",p),i.appendChild(e),{unbind(){e.removeEventListener("dragstart",h),e.removeEventListener("dragend",p)},plugin:new od({key:"string"==typeof t?new ad(t):t,state:{init:()=>({locked:!1}),apply(t,r,i,u){const h=t.getMeta("lockDragHandle"),p=t.getMeta("hideDragHandle");if(void 0!==h&&(a=h),p)return d(),a=!1,l=null,c=-1,null==o||o({editor:n,node:null,pos:-1}),r;if(t.docChanged&&-1!==c&&e)if(t.getMeta(DE)){const t=((t,e)=>{const n=DE.getState(t);return n?aT(n.doc,n.type,e,n.binding.mapping)||0:-1})(u,s);t!==c&&(c=t)}else{const e=t.mapping.map(c);e!==c&&(c=e,s=QO(u,c))}return r}},view:t=>{var r;return e.draggable=!0,e.style.pointerEvents="auto",null==(r=n.view.dom.parentElement)||r.appendChild(i),i.style.pointerEvents="none",i.style.position="absolute",i.style.top="0",i.style.left="0",{update(r,i){if(!e)return;if(!n.isEditable)return void d();if(e.draggable=!a,t.state.doc.eq(i.doc)||-1===c)return;let h=t.nodeDOM(c);if(h=ZO(t,h),h===t.dom)return;if(1!==(null==h?void 0:h.nodeType))return;const p=t.posAtDOM(h,0),f=XO(n.state.doc,p),m=YO(n.state.doc,p);l=f,c=m,s=QO(t.state,c),null==o||o({editor:n,node:l,pos:c}),u(h)},destroy(){e&&GO(i)}}},props:{handleDOMEvents:{mouseleave:(t,e)=>(a||e.target&&!i.contains(e.relatedTarget)&&(d(),l=null,c=-1,null==o||o({editor:n,node:null,pos:-1})),!1),mousemove(t,r){if(!e||a)return!1;const i=qO({x:r.clientX,y:r.clientY,direction:"right",editor:n});if(!i.resultElement)return!1;let h=i.resultElement;if(h=ZO(t,h),h===t.dom)return!1;if(1!==(null==h?void 0:h.nodeType))return!1;const p=t.posAtDOM(h,0),f=XO(n.state.doc,p);if(f!==l){const r=YO(n.state.doc,p);l=f,c=r,s=QO(t.state,c),null==o||o({editor:n,node:l,pos:c}),u(h),e&&(n.isEditable?(e.style.visibility="",e.style.pointerEvents="auto"):d())}return!1}}}})}},nD={placement:"left-start",strategy:"absolute"},rD=hm.create({name:"dragHandle",addOptions:()=>({render(){const t=document.createElement("div");return t.classList.add("drag-handle"),t},computePositionConfig:{},locked:!1,onNodeChange:()=>null}),addCommands(){return{lockDragHandle:()=>({editor:t})=>(this.options.locked=!0,t.commands.setMeta("lockDragHandle",this.options.locked)),unlockDragHandle:()=>({editor:t})=>(this.options.locked=!1,t.commands.setMeta("lockDragHandle",this.options.locked)),toggleDragHandle:()=>({editor:t})=>(this.options.locked=!this.options.locked,t.commands.setMeta("lockDragHandle",this.options.locked))}},addProseMirrorPlugins(){const t=this.options.render();return[eD({computePositionConfig:{...nD,...this.options.computePositionConfig},element:t,editor:this.editor,onNodeChange:this.options.onNodeChange}).plugin]}}),oD=Uv({name:"DragHandleVue",props:{pluginKey:{type:[String,Object],default:tD},editor:{type:Object,required:!0},computePositionConfig:{type:Object,default:()=>({})},onNodeChange:{type:Function,default:null},class:{type:String,default:"drag-handle"}},setup(t,{slots:e}){const n=Xb(null);return Zv(()=>{const{editor:e,pluginKey:r,onNodeChange:o,computePositionConfig:i}=t;e.registerPlugin(eD({editor:e,element:n.value,pluginKey:r,computePositionConfig:{...nD,...i},onNodeChange:o}).plugin)}),nw(()=>{const{pluginKey:e,editor:n}=t;n.unregisterPlugin(e)}),()=>{var r;return Kk("div",{ref:n,class:t.class},null==(r=e.default)?void 0:r.call(e))}}});function iD(t,e){return function(t,e){const n=t.attrs;return n?e.filter(e=>e.type===("string"==typeof t.type?t.type:t.type.name)&&e.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n)||{[t.name]:t.name in n?n[t.name]:t.attribute.default}:{[t.name]:t.name in n?n[t.name]:t.attribute.default}).reduce((t,e)=>kf(t,e),{}):{}}(t,e)}function sD(t){return function(t,{nodeMapping:e,markMapping:n,unhandledNode:r,unhandledMark:o}){return function i({content:s,parent:a}){var l;const c="string"==typeof s.type?s.type:s.type.name,d=null!=(l=e[c])?l:r;if(!d)throw new Error(`missing handler for node type ${c}`);const u=t({component:d,props:{node:s,parent:a,renderElement:i,get children(){const t=[];return s.content&&s.content.forEach(e=>{t.push(i({content:e,parent:s}))}),t}}});return s.marks?s.marks.reduce((e,r)=>{var i;const l="string"==typeof r.type?r.type:r.type.name,c=null!=(i=n[l])?i:o;if(!c)throw new Error(`missing handler for mark type ${l}`);return t({component:c,props:{mark:r,parent:a,node:s,children:e}})},u):u}}(t=>t.component(t.props),t)}function aD(t){const e=Object.entries(t||{}).map(([t,e])=>`${t.split(" ").at(-1)}=${JSON.stringify(e)}`).join(" ");return e?` ${e}`:""}function lD(t){return[].concat(t||"").filter(Boolean).join("")}function cD(t){if("string"==typeof t)return()=>t;if("object"==typeof t&&"length"in t){const[e,n,r,...o]=t;let i=e;const s=i.split(" ");if(s.length>1&&(i=`${s[1]} xmlns="${s[0]}"`),void 0===n)return()=>`<${i}/>`;if(0===n)return t=>`<${i}>${lD(t)}</${i}>`;if("object"==typeof n)return Array.isArray(n)?void 0===r||0===r?t=>`<${i}>${cD(n)(t)}</${i}>`:t=>`<${i}>${cD(n)(t)}${[r].concat(o).map(e=>cD(e)(t))}</${i}>`:void 0===r?()=>`<${i}${aD(n)}/>`:0===r?t=>`<${i}${aD(n)}>${lD(t)}</${i}>`:t=>`<${i}${aD(n)}>${[r].concat(o).map(e=>cD(e)(t)).join("")}</${i}>`}throw new Error("[tiptap error]: Unsupported DomOutputSpec type, check the `renderHTML` method output or implement a node mapping",{cause:t})}function dD(t,e){return function(t,e){const n=t.attrs;return n?e.filter(e=>e.type===("string"==typeof t.type?t.type:t.type.name)&&e.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n)||{[t.name]:t.name in n?n[t.name]:t.attribute.default}:{[t.name]:t.name in n?n[t.name]:t.attribute.default}).reduce((t,e)=>kf(t,e),{}):{}}(t,e)}function uD(t){return function(t,{nodeMapping:e,markMapping:n,unhandledNode:r,unhandledMark:o}){return function i({content:s,parent:a}){var l;const c="string"==typeof s.type?s.type:s.type.name,d=null!=(l=e[c])?l:r;if(!d)throw new Error(`missing handler for node type ${c}`);const u=t({component:d,props:{node:s,parent:a,renderElement:i,get children(){const t=[];return s.content&&s.content.forEach(e=>{t.push(i({content:e,parent:s}))}),t}}});return s.marks?s.marks.reduce((e,r)=>{var i;const l="string"==typeof r.type?r.type:r.type.name,c=null!=(i=n[l])?i:o;if(!c)throw new Error(`missing handler for mark type ${l}`);return t({component:c,props:{mark:r,parent:a,node:s,children:e}})},u):u}}(t=>t.component(t.props),t)}function hD(t){const e=Object.entries(t||{}).map(([t,e])=>`${t.split(" ").at(-1)}=${JSON.stringify(e)}`).join(" ");return e?` ${e}`:""}function pD(t){return[].concat(t||"").filter(Boolean).join("")}function fD(t){if("string"==typeof t)return()=>t;if("object"==typeof t&&"length"in t){const[e,n,r,...o]=t;let i=e;const s=i.split(" ");if(s.length>1&&(i=`${s[1]} xmlns="${s[0]}"`),void 0===n)return()=>`<${i}/>`;if(0===n)return t=>`<${i}>${pD(t)}</${i}>`;if("object"==typeof n)return Array.isArray(n)?void 0===r||0===r?t=>`<${i}>${fD(n)(t)}</${i}>`:t=>`<${i}>${fD(n)(t)}${[r].concat(o).map(e=>fD(e)(t))}</${i}>`:void 0===r?()=>`<${i}${hD(n)}/>`:0===r?t=>`<${i}${hD(n)}>${pD(t)}</${i}>`:t=>`<${i}${hD(n)}>${[r].concat(o).map(e=>fD(e)(t)).join("")}</${i}>`}throw new Error("[tiptap error]: Unsupported DomOutputSpec type, check the `renderHTML` method output or implement a node mapping",{cause:t})}function mD(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function gD(t){return t instanceof mD(t).Element||t instanceof Element}function yD(t){return t instanceof mD(t).HTMLElement||t instanceof HTMLElement}function bD(t){return"undefined"!=typeof ShadowRoot&&(t instanceof mD(t).ShadowRoot||t instanceof ShadowRoot)}var vD=Math.max,wD=Math.min,kD=Math.round;function SD(){var t=navigator.userAgentData;return null!=t&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function xD(){return!/^((?!chrome|android).)*safari/i.test(SD())}function CD(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var r=t.getBoundingClientRect(),o=1,i=1;e&&yD(t)&&(o=t.offsetWidth>0&&kD(r.width)/t.offsetWidth||1,i=t.offsetHeight>0&&kD(r.height)/t.offsetHeight||1);var s=(gD(t)?mD(t):window).visualViewport,a=!xD()&&n,l=(r.left+(a&&s?s.offsetLeft:0))/o,c=(r.top+(a&&s?s.offsetTop:0))/i,d=r.width/o,u=r.height/i;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l,x:l,y:c}}function _D(t){var e=mD(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function ED(t){return t?(t.nodeName||"").toLowerCase():null}function TD(t){return((gD(t)?t.ownerDocument:t.document)||window.document).documentElement}function MD(t){return CD(TD(t)).left+_D(t).scrollLeft}function AD(t){return mD(t).getComputedStyle(t)}function OD(t){var e=AD(t),n=e.overflow,r=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+o+r)}function DD(t,e,n){void 0===n&&(n=!1);var r,o,i=yD(e),s=yD(e)&&function(t){var e=t.getBoundingClientRect(),n=kD(e.width)/t.offsetWidth||1,r=kD(e.height)/t.offsetHeight||1;return 1!==n||1!==r}(e),a=TD(e),l=CD(t,s,n),c={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(i||!i&&!n)&&(("body"!==ED(e)||OD(a))&&(c=(r=e)!==mD(r)&&yD(r)?{scrollLeft:(o=r).scrollLeft,scrollTop:o.scrollTop}:_D(r)),yD(e)?((d=CD(e,!0)).x+=e.clientLeft,d.y+=e.clientTop):a&&(d.x=MD(a))),{x:l.left+c.scrollLeft-d.x,y:l.top+c.scrollTop-d.y,width:l.width,height:l.height}}function RD(t){var e=CD(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function LD(t){return"html"===ED(t)?t:t.assignedSlot||t.parentNode||(bD(t)?t.host:null)||TD(t)}function ND(t){return["html","body","#document"].indexOf(ED(t))>=0?t.ownerDocument.body:yD(t)&&OD(t)?t:ND(LD(t))}function ID(t,e){var n;void 0===e&&(e=[]);var r=ND(t),o=r===(null==(n=t.ownerDocument)?void 0:n.body),i=mD(r),s=o?[i].concat(i.visualViewport||[],OD(r)?r:[]):r,a=e.concat(s);return o?a:a.concat(ID(LD(s)))}function PD(t){return["table","td","th"].indexOf(ED(t))>=0}function $D(t){return yD(t)&&"fixed"!==AD(t).position?t.offsetParent:null}function HD(t){for(var e=mD(t),n=$D(t);n&&PD(n)&&"static"===AD(n).position;)n=$D(n);return n&&("html"===ED(n)||"body"===ED(n)&&"static"===AD(n).position)?e:n||function(t){var e=/firefox/i.test(SD());if(/Trident/i.test(SD())&&yD(t)&&"fixed"===AD(t).position)return null;var n=LD(t);for(bD(n)&&(n=n.host);yD(n)&&["html","body"].indexOf(ED(n))<0;){var r=AD(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||e&&"filter"===r.willChange||e&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(t)||e}var BD="top",jD="bottom",UD="right",FD="left",VD="auto",zD=[BD,jD,UD,FD],WD="start",qD="end",KD="viewport",JD="popper",GD=zD.reduce(function(t,e){return t.concat([e+"-"+WD,e+"-"+qD])},[]),YD=[].concat(zD,[VD]).reduce(function(t,e){return t.concat([e,e+"-"+WD,e+"-"+qD])},[]),XD=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function QD(t){var e=new Map,n=new Set,r=[];function o(t){n.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach(function(t){if(!n.has(t)){var r=e.get(t);r&&o(r)}}),r.push(t)}return t.forEach(function(t){e.set(t.name,t)}),t.forEach(function(t){n.has(t.name)||o(t)}),r}var ZD={placement:"bottom",modifiers:[],strategy:"absolute"};function tR(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(t){return!(t&&"function"==typeof t.getBoundingClientRect)})}function eR(t){void 0===t&&(t={});var e=t,n=e.defaultModifiers,r=void 0===n?[]:n,o=e.defaultOptions,i=void 0===o?ZD:o;return function(t,e,n){void 0===n&&(n=i);var o,s,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},ZD,i),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},l=[],c=!1,d={state:a,setOptions:function(n){var o="function"==typeof n?n(a.options):n;u(),a.options=Object.assign({},i,a.options,o),a.scrollParents={reference:gD(t)?ID(t):t.contextElement?ID(t.contextElement):[],popper:ID(e)};var s=function(t){var e=QD(t);return XD.reduce(function(t,n){return t.concat(e.filter(function(t){return t.phase===n}))},[])}(function(t){var e=t.reduce(function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign({},n,e,{options:Object.assign({},n.options,e.options),data:Object.assign({},n.data,e.data)}):e,t},{});return Object.keys(e).map(function(t){return e[t]})}([].concat(r,a.options.modifiers)));return a.orderedModifiers=s.filter(function(t){return t.enabled}),a.orderedModifiers.forEach(function(t){var e=t.name,n=t.options,r=void 0===n?{}:n,o=t.effect;if("function"==typeof o){var i=o({state:a,name:e,instance:d,options:r});l.push(i||function(){})}}),d.update()},forceUpdate:function(){if(!c){var t=a.elements,e=t.reference,n=t.popper;if(tR(e,n)){a.rects={reference:DD(e,HD(n),"fixed"===a.options.strategy),popper:RD(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach(function(t){return a.modifiersData[t.name]=Object.assign({},t.data)});for(var r=0;r<a.orderedModifiers.length;r++)if(!0!==a.reset){var o=a.orderedModifiers[r],i=o.fn,s=o.options,l=void 0===s?{}:s,u=o.name;"function"==typeof i&&(a=i({state:a,options:l,name:u,instance:d})||a)}else a.reset=!1,r=-1}}},update:(o=function(){return new Promise(function(t){d.forceUpdate(),t(a)})},function(){return s||(s=new Promise(function(t){Promise.resolve().then(function(){s=void 0,t(o())})})),s}),destroy:function(){u(),c=!0}};if(!tR(t,e))return d;function u(){l.forEach(function(t){return t()}),l=[]}return d.setOptions(n).then(function(t){!c&&n.onFirstUpdate&&n.onFirstUpdate(t)}),d}}var nR={passive:!0};function rR(t){return t.split("-")[0]}function oR(t){return t.split("-")[1]}function iR(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function sR(t){var e,n=t.reference,r=t.element,o=t.placement,i=o?rR(o):null,s=o?oR(o):null,a=n.x+n.width/2-r.width/2,l=n.y+n.height/2-r.height/2;switch(i){case BD:e={x:a,y:n.y-r.height};break;case jD:e={x:a,y:n.y+n.height};break;case UD:e={x:n.x+n.width,y:l};break;case FD:e={x:n.x-r.width,y:l};break;default:e={x:n.x,y:n.y}}var c=i?iR(i):null;if(null!=c){var d="y"===c?"height":"width";switch(s){case WD:e[c]=e[c]-(n[d]/2-r[d]/2);break;case qD:e[c]=e[c]+(n[d]/2-r[d]/2)}}return e}var aR={top:"auto",right:"auto",bottom:"auto",left:"auto"};function lR(t){var e,n=t.popper,r=t.popperRect,o=t.placement,i=t.variation,s=t.offsets,a=t.position,l=t.gpuAcceleration,c=t.adaptive,d=t.roundOffsets,u=t.isFixed,h=s.x,p=void 0===h?0:h,f=s.y,m=void 0===f?0:f,g="function"==typeof d?d({x:p,y:m}):{x:p,y:m};p=g.x,m=g.y;var y=s.hasOwnProperty("x"),b=s.hasOwnProperty("y"),v=FD,w=BD,k=window;if(c){var S=HD(n),x="clientHeight",C="clientWidth";S===mD(n)&&"static"!==AD(S=TD(n)).position&&"absolute"===a&&(x="scrollHeight",C="scrollWidth"),(o===BD||(o===FD||o===UD)&&i===qD)&&(w=jD,m-=(u&&S===k&&k.visualViewport?k.visualViewport.height:S[x])-r.height,m*=l?1:-1),o!==FD&&(o!==BD&&o!==jD||i!==qD)||(v=UD,p-=(u&&S===k&&k.visualViewport?k.visualViewport.width:S[C])-r.width,p*=l?1:-1)}var _,E=Object.assign({position:a},c&&aR),T=!0===d?function(t,e){var n=t.x,r=t.y,o=e.devicePixelRatio||1;return{x:kD(n*o)/o||0,y:kD(r*o)/o||0}}({x:p,y:m},mD(n)):{x:p,y:m};return p=T.x,m=T.y,l?Object.assign({},E,((_={})[w]=b?"0":"",_[v]=y?"0":"",_.transform=(k.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",_)):Object.assign({},E,((e={})[w]=b?m+"px":"",e[v]=y?p+"px":"",e.transform="",e))}const cR={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];yD(o)&&ED(o)&&(Object.assign(o.style,n),Object.keys(r).forEach(function(t){var e=r[t];!1===e?o.removeAttribute(t):o.setAttribute(t,!0===e?"":e)}))})},effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(t){var r=e.elements[t],o=e.attributes[t]||{},i=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]).reduce(function(t,e){return t[e]="",t},{});yD(r)&&ED(r)&&(Object.assign(r.style,i),Object.keys(o).forEach(function(t){r.removeAttribute(t)}))})}},requires:["computeStyles"]};var dR={left:"right",right:"left",bottom:"top",top:"bottom"};function uR(t){return t.replace(/left|right|bottom|top/g,function(t){return dR[t]})}var hR={start:"end",end:"start"};function pR(t){return t.replace(/start|end/g,function(t){return hR[t]})}function fR(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&bD(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function mR(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function gR(t,e,n){return e===KD?mR(function(t,e){var n=mD(t),r=TD(t),o=n.visualViewport,i=r.clientWidth,s=r.clientHeight,a=0,l=0;if(o){i=o.width,s=o.height;var c=xD();(c||!c&&"fixed"===e)&&(a=o.offsetLeft,l=o.offsetTop)}return{width:i,height:s,x:a+MD(t),y:l}}(t,n)):gD(e)?function(t,e){var n=CD(t,!1,"fixed"===e);return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}(e,n):mR(function(t){var e,n=TD(t),r=_D(t),o=null==(e=t.ownerDocument)?void 0:e.body,i=vD(n.scrollWidth,n.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),s=vD(n.scrollHeight,n.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),a=-r.scrollLeft+MD(t),l=-r.scrollTop;return"rtl"===AD(o||n).direction&&(a+=vD(n.clientWidth,o?o.clientWidth:0)-i),{width:i,height:s,x:a,y:l}}(TD(t)))}function yR(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function bR(t,e){return e.reduce(function(e,n){return e[n]=t,e},{})}function vR(t,e){void 0===e&&(e={});var n=e,r=n.placement,o=void 0===r?t.placement:r,i=n.strategy,s=void 0===i?t.strategy:i,a=n.boundary,l=void 0===a?"clippingParents":a,c=n.rootBoundary,d=void 0===c?KD:c,u=n.elementContext,h=void 0===u?JD:u,p=n.altBoundary,f=void 0!==p&&p,m=n.padding,g=void 0===m?0:m,y=yR("number"!=typeof g?g:bR(g,zD)),b=h===JD?"reference":JD,v=t.rects.popper,w=t.elements[f?b:h],k=function(t,e,n,r){var o="clippingParents"===e?function(t){var e=ID(LD(t)),n=["absolute","fixed"].indexOf(AD(t).position)>=0&&yD(t)?HD(t):t;return gD(n)?e.filter(function(t){return gD(t)&&fR(t,n)&&"body"!==ED(t)}):[]}(t):[].concat(e),i=[].concat(o,[n]),s=i[0],a=i.reduce(function(e,n){var o=gR(t,n,r);return e.top=vD(o.top,e.top),e.right=wD(o.right,e.right),e.bottom=wD(o.bottom,e.bottom),e.left=vD(o.left,e.left),e},gR(t,s,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}(gD(w)?w:w.contextElement||TD(t.elements.popper),l,d,s),S=CD(t.elements.reference),x=sR({reference:S,element:v,strategy:"absolute",placement:o}),C=mR(Object.assign({},v,x)),_=h===JD?C:S,E={top:k.top-_.top+y.top,bottom:_.bottom-k.bottom+y.bottom,left:k.left-_.left+y.left,right:_.right-k.right+y.right},T=t.modifiersData.offset;if(h===JD&&T){var M=T[o];Object.keys(E).forEach(function(t){var e=[UD,jD].indexOf(t)>=0?1:-1,n=[BD,jD].indexOf(t)>=0?"y":"x";E[t]+=M[n]*e})}return E}const wR={name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var o=n.mainAxis,i=void 0===o||o,s=n.altAxis,a=void 0===s||s,l=n.fallbackPlacements,c=n.padding,d=n.boundary,u=n.rootBoundary,h=n.altBoundary,p=n.flipVariations,f=void 0===p||p,m=n.allowedAutoPlacements,g=e.options.placement,y=rR(g),b=l||(y!==g&&f?function(t){if(rR(t)===VD)return[];var e=uR(t);return[pR(t),e,pR(e)]}(g):[uR(g)]),v=[g].concat(b).reduce(function(t,n){return t.concat(rR(n)===VD?function(t,e){void 0===e&&(e={});var n=e,r=n.placement,o=n.boundary,i=n.rootBoundary,s=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?YD:l,d=oR(r),u=d?a?GD:GD.filter(function(t){return oR(t)===d}):zD,h=u.filter(function(t){return c.indexOf(t)>=0});0===h.length&&(h=u);var p=h.reduce(function(e,n){return e[n]=vR(t,{placement:n,boundary:o,rootBoundary:i,padding:s})[rR(n)],e},{});return Object.keys(p).sort(function(t,e){return p[t]-p[e]})}(e,{placement:n,boundary:d,rootBoundary:u,padding:c,flipVariations:f,allowedAutoPlacements:m}):n)},[]),w=e.rects.reference,k=e.rects.popper,S=new Map,x=!0,C=v[0],_=0;_<v.length;_++){var E=v[_],T=rR(E),M=oR(E)===WD,A=[BD,jD].indexOf(T)>=0,O=A?"width":"height",D=vR(e,{placement:E,boundary:d,rootBoundary:u,altBoundary:h,padding:c}),R=A?M?UD:FD:M?jD:BD;w[O]>k[O]&&(R=uR(R));var L=uR(R),N=[];if(i&&N.push(D[T]<=0),a&&N.push(D[R]<=0,D[L]<=0),N.every(function(t){return t})){C=E,x=!1;break}S.set(E,N)}if(x)for(var I=function(t){var e=v.find(function(e){var n=S.get(e);if(n)return n.slice(0,t).every(function(t){return t})});if(e)return C=e,"break"},P=f?3:1;P>0&&"break"!==I(P);P--);e.placement!==C&&(e.modifiersData[r]._skip=!0,e.placement=C,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function kR(t,e,n){return vD(t,wD(e,n))}const SR={name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name,o=n.mainAxis,i=void 0===o||o,s=n.altAxis,a=void 0!==s&&s,l=n.boundary,c=n.rootBoundary,d=n.altBoundary,u=n.padding,h=n.tether,p=void 0===h||h,f=n.tetherOffset,m=void 0===f?0:f,g=vR(e,{boundary:l,rootBoundary:c,padding:u,altBoundary:d}),y=rR(e.placement),b=oR(e.placement),v=!b,w=iR(y),k="x"===w?"y":"x",S=e.modifiersData.popperOffsets,x=e.rects.reference,C=e.rects.popper,_="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,E="number"==typeof _?{mainAxis:_,altAxis:_}:Object.assign({mainAxis:0,altAxis:0},_),T=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,M={x:0,y:0};if(S){if(i){var A,O="y"===w?BD:FD,D="y"===w?jD:UD,R="y"===w?"height":"width",L=S[w],N=L+g[O],I=L-g[D],P=p?-C[R]/2:0,$=b===WD?x[R]:C[R],H=b===WD?-C[R]:-x[R],B=e.elements.arrow,j=p&&B?RD(B):{width:0,height:0},U=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},F=U[O],V=U[D],z=kR(0,x[R],j[R]),W=v?x[R]/2-P-z-F-E.mainAxis:$-z-F-E.mainAxis,q=v?-x[R]/2+P+z+V+E.mainAxis:H+z+V+E.mainAxis,K=e.elements.arrow&&HD(e.elements.arrow),J=K?"y"===w?K.clientTop||0:K.clientLeft||0:0,G=null!=(A=null==T?void 0:T[w])?A:0,Y=L+q-G,X=kR(p?wD(N,L+W-G-J):N,L,p?vD(I,Y):I);S[w]=X,M[w]=X-L}if(a){var Q,Z="x"===w?BD:FD,tt="x"===w?jD:UD,et=S[k],nt="y"===k?"height":"width",rt=et+g[Z],ot=et-g[tt],it=-1!==[BD,FD].indexOf(y),st=null!=(Q=null==T?void 0:T[k])?Q:0,at=it?rt:et-x[nt]-C[nt]-st+E.altAxis,lt=it?et+x[nt]+C[nt]-st-E.altAxis:ot,ct=p&&it?function(t,e,n){var r=kR(t,e,n);return r>n?n:r}(at,et,lt):kR(p?at:rt,et,p?lt:ot);S[k]=ct,M[k]=ct-et}e.modifiersData[r]=M}},requiresIfExists:["offset"]};function xR(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function CR(t){return[BD,UD,jD,FD].some(function(e){return t[e]>=0})}var _R=eR({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,n=t.instance,r=t.options,o=r.scroll,i=void 0===o||o,s=r.resize,a=void 0===s||s,l=mD(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return i&&c.forEach(function(t){t.addEventListener("scroll",n.update,nR)}),a&&l.addEventListener("resize",n.update,nR),function(){i&&c.forEach(function(t){t.removeEventListener("scroll",n.update,nR)}),a&&l.removeEventListener("resize",n.update,nR)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,n=t.name;e.modifiersData[n]=sR({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,n=t.options,r=n.gpuAcceleration,o=void 0===r||r,i=n.adaptive,s=void 0===i||i,a=n.roundOffsets,l=void 0===a||a,c={placement:rR(e.placement),variation:oR(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,lR(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,lR(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},cR,{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,n=t.options,r=t.name,o=n.offset,i=void 0===o?[0,0]:o,s=YD.reduce(function(t,n){return t[n]=function(t,e,n){var r=rR(t),o=[FD,BD].indexOf(r)>=0?-1:1,i="function"==typeof n?n(Object.assign({},e,{placement:t})):n,s=i[0],a=i[1];return s=s||0,a=(a||0)*o,[FD,UD].indexOf(r)>=0?{x:a,y:s}:{x:s,y:a}}(n,e.rects,i),t},{}),a=s[e.placement],l=a.x,c=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=s}},wR,SR,{name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,n=t.state,r=t.name,o=t.options,i=n.elements.arrow,s=n.modifiersData.popperOffsets,a=rR(n.placement),l=iR(a),c=[FD,UD].indexOf(a)>=0?"height":"width";if(i&&s){var d=function(t,e){return yR("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:bR(t,zD))}(o.padding,n),u=RD(i),h="y"===l?BD:FD,p="y"===l?jD:UD,f=n.rects.reference[c]+n.rects.reference[l]-s[l]-n.rects.popper[c],m=s[l]-n.rects.reference[l],g=HD(i),y=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,b=f/2-m/2,v=d[h],w=y-u[c]-d[p],k=y/2-u[c]/2+b,S=kR(v,k,w),x=l;n.modifiersData[r]=((e={})[x]=S,e.centerOffset=S-k,e)}},effect:function(t){var e=t.state,n=t.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=e.elements.popper.querySelector(r)))&&fR(e.elements.popper,r)&&(e.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,n=t.name,r=e.rects.reference,o=e.rects.popper,i=e.modifiersData.preventOverflow,s=vR(e,{elementContext:"reference"}),a=vR(e,{altBoundary:!0}),l=xR(s,r),c=xR(a,o,i),d=CR(l),u=CR(c);e.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:u},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}}]}),ER="tippy-content",TR="tippy-arrow",MR="tippy-svg-arrow",AR={passive:!0,capture:!0},OR=function(){return document.body};function DR(t,e,n){if(Array.isArray(t)){var r=t[e];return null==r?Array.isArray(n)?n[e]:n:r}return t}function RR(t,e){var n={}.toString.call(t);return 0===n.indexOf("[object")&&n.indexOf(e+"]")>-1}function LR(t,e){return"function"==typeof t?t.apply(void 0,e):t}function NR(t,e){return 0===e?t:function(r){clearTimeout(n),n=setTimeout(function(){t(r)},e)};var n}function IR(t){return[].concat(t)}function PR(t,e){-1===t.indexOf(e)&&t.push(e)}function $R(t){return[].slice.call(t)}function HR(t){return Object.keys(t).reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{})}function BR(){return document.createElement("div")}function jR(t){return["Element","Fragment"].some(function(e){return RR(t,e)})}function UR(t,e){t.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function FR(t,e){t.forEach(function(t){t&&t.setAttribute("data-state",e)})}function VR(t,e,n){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(e){t[r](e,n)})}function zR(t,e){for(var n=e;n;){var r;if(t.contains(n))return!0;n=null==n.getRootNode||null==(r=n.getRootNode())?void 0:r.host}return!1}var WR={isTouch:!1},qR=0;function KR(){WR.isTouch||(WR.isTouch=!0,window.performance&&document.addEventListener("mousemove",JR))}function JR(){var t=performance.now();t-qR<20&&(WR.isTouch=!1,document.removeEventListener("mousemove",JR)),qR=t}function GR(){var t=document.activeElement;if(function(t){return!(!t||!t._tippy||t._tippy.reference!==t)}(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}var YR=!("undefined"==typeof window||"undefined"==typeof document||!window.msCrypto),XR=Object.assign({appendTo:OR,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),QR=Object.keys(XR);function ZR(t){var e=(t.plugins||[]).reduce(function(e,n){var r,o=n.name,i=n.defaultValue;return o&&(e[o]=void 0!==t[o]?t[o]:null!=(r=XR[o])?r:i),e},{});return Object.assign({},t,e)}function tL(t,e){var n=Object.assign({},e,{content:LR(e.content,[t])},e.ignoreAttributes?{}:function(t,e){return(e?Object.keys(ZR(Object.assign({},XR,{plugins:e}))):QR).reduce(function(e,n){var r=(t.getAttribute("data-tippy-"+n)||"").trim();if(!r)return e;if("content"===n)e[n]=r;else try{e[n]=JSON.parse(r)}catch(t){e[n]=r}return e},{})}(t,e.plugins));return n.aria=Object.assign({},XR.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?e.interactive:n.aria.expanded,content:"auto"===n.aria.content?e.interactive?null:"describedby":n.aria.content},n}function eL(t,e){t.innerHTML=e}function nL(t){var e=BR();return!0===t?e.className=TR:(e.className=MR,jR(t)?e.appendChild(t):eL(e,t)),e}function rL(t,e){jR(e.content)?(eL(t,""),t.appendChild(e.content)):"function"!=typeof e.content&&(e.allowHTML?eL(t,e.content):t.textContent=e.content)}function oL(t){var e=t.firstElementChild,n=$R(e.children);return{box:e,content:n.find(function(t){return t.classList.contains(ER)}),arrow:n.find(function(t){return t.classList.contains(TR)||t.classList.contains(MR)}),backdrop:n.find(function(t){return t.classList.contains("tippy-backdrop")})}}function iL(t){var e=BR(),n=BR();n.className="tippy-box",n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=BR();function o(n,r){var o=oL(e),i=o.box,s=o.content,a=o.arrow;r.theme?i.setAttribute("data-theme",r.theme):i.removeAttribute("data-theme"),"string"==typeof r.animation?i.setAttribute("data-animation",r.animation):i.removeAttribute("data-animation"),r.inertia?i.setAttribute("data-inertia",""):i.removeAttribute("data-inertia"),i.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?i.setAttribute("role",r.role):i.removeAttribute("role"),n.content===r.content&&n.allowHTML===r.allowHTML||rL(s,t.props),r.arrow?a?n.arrow!==r.arrow&&(i.removeChild(a),i.appendChild(nL(r.arrow))):i.appendChild(nL(r.arrow)):a&&i.removeChild(a)}return r.className=ER,r.setAttribute("data-state","hidden"),rL(r,t.props),e.appendChild(n),n.appendChild(r),o(t.props,t.props),{popper:e,onUpdate:o}}iL.$$tippy=!0;var sL=1,aL=[],lL=[];function cL(t,e){var n,r,o,i,s,a,l,c,d=tL(t,Object.assign({},XR,ZR(HR(e)))),u=!1,h=!1,p=!1,f=!1,m=[],g=NR(K,d.interactiveDebounce),y=sL++,b=(c=d.plugins).filter(function(t,e){return c.indexOf(t)===e}),v={id:y,reference:t,popper:BR(),popperInstance:null,props:d,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:b,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(o)},setProps:function(e){if(!v.state.isDestroyed){L("onBeforeUpdate",[v,e]),W();var n=v.props,r=tL(t,Object.assign({},n,HR(e),{ignoreAttributes:!0}));v.props=r,z(),n.interactiveDebounce!==r.interactiveDebounce&&(P(),g=NR(K,r.interactiveDebounce)),n.triggerTarget&&!r.triggerTarget?IR(n.triggerTarget).forEach(function(t){t.removeAttribute("aria-expanded")}):r.triggerTarget&&t.removeAttribute("aria-expanded"),I(),R(),S&&S(n,r),v.popperInstance&&(X(),Z().forEach(function(t){requestAnimationFrame(t._tippy.popperInstance.forceUpdate)})),L("onAfterUpdate",[v,e])}},setContent:function(t){v.setProps({content:t})},show:function(){var t=v.state.isVisible,e=v.state.isDestroyed,n=!v.state.isEnabled,r=WR.isTouch&&!v.props.touch,o=DR(v.props.duration,0,XR.duration);if(!(t||e||n||r||M().hasAttribute("disabled")||(L("onShow",[v],!1),!1===v.props.onShow(v)))){if(v.state.isVisible=!0,T()&&(k.style.visibility="visible"),R(),j(),v.state.isMounted||(k.style.transition="none"),T()){var i=O();UR([i.box,i.content],0)}a=function(){var t;if(v.state.isVisible&&!f){if(f=!0,k.offsetHeight,k.style.transition=v.props.moveTransition,T()&&v.props.animation){var e=O(),n=e.box,r=e.content;UR([n,r],o),FR([n,r],"visible")}N(),I(),PR(lL,v),null==(t=v.popperInstance)||t.forceUpdate(),L("onMount",[v]),v.props.animation&&T()&&function(t){F(t,function(){v.state.isShown=!0,L("onShown",[v])})}(o)}},function(){var t,e=v.props.appendTo,n=M();(t=v.props.interactive&&e===OR||"parent"===e?n.parentNode:LR(e,[n])).contains(k)||t.appendChild(k),v.state.isMounted=!0,X()}()}},hide:function(){var t=!v.state.isVisible,e=v.state.isDestroyed,n=!v.state.isEnabled,r=DR(v.props.duration,1,XR.duration);if(!(t||e||n)&&(L("onHide",[v],!1),!1!==v.props.onHide(v))){if(v.state.isVisible=!1,v.state.isShown=!1,f=!1,u=!1,T()&&(k.style.visibility="hidden"),P(),U(),R(!0),T()){var o=O(),i=o.box,s=o.content;v.props.animation&&(UR([i,s],r),FR([i,s],"hidden"))}N(),I(),v.props.animation?T()&&function(t,e){F(t,function(){!v.state.isVisible&&k.parentNode&&k.parentNode.contains(k)&&e()})}(r,v.unmount):v.unmount()}},hideWithInteractivity:function(t){A().addEventListener("mousemove",g),PR(aL,g),g(t)},enable:function(){v.state.isEnabled=!0},disable:function(){v.hide(),v.state.isEnabled=!1},unmount:function(){v.state.isVisible&&v.hide(),v.state.isMounted&&(Q(),Z().forEach(function(t){t._tippy.unmount()}),k.parentNode&&k.parentNode.removeChild(k),lL=lL.filter(function(t){return t!==v}),v.state.isMounted=!1,L("onHidden",[v]))},destroy:function(){v.state.isDestroyed||(v.clearDelayTimeouts(),v.unmount(),W(),delete t._tippy,v.state.isDestroyed=!0,L("onDestroy",[v]))}};if(!d.render)return v;var w=d.render(v),k=w.popper,S=w.onUpdate;k.setAttribute("data-tippy-root",""),k.id="tippy-"+v.id,v.popper=k,t._tippy=v,k._tippy=v;var x=b.map(function(t){return t.fn(v)}),C=t.hasAttribute("aria-expanded");return z(),I(),R(),L("onCreate",[v]),d.showOnCreate&&tt(),k.addEventListener("mouseenter",function(){v.props.interactive&&v.state.isVisible&&v.clearDelayTimeouts()}),k.addEventListener("mouseleave",function(){v.props.interactive&&v.props.trigger.indexOf("mouseenter")>=0&&A().addEventListener("mousemove",g)}),v;function _(){var t=v.props.touch;return Array.isArray(t)?t:[t,0]}function E(){return"hold"===_()[0]}function T(){var t;return!(null==(t=v.props.render)||!t.$$tippy)}function M(){return l||t}function A(){var t,e,n=M().parentNode;return n?null!=(e=IR(n)[0])&&null!=(t=e.ownerDocument)&&t.body?e.ownerDocument:document:document}function O(){return oL(k)}function D(t){return v.state.isMounted&&!v.state.isVisible||WR.isTouch||i&&"focus"===i.type?0:DR(v.props.delay,t?0:1,XR.delay)}function R(t){void 0===t&&(t=!1),k.style.pointerEvents=v.props.interactive&&!t?"":"none",k.style.zIndex=""+v.props.zIndex}function L(t,e,n){var r;void 0===n&&(n=!0),x.forEach(function(n){n[t]&&n[t].apply(n,e)}),n&&(r=v.props)[t].apply(r,e)}function N(){var e=v.props.aria;if(e.content){var n="aria-"+e.content,r=k.id;IR(v.props.triggerTarget||t).forEach(function(t){var e=t.getAttribute(n);if(v.state.isVisible)t.setAttribute(n,e?e+" "+r:r);else{var o=e&&e.replace(r,"").trim();o?t.setAttribute(n,o):t.removeAttribute(n)}})}}function I(){!C&&v.props.aria.expanded&&IR(v.props.triggerTarget||t).forEach(function(t){v.props.interactive?t.setAttribute("aria-expanded",v.state.isVisible&&t===M()?"true":"false"):t.removeAttribute("aria-expanded")})}function P(){A().removeEventListener("mousemove",g),aL=aL.filter(function(t){return t!==g})}function $(e){if(!WR.isTouch||!p&&"mousedown"!==e.type){var n=e.composedPath&&e.composedPath()[0]||e.target;if(!v.props.interactive||!zR(k,n)){if(IR(v.props.triggerTarget||t).some(function(t){return zR(t,n)})){if(WR.isTouch)return;if(v.state.isVisible&&v.props.trigger.indexOf("click")>=0)return}else L("onClickOutside",[v,e]);!0===v.props.hideOnClick&&(v.clearDelayTimeouts(),v.hide(),h=!0,setTimeout(function(){h=!1}),v.state.isMounted||U())}}}function H(){p=!0}function B(){p=!1}function j(){var t=A();t.addEventListener("mousedown",$,!0),t.addEventListener("touchend",$,AR),t.addEventListener("touchstart",B,AR),t.addEventListener("touchmove",H,AR)}function U(){var t=A();t.removeEventListener("mousedown",$,!0),t.removeEventListener("touchend",$,AR),t.removeEventListener("touchstart",B,AR),t.removeEventListener("touchmove",H,AR)}function F(t,e){var n=O().box;function r(t){t.target===n&&(VR(n,"remove",r),e())}if(0===t)return e();VR(n,"remove",s),VR(n,"add",r),s=r}function V(e,n,r){void 0===r&&(r=!1),IR(v.props.triggerTarget||t).forEach(function(t){t.addEventListener(e,n,r),m.push({node:t,eventType:e,handler:n,options:r})})}function z(){var t;E()&&(V("touchstart",q,{passive:!0}),V("touchend",J,{passive:!0})),(t=v.props.trigger,t.split(/\s+/).filter(Boolean)).forEach(function(t){if("manual"!==t)switch(V(t,q),t){case"mouseenter":V("mouseleave",J);break;case"focus":V(YR?"focusout":"blur",G);break;case"focusin":V("focusout",G)}})}function W(){m.forEach(function(t){var e=t.node,n=t.eventType,r=t.handler,o=t.options;e.removeEventListener(n,r,o)}),m=[]}function q(t){var e,n=!1;if(v.state.isEnabled&&!Y(t)&&!h){var r="focus"===(null==(e=i)?void 0:e.type);i=t,l=t.currentTarget,I(),!v.state.isVisible&&function(t){return RR(t,"MouseEvent")}(t)&&aL.forEach(function(e){return e(t)}),"click"===t.type&&(v.props.trigger.indexOf("mouseenter")<0||u)&&!1!==v.props.hideOnClick&&v.state.isVisible?n=!0:tt(t),"click"===t.type&&(u=!n),n&&!r&&et(t)}}function K(t){var e=t.target,n=M().contains(e)||k.contains(e);if("mousemove"!==t.type||!n){var r=Z().concat(k).map(function(t){var e,n=null==(e=t._tippy.popperInstance)?void 0:e.state;return n?{popperRect:t.getBoundingClientRect(),popperState:n,props:d}:null}).filter(Boolean);(function(t,e){var n=e.clientX,r=e.clientY;return t.every(function(t){var e=t.popperRect,o=t.popperState,i=t.props.interactiveBorder,s=o.placement.split("-")[0],a=o.modifiersData.offset;if(!a)return!0;var l="bottom"===s?a.top.y:0,c="top"===s?a.bottom.y:0,d="right"===s?a.left.x:0,u="left"===s?a.right.x:0,h=e.top-r+l>i,p=r-e.bottom-c>i,f=e.left-n+d>i,m=n-e.right-u>i;return h||p||f||m})})(r,t)&&(P(),et(t))}}function J(t){Y(t)||v.props.trigger.indexOf("click")>=0&&u||(v.props.interactive?v.hideWithInteractivity(t):et(t))}function G(t){v.props.trigger.indexOf("focusin")<0&&t.target!==M()||v.props.interactive&&t.relatedTarget&&k.contains(t.relatedTarget)||et(t)}function Y(t){return!!WR.isTouch&&E()!==t.type.indexOf("touch")>=0}function X(){Q();var e=v.props,n=e.popperOptions,r=e.placement,o=e.offset,i=e.getReferenceClientRect,s=e.moveTransition,l=T()?oL(k).arrow:null,c=i?{getBoundingClientRect:i,contextElement:i.contextElement||M()}:t,d=[{name:"offset",options:{offset:o}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!s}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(t){var e=t.state;if(T()){var n=O().box;["placement","reference-hidden","escaped"].forEach(function(t){"placement"===t?n.setAttribute("data-placement",e.placement):e.attributes.popper["data-popper-"+t]?n.setAttribute("data-"+t,""):n.removeAttribute("data-"+t)}),e.attributes.popper={}}}}];T()&&l&&d.push({name:"arrow",options:{element:l,padding:3}}),d.push.apply(d,(null==n?void 0:n.modifiers)||[]),v.popperInstance=_R(c,k,Object.assign({},n,{placement:r,onFirstUpdate:a,modifiers:d}))}function Q(){v.popperInstance&&(v.popperInstance.destroy(),v.popperInstance=null)}function Z(){return $R(k.querySelectorAll("[data-tippy-root]"))}function tt(t){v.clearDelayTimeouts(),t&&L("onTrigger",[v,t]),j();var e=D(!0),r=_(),o=r[0],i=r[1];WR.isTouch&&"hold"===o&&i&&(e=i),e?n=setTimeout(function(){v.show()},e):v.show()}function et(t){if(v.clearDelayTimeouts(),L("onUntrigger",[v,t]),v.state.isVisible){if(!(v.props.trigger.indexOf("mouseenter")>=0&&v.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(t.type)>=0&&u)){var e=D(!1);e?r=setTimeout(function(){v.state.isVisible&&v.hide()},e):o=requestAnimationFrame(function(){v.hide()})}}else U()}}function dL(t,e){void 0===e&&(e={});var n=XR.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",KR,AR),window.addEventListener("blur",GR);var r=Object.assign({},e,{plugins:n}),o=function(t){return jR(t)?[t]:function(t){return RR(t,"NodeList")}(t)?$R(t):Array.isArray(t)?t:$R(document.querySelectorAll(t))}(t).reduce(function(t,e){var n=e&&cL(e,r);return n&&t.push(n),t},[]);return jR(t)?o[0]:o}dL.defaultProps=XR,dL.setDefaultProps=function(t){Object.keys(t).forEach(function(e){XR[e]=t[e]})},dL.currentInput=WR,Object.assign({},cR,{effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow)}}),dL.setDefaultProps({render:iL});const uL=dL;var hL=o(5072),pL=o.n(hL),fL=o(7825),mL=o.n(fL),gL=o(7659),yL=o.n(gL),bL=o(5056),vL=o.n(bL),wL=o(540),kL=o.n(wL),SL=o(1113),xL=o.n(SL),CL=o(1002),_L={};_L.styleTagTransform=xL(),_L.setAttributes=vL(),_L.insert=yL().bind(null,"head"),_L.domAPI=mL(),_L.insertStyleElement=kL(),pL()(CL.A,_L),CL.A&&CL.A.locals&&CL.A.locals;var EL=s_,TL=k_,ML=a_,AL=C_,OL=x_,DL=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,RL=Ug.create({name:"image",addOptions:()=>({inline:!1,allowBase64:!1,HTMLAttributes:{}}),inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes:()=>({src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}),parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",kf(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[$g({find:DL,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),LL=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,NL=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,IL=am.create({name:"highlight",addOptions:()=>({multicolor:!1,HTMLAttributes:{}}),addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML:()=>[{tag:"mark"}],renderHTML({HTMLAttributes:t}){return["mark",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Pg({find:LL,type:this.type})]},addPasteRules(){return[Fg({find:NL,type:this.type})]}}),PL=am.create({name:"subscript",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"sub"},{style:"vertical-align",getAttrs:t=>"sub"===t&&null}],renderHTML({HTMLAttributes:t}){return["sub",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setSubscript:()=>({commands:t})=>t.setMark(this.name),toggleSubscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSubscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-,":()=>this.editor.commands.toggleSubscript()}}}),$L=am.create({name:"superscript",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"sup"},{style:"vertical-align",getAttrs:t=>"super"===t&&null}],renderHTML({HTMLAttributes:t}){return["sup",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{setSuperscript:()=>({commands:t})=>t.setMark(this.name),toggleSuperscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSuperscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-.":()=>this.editor.commands.toggleSuperscript()}}}),HL=am.create({name:"textStyle",priority:101,addOptions:()=>({HTMLAttributes:{},mergeNestedSpanStyles:!0}),parseHTML(){return[{tag:"span",consuming:!1,getAttrs:t=>!!t.hasAttribute("style")&&(this.options.mergeNestedSpanStyles&&(t=>{if(!t.children.length)return;const e=t.querySelectorAll("span");e&&e.forEach(t=>{var e,n;const r=t.getAttribute("style"),o=null==(n=null==(e=t.parentElement)?void 0:e.closest("span"))?void 0:n.getAttribute("style");t.setAttribute("style",`${o};${r}`)})})(t),{})}]},renderHTML({HTMLAttributes:t}){return["span",kf(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleTextStyle:t=>({commands:e})=>e.toggleMark(this.name,t),removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(e,n)=>{if(e.isTextblock)return!0;e.marks.filter(t=>t.type===this.type).some(t=>Object.values(t.attrs).some(t=>!!t))||t.removeMark(n,n+e.nodeSize,this.type)}),!0}}}}),BL=hm.create({name:"backgroundColor",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:t=>{var e;return null==(e=t.style.backgroundColor)?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.backgroundColor?{style:`background-color: ${t.backgroundColor}`}:{}}}}]},addCommands:()=>({setBackgroundColor:t=>({chain:e})=>e().setMark("textStyle",{backgroundColor:t}).run(),unsetBackgroundColor:()=>({chain:t})=>t().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()})}),jL=hm.create({name:"color",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return null==(e=t.style.color)?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands:()=>({setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()})}),UL=hm.create({name:"fontFamily",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:t=>t.style.fontFamily,renderHTML:t=>t.fontFamily?{style:`font-family: ${t.fontFamily}`}:{}}}}]},addCommands:()=>({setFontFamily:t=>({chain:e})=>e().setMark("textStyle",{fontFamily:t}).run(),unsetFontFamily:()=>({chain:t})=>t().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()})}),FL=hm.create({name:"fontSize",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:t=>t.style.fontSize,renderHTML:t=>t.fontSize?{style:`font-size: ${t.fontSize}`}:{}}}}]},addCommands:()=>({setFontSize:t=>({chain:e})=>e().setMark("textStyle",{fontSize:t}).run(),unsetFontSize:()=>({chain:t})=>t().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()})}),VL=hm.create({name:"lineHeight",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:t=>t.style.lineHeight,renderHTML:t=>t.lineHeight?{style:`line-height: ${t.lineHeight}`}:{}}}}]},addCommands:()=>({setLineHeight:t=>({chain:e})=>e().setMark("textStyle",{lineHeight:t}).run(),unsetLineHeight:()=>({chain:t})=>t().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()})}),zL=(hm.create({name:"textStyleKit",addExtensions(){const t=[];return!1!==this.options.backgroundColor&&t.push(BL.configure(this.options.backgroundColor)),!1!==this.options.color&&t.push(jL.configure(this.options.color)),!1!==this.options.fontFamily&&t.push(UL.configure(this.options.fontFamily)),!1!==this.options.fontSize&&t.push(FL.configure(this.options.fontSize)),!1!==this.options.lineHeight&&t.push(VL.configure(this.options.lineHeight)),!1!==this.options.textStyle&&t.push(HL.configure(this.options.textStyle)),t}}),hm.create({name:"textAlign",addOptions:()=>({types:[],alignments:["left","center","right","justify"],defaultAlignment:null}),addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>!!this.options.alignments.includes(t)&&this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).every(t=>t),unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).every(t=>t),toggleTextAlign:t=>({editor:e,commands:n})=>!!this.options.alignments.includes(t)&&(e.isActive({textAlign:t})?n.unsetTextAlign():n.setTextAlign(t))}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}})),WL=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu\.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,qL=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu\.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/g,KL=t=>t.match(WL),JL=(t,e)=>e?"https://www.youtube-nocookie.com/embed/videoseries?list=":t?"https://www.youtube-nocookie.com/embed/":"https://www.youtube.com/embed/",GL=Ug.create({name:"youtube",addOptions:()=>({addPasteHandler:!0,allowFullscreen:!0,autoplay:!1,ccLanguage:void 0,ccLoadPolicy:void 0,controls:!0,disableKBcontrols:!1,enableIFrameApi:!1,endTime:0,height:480,interfaceLanguage:void 0,ivLoadPolicy:0,loop:!1,modestBranding:!1,HTMLAttributes:{},inline:!1,nocookie:!1,origin:"",playlist:"",progressBarColor:void 0,width:640,rel:1}),inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},start:{default:0},width:{default:this.options.width},height:{default:this.options.height}}},parseHTML:()=>[{tag:"div[data-youtube-video] iframe"}],addCommands(){return{setYoutubeVideo:t=>({commands:e})=>!!KL(t.src)&&e.insertContent({type:this.name,attrs:t})}},addPasteRules(){return this.options.addPasteHandler?[(t={find:qL,type:this.type,getAttributes:t=>({src:t.input})},new lm({find:t.find,handler({match:e,chain:n,range:r,pasteEvent:o}){const i=bf(t.getAttributes,void 0,e,o),s=bf(t.getContent,void 0,i);if(!1===i||null===i)return null;const a={type:t.type.name,attrs:i};s&&(a.content=s),e.input&&n().deleteRange(r).insertContentAt(r.from,a)}}))]:[];var t},renderHTML({HTMLAttributes:t}){const e=(t=>{const{url:e,allowFullscreen:n,autoplay:r,ccLanguage:o,ccLoadPolicy:i,controls:s,disableKBcontrols:a,enableIFrameApi:l,endTime:c,interfaceLanguage:d,ivLoadPolicy:u,loop:h,modestBranding:p,nocookie:f,origin:m,playlist:g,progressBarColor:y,startAt:b,rel:v}=t;if(!KL(e))return null;if(e.includes("/embed/"))return e;if(e.includes("youtu.be")){const t=e.split("/").pop();return t?`${JL(f)}${t}`:null}const w=/(?:(v|list)=|shorts\/)([-\w]+)/gm.exec(e);if(!w||!w[2])return null;let k=`${JL(f,"list"===w[1])}${w[2]}`;const S=[];return!1===n&&S.push("fs=0"),r&&S.push("autoplay=1"),o&&S.push(`cc_lang_pref=${o}`),i&&S.push("cc_load_policy=1"),s||S.push("controls=0"),a&&S.push("disablekb=1"),l&&S.push("enablejsapi=1"),c&&S.push(`end=${c}`),d&&S.push(`hl=${d}`),u&&S.push(`iv_load_policy=${u}`),h&&S.push("loop=1"),p&&S.push("modestbranding=1"),m&&S.push(`origin=${m}`),g&&S.push(`playlist=${g}`),b&&S.push(`start=${b}`),y&&S.push(`color=${y}`),void 0!==v&&S.push(`rel=${v}`),S.length&&(k+=`${"v"===w[1]?"?":"&"}${S.join("&")}`),k})({url:t.src,allowFullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,controls:this.options.controls,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,nocookie:this.options.nocookie,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,startAt:t.start||0,rel:this.options.rel});return t.src=e,["div",{"data-youtube-video":""},["iframe",kf(this.options.HTMLAttributes,{width:this.options.width,height:this.options.height,allowfullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,rel:this.options.rel},t)]]}}),YL=GL;function XL(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function QL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function ZL(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?QL(Object(n),!0).forEach(function(e){s(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):QL(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var tN="dlux.io"===location.hostname||"data.dlux.io"===location.hostname,eN=E_.extend({name:"paragraph",onCreate:function(){tN||console.log(" CustomParagraph extension loaded - context-aware textAlign validation")},addAttributes:function(){var t;return ZL(ZL({},(null===(t=this.parent)||void 0===t?void 0:t.call(this))||{}),{},{textAlign:{default:null,parseHTML:function(t){return t.style.textAlign||null},renderHTML:function(t){return t.textAlign?{style:"text-align: ".concat(t.textAlign)}:{}}}})}}),nN=zL.extend({name:"textAlign",onCreate:function(){tN||console.log(" CustomTextAlign extension loaded and initialized")},addCommands:function(){return{setTextAlign:function(t){return function(e){var n=e.state,r=(e.dispatch,e.commands);console.log(" CustomTextAlign: setTextAlign called with alignment:",t);for(var o=n.selection.$from,i=o.depth;i>0;i--)if("blockquote"===o.node(i).type.name)return console.log(" CustomTextAlign: Blocking alignment inside blockquote for alignment:",t),!1;return console.log(" CustomTextAlign: Allowing alignment",t,"- not in blockquote"),r.updateAttributes("paragraph",{textAlign:t})}}}}}),rN=hm.create({name:"blockquoteAlignmentFilter",onCreate:function(){tN||console.log(" BlockquoteAlignmentFilter extension loaded - schema-level enforcement")},addProseMirrorPlugins:function(){return[new od({key:new ad("blockquoteAlignmentFilter"),filterTransaction:function(t,e){var n=!1;return t.steps.forEach(function(t){if(t.slice){var r=function(o){o.content.forEach(function(o){var i;if(null!==(i=o.attrs)&&void 0!==i&&i.textAlign){var s=t.from;if(void 0!==s)try{for(var a=e.doc.resolve(s),l=a.depth;l>0;l--)if("blockquote"===a.node(l).type.name)return console.log(" BlockquoteAlignmentFilter: Blocking transaction with textAlign in blockquote"),void(n=!0)}catch(t){}}o.content&&r(o.content)})};r(t.slice)}}),!n},appendTransaction:function(t,e,n){var r=n.tr,o=!1;return n.doc.descendants(function(t,e){if("paragraph"===t.type.name&&t.attrs.textAlign)for(var i=n.doc.resolve(e),s=i.depth;s>0;s--)if("blockquote"===i.node(s).type.name){console.log(" BlockquoteAlignmentFilter: Removing textAlign from paragraph in blockquote"),r.setNodeMarkup(e,null,ZL(ZL({},t.attrs),{},{textAlign:null})),o=!0;break}}),o?r:null}})]}}),oN=RL.extend({name:"image",addOptions:function(){var t;return ZL(ZL({},null===(t=this.parent)||void 0===t?void 0:t.call(this)),{},{onImageClick:null})},addCommands:function(){var t,e=this;return ZL(ZL({},null===(t=this.parent)||void 0===t?void 0:t.call(this)),{},{editImage:function(t,n){return function(r){return r.editor,e.options.onImageClick&&e.options.onImageClick(t,n),!0}}})},addNodeView:function(){return function(t){var e=t.node,n=t.getPos,r=t.editor,o=e,i=document.createElement("figure");i.className="image-figure",i.style.display="block",i.style.position="relative",i.style.margin="1rem 0",i.style.textAlign="center";var s=document.createElement("img");s.src=e.attrs.src,s.alt=e.attrs.alt||"",s.title=e.attrs.title||"",s.className=e.attrs.class||"content-image",s.style.cursor="pointer",s.style.maxWidth="100%",s.style.height="auto";var a=document.createElement("figcaption");a.className="image-caption",a.textContent=e.attrs.alt||"",a.style.display=e.attrs.alt?"block":"none";var l=function(t){if(t.preventDefault(),t.stopPropagation(),"function"==typeof n){var e=n();r.commands.editImage(e,o.attrs)}};return s.addEventListener("click",l),i.appendChild(s),i.appendChild(a),{dom:i,update:function(t){return t.type===e.type&&(o=t,s.src=t.attrs.src,s.alt=t.attrs.alt||"",s.title=t.attrs.title||"",a.textContent=t.attrs.alt||"",a.style.display=t.attrs.alt?"block":"none",!0)},destroy:function(){s.removeEventListener("click",l)}}}},addProseMirrorPlugins:function(){var t,e=(null===(t=this.parent)||void 0===t?void 0:t.call(this))||[];return[].concat(n(e),[new od({key:new ad("customImageDrag"),props:{handleDOMEvents:{dragstart:function(t,e){if("IMG"!==e.target.tagName)return!1;e.dataTransfer.effectAllowed="move";var n=e.target,r=document.createElement("canvas"),o=r.getContext("2d"),i=Math.min(100/n.width,100/n.height,1);r.width=n.width*i,r.height=n.height*i,o.drawImage(n,0,0,r.width,r.height),o.strokeStyle="#5C94FE",o.lineWidth=2,o.strokeRect(0,0,r.width,r.height),e.dataTransfer.setDragImage(r,r.width/2,r.height/2);var s=t.posAtDOM(e.target,0);return s>=0&&(window.dluxEditor=window.dluxEditor||{},window.dluxEditor.draggingImagePos=s,e.target.style.opacity="0.5"),!1},dragover:function(t,e){return e.dataTransfer&&e.dataTransfer.types.includes("text/html")&&(e.dataTransfer.dropEffect="move"),!1},dragend:function(t,e){return"IMG"===e.target.tagName&&(e.target.style.opacity=""),window.dluxEditor&&delete window.dluxEditor.draggingImagePos,!1},drop:function(t,e){var n;if(void 0!==(null===(n=window.dluxEditor)||void 0===n?void 0:n.draggingImagePos)){var r=window.dluxEditor.draggingImagePos,o=t.posAtCoords({left:e.clientX,top:e.clientY});if(o&&o.pos!==r){e.preventDefault(),t.state.doc.resolve(r);var i=t.state.doc.nodeAt(r);if(i&&"image"===i.type.name){var s=t.state.tr,a=o.pos;return a>r&&(a-=i.nodeSize),s.delete(r,r+i.nodeSize),s.insert(a,i),t.dispatch(s),delete window.dluxEditor.draggingImagePos,!0}}}return!1}}}})])}}),iN=XS.extend({name:"horizontalRule",atom:!0,draggable:!0,selectable:!0,addCommands:function(){var t;return(null===(t=this.parent)||void 0===t?void 0:t.call(this))||{}},renderHTML:function(t){return["div",{class:"hr-wrapper"},["hr",t.HTMLAttributes]]},parseDOM:function(){return[{tag:"div.hr-wrapper",getContent:function(t,e){return e.nodeFromJSON({type:"horizontalRule"}).content}},{tag:"hr"}]}}),sN={tableCell:{blocks:["table","horizontalRule"],transforms:["heading","codeBlock","blockquote","bulletList","orderedList"]},tableHeader:{blocks:["table","horizontalRule"],transforms:["heading","codeBlock","blockquote","bulletList","orderedList"]},blockquote:{blocks:["table","horizontalRule"],transforms:["heading","codeBlock","bulletList","orderedList"]}};function aN(t){var e=sN[t];return e?Array.isArray(e)?e:[].concat(n(e.blocks||[]),n(e.transforms||[])):[]}function lN(t,e){var n=sN[t];return!(!n||Array.isArray(n))&&(n.transforms||[]).includes(e)}function cN(t,e,n){for(var r=t.doc.resolve(e),o=r.depth;o>0;o--){var i=r.node(o).type.name,s=aN(i);if(s.includes(n))return{blocked:!0,byNode:i,atDepth:o,blockedContent:s,canTransform:lN(i,n)}}return{blocked:!1}}function dN(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=[];t.content.forEach(function(i){switch(i.type.name){case"heading":var s="blockquote"===r?{}:i.attrs;o.push(e.nodes.paragraph.create(s,i.content));break;case"codeBlock":var a=[];i.content.forEach(function(t){if(t.isText){var n=e.marks.code?[e.marks.code.create()]:[];a.push(t.mark(n))}});var l="blockquote"===r?{}:i.attrs;o.push(e.nodes.paragraph.create(l,a));break;case"blockquote":i.content.forEach(function(i){if("paragraph"===i.type.name){var s="blockquote"===r?{}:i.attrs;o.push(e.nodes.paragraph.create(s,i.content))}else{var a=dN(t.constructor.maxOpen(e.nodeFromJSON({type:"doc",content:[i.toJSON()]}).content),e,r);o.push.apply(o,n(a.content.content))}});break;case"bulletList":case"orderedList":i.content.forEach(function(t){"listItem"===t.type.name&&t.content.forEach(function(t){if("paragraph"===t.type.name){var n="blockquote"===r?{}:t.attrs;o.push(e.nodes.paragraph.create(n,t.content))}else{var i="blockquote"===r?{}:t.attrs;o.push(e.nodes.paragraph.create(i,t.content))}})});break;case"paragraph":"blockquote"===r?o.push(e.nodes.paragraph.create({},i.content)):o.push(i);break;case"text":o.push(i);break;default:if(i.isBlock&&i.content.size>0){var c="blockquote"===r?{}:i.attrs;o.push(e.nodes.paragraph.create(c,i.content))}else if(i.isInline||i.isText){var d="blockquote"===r?{}:null;o.push(e.nodes.paragraph.create(d,[i]))}}});var i=e.nodeFromJSON({type:"doc",content:o.map(function(t){return t.toJSON()})}).content;return t.constructor.maxOpen(i)}var uN=Ug.create({name:"dluxvideo",group:"block",atom:!0,draggable:!0,addAttributes:function(){return{src:{default:null,parseHTML:function(t){return t.getAttribute("src")},renderHTML:function(t){return t.src?{src:t.src}:{}}},poster:{default:null,parseHTML:function(t){return t.getAttribute("poster")},renderHTML:function(t){return t.poster?{poster:t.poster}:{}}},width:{default:"100%",parseHTML:function(t){return t.getAttribute("width")||"100%"},renderHTML:function(t){return{width:t.width||"100%"}}},height:{default:"auto",parseHTML:function(t){return t.getAttribute("height")||"auto"},renderHTML:function(t){return{height:t.height||"auto"}}},controls:{default:!0,parseHTML:function(t){return t.hasAttribute("controls")},renderHTML:function(t){return t.controls?{controls:"controls"}:{}}},autoplay:{default:!1,parseHTML:function(t){return t.hasAttribute("autoplay")},renderHTML:function(t){return t.autoplay?{autoplay:"autoplay"}:{}}},loop:{default:!1,parseHTML:function(t){return t.hasAttribute("loop")},renderHTML:function(t){return t.loop?{loop:"loop"}:{}}},muted:{default:!1,parseHTML:function(t){return t.hasAttribute("muted")},renderHTML:function(t){return t.muted?{muted:"muted"}:{}}},type:{default:null,parseHTML:function(t){return t.getAttribute("type")},renderHTML:function(t){return t.type?{type:t.type}:{}}},"data-type":{default:null,parseHTML:function(t){return t.getAttribute("data-type")},renderHTML:function(t){return t["data-type"]?{"data-type":t["data-type"]}:{}}},"data-mime-type":{default:null,parseHTML:function(t){return t.getAttribute("data-mime-type")},renderHTML:function(t){return t["data-mime-type"]?{"data-mime-type":t["data-mime-type"]}:{}}},crossorigin:{default:"anonymous",parseHTML:function(t){return t.getAttribute("crossorigin")||"anonymous"},renderHTML:function(t){return t.crossorigin?{crossorigin:t.crossorigin}:{}}}}},parseHTML:function(){return[{tag:"video[src]"}]},renderHTML:function(t){var e=ZL({},t.HTMLAttributes);return!0===e.controls||"true"===e.controls?e.controls="controls":!1!==e.controls&&"false"!==e.controls||delete e.controls,e.width||(e.width="100%"),e.height||(e.height="auto"),!e.crossorigin&&e.src&&e.src.includes("ipfs")&&(e.crossorigin="anonymous"),["video",e]},addCommands:function(){var t=this;return{setDluxVideo:function(e){return function(n){return n.commands.insertContent({type:t.name,attrs:e})}}}},addNodeView:function(){return function(t){var e=t.node,n=(t.editor,document.createElement("div"));n.className="dlux-video-container",n.style.position="relative",n.style.marginBottom="1rem",n.style.width="100%";var r=document.createElement("video");r.className="video-js vjs-default-skin vjs-big-play-centered vjs-fluid",n.appendChild(r);var o=null;return setTimeout(function(){window.DluxVideoPlayer?(o=window.DluxVideoPlayer.initializePlayer(r,{src:e.attrs.src,type:e.attrs.type||(e.attrs.src.includes(".m3u8")?"application/x-mpegURL":"video/mp4"),poster:e.attrs.poster,autoplay:e.attrs.autoplay,loop:e.attrs.loop,muted:e.attrs.muted}),n._dluxVideoPlayer=o):console.error("DluxVideoPlayer not available. Make sure video-player-bundle.js is loaded.")},100),{dom:n,contentDOM:null,update:function(t){if(t.type!==e.type)return!1;if(o&&t.attrs.src!==e.attrs.src){var n=t.attrs.type||(t.attrs.src.includes(".m3u8")?"application/x-mpegURL":"video/mp4");o.src({src:t.attrs.src,type:n})}return e=t,!0},destroy:function(){n._dluxVideoPlayer&&window.DluxVideoPlayer&&(window.DluxVideoPlayer.destroyPlayer(r),n._dluxVideoPlayer=null)}}}},addProseMirrorPlugins:function(){var t,e=(null===(t=this.parent)||void 0===t?void 0:t.call(this))||[];return[].concat(n(e),[new od({key:new ad("dluxVideoDrag"),props:{handleDOMEvents:{dragstart:function(t,e){var n=e.target,r=null;if("VIDEO"===n.tagName)r=n;else{if(!n.classList.contains("dlux-video-container"))return!1;r=n.querySelector("video")}e.dataTransfer.effectAllowed="move";var o=t.posAtDOM(n,0);if(o>=0){var i,s=t.state.doc.nodeAt(o);if(s&&s.attrs.poster){(i=document.createElement("img")).src=s.attrs.poster,i.style.width="100px",i.style.height="auto",i.style.maxHeight="100px",i.style.objectFit="cover",i.style.border="2px solid #5C94FE",i.style.borderRadius="4px",i.style.position="absolute",i.style.top="-1000px",document.body.appendChild(i);var a=function(){i.remove(),document.removeEventListener("dragend",a)};document.addEventListener("dragend",a)}else{(i=document.createElement("div")).style.width="100px",i.style.height="75px",i.style.backgroundColor="#2a2a2a",i.style.border="2px solid #5C94FE",i.style.borderRadius="4px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.position="absolute",i.style.top="-1000px",i.innerHTML='<span style="color: #fff; font-size: 30px;"></span>',document.body.appendChild(i);var l=function(){i.remove(),document.removeEventListener("dragend",l)};document.addEventListener("dragend",l)}e.dataTransfer.setDragImage(i,50,37),window.dluxEditor=window.dluxEditor||{},window.dluxEditor.draggingVideoPos=o,n.classList.contains("dlux-video-container")?n.style.opacity="0.5":r&&(r.style.opacity="0.5")}return!1},dragover:function(t,e){return e.dataTransfer&&e.dataTransfer.types.includes("text/html")&&(e.dataTransfer.dropEffect="move"),!1},dragend:function(t,e){if("VIDEO"===e.target.tagName)e.target.style.opacity="";else if(e.target.classList.contains("dlux-video-container")){e.target.style.opacity="";var n=e.target.querySelector("video");n&&(n.style.opacity="")}return window.dluxEditor&&delete window.dluxEditor.draggingVideoPos,!1},drop:function(t,e){var n;if(void 0!==(null===(n=window.dluxEditor)||void 0===n?void 0:n.draggingVideoPos)){var r=window.dluxEditor.draggingVideoPos,o=t.posAtCoords({left:e.clientX,top:e.clientY});if(o&&o.pos!==r){e.preventDefault(),t.state.doc.resolve(r);var i=t.state.doc.nodeAt(r);if(i&&"dluxvideo"===i.type.name){var s=t.state.tr,a=o.pos;return a>r&&(a-=i.nodeSize),s.delete(r,r+i.nodeSize),s.insert(a,i),t.dispatch(s),delete window.dluxEditor.draggingVideoPos,!0}}}return!1}}}})])}}),hN=YL.extend({name:"spkvideo",addOptions:function(){var t;return ZL(ZL({},null===(t=this.parent)||void 0===t?void 0:t.call(this)),{},{onVideoClick:null})},addAttributes:function(){return{src:{default:null,parseHTML:function(t){var e=t.getAttribute("data-original-src");if(e)return e;var n=t.getAttribute("src");return n&&n.startsWith("blob:")&&("application/x-mpegURL"===t.getAttribute("type")||"m3u8"===t.getAttribute("data-type"))&&console.warn("Found HLS video with blob URL but no original src preserved"),n},renderHTML:function(t){return t.src?{src:t.src}:{}}},controls:{default:!0,parseHTML:function(t){return t.hasAttribute("controls")},renderHTML:function(t){return t.controls?{controls:"controls"}:{}}},width:{default:"100%",parseHTML:function(t){return t.getAttribute("width")||"100%"},renderHTML:function(t){return{width:t.width||"100%"}}},height:{default:"auto",parseHTML:function(t){return t.getAttribute("height")||"auto"},renderHTML:function(t){return{height:t.height||"auto"}}},type:{default:null,parseHTML:function(t){return t.getAttribute("type")},renderHTML:function(t){return t.type?{type:t.type}:{}}},crossorigin:{default:"anonymous",parseHTML:function(t){return t.getAttribute("crossorigin")||"anonymous"},renderHTML:function(t){return t.crossorigin?{crossorigin:t.crossorigin}:{}}},"data-type":{default:null,parseHTML:function(t){return t.getAttribute("data-type")},renderHTML:function(t){return t["data-type"]?{"data-type":t["data-type"]}:{}}},"data-mime-type":{default:null,parseHTML:function(t){return t.getAttribute("data-mime-type")},renderHTML:function(t){return t["data-mime-type"]?{"data-mime-type":t["data-mime-type"]}:{}}},"data-original-src":{default:null,parseHTML:function(t){return t.getAttribute("data-original-src")},renderHTML:function(t){return t.src&&!t.src.startsWith("blob:")?{"data-original-src":t.src}:t["data-original-src"]?{"data-original-src":t["data-original-src"]}:{}}}}},parseHTML:function(){return[{tag:"video[src]"}]},renderHTML:function(t){var e=ZL({},t.HTMLAttributes);return!0===e.controls||"true"===e.controls?e.controls="controls":!1!==e.controls&&"false"!==e.controls||delete e.controls,e.width||(e.width="100%"),e.height||(e.height="auto"),!e.crossorigin&&e.src&&e.src.includes("ipfs")&&(e.crossorigin="anonymous"),["video",e]},addCommands:function(){var t=this;return{setVideo:function(e){return function(n){return n.commands.insertContent({type:t.name,attrs:e})}},editVideo:function(e,n){return function(r){return r.editor,t.options.onVideoClick&&t.options.onVideoClick(e,n),!0}}}}}),pN=iA.extend({addProseMirrorPlugins:function(){return[new od({key:new ad("customTableCell"),props:{handleDragOver:function(t,e){var n=e.dataTransfer;if(!n)return!1;if(Array.from(n.types).some(function(t){return t.includes("application/x-pm")||t.includes("text/html")})){var r=t.posAtCoords({left:e.clientX,top:e.clientY});if(r)for(var o=t.state.doc.resolve(r.pos),i=o.depth;i>0;i--){var s=o.node(i);if("tableCell"===s.type.name||"tableHeader"===s.type.name){var a,l=null===(a=window.dluxEditor)||void 0===a?void 0:a.dragHandleHoveredNode,c=!1;if(l&&"table"===l.type.name)c=!0;else{var d=t.state.doc.nodeAt(t.state.selection.from);d&&"table"===d.type.name&&(c=!0)}if(c)return e.dataTransfer.dropEffect="none",e.preventDefault(),!0}}}return!1},handleDrop:function(t,e,n,r){var o=t.posAtCoords({left:e.clientX,top:e.clientY});if(!o)return!1;var i=new Set;n&&n.content&&n.content.descendants(function(t){i.add(t.type.name)});var s,a=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return XL(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?XL(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,i=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}(i);try{for(a.s();!(s=a.n()).done;){var l=s.value,c=cN(t.state,o.pos,l);if(c.blocked&&!c.canTransform)return e.preventDefault(),!0}}catch(t){a.e(t)}finally{a.f()}for(var d=t.state.doc.resolve(o.pos),u=!1,h=d.depth;h>0;h--){var p=d.node(h);if("tableCell"===p.type.name||"tableHeader"===p.type.name){u=!0;break}}if(u&&n){var f=!1;if(n.content.forEach(function(t){["heading","codeBlock","blockquote","bulletList","orderedList"].includes(t.type.name)&&(f=!0)}),f){var m=dN(n,t.state.schema);if(r){var g=t.state.selection,y=g.from,b=g.to,v=t.state.tr,w=o.pos;return w>y&&(w-=b-y),v.delete(y,b),v.insert(w,m.content),t.dispatch(v),!0}var k=t.state.tr;return k.replaceRange(o.pos,o.pos,m),t.dispatch(k),!0}}if(r&&n){var S=t.state.selection,x=S.from,C=S.to,_=t.state.tr,E=o.pos;return E>x&&(E-=C-x),_.delete(x,C),_.insert(E,n.content),t.dispatch(_),!0}return!1}}})]}}),fN=uE.extend({name:"customDropcursor",addProseMirrorPlugins:function(){var t,e=null===(t=this.parent)||void 0===t||null===(t=t.call(this))||void 0===t?void 0:t[0];return e?[new od({key:new ad("tableDragControl"),view:function(t){var e=null,n=null,r=function(){n&&(n._observer&&n._observer.disconnect(),n.remove(),n=null)},o=function(n){var r,o;if(null!==(r=(o=n.target).hasAttribute)&&void 0!==r&&r.call(o,"data-drag-handle")){var i,s=null===(i=window.dluxEditor)||void 0===i?void 0:i.dragHandleHoveredNode;if(s)e=s.type.name,console.log(" CustomDropcursor: Dragging node type from hoveredNode:",e);else{var a=t.state,l=a.selection.from,c=a.doc.resolve(l),d=a.doc.nodeAt(l);if("paragraph"===(e=d?d.type.name:c.parent.type.name)||"text"===e)for(var u=c.depth;u>=0;u--){var h=c.node(u);if(h&&["blockquote","table","codeBlock","heading"].includes(h.type.name)){e=h.type.name;break}}console.log(" CustomDropcursor: Dragging node type from fallback:",e)}}},i=function(o){if(e){var i=t.posAtCoords({left:o.clientX,top:o.clientY});if(i){var s=function(t,e,n){if(!n)return!0;var r=cN(t,e,n);if(!r.blocked)return!0;if(r.canTransform)return!0;var o=sN[r.byNode];return o&&o.blocks&&o.blocks.includes(n),!1}(t.state,i.pos,e);s?(n&&r(),t.dom.classList.remove("table-drag-over-cell"),"blockquote"===e&&console.log(" CustomDropcursor: Showing dropcursor for",e,"at position",i.pos)):(n||function(){(n=document.createElement("style")).textContent="\n            .ProseMirror-dropcursor,\n            .prosemirror-dropcursor-block,\n            .prosemirror-dropcursor-inline {\n              display: none !important;\n              visibility: hidden !important;\n              opacity: 0 !important;\n              width: 0 !important;\n              height: 0 !important;\n              background-color: transparent !important;\n            }\n            /* Change cursor to not-allowed when dragging table over cells */\n            .ProseMirror.table-drag-over-cell,\n            .ProseMirror.table-drag-over-cell * {\n              cursor: not-allowed !important;\n            }\n          ",document.head.appendChild(n);var e=new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.forEach(function(t){1===t.nodeType&&t.classList&&(t.classList.contains("ProseMirror-dropcursor")||t.classList.contains("prosemirror-dropcursor-block")||t.classList.contains("prosemirror-dropcursor-inline"))&&(t.style.display="none",t.style.visibility="hidden",t.style.opacity="0")})})});e.observe(t.dom.offsetParent||document.body,{childList:!0,subtree:!0}),n._observer=e}(),t.dom.classList.add("table-drag-over-cell"),console.log(" CustomDropcursor: Hiding dropcursor for",e,"at position",i.pos))}}else n&&(r(),t.dom.classList.remove("table-drag-over-cell"))},s=function(){e&&(e=null,r(),t.dom.classList.remove("table-drag-over-cell"))};return document.addEventListener("dragstart",o,!0),document.addEventListener("dragover",i,!0),document.addEventListener("dragend",s,!0),{destroy:function(){document.removeEventListener("dragstart",o,!0),document.removeEventListener("dragover",i,!0),document.removeEventListener("dragend",s,!0),r()}}}}),e]:(console.warn(" CustomDropcursor: No parent dropcursor plugin found"),[])}}),mN=AS.extend({name:"blockquote",content:"paragraph+",draggable:!0,onCreate:function(){tN||console.log(" CustomBlockquote extension loaded and initialized")},addInputRules:function(){return[jg({find:/^>\s$/,type:this.type,getAttributes:function(){return{}}})]},addProseMirrorPlugins:function(){var t,e=(null===(t=this.parent)||void 0===t?void 0:t.call(this))||[];return[].concat(n(e),[new od({key:new ad("blockquoteDropHandler"),props:{handleDrop:function(t,e,n,r){if(!n)return!1;var o=t.posAtCoords({left:e.clientX,top:e.clientY});if(!o)return!1;for(var i=t.state.doc.resolve(o.pos),s=!1,a=i.depth;a>0;a--)if("blockquote"===i.node(a).type.name){s=!0;break}if(s){var l=function(t){var e;if(null!==(e=t.attrs)&&void 0!==e&&e.textAlign&&"left"!==t.attrs.textAlign)return console.log(" Found textAlign:",t.attrs.textAlign,"on node:",t.type.name),!0;if(["heading","codeBlock","bulletList","orderedList"].includes(t.type.name))return console.log(" Found restricted node type:",t.type.name),!0;if(t.content&&t.content.size>0){var n=!1;return t.content.forEach(function(t){l(t)&&(n=!0)}),n}return!1},c=!1;if(n.content.forEach(function(t){l(t)&&(c=!0)}),console.log(" Drop into blockquote - needs transformation:",c),c){var d=dN(n,t.state.schema,"blockquote"),u=t.state.tr;if(r){var h=t.state.selection.$from,p=t.state.selection.$to;u.delete(h.pos,p.pos)}return u.replaceRange(o.pos,o.pos,d),t.dispatch(u),e.preventDefault(),!0}}return!1}}})])}}),gN=hm.create({name:"blockquoteNestingFilter",addProseMirrorPlugins:function(){return[new od({key:new ad("blockquoteNestingFilter"),filterTransaction:function(t,e){if(!t.docChanged)return!0;var n=!1;return t.steps.forEach(function(e){if("ReplaceStep"===e.constructor.name||"ReplaceAroundStep"===e.constructor.name){var r=e.slice;if(!r||!r.content||0===r.content.size)return;var o=!1;if(r.content.forEach(function(t){t&&t.type&&"blockquote"===t.type.name&&(o=!0)}),!o)return;try{for(var i=t.mapping.map(e.from),s=t.doc.resolve(i),a=s.depth;a>0;a--)if("blockquote"===s.node(a).type.name){n=!0,console.log(" BlockquoteNestingFilter: Blocking transaction that would create nested blockquote");break}}catch(t){console.error("BlockquoteNestingFilter: Error checking position:",t)}}}),!n},appendTransaction:function(t,e,n){var r=t.some(function(t){return t.docChanged});if(!r)return null;var o=null;return n.doc.descendants(function(t,e){"blockquote"===t.type.name&&t.forEach(function(t,r){if("blockquote"===t.type.name){o||(o=n.tr);var i=e+r+1;console.log(" BlockquoteNestingFilter: Found nested blockquote, unwrapping...");var s=i;t.nodeSize,o.replaceRangeWith(s-1,s+t.nodeSize-1,t.content)}})}),o}})]}}),yN=GS.extend({addInputRules:function(){var t;return((null===(t=this.parent)||void 0===t?void 0:t.call(this))||[]).map(function(t){var e=t.handler;return ZL(ZL({},t),{},{handler:function(t){for(var n=t.state.selection.$from,r=n.depth;r>0;r--)if("blockquote"===n.node(r).type.name)return null;return e(t)}})})}}),bN={HocuspocusProvider:Gs,WebrtcProvider:class extends P{constructor(t,e,{signaling:n=["wss://y-webrtc-eu.fly.dev"],password:r=null,awareness:o=new aa(e),maxConns:i=20+H(15*zt()),filterBcConns:s=!0,peerOpts:a={}}={}){super(),this.roomName=t,this.doc=e,this.filterBcConns=s,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=n,this.signalingConns=[],this.maxConns=i,this.peerOpts=a,this.key=r?((t,e)=>{const n=tt(t).buffer,r=tt(e).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(t=>crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))})(r,t):Gt(null),this.room=null,this.key.then(n=>{this.room=((t,e,n,r)=>{if(fa.has(n))throw xt(`A Yjs Doc connected to room "${n}" already exists!`);const o=new xa(t,e,n,r);return fa.set(n,o),o})(e,this,t,n),this.shouldConnect?this.room.connect():this.room.disconnect(),Ea(this)}),this.connect(),this.destroy=this.destroy.bind(this),e.on("destroy",this.destroy)}get connected(){return null!==this.room&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const e=O(pa,t,()=>new _a(t));this.signalingConns.push(e),e.providers.add(this)}),this.room&&(this.room.connect(),Ea(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),0===t.providers.size&&(t.destroy(),pa.delete(t.url))}),this.room&&(this.room.disconnect(),Ea(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),fa.delete(this.roomName)}),super.destroy()}},Y:t,IndexeddbPersistence:class extends ${constructor(t,e){super(),this.doc=e,this.name=t,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=(t=>Jt((e,n)=>{const r=indexedDB.open(t);r.onupgradeneeded=t=>(t=>[["updates",{autoIncrement:!0}],["custom"]].forEach(e=>t.createObjectStore.apply(t,e)))(t.target.result),r.onerror=t=>n(xt(t.target.error)),r.onsuccess=t=>{const n=t.target.result;n.onversionchange=()=>{n.close()},e(n)}}))(t),this.whenSynced=Jt(t=>this.on("synced",()=>t(this))),this._db.then(t=>{this.db=t,Pa(this,t=>Da(t,Mn(e)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(t,e)=>{if(this.db&&e!==this){const[e]=Ma(this.db,[Ia]);Da(e,t),++this._dbsize>=500&&(null!==this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{((t,e=!0)=>{Pa(t).then(n=>{(e||t._dbsize>=500)&&Da(n,Mn(t.doc)).then(()=>{return Oa(n,(e=t._dbref,IDBKeyRange.upperBound(e,!0)));var e}).then(()=>Aa(n).then(e=>{t._dbsize=e}))})})(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},e.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),e.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(t=>{t.close()})}clearData(){return this.destroy().then(()=>{var t;t=this.name,Ta(indexedDB.deleteDatabase(t))})}get(t){return this._db.then(e=>{const[n]=Ma(e,[Na],"readonly");return((t,e)=>Ta(t.get(e)))(n,t)})}set(t,e){return this._db.then(n=>{const[r]=Ma(n,[Na]);return((t,e,n)=>Ta(t.put(e,n)))(r,e,t)})}del(t){return this._db.then(e=>{const[n]=Ma(e,[Na]);return Oa(n,t)})}},createCollaborativeDocument:function(){return new pn},Editor:Ig,Extension:hm,EditorContent:CS,useEditor:(t={})=>{const e=Qb(undefined,!0);return Zv(()=>{e.value=new xS(t)}),nw(()=>{var t,n,r;const o=null==(t=e.value)?void 0:t.options.element,i=null==o?void 0:o.cloneNode(!0);null==(n=null==o?void 0:o.parentNode)||n.replaceChild(i,o),null==(r=e.value)||r.destroy()}),e},VueRenderer:_S,StarterKit:yE,Collaboration:gT,CollaborationCaret:vT,BubbleMenu:HO,FloatingMenu:jO,DragHandle:rD,DragHandleVue:oD,Document:WS,Paragraph:eN,Text:R_,Placeholder:pE,Bold:IS,Italic:rx,Strike:O_,Underline:N_,Code:BS,Heading:yN,ListItem:ML,BulletList:EL,OrderedList:TL,TaskList:AL,TaskItem:OL,CustomBlockquote:mN,HorizontalRule:iN,HardBreak:KS,Link:n_,CustomImage:oN,CodeBlock:VS,CustomDropcursor:fN,CustomHorizontalRule:iN,Gapcursor:hE,CharacterCount:dE,Typography:wT,Mention:AT,Highlight:IL,Subscript:PL,Superscript:$L,TextStyle:HL,TextAlign:nN,Youtube:YL,SpkVideo:hN,DluxVideo:uN,TableKit:GM,CustomTableCell:pN,BlockquoteNestingFilter:gN,BlockquoteAlignmentFilter:rN,Plugin:od,PluginKey:ad,TextSelection:Vc,DecorationSet:Vh,Slice:Ja,renderToMarkdown:function({content:t,extensions:e,options:n}){return function({content:t,extensions:e,options:n}){return function({renderer:t,domOutputSpecToElement:e,mapDefinedTypes:n,content:r,extensions:o,options:i}){const s=wf(o=Tf(o)),{nodeExtensions:a,markExtensions:l}=vf(o);return r instanceof hl||(r=hl.fromJSON(_f(o),r)),t({...i,nodeMapping:{...Object.fromEntries(a.filter(t=>!(t.name in n||(null==i?void 0:i.nodeMapping)&&t.name in i.nodeMapping)).map(t=>function(t,e,n,r){const o={name:e.name,options:e.options,storage:e.storage,parent:e.parent},i=ff(e,"renderHTML",o);return i?[e.name,({node:r,children:o})=>{try{return t(i({node:r,HTMLAttributes:iD(r,n)}))(o)}catch(t){throw new Error(`[tiptap error]: Node ${e.name} cannot be rendered, it's "renderToHTML" method threw an error: ${t.message}`,{cause:t})}}]:(null==r?void 0:r.unhandledNode)?[e.name,r.unhandledNode]:[e.name,()=>{throw new Error(`[tiptap error]: Node ${e.name} cannot be rendered, it is missing a "renderToHTML" method, please implement it or override the corresponding "nodeMapping" method to have a custom rendering`)}]}(e,t,s,i))),...n,...null==i?void 0:i.nodeMapping},markMapping:{...Object.fromEntries(l.filter(t=>!(null==i?void 0:i.markMapping)||!(t.name in i.markMapping)).map(t=>function(t,e,n,r){const o={name:e.name,options:e.options,storage:e.storage,parent:e.parent},i=ff(e,"renderHTML",o);return i?[e.name,({mark:r,children:o})=>{try{return t(i({mark:r,HTMLAttributes:iD(r,n)}))(o)}catch(t){throw new Error(`[tiptap error]: Mark ${e.name} cannot be rendered, it's "renderToHTML" method threw an error: ${t.message}`,{cause:t})}}]:(null==r?void 0:r.unhandledMark)?[e.name,r.unhandledMark]:[e.name,()=>{throw new Error(`Node ${e.name} cannot be rendered, it is missing a "renderToHTML" method`)}]}(e,t,s,i))),...null==i?void 0:i.markMapping}})({content:r})}({renderer:sD,domOutputSpecToElement:cD,mapDefinedTypes:{doc:({children:t})=>lD(t),text:({node:t})=>{var e;return null!=(e=t.text)?e:""}},content:t,extensions:e,options:n})}({content:t,extensions:e,options:{nodeMapping:{bulletList:({children:t})=>`\n${lD(t)}`,orderedList:({children:t})=>`\n${lD(t)}`,listItem({node:t,children:e,parent:n}){if("bulletList"===(null==n?void 0:n.type.name))return`- ${lD(e).trim()}\n`;if("orderedList"===(null==n?void 0:n.type.name)){let r=n.attrs.start||1;return n.forEach((e,n,o)=>{t===e&&(r=o+1)}),`${r}. ${lD(e).trim()}\n`}return lD(e)},paragraph:({children:t})=>`\n${lD(t)}\n`,heading({node:t,children:e}){const n=t.attrs.level;return`${new Array(n).fill("#").join("")} ${e}\n`},codeBlock:({node:t,children:e})=>`\n\`\`\`${t.attrs.language}\n${lD(e)}\n\`\`\`\n`,blockquote:({children:t})=>`\n${lD(t).trim().split("\n").map(t=>`> ${t}`).join("\n")}`,image:({node:t})=>`![${t.attrs.alt}](${t.attrs.src})`,hardBreak:()=>"\n",horizontalRule:()=>"\n---\n",table:({children:t,node:e})=>Array.isArray(t)?`\n${lD(t[0])}| ${new Array(e.childCount-2).fill("---").join(" | ")} |\n${lD(t.slice(1))}\n`:`\n${lD(t)}\n`,tableRow:({children:t})=>Array.isArray(t)?`| ${t.join(" | ")} |\n`:`${lD(t)}\n`,tableHeader:({children:t})=>lD(t).trim(),tableCell:({children:t})=>lD(t).trim(),...null==n?void 0:n.nodeMapping},markMapping:{bold:({children:t})=>`**${lD(t)}**`,italic({children:t,node:e}){let n=!1;return(null==e?void 0:e.marks.some(t=>"bold"===t.type.name))&&(n=!0),n?`*${lD(t)}*`:`_${lD(t)}_`},code:({children:t})=>`\`${lD(t)}\``,strike:({children:t})=>`~~${lD(t)}~~`,underline:({children:t})=>`<u>${lD(t)}</u>`,subscript:({children:t})=>`<sub>${lD(t)}</sub>`,superscript:({children:t})=>`<sup>${lD(t)}</sup>`,link:({node:t,children:e})=>`[${lD(e)}](${t.attrs.href})`,highlight:({children:t})=>`==${lD(t)}==`,...null==n?void 0:n.markMapping},...n}})},renderToHTMLString:function({content:t,extensions:e,options:n}){return function({renderer:t,domOutputSpecToElement:e,mapDefinedTypes:n,content:r,extensions:o,options:i}){const s=wf(o=Tf(o)),{nodeExtensions:a,markExtensions:l}=vf(o);return r instanceof hl||(r=hl.fromJSON(_f(o),r)),t({...i,nodeMapping:{...Object.fromEntries(a.filter(t=>!(t.name in n||(null==i?void 0:i.nodeMapping)&&t.name in i.nodeMapping)).map(t=>function(t,e,n,r){const o={name:e.name,options:e.options,storage:e.storage,parent:e.parent},i=ff(e,"renderHTML",o);return i?[e.name,({node:r,children:o})=>{try{return t(i({node:r,HTMLAttributes:dD(r,n)}))(o)}catch(t){throw new Error(`[tiptap error]: Node ${e.name} cannot be rendered, it's "renderToHTML" method threw an error: ${t.message}`,{cause:t})}}]:(null==r?void 0:r.unhandledNode)?[e.name,r.unhandledNode]:[e.name,()=>{throw new Error(`[tiptap error]: Node ${e.name} cannot be rendered, it is missing a "renderToHTML" method, please implement it or override the corresponding "nodeMapping" method to have a custom rendering`)}]}(e,t,s,i))),...n,...null==i?void 0:i.nodeMapping},markMapping:{...Object.fromEntries(l.filter(t=>!(null==i?void 0:i.markMapping)||!(t.name in i.markMapping)).map(t=>function(t,e,n,r){const o={name:e.name,options:e.options,storage:e.storage,parent:e.parent},i=ff(e,"renderHTML",o);return i?[e.name,({mark:r,children:o})=>{try{return t(i({mark:r,HTMLAttributes:dD(r,n)}))(o)}catch(t){throw new Error(`[tiptap error]: Mark ${e.name} cannot be rendered, it's "renderToHTML" method threw an error: ${t.message}`,{cause:t})}}]:(null==r?void 0:r.unhandledMark)?[e.name,r.unhandledMark]:[e.name,()=>{throw new Error(`Node ${e.name} cannot be rendered, it is missing a "renderToHTML" method`)}]}(e,t,s,i))),...null==i?void 0:i.markMapping}})({content:r})}({renderer:uD,domOutputSpecToElement:fD,mapDefinedTypes:{doc:({children:t})=>pD(t),text:({node:t})=>{var e;return null!=(e=t.text)?e:""}},content:t,extensions:e,options:n})},tippy:uL,suggestion:xT};"undefined"!=typeof window&&(window.TiptapCollaboration=bN,window.HocuspocusProvider=Gs,window.Y=t);const vN=bN})(),i})());